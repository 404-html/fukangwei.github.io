<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="泥腿子出身">
<meta property="og:url" content="http://fukangwei.gitee.io/page/35/index.html">
<meta property="og:site_name" content="泥腿子出身">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="泥腿子出身">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/page/35/">





  <title>泥腿子出身</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泥腿子出身</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/07/C语言应用代码/Quake-III浮点开方函数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/07/C语言应用代码/Quake-III浮点开方函数/" itemprop="url">Quake-III浮点开方函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-07T10:03:49+08:00">
                2019-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>QUAKE</code>的开发商<code>ID SOFTWARE</code>遵守<code>GPL</code>协议，公开了<code>QUAKE-III</code>的源代码，让世人有幸目睹<code>Carmack</code>传奇的<code>3D</code>引擎的源码，名称为<code>quake3-1.32b-source.zip</code>。<br>&emsp;&emsp;我们知道，越底层的函数，调用越频繁。<code>3D</code>引擎归根到底还是数学运算，那么找到最底层的数学运算函数(<code>game/code/q_math.c</code>)，必然是精心编写的。在<code>game/code/q_math.c</code>里发现了这样一段代码，它的作用是将一个数开平方并取倒，经测试这段代码比<code>(float)(1.0 / sqrt(x))</code>快<code>4</code>倍：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">Q_rsqrt</span> <span class="params">( <span class="keyword">float</span> number )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> i;</span><br><span class="line">    <span class="keyword">float</span> x2, y;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">float</span> threehalfs = <span class="number">1.5F</span>;</span><br><span class="line">    x2 = number * <span class="number">0.5F</span>;</span><br><span class="line">    y = number;</span><br><span class="line">    i = * ( <span class="keyword">long</span> * ) &amp;y; <span class="comment">/* evil floating point bit level hacking */</span></span><br><span class="line">    i = <span class="number">0x5f3759df</span> - ( i &gt;&gt; <span class="number">1</span> ); <span class="comment">/* what the fuck? */</span></span><br><span class="line">    y = * ( <span class="keyword">float</span> * ) &amp;i;</span><br><span class="line">    y = y * ( threehalfs - ( x2 * y * y ) ); <span class="comment">/* 1st iteration */</span></span><br><span class="line">    <span class="comment">// y = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Q3_VM</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __linux__</span></span><br><span class="line">    assert ( !isnan ( y ) ); <span class="comment">/* bk010122 - FPE? */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这个简洁的函数最核心的部分就是标注了<code>what the fuck?</code>的一句<code>i = 0x5f3759df - ( i &gt;&gt; 1 );</code>，再加上<code>y = y * ( threehalfs - ( x2 * y * y ) );</code>，两句话就完成了开方运算！而且注意到，核心那句是定点移位运算，速度极快！特别在很多没有乘法指令的<code>RISC</code>结构<code>CPU</code>上，这样做是极其高效的。<br>&emsp;&emsp;算法的原理其实不复杂，就是牛顿迭代法，用$x - \frac{f(x)}{f’(x)}$来不断的逼近$f(x) = a$的根。简单来说比如求平方根：</p>
<p>\begin{equation}<br>f(x) = x^2 = a \\<br>f’(x) = 2x \\<br>\frac{f(x)}{f’(x)} = \frac{x}{2}<br>\end{equation}</p>
<p>把$f(x)$代入$x - \frac{f(x)}{f’(x)}$后有$(x+\frac{a}{x})/2$。现在我们令<code>a</code>为<code>5</code>，选一个猜测值(比如<code>2</code>)，那么可以这么算：<code>5/2 = 2.5；(2.5 + 2)/2 = 2.25；5/2.25 = xxx；(2.25 + xxx)/2 = xxxx</code>。这样反复迭代下去，结果必定收敛于<code>sqrt(5)</code>。但是卡马克(<code>quake3</code>作者)真正厉害的地方是，他选择了一个神秘的常数<code>0x5f3759df</code>来计算那个猜测值。就是加注释的那一行，那一行算出的值非常接近<code>1/sqrt(n)</code>，这样只需要<code>2</code>次牛顿迭代就可以达到所需要的精度。<br>&emsp;&emsp;普渡大学的数学家<code>Chris Lomont</code>采用暴力的方法，找到一个比卡马克数字要好上那么一丁点的数字，这个数字就是<code>0x5f375a86</code>。<code>Lomont</code>为此写下一篇论文<code>Fast Inverse Square Root</code>。论文下载地址为<code>http://www.math.purdue.edu/~clomont/Math/Papers/2003/InvSqrt.pdf</code>和<code>http://www.matrix67.com/data/InvSqrt.pdf</code>。最精简的<code>1/sqrt</code>函数如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">InvSqrt</span> <span class="params">( <span class="keyword">float</span> x )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> xhalf = <span class="number">0.5f</span> * x;</span><br><span class="line">    <span class="keyword">int</span> i = * ( <span class="keyword">int</span> * ) &amp;x; <span class="comment">/* get bits for floating VALUE */</span></span><br><span class="line">    i = <span class="number">0x5f375a86</span> - ( i &gt;&gt; <span class="number">1</span> ); <span class="comment">/* gives initial guess y0 */</span></span><br><span class="line">    x = * ( <span class="keyword">float</span> * ) &amp;i; <span class="comment">/* convert bits BACK to float */</span></span><br><span class="line">    x = x * ( <span class="number">1.5f</span> - xhalf * x * x ); <span class="comment">/* Newton step, repeating increases accuracy */</span></span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/07/C语言应用代码/统计关键字出现次数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/07/C语言应用代码/统计关键字出现次数/" itemprop="url">统计关键字出现次数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-07T09:56:43+08:00">
                2019-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXWORD 100 <span class="comment">/* 关键字最大的个数 */</span></span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span> &#123;</span> <span class="comment">/* 结构体数组，关键字按顺序排列 */</span></span><br><span class="line">    <span class="keyword">char</span> *word;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">&#125; keytab[] = &#123;</span><br><span class="line">    <span class="string">"auto"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"break"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"case"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"char"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"const"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"continue"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"default"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="string">"unsigned"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"void"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"volatile"</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="string">"while"</span>, <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line"><span class="comment">/* 关键字的个数等于数组的长度除以单个元素的长度 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NKEYS (sizeof keytab / sizeof(struct key))</span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getword</span> <span class="params">( <span class="keyword">char</span> *, <span class="keyword">int</span> )</span></span>; <span class="comment">/* 从输入中读取下一个字符或单词 */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binsearch</span> <span class="params">( <span class="keyword">char</span> *, struct key *, <span class="keyword">int</span> )</span></span>; <span class="comment">/* 在tab[0]到tab[n-1]中查找单词 */</span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">char</span> word[MAXWORD];</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">while</span> ( getword ( word, MAXWORD ) != EOF ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="built_in">isalpha</span> ( word[<span class="number">0</span>] ) ) <span class="comment">/* word的第一个单词为字母 */</span></span><br><span class="line">            <span class="keyword">if</span> ( ( n = binsearch ( word, keytab, NKEYS ) ) &gt;= <span class="number">0</span> ) &#123;</span><br><span class="line">                keytab[n].count++; <span class="comment">/* 在结构体中查找成功，关键字计数加1 */</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; NKEYS; n++ ) &#123; <span class="comment">/* 统计结束，打印结果 */</span></span><br><span class="line">        <span class="keyword">if</span> ( keytab[n].count &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">"%4d %s\n"</span>, keytab[n].count, keytab[n].word );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="comment">/* binsearch: find word in tab[0]...tab[n-1] */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binsearch</span> <span class="params">( <span class="keyword">char</span> *word, struct key tab[], <span class="keyword">int</span> n )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cond;</span><br><span class="line">    <span class="keyword">int</span> low, high, mid;</span><br><span class="line">    low = <span class="number">0</span>;</span><br><span class="line">    high = n - <span class="number">1</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">while</span> ( low &lt;= high ) &#123;</span><br><span class="line">        mid = ( low + high ) / <span class="number">2</span>;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> ( ( cond = <span class="built_in">strcmp</span> ( word, tab[mid].word ) ) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">            high = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( cond &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="comment">/* getword从输入中读取下一个单词，单词可以是字母开头的字母和数字串，也可以是一个非空白字符串。</span></span><br><span class="line"><span class="comment">   函数返回值可能是单词的第一个字符、文件结束符EOF或字符本身(如果该字符不是字母字符本身) */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getword</span> <span class="params">( <span class="keyword">char</span> *word, <span class="keyword">int</span> lim )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c, getch ( <span class="keyword">void</span> );</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ungetch</span> <span class="params">( <span class="keyword">int</span> )</span></span>;</span><br><span class="line">    <span class="keyword">char</span> *w = word;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">while</span> ( <span class="built_in">isspace</span> ( c = getch() ) ) <span class="comment">/* c跳过空白符 */</span></span><br><span class="line">        ;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( c != EOF ) &#123;</span><br><span class="line">        *w++ = c;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">isalpha</span> ( c ) ) &#123; <span class="comment">/* c不是字母 */</span></span><br><span class="line">        *w = <span class="string">'\0'</span>;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( ; --lim &gt; <span class="number">0</span>; w++ ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">isalnum</span> ( *w = getch() ) ) &#123; <span class="comment">/* 输入不是字母或数字时，该单词结束 */</span></span><br><span class="line">            ungetch ( *w );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    *w = <span class="string">'\0'</span>; <span class="comment">/* 字符串结束符“\0” */</span></span><br><span class="line">    <span class="keyword">return</span> word[<span class="number">0</span>]; <span class="comment">/* 返回值是单词的第一个字符 */</span></span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 100</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">char</span> buf[BUFSIZE];</span><br><span class="line"><span class="keyword">int</span> bufp = <span class="number">0</span>;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getch</span> <span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ( bufp &gt; <span class="number">0</span> ) ? buf[--bufp] : getchar();</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetch</span> <span class="params">( <span class="keyword">int</span> c )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( bufp &gt;= BUFSIZE ) &#123;</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"ungetch: too many characters\n"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        buf[bufp++] = c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./main &lt; main.c</span><br><span class="line">   1 auto</span><br><span class="line">   2 <span class="built_in">break</span></span><br><span class="line">   1 <span class="keyword">case</span></span><br><span class="line">   9 char</span><br><span class="line">   1 const</span><br><span class="line">   1 <span class="built_in">continue</span></span><br><span class="line">   1 default</span><br><span class="line">   1 unsigned</span><br><span class="line">   6 void</span><br><span class="line">   1 volatile</span><br><span class="line">   4 <span class="keyword">while</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/07/C语言应用代码/绘制三角函数曲线/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/07/C语言应用代码/绘制三角函数曲线/" itemprop="url">绘制三角函数曲线</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-07T09:45:03+08:00">
                2019-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="cos曲线"><a href="#cos曲线" class="headerlink" title="cos曲线"></a>cos曲线</h3><p>&emsp;&emsp;在屏幕上用<code>*</code>显示<code>0°</code>至<code>360°</code>的<code>cos</code>曲线：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">double</span> y;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( y = <span class="number">1</span>; y &gt;= <span class="number">-1</span>; y = y - <span class="number">0.1</span> ) &#123;</span><br><span class="line">        x = <span class="built_in">acos</span> ( y ) * <span class="number">10</span>;</span><br><span class="line">        m = <span class="number">62</span> - x;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; x; i++ ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"*"</span> );</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( i = x; i &lt; m; i++ ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"*\n"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sin曲线"><a href="#sin曲线" class="headerlink" title="sin曲线"></a>sin曲线</h3><p>&emsp;&emsp;在屏幕上用<code>*</code>显示<code>0°</code>至<code>360°</code>的<code>sin</code>曲线：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">double</span> y;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( y = <span class="number">1</span>; y &gt;= <span class="number">0.1</span>; y = y - <span class="number">0.1</span> ) &#123;</span><br><span class="line">        x = <span class="built_in">asin</span> ( y ) * <span class="number">10</span>;</span><br><span class="line">        m = <span class="number">31</span> - x;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; x; i++ ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"*"</span> );</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( ; i &lt; m; i++ ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"*\n"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"*"</span> );</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">31</span>; i++ ) &#123;</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"*"</span> );</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">31</span>; i &lt; <span class="number">62</span>; i++ ) &#123;</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"*\n"</span> );</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( y = <span class="number">-0.1</span>; y &gt;= <span class="number">-1</span>; y = y - <span class="number">0.1</span> ) &#123;</span><br><span class="line">        x = - <span class="built_in">asin</span> ( y ) * <span class="number">10</span>;</span><br><span class="line">        m = <span class="number">31</span> - x;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; x + <span class="number">32</span>; i++ ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"*"</span> );</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( i = x; i &lt; m; i++ ) &#123;</span><br><span class="line">            <span class="built_in">printf</span> ( <span class="string">" "</span> );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">printf</span> ( <span class="string">"*\n"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/Qt语法详解/Qt之QFontDialog/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/Qt语法详解/Qt之QFontDialog/" itemprop="url">Qt之QFontDialog</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T20:55:52+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>QFontDialog</code>类提供了可以选择字体的对话框窗口部件，继承了<code>QDialog</code>，其头文件为<code>qfontdialog.h</code>。静态公有成员如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QFont <span class="title">getFont</span> <span class="params">( <span class="keyword">bool</span> *ok, <span class="keyword">const</span> QFont &amp;initial, QWidget *parent = <span class="number">0</span>, <span class="keyword">const</span> <span class="keyword">char</span> *name = <span class="number">0</span> )</span></span>;</span><br><span class="line"><span class="function">QFont <span class="title">getFont</span> <span class="params">( <span class="keyword">bool</span> *ok, QWidget *parent = <span class="number">0</span>, <span class="keyword">const</span> <span class="keyword">char</span> *name = <span class="number">0</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<p>实例如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> ok;</span><br><span class="line">QFont font = QFontDialog::getFont ( &amp;ok, QFont ( <span class="string">"Helvetica [Cronyx]"</span>, <span class="number">10</span> ), <span class="keyword">this</span> );</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> ( ok ) &#123;</span><br><span class="line">    <span class="comment">/* font被设置为用户选择的字体 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* 用户取消这个对话框，font被设置为初始值，在这里就是“Helvetica [Cronyx], 10” */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对话框也可以被用来直接设置窗口部件的字体：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myWidget.setFont ( QFontDialog::getFont ( <span class="number">0</span>, myWidget.font() ) );</span><br></pre></td></tr></table></figure>
<p>如果用户点击<code>OK</code>，它们选择的字体将被<code>myWidget</code>使用，并且如果点击<code>Cancel</code>，最初的字体被使用。</p>
<p><img src="/2019/02/06/Qt语法详解/Qt之QFontDialog/1.png" height="196" width="513"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QFont QFontDialog::getFont (</span><br><span class="line">    <span class="keyword">bool</span> *ok, <span class="keyword">const</span> QFont &amp;initial,</span><br><span class="line">    QWidget *parent = <span class="number">0</span>, <span class="keyword">const</span> <span class="keyword">char</span> *name = <span class="number">0</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>该函数执行一个模式字体对话框并且返回一个字体。如果用户点击<code>OK</code>，被选择的字体将被返回，并且如果点击<code>Cancel</code>，<code>initial</code>字体被返回。对话框的父对象为<code>parent</code>、名称为<code>name</code>。<code>initial</code>是初始选择的字体。如果<code>ok</code>参数为非零，则用户点击<code>OK</code>，<code>*ok</code>被设置为真，并且如果用户点击<code>Cancel</code>，就被设置为假。这个静态函数没有完整的<code>QFontDialog</code>对象灵活，但是更容易使用。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> ok;</span><br><span class="line">QFont font = QFontDialog::getFont ( &amp;ok, <span class="keyword">this</span> );</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> ( ok ) &#123;</span><br><span class="line">    <span class="comment">/* font被设置为用户选择的字体 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* 用户取消这个对话框，font被设置为默认应用程序字体，QApplication::font */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/单片机/STM32之RTC/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/单片机/STM32之RTC/" itemprop="url">STM32之RTC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T20:29:56+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;先熟悉一下几个知识点：</p>
<ul>
<li><code>STM32</code>的实时时钟<code>RTC</code>是一个独立的定时器。</li>
<li><code>RTC</code>模块和其时钟配置系统(<code>RCC_BDCR</code>寄存器)是在后备区域。当系统复位或断电的时候，后备区域依然自动计时。我们可以在后备区域放一些关键的数据。</li>
<li><code>RTC</code>的部分区域可由<code>VCC</code>来供电，也可以由备用电源来供电。</li>
</ul>
<p>&emsp;&emsp;<code>RTC</code>时钟框图可以分为完全独立的两个部分：第一个是<code>APB1</code>接口部分，用来<code>RTC</code>相关的寄存器；第二个是<code>RTC</code>核心。对于第一部分，这里涉及到寄存器<code>RTC_CRL</code>中的<code>RSF</code>位，这位是寄存器的同步标志。对于第二部分，这里分为两个模块：一是<code>RTC</code>预分频器模块；二是一个<code>32</code>位的可编程计数器。</p>
<p><img src="/2019/02/06/单片机/STM32之RTC/1.png" height="300" width="365"></p>
<p>&emsp;&emsp;下面开始分析第二部分，先给大家介绍下后备区域的几个特别重要的寄存器：</p>
<ul>
<li><code>RTC_DIV</code>：<code>RTC</code>预分频器余数寄存器。这个寄存器的作用是来获得比秒钟更加准确的时钟(例如<code>0.1s</code>、<code>0.01s</code>)，该寄存器是自减的，用来保存还需要多少个时钟周期获得一个秒信号。这里加上一个公式<code>fTR_CLK = fRTCCLK/(PRL[19:0] + 1)</code>。<code>RTC_DIV</code>寄存器的值是由<code>RTC_PRL</code>(<code>RTC</code>预分频器装载寄存器)提供的，而<code>RTC_DIV</code>寄存器的时钟频率是由<code>RTCCLK</code>提供的。比如我们把<code>RTC_PRL</code>值设为<code>32767</code>，则<code>RTC_DIV</code>寄存器的值也为<code>32767</code>，它和<code>RTCCLK</code>的时钟频率是一样的。<code>RTCCLK</code>的时钟周期是<code>1/32768</code>(<code>s</code>)，也就是每一个<code>RTCCLK</code>的时钟周期，<code>RTC_DIV</code>自减<code>1</code>，直至到<code>1s</code>钟后，被硬件重新装载，也就是<code>1s</code>钟减<code>32768</code>次。那它到底是怎么提供<code>0.1s</code>，甚至是<code>0.01s</code>的呢？举个例子就明白了。比如我想要得到<code>1.12</code>秒的这个时间，就要求<code>RTC_DIV</code>自减<code>0.12 / (1 / 32768)</code>次。</li>
<li><code>RTC_PRL</code>：<code>RTC</code>预分频装载寄存器。这个寄存器有两个作用：一是提供给<code>RTC_DIV</code>的重新装载值，二是设置时钟分频系数。对于设置时钟分频系数，比如我们使用<code>32.768KHz</code>的晶振作为时钟输入，那么我们配置这个寄存器值为<code>32767</code>，就可以得到<code>1s</code>钟的计数频率(<code>32768 / (32767 + 1)</code>，单位是<code>Hz</code>)。</li>
<li><code>RTC_CNT</code>：它是<code>RTC</code>计数器寄存器。这个寄存器较简单，用来记录秒钟值。如果之前对<code>RTC_CR</code>的相关中断允许位配置的话，<code>RTC_CNT</code>寄存器可以产生一个溢出中断。</li>
<li><code>RTC_ALR</code>：它是<code>RTC</code>闹钟寄存器，用来标记闹钟产生时间。如果<code>RTC_CNT</code>的值和<code>RTC_ALR</code>的值相等，并使能中断的话(在<code>RTC_CR</code>中配置)，会产生一个闹钟中断。</li>
</ul>
<p>&emsp;&emsp;给大家理一遍思路：首先外部加进来一个时钟信号<code>RTCCLK</code>(<code>32.768K</code>)，然后设置<code>RTC_PRL</code>的分频系数为<code>32767</code>，得到一个秒时钟信号<code>TR_CLK</code>(<code>1Hz</code>)。当<code>TR_CLK</code>每过一个时钟周期，产生一个<code>RTC_Second</code>(秒钟中断)，同时<code>RTC_CNT</code>计数器(记录秒值)加<code>1</code>。如果要求更精准的时间，还可以在<code>RTC_CR</code>寄存器的<code>RSF</code>位被置为<code>1</code>时去读<code>RTC_DIV</code>的值。<br>&emsp;&emsp;如果想显示时间，就要先设置一个基础时间，然后让系统在基础时间上进行自加。<br>&emsp;&emsp;第一步：设置一个基础时间。在对时钟进行配置时(在初始化函数<code>RTC_Init</code>中配置)，里面有个<code>RTC_Set</code>函数，此函数会对你设置的年月日时分秒进行计算，算出从<code>1970</code>年到你设置那个时刻总共是多少秒，然后把算出来的这个秒值赋给<code>RTC_CNT</code>计数器作为初值。<br>&emsp;&emsp;第二步：系统自己更新时间(自加)。在更新函数<code>RTC_Get</code>中，首先会读取<code>RTC_CNT</code>计数器中的值，然后经过一番计算，计算出年月日时分秒和星期，分别赋值给那些时间的结构体变量。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/Linux系统编程/exit和_exit的区别/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/Linux系统编程/exit和_exit的区别/" itemprop="url">exit和_exit的区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T19:51:39+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;在<code>Linux</code>的标准库中，有一套称作高级<code>I/O</code>的函数，例如<code>printf</code>、<code>fopen</code>、<code>fread</code>、<code>fwrite</code>，也被称作<code>缓冲I/O</code>。其特征是对应每一个打开的文件，在内存中都有一片缓冲区，每次读文件会多读若干条记录，这样下次读文件时就可以直接从内存的缓存中取出；每次写文件时也仅仅是写入到内存的缓冲区，等待满足一定的条件(达到一定的数量或者遇到特定字符，例如换行和文件结束符<code>EOF</code>)，再将缓冲区的内容一次性的写入文件，这样就大大增加了文件读写的速度，但也为我们编程带来了一点点麻烦。如果有些数据，我们认为已经写入了文件，实际上因为没有满足特定的条件，它们还只是保存在缓冲区内，这时用<code>_exit</code>函数直接将程序关闭，缓冲区中的数据就会丢失；反之，如果想保证数据的完整性，就一定要使用<code>exit</code>函数。<br>&emsp;&emsp;<code>exit</code>函数与<code>_exit</code>函数最大的区别就在于：<code>exit</code>函数在调用<code>exit</code>系统调用之前要检查文件的打开情况，把文件缓冲区中的内容写回文件，就是图中的<code>清理I/O缓冲</code>一项。<br>&emsp;&emsp;<code>exit</code>函数定义在<code>stdlib.h</code>中，而<code>_exit</code>定义在<code>unistd.h</code>中。<code>exit</code>和<code>_exit</code>都用于正常终止一个函数，但<code>_exit</code>直接是一个<code>sys_exit</code>系统调用，而<code>exit</code>则通常是普通函数库中的一个函数。它会先执行一些清除操作，例如调用执行各终止处理函数、关闭所有标准<code>IO</code>等，然后调用<code>sys_exit</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">/* 程序1 */</span></span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"this is a test function!\n"</span> )</span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"test exit"</span> );</span><br><span class="line">    <span class="built_in">exit</span> ( <span class="number">0</span> );</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">/* 程序2 */</span></span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"this is a test function!\n"</span> )</span><br><span class="line">    <span class="built_in">printf</span> ( <span class="string">"test exit"</span> );</span><br><span class="line">    _exit ( <span class="number">0</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序<code>1</code>输出两句话，而程序<code>2</code>只输出一句话。其原因就是程序<code>2</code>的<code>printf ( &quot;test exit&quot; );</code>没有加上特殊的字符，这时的文件是存放在缓冲区的。输出函数要写入数据到缓冲区，首先进行系统调用，然后系统会打开显示设备的缓冲区。<code>exit</code>的作用就是结束并清理，先检查缓冲区，把没有写入的数据写入到文件；而<code>_exit</code>是立刻关闭文件，文件缓冲区的内容也就消失了，这时就不可能输出到显示设备了。</p>
<p><img src="/2019/02/06/Linux系统编程/exit和_exit的区别/1.png" height="264" width="224"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/深度学习/占位符和feed_dict/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/深度学习/占位符和feed_dict/" itemprop="url">占位符和feed_dict</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T19:43:34+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;虽然<code>TensorFlow</code>可以创建各种形式的常量和变量，但同样还支持占位符。占位符并没有初始值，它只会分配必要的内存。在会话中，占位符可以使用<code>feed_dict</code>馈送数据。<br>&emsp;&emsp;<code>feed_dict</code>是一个字典，在字典中需要给出每一个用到的占位符的取值。在训练神经网络时，需要每次提供一个批量的训练样本，如果每次迭代选取的数据要通过常量表示，那么<code>TensorFlow</code>的计算图会非常大，因为每增加一个常量，<code>TensorFlow</code>都会在计算图中增加一个结点。所以拥有几百万次迭代的神经网络会拥有极其庞大的计算图，而占位符却可以解决这一问题，它只会拥有占位符这一个结点。<br>&emsp;&emsp;下面一段代码分别展示了使用常量和占位符进行计算：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">​</span><br><span class="line">w1 = tf.Variable(tf.random_normal([<span class="number">1</span>, <span class="number">2</span>], stddev=<span class="number">1</span>, seed=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 因为需要重复输入x，而每建一个x就会生成一个结点，计算图的效率会很低，所以使用占位符</span></span><br><span class="line">x = tf.placeholder(tf.float32, shape=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">x1 = tf.constant([[<span class="number">0.7</span>, <span class="number">0.9</span>]])</span><br><span class="line">​</span><br><span class="line">a = x + w1</span><br><span class="line">b = x1 + w1</span><br><span class="line">​</span><br><span class="line">sess = tf.Session()</span><br><span class="line">sess.run(tf.global_variables_initializer())</span><br><span class="line"><span class="comment"># 运行y时将占位符填上，feed_dict为字典，变量名不可变</span></span><br><span class="line">y_1 = sess.run(a, feed_dict=&#123;x: [[<span class="number">0.7</span>, <span class="number">0.9</span>]]&#125;)</span><br><span class="line">y_2 = sess.run(b)</span><br><span class="line">print(y_1)</span><br><span class="line">print(y_2)</span><br><span class="line">sess.close()</span><br></pre></td></tr></table></figure>
<p>其中<code>y_1</code>的计算过程使用占位符，而<code>y_2</code>的计算过程使用常量。下面是使用占位符的案例(计算两点之间的距离)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_eucledian_distance</span><span class="params">(point1, point2)</span>:</span></span><br><span class="line">    difference = tf.subtract(point1, point2)</span><br><span class="line">    power2 = tf.pow(difference, tf.constant(<span class="number">2.0</span>, shape=(<span class="number">1</span>, <span class="number">2</span>)))</span><br><span class="line">    add = tf.reduce_sum(power2)</span><br><span class="line">    eucledian_distance = tf.sqrt(add)</span><br><span class="line">    <span class="keyword">return</span> eucledian_distance</span><br><span class="line">​</span><br><span class="line">list_of_points1_ = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>]]</span><br><span class="line">list_of_points2_ = [[<span class="number">15</span>, <span class="number">16</span>], [<span class="number">13</span>, <span class="number">14</span>], [<span class="number">11</span>, <span class="number">12</span>], [<span class="number">9</span>, <span class="number">10</span>]]</span><br><span class="line">​</span><br><span class="line">list_of_points1 = np.array([np.array(elem).reshape(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">for</span> elem <span class="keyword">in</span> list_of_points1_])</span><br><span class="line">list_of_points2 = np.array([np.array(elem).reshape(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">for</span> elem <span class="keyword">in</span> list_of_points2_])</span><br><span class="line">​</span><br><span class="line">graph = tf.Graph()</span><br><span class="line">​</span><br><span class="line"><span class="keyword">with</span> graph.as_default():</span><br><span class="line">    <span class="comment"># 使用tf.placeholder创建占位符 ，在session.run过程中再投递数据</span></span><br><span class="line">    point1 = tf.placeholder(tf.float32, shape=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    point2 = tf.placeholder(tf.float32, shape=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    dist = calculate_eucledian_distance(point1, point2)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">with</span> tf.Session(graph=graph) <span class="keyword">as</span> session:</span><br><span class="line">    tf.global_variables_initializer().run()</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> range(len(list_of_points1)):</span><br><span class="line">        point1_ = list_of_points1[ii]</span><br><span class="line">        point2_ = list_of_points2[ii]</span><br><span class="line">        <span class="comment"># 使用feed_dict将数据投入到[dist]中</span></span><br><span class="line">        feed_dict = &#123;point1: point1_, point2: point2_&#125;</span><br><span class="line">        distance = session.run([dist], feed_dict=feed_dict)</span><br><span class="line">        print(<span class="string">"the distance between &#123;&#125; and &#123;&#125; -&gt; &#123;&#125;"</span>.format(point1_, point2_, distance))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">the distance between [[1 2]] and [[15 16]] -&gt; [19.79899]</span><br><span class="line">the distance between [[3 4]] and [[13 14]] -&gt; [14.142136]</span><br><span class="line">the distance between [[5 6]] and [[11 12]] -&gt; [8.485281]</span><br><span class="line">the distance between [[7 8]] and [[ 9 10]] -&gt; [2.828427]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>补充说明</strong>：也可以这样理解：<code>feed_dict</code>是为<code>placeholder</code>准备数据的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/CC2530和zigbee笔记/zigbee的概念/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/CC2530和zigbee笔记/zigbee的概念/" itemprop="url">zigbee的概念</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T19:07:06+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>ZigBee</code>是基于<code>IEEE 802.15.4</code>标准的低功耗局域网协议。根据国际标准规定，<code>ZigBee</code>技术是一种短距离、低功耗的无线通信技术。这一名称(又称<code>紫蜂协议</code>)来源于蜜蜂的八字舞，由于蜜蜂(<code>bee</code>)是靠飞翔和<code>嗡嗡</code>(<code>zig</code>)地抖动翅膀的<code>舞蹈</code>来与同伴传递花粉所在方位信息，也就是说蜜蜂依靠这样的方式构成了群体中的通信网络。其特点是近距离、低复杂度、自组织、低功耗、低数据速率。主要适合用于自动控制和远程控制领域，可以嵌入各种设备。简而言之，<code>ZigBee</code>就是一种便宜的、低功耗的近距离无线组网通讯技术，是一种低速短距离传输的无线网络协议。<code>ZigBee</code>协议从下到上分别为物理层<code>PHY</code>、媒体访问控制层<code>MAC</code>、传输层<code>TL</code>、网络层<code>NWK</code>、应用层<code>APL</code>等。其中物理层和媒体访问控制层遵循<code>IEEE 802.15.4</code>标准的规定。</p>
<h3 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h3><p>&emsp;&emsp;<code>ZigBee</code>的底层技术基于<code>IEEE 802.15.4</code>，即其物理层和媒体访问控制层直接使用了<code>IEEE 802.15.4</code>的定义。<br>&emsp;&emsp;在蓝牙技术的使用过程中，人们发现蓝牙技术尽管有许多优点，但仍存在许多缺陷。对于工业、家庭自动化控制和工业遥测遥控领域而言，蓝牙技术太复杂、功耗大、距离近、组网规模太小等。而工业自动化对无线数据通信的需求越来越强烈，而且对于工业现场，这种无线传输必须是高可靠的，并能抵抗工业现场的各种电磁干扰。因此，经过人们长期努力，<code>ZigBee</code>协议在<code>2003</code>年正式问世。另外，<code>Zigbee</code>使用了在它之前所研究过的面向家庭网络的通信协议<code>Home RF Lite</code>。<br>&emsp;&emsp;长期以来，低价位、低速率、短距离、低功率的无线通讯市场一直存在着。蓝牙的出现曾让工业控制、家用自动控制、玩具制造商等业者雀跃不已，但是蓝牙的售价一直居高不下，严重影响了这些厂商的使用意愿。如今，这些业者都参加了<code>IEEE 802.15.4</code>小组，负责制定<code>ZigBee</code>的物理层和媒体介质访问层。<code>IEEE 802.15.4</code>规范是一种经济、高效、低数据速率(小于<code>250kbps</code>)、工作在<code>2.4GHz</code>和<code>868/915MHz</code>的无线技术，用于个人区域网和对等网络，它是<code>ZigBee</code>应用层和网络层协议的基础。<code>ZigBee</code>是一种新兴的近距离、低复杂度、低功耗、低数据速率、低成本的无线网络技术，它是一种介于无线标记技术和蓝牙之间的技术提案，主要用于近距离无线连接。它依据<code>802.15.4</code>标准，在数千个微小的传感器之间相互协调实现通信。这些传感器只需要很少的能量，以接力的方式通过无线电波将数据从一个网络节点传到另一个节点，所以它们的通信效率非常高。</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>低功耗。在低耗电待机模式下，<code>2</code>节<code>5</code>号干电池可支持<code>1</code>个节点工作<code>6</code>至<code>24</code>个月，甚至更长，这是<code>ZigBee</code>的突出优势。相比较而言，蓝牙只能工作数周，<code>WiFi</code>只可工作数小时。</li>
<li>低成本。通过大幅简化协议(不到蓝牙的<code>1/10</code>)，降低了对通信控制器的要求。而且<code>ZigBee</code>免协议专利费，其支持芯片的价格大约为<code>2</code>美元。</li>
<li>低速率。<code>ZigBee</code>工作在<code>20</code>至<code>250kbps</code>的速率，分别提供<code>250kbps</code>(<code>2.4GHz</code>)、<code>40kbps</code>(<code>915MHz</code>)和<code>20kbps</code>(<code>868MHz</code>)的原始数据吞吐率，满足低速率传输数据的应用需求。</li>
<li>近距离。传输范围一般介于<code>10</code>至<code>100m</code>之间，在增加发射功率后，亦可增加到<code>1</code>至<code>3km</code>，这指的是相邻节点间的距离。如果通过路由和节点间通信的接力，传输距离将可以更远。</li>
<li>短时延。<code>ZigBee</code>的响应速度较快，一般从睡眠转入工作状态只需<code>15ms</code>，节点连接进入网络只需<code>30ms</code>，进一步节省了电能。相比较而言，蓝牙需要<code>3</code>至<code>10s</code>、<code>WiFi</code>需要<code>3s</code>。</li>
<li>高容量。<code>ZigBee</code>可采用星状、片状和网状网络结构，由一个主节点管理若干子节点，最多一个主节点可管理<code>254</code>个子节点；同时主节点还可由上一层网络节点管理，最多可组成<code>65000</code>个节点的大网。</li>
<li>高安全。<code>ZigBee</code>提供了三级安全模式，包括无安全设定、使用访问控制清单(<code>Access Control List</code>，<code>ACL</code>)防止非法获取数据以及采用高级加密标准(<code>AES128</code>)的对称密码，以灵活确定其安全属性。</li>
<li>免执照频段。使用工业科学医疗(<code>ISM</code>)频段，即<code>915MHz</code>(美国)、<code>868MHz</code>(欧洲)、<code>2.4GHz</code>(全球)。由于此三个频带物理层并不相同，其各自信道带宽也不同，分别为<code>0.6MHz</code>、<code>2MHz</code>和<code>5MHz</code>，分别有<code>1</code>个、<code>10</code>个和<code>16</code>个信道。这三个频带的扩频和调制方式亦有区别。扩频都使用直接序列扩频(<code>DSSS</code>)，但从比特到码片的变换差别较大。调制方式都用了调相技术，但<code>868MHz</code>和<code>915MHz</code>频段采用的是<code>BPSK</code>，而<code>2.4GHz</code>频段采用的是<code>OQPSK</code>。</li>
</ul>
<h3 id="组网通信方式"><a href="#组网通信方式" class="headerlink" title="组网通信方式"></a>组网通信方式</h3><p>&emsp;&emsp;<code>ZigBee</code>技术所采用的自组织网是怎么回事？举一个简单的例子，当一队伞兵空降后，每人持有一个<code>ZigBee</code>网络模块终端，降落到地面后，只要他们彼此间在网络模块的通信范围内，通过彼此自动寻找，很快就可以形成一个互联互通的<code>ZigBee</code>网络。而且由于人员的移动，彼此间的联络还会发生变化。因而，模块还可以通过重新寻找通信对象，确定彼此间的联络，对原有网络进行刷新，这就是自组织网。<br>&emsp;&emsp;<code>ZigBee</code>技术为什么要使用自组织网来通信？网状网通信实际上就是多通道通信，在实际工业现场，由于各种原因，往往并不能保证每一个无线通道都能够始终畅通，就像城市的街道一样，可能因为车祸、道路维修等，使得某条道路的交通出现暂时中断。此时由于有多个通道，车辆(相当于我们的控制数据)仍然可以通过其他道路到达目的地，而这一点对工业现场控制而言则非常重要。<br>&emsp;&emsp;为什么自组织网要采用动态路由的方式？所谓动态路由是指网络中数据传输的路径并不是预先设定的，而是传输数据前，通过对网络当时可利用的所有路径进行搜索，分析它们的位置关系以及远近，然后选择其中的一条路径进行数据传输。在我们的网络管理软件中，路径的选择使用的是<code>梯度法</code>，即先选择路径最近的一条通道进行传输，如果传不通，再使用另外一条稍远一点的通路进行传输，以此类推，直到数据送达目的地为止。在实际工业现场，预先确定的传输路径随时都可能发生变化，或者因各种原因路径被中断了，或者过于繁忙不能进行及时传送。动态路由结合网状拓扑结构，就可以很好解决这个问题，从而保证数据的可靠传输。<br>&emsp;&emsp;<code>ZigBee</code>网络中的设备可分为协调器(<code>Coordinator</code>)、汇聚节点(<code>Router</code>)、传感器节点(<code>EndDevice</code>)等三种角色：</p>
<p><img src="/2019/02/06/CC2530和zigbee笔记/zigbee的概念/1.png" height="337" width="517"></p>
<ul>
<li>协调器(<code>coordinator</code>)：每个<code>zigbee</code>网络只允许有一个<code>zigbee</code>的协调器，协调器首先选择一个信道和网络标识(<code>PAN ID</code>)，然后开始这个网络。因为协调器是整个网络的开始，它具有网络的最高权限，是整个网络的维护者，还可以保持间接寻址用的表格绑定，同时还可以设计安全中心和执行其他动作，保持网络其他设备的通信。</li>
<li>路由器(<code>router</code>)：路由器是一种支持关联的设备，能够实现其他节点的消息转发功能。Zigbee的树形网络可以有多个<code>zigbee</code>路由器设备，<code>zigbee</code>的星型网络不支持<code>zigbee</code>的路由器设备。</li>
<li>终端(<code>end</code>)：<code>zigbee</code>终端节点是具体执行的数据采集传输的设备，它不能转发其他节点的消息。</li>
</ul>
<h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><p>&emsp;&emsp;数据速率比较低，在<code>2.4GHz</code>的频段只有<code>250Kb/s</code>，而且这只是链路上的速率，除了信道竞争应答和重传等消耗，真正能被应用所利用的速率可能不足<code>100Kb/s</code>，并且余下的速率可能要被邻近多个节点和同一个节点的多个应用瓜分，因此不适合做传输视频之类的事情。适合的应用领域是传感和控制。<br>&emsp;&emsp;在可靠性方面，<code>ZigBee</code>有很多方面进行保证。物理层采用了扩频技术，能够在一定程度上抵抗干扰，<code>MAC</code>应用层(<code>APS</code>部分)有应答重传功能。<code>MAC</code>层的<code>CSMA</code>机制使节点发送前先监听信道，可以起到避开干扰的作用。当<code>ZigBee</code>网络受到外界干扰，无法正常工作时，整个网络可以动态地切换到另一个工作信道上。<br>&emsp;&emsp;在时延方面，由于<code>ZigBee</code>采用随机接入<code>MAC</code>层，且不支持时分复用的信道接入方式，因此不能很好地支持一些实时的业务。<br>&emsp;&emsp;对于能耗特性，能耗特性是<code>ZigBee</code>的一个技术优势。通常<code>ZigBee</code>节点所承载的应用数据速率都比较低。在不需要通信时，节点可以进入很低功耗的休眠状态，此时能耗可能只有正常工作状态下的千分之一。由于一般情况下，休眠时间占总运行时间的大部分，有时正常工作的时间还不到百分之一，因此达到很高的节能效果。<br>&emsp;&emsp;对于组网和路由性，<code>ZigBee</code>具有大规模的组网能力，每个网络<code>65000</code>个节点，而每个蓝牙网络只有<code>8</code>个节点。在路由方面，<code>ZigBee</code>支持可靠性很高的网状网的路由，所以可以布置范围很广的网络，并支持多播和广播特性，能够给丰富的应用带来有力的支持。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/CC2530和zigbee笔记/以太网网关的设计/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/CC2530和zigbee笔记/以太网网关的设计/" itemprop="url">以太网网关的设计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T18:42:22+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;实验要实现的功能是要<code>ZigBee</code>与<code>ENC28J60</code>模块通信，然后实现<code>CC2530</code>串口与服务器透传，整个实验只需要用到一个<code>ZigBee</code>节点。<br>&emsp;&emsp;1. 打开例程<code>SampleApp.eww</code>工程，添加<code>ENC28J60</code>模块的驱动：</p>
<p><img src="/2019/02/06/CC2530和zigbee笔记/以太网网关的设计/1.png" height="360" width="235"></p>
<p>&emsp;&emsp;2. 在<code>SampleApp.c</code>文件中添加如下内容：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tapdev.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"uip_arp.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"uip.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"app.h"</span></span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETHBUF ((struct uip_eth_hdr *)&amp;uip_buf[0])</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;3. 在<code>SampleApp_Init</code>函数中初始化网络模块和<code>PC</code>端的<code>IP</code>地址：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">tapdev_init();</span><br><span class="line">uip_arp_init();</span><br><span class="line">uip_init();</span><br><span class="line">&#123;</span><br><span class="line">    uint16 ipaddr[<span class="number">2</span>];</span><br><span class="line">    uip_ipaddr ( ipaddr, <span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">200</span> ); <span class="comment">/* 设置本地IP */</span></span><br><span class="line">    uip_sethostaddr ( ipaddr );</span><br><span class="line">    uip_ipaddr ( ipaddr, <span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span> ); <span class="comment">/* 设置路由器IP */</span></span><br><span class="line">    uip_setdraddr ( ipaddr );</span><br><span class="line">    uip_ipaddr ( ipaddr, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span> ); <span class="comment">/* 设置网络掩码 */</span></span><br><span class="line">    uip_setnetmask ( ipaddr );</span><br><span class="line">    <span class="comment">/* 启动UDP */</span></span><br><span class="line">    uip_ipaddr ( ipaddr, <span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">239</span> ); <span class="comment">/* 设置PC端IP */</span></span><br><span class="line">    uip_udp_new ( ipaddr, <span class="number">6000</span>, <span class="number">6000</span> );</span><br><span class="line">    udp_sendconn-&gt;ripaddr[<span class="number">0</span>] = HTONS ( ( <span class="number">192</span> &lt;&lt; <span class="number">8</span> ) | <span class="number">168</span> );</span><br><span class="line">    <span class="comment">/* 设置UDP发送目标IP */</span></span><br><span class="line">    udp_sendconn-&gt;ripaddr[<span class="number">1</span>] = HTONS ( ( <span class="number">1</span> &lt;&lt; <span class="number">8</span> ) | <span class="number">239</span> );</span><br><span class="line">    udp_sendconn-&gt;lport = HTONS ( <span class="number">6000</span> );</span><br><span class="line">    udp_sendconn-&gt;rport = HTONS ( <span class="number">6000</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>SampleApp_Init</code>函数的最后设置<code>ARP</code>和<code>uip</code>发送定时器：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">osal_start_timerEx ( SampleApp_TaskID, SAMPLEAPP_ARP_TIMER_MSG_EVT, <span class="number">100</span> );</span><br><span class="line">osal_start_timerEx ( SampleApp_TaskID, SAMPLEAPP_UIP_SEND_MSG_EVT, <span class="number">100</span> );</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;4. 修改<code>SampleApp_ProcessEvent</code>函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">uint16 <span class="title">SampleApp_ProcessEvent</span> <span class="params">( uint8 task_id, uint16 events )</span> </span>&#123;</span><br><span class="line">    afIncomingMSGPacket_t *MSGpkt;</span><br><span class="line">    ( <span class="keyword">void</span> ) task_id; <span class="comment">/* Intentionally unreferenced parameter */</span></span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SYS_EVENT_MSG ) &#123;</span><br><span class="line">        MSGpkt = ( afIncomingMSGPacket_t * ) osal_msg_receive ( SampleApp_TaskID );</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">while</span> ( MSGpkt ) &#123;</span><br><span class="line">            <span class="keyword">switch</span> ( MSGpkt-&gt;hdr.event ) &#123;</span><br><span class="line">                <span class="keyword">case</span> KEY_CHANGE: <span class="comment">/* Received when a key is pressed */</span></span><br><span class="line">                    SampleApp_HandleKeys ( ( ( keyChange_t * ) MSGpkt )-&gt;state, \</span><br><span class="line">                                           ( ( keyChange_t * ) MSGpkt )-&gt;keys );</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">​</span><br><span class="line">                <span class="comment">/* Received when a messages is received (OTA) for this endpoint */</span></span><br><span class="line">                <span class="keyword">case</span> AF_INCOMING_MSG_CMD:</span><br><span class="line">                    SampleApp_MessageMSGCB ( MSGpkt );</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">​</span><br><span class="line">                <span class="keyword">case</span> ZDO_STATE_CHANGE:</span><br><span class="line">                    <span class="comment">/* Received whenever the device changes state in the network */</span></span><br><span class="line">                    SampleApp_NwkState = ( devStates_t ) ( MSGpkt-&gt;hdr.status );</span><br><span class="line">​</span><br><span class="line">                    <span class="keyword">if</span> ( ( SampleApp_NwkState == DEV_ZB_COORD ) || ( SampleApp_NwkState == DEV_ROUTER ) || \</span><br><span class="line">                         ( SampleApp_NwkState == DEV_END_DEVICE ) ) &#123;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">/* Device is no longer in the network */</span></span><br><span class="line">                    &#125;</span><br><span class="line">​</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">​</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">​</span><br><span class="line">            osal_msg_deallocate ( ( uint8 * ) MSGpkt ); <span class="comment">/* Release the memory */</span></span><br><span class="line">            <span class="comment">/* Next - if one is available */</span></span><br><span class="line">            MSGpkt = ( afIncomingMSGPacket_t * ) osal_msg_receive ( SampleApp_TaskID );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">return</span> ( events ^ SYS_EVENT_MSG ); <span class="comment">/* return unprocessed events */</span></span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SAMPLEAPP_SEND_PERIODIC_MSG_EVT ) &#123; <span class="comment">/* 周期发送函数 */</span></span><br><span class="line">        <span class="keyword">return</span> ( events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT ); <span class="comment">/* return unprocessed events */</span></span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SAMPLEAPP_ARP_TIMER_MSG_EVT ) &#123; <span class="comment">/* arptimer */</span></span><br><span class="line">        uip_arp_timer();</span><br><span class="line">        <span class="comment">/* 10s更新一次 */</span></span><br><span class="line">        osal_start_timerEx ( SampleApp_TaskID, SAMPLEAPP_ARP_TIMER_MSG_EVT, <span class="number">10000</span> );</span><br><span class="line">        <span class="keyword">return</span> ( events ^ SAMPLEAPP_ARP_TIMER_MSG_EVT ); <span class="comment">/* return unprocessed events */</span></span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SAMPLEAPP_UIP_REV_MSG_EVT ) &#123; <span class="comment">/* 收到网络数据 */</span></span><br><span class="line">        <span class="keyword">if</span> ( ETHBUF-&gt;type == htons ( UIP_ETHTYPE_IP ) ) &#123;</span><br><span class="line">            uip_arp_ipin();</span><br><span class="line">            uip_input();</span><br><span class="line">​</span><br><span class="line">            <span class="keyword">if</span> ( uip_len &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">                uip_arp_out();</span><br><span class="line">                tapdev_send();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( ETHBUF-&gt;type == htons ( UIP_ETHTYPE_ARP ) ) &#123;</span><br><span class="line">            uip_arp_arpin();</span><br><span class="line">​</span><br><span class="line">            <span class="keyword">if</span> ( uip_len &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">                tapdev_send();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">return</span> ( events ^ SAMPLEAPP_UIP_REV_MSG_EVT ); <span class="comment">/* return unprocessed events */</span></span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SAMPLEAPP_UIP_SEND_MSG_EVT ) &#123; <span class="comment">/* 发送网络数据 */</span></span><br><span class="line">        uip_udp_periodic ( <span class="number">0</span> ); <span class="comment">/* 检查UDP是否有数据发送 */</span></span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> ( uip_len &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">            uip_arp_out();</span><br><span class="line">            tapdev_send();</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">for</span> ( uint8 i = <span class="number">0</span>; i &lt; UIP_CONNS; i++ ) &#123;</span><br><span class="line">            uip_periodic ( i );</span><br><span class="line">​</span><br><span class="line">            <span class="keyword">if</span> ( uip_len &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">                uip_arp_out();</span><br><span class="line">                tapdev_send();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        osal_start_timerEx ( SampleApp_TaskID, SAMPLEAPP_UIP_SEND_MSG_EVT, <span class="number">500</span> );</span><br><span class="line">        <span class="keyword">return</span> ( events ^ SAMPLEAPP_UIP_SEND_MSG_EVT ); <span class="comment">/* return unprocessed events */</span></span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">/* Discard unknown events */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;5. 修改<code>tapdev.c</code>文件，将<code>tapdev_poll</code>函数改为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tapdev_poll</span> <span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    uip_len = tapdev_read();</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( uip_len &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">        <span class="keyword">extern</span> uint8 SampleApp_TaskID;</span><br><span class="line">        <span class="comment">/* 通知应用程序收到了网络数据 */</span></span><br><span class="line">        osal_set_event ( SampleApp_TaskID, SAMPLEAPP_UIP_REV_MSG_EVT );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;6. 将<code>Hal_ProcessPoll</code>函数修改为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Hal_ProcessPoll</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (defined HAL_TIMER) &amp;&amp; (HAL_TIMER == TRUE) <span class="comment">/* Timer Poll */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">error</span> <span class="meta-string">"The hal timer driver module is removed."</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (defined HAL_UART) &amp;&amp; (HAL_UART == TRUE) <span class="comment">/* UART Poll */</span></span></span><br><span class="line">    HalUARTPoll();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (defined HAL_SPI) &amp;&amp; (HAL_SPI == TRUE) <span class="comment">/* SPI Poll */</span></span></span><br><span class="line">    HalSpiPoll();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (defined HAL_HID) &amp;&amp; (HAL_HID == TRUE) <span class="comment">/* HID poll */</span></span></span><br><span class="line">    usbHidProcessEvents();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined( POWER_SAVING )</span></span><br><span class="line">    ALLOW_SLEEP_MODE(); <span class="comment">/* Allow sleep before the next OSAL event loop */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    tapdev_poll(); <span class="comment">/* 检查网络数据 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;7. 在串口回传函数中启动网络数据发送：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SerialCallback</span> <span class="params">( uint8 port, uint8 events )</span> </span>&#123;</span><br><span class="line">    ( <span class="keyword">void</span> ) port;</span><br><span class="line">    uint8 numBytes = <span class="number">0</span>;</span><br><span class="line">    uint8 buf[<span class="number">60</span>];</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; HAL_UART_RX_TIMEOUT ) &#123; <span class="comment">/* 串口有数据 */</span></span><br><span class="line">        numBytes = Hal_UART_RxBufLen ( <span class="number">0</span> ); <span class="comment">/* 读出串口缓冲区有多少字节 */</span></span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> ( numBytes ) &#123;</span><br><span class="line">            <span class="comment">/* 从串口缓冲区读出numBytes字节数据 */</span></span><br><span class="line">            HalUARTRead ( <span class="number">0</span>, buf, numBytes );</span><br><span class="line">            HalUARTWrite ( <span class="number">0</span>, <span class="string">"send...\n"</span>, <span class="number">8</span> );</span><br><span class="line">            osal_memcpy ( udp_sendData, buf, numBytes );</span><br><span class="line">            udp_sendDataLen = numBytes;</span><br><span class="line">            <span class="comment">/* 启动网络数据发送事件 */</span></span><br><span class="line">            osal_set_event ( SampleApp_TaskID, SAMPLEAPP_UIP_SEND_MSG_EVT );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;8. 在<code>SampleApp_Init</code>中添加串口初始化函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UartInit ( SerialCallback );</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;9. 连接硬件，将程序下载到<code>CC2530</code>硬件中，串口和网口可以互相发送数据。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/06/CC2530和zigbee笔记/MAC地址查询/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/CC2530和zigbee笔记/MAC地址查询/" itemprop="url">MAC地址查询</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-06T18:30:11+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;实验内容：协调器上电后建立网路，路由器自动加入网络。然后路由器调用调用相关的<code>API</code>函数获得某一网络号节点的<code>MAC</code>地址，然后通过串口将其发送到<code>PC</code>端的串口调试助手。<br>&emsp;&emsp;获得某一网络号节点的<code>MAC</code>地址的<code>API</code>函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZDP_IEEEAddrReq ( uint16 shortAddr, byte ReqType, byte StartIndex, byte SecurtyEnable );</span><br></pre></td></tr></table></figure>
<p>除了<code>shortAddr</code>这个参数外，其他均填<code>0</code>。<br>&emsp;&emsp;协调器程序和<code>获取自身和父节点网络与MAC地址</code>实验一样。路由器程序设计如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"OSAL.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"AF.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ZDApp.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ZDObject.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ZDProfile.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinator.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DebugTrace.h"</span></span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(WIN32)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"OnBoard.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hal_lcd.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hal_led.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hal_key.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hal_uart.h"</span></span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SHOW_INFO_EVENT 0x01</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">const</span> cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] = &#123;</span><br><span class="line">    GENERICAPP_CLUSTERID</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">const</span> SimpleDescriptionFormat_t GenericApp_SimpleDesc = &#123;</span><br><span class="line">    GENERICAPP_ENDPOINT,</span><br><span class="line">    GENERICAPP_PROFID,</span><br><span class="line">    GENERICAPP_DEVICEID,</span><br><span class="line">    GENERICAPP_DEVICE_VERSION,</span><br><span class="line">    GENERICAPP_FLAGS,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    ( cId_t * ) <span class="literal">NULL</span>,</span><br><span class="line">    GENERICAPP_MAX_CLUSTERS,</span><br><span class="line">    ( cId_t * ) GenericApp_ClusterList</span><br><span class="line">&#125;;</span><br><span class="line">​</span><br><span class="line">endPointDesc_t GenericApp_epDesc;</span><br><span class="line">byte GenericApp_TaskID;</span><br><span class="line">byte GenericApp_TransID;</span><br><span class="line">devStates_t GenericApp_NwkState;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowInfo</span> <span class="params">( <span class="keyword">void</span> )</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">To_string</span> <span class="params">( uint8 *dest, <span class="keyword">char</span> *src, uint8 length )</span></span>;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GenericApp_ProcessZDOMsgs</span> <span class="params">( zdoIncomingMsg_t *inMsg )</span></span>; <span class="comment">/* 增加这个函数的目的是对ZDO_CB_MSG消息响应 */</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">RFTXBUF</span> &#123;</span></span><br><span class="line">    uint8 myNWK[<span class="number">4</span>];</span><br><span class="line">    uint8 myMAC[<span class="number">16</span>];</span><br><span class="line">    uint8 pNWK[<span class="number">4</span>];</span><br><span class="line">    uint8 pMAC[<span class="number">16</span>];</span><br><span class="line">&#125; RFTX;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GenericApp_Init</span> <span class="params">( byte task_id )</span> </span>&#123;</span><br><span class="line">    GenericApp_TaskID = task_id;</span><br><span class="line">    GenericApp_NwkState = DEV_INIT;</span><br><span class="line">    GenericApp_TransID = <span class="number">0</span>;</span><br><span class="line">    GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;</span><br><span class="line">    GenericApp_epDesc.task_id = &amp;GenericApp_TaskID;</span><br><span class="line">    GenericApp_epDesc.simpleDesc = ( SimpleDescriptionFormat_t * ) &amp;GenericApp_SimpleDesc;</span><br><span class="line">    GenericApp_epDesc.latencyReq = noLatencyReqs;</span><br><span class="line">    afRegister ( &amp;GenericApp_epDesc );</span><br><span class="line">    halUARTCfg_t uartConfig;</span><br><span class="line">    uartConfig.configured = TRUE;</span><br><span class="line">    uartConfig.baudRate  = HAL_UART_BR_115200;</span><br><span class="line">    uartConfig.flowControl = FALSE;</span><br><span class="line">    uartConfig.callBackFunc = <span class="literal">NULL</span>;</span><br><span class="line">    HalUARTOpen ( <span class="number">0</span>, &amp;uartConfig );</span><br><span class="line">    ZDO_RegisterForZDOMsg ( GenericApp_TaskID, IEEE_addr_rsp ); <span class="comment">/* 对IEEE_addr_rsp消息响应的注册 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">UINT16 <span class="title">GenericApp_ProcessEvent</span> <span class="params">( byte task_id, UINT16 events )</span> </span>&#123;</span><br><span class="line">    afIncomingMSGPacket_t *MSGpkt;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SYS_EVENT_MSG ) &#123;</span><br><span class="line">        MSGpkt = ( afIncomingMSGPacket_t * ) osal_msg_receive ( GenericApp_TaskID );</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">while</span> ( MSGpkt ) &#123;</span><br><span class="line">            <span class="keyword">switch</span> ( MSGpkt-&gt;hdr.event ) &#123;</span><br><span class="line">                <span class="keyword">case</span> ZDO_CB_MSG:</span><br><span class="line">                    GenericApp_ProcessZDOMsgs ( ( zdoIncomingMsg_t * ) MSGpkt ); <span class="comment">/* 注意这句代码 */</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">​</span><br><span class="line">                <span class="keyword">case</span> ZDO_STATE_CHANGE:</span><br><span class="line">                    GenericApp_NwkState = ( devStates_t ) ( MSGpkt-&gt;hdr.status );</span><br><span class="line">​</span><br><span class="line">                    <span class="keyword">if</span> ( GenericApp_NwkState == DEV_ROUTER ) &#123;</span><br><span class="line">                        HalLedBlink ( HAL_LED_1, <span class="number">0</span>, <span class="number">50</span>, <span class="number">500</span> );</span><br><span class="line">                        osal_set_event ( GenericApp_TaskID, SHOW_INFO_EVENT );</span><br><span class="line">                    &#125;</span><br><span class="line">​</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">​</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">​</span><br><span class="line">            osal_msg_deallocate ( ( uint8 * ) MSGpkt );</span><br><span class="line">            MSGpkt = ( afIncomingMSGPacket_t * ) osal_msg_receive ( GenericApp_TaskID );</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">return</span> ( events ^ SYS_EVENT_MSG );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( events &amp; SHOW_INFO_EVENT ) &#123;</span><br><span class="line">        HalLedBlink ( HAL_LED_2, <span class="number">0</span>, <span class="number">50</span>, <span class="number">500</span> );</span><br><span class="line">        ShowInfo();</span><br><span class="line">        ZDP_IEEEAddrReq ( <span class="number">0x0000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> ); <span class="comment">/* 请求协调器IEEE地址 */</span></span><br><span class="line">        osal_start_timerEx ( GenericApp_TaskID, SHOW_INFO_EVENT, <span class="number">5000</span> );</span><br><span class="line">        <span class="keyword">return</span> ( events ^ SHOW_INFO_EVENT );</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GenericApp_ProcessZDOMsgs</span> <span class="params">( zdoIncomingMsg_t *inMsg )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">char</span> changeline[<span class="number">2</span>] = &#123;<span class="number">0x0A</span>, <span class="number">0x0D</span>&#125;;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">switch</span> ( inMsg-&gt;clusterID ) &#123;</span><br><span class="line">        <span class="keyword">case</span> IEEE_addr_rsp: &#123;</span><br><span class="line">            <span class="comment">/* 对接受到的数据包进行解析，解析完后，pRsp指向数据包的存放地址 */</span></span><br><span class="line">            ZDO_NwkIEEEAddrResp_t *pRsp = ZDO_ParseAddrRsp ( inMsg );</span><br><span class="line">​</span><br><span class="line">            <span class="keyword">if</span> ( pRsp ) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( pRsp-&gt;status == ZSuccess ) &#123; <span class="comment">/* 解析是否正确 */</span></span><br><span class="line">                    To_string ( buf, pRsp-&gt;extAddr, <span class="number">8</span> ); <span class="comment">/* 把MAC地址转换为16进制形式存放 */</span></span><br><span class="line">                    HalUARTWrite ( <span class="number">0</span>, <span class="string">"Coordinator MAC:"</span>, osal_strlen ( <span class="string">"Coordinator MAC:"</span> ) );</span><br><span class="line">                    HalUARTWrite ( <span class="number">0</span>, buf, <span class="number">16</span> );</span><br><span class="line">                    HalUARTWrite ( <span class="number">0</span>, changeline, <span class="number">2</span> );</span><br><span class="line">                &#125;</span><br><span class="line">​</span><br><span class="line">                osal_mem_free ( pRsp ); <span class="comment">/* 调用该函数释放数据包缓冲区 */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowInfo</span> <span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    RFTX rftx;</span><br><span class="line">    uint8 buf[<span class="number">8</span>];</span><br><span class="line">    uint8 changline[<span class="number">2</span>] = &#123;<span class="number">0x0A</span>, <span class="number">0x0D</span>&#125;;</span><br><span class="line">    uint16 nwk;</span><br><span class="line">    nwk = NLME_GetShortAddr();</span><br><span class="line">    To_string ( rftx.myNWK, ( uint8 * ) &amp;nwk, <span class="number">2</span> );</span><br><span class="line">    To_string ( rftx.myMAC, NLME_GetExtAddr(), <span class="number">8</span> );</span><br><span class="line">    nwk = NLME_GetCoordShortAddr();</span><br><span class="line">    To_string ( rftx.pNWK, ( uint8 * ) &amp;nwk, <span class="number">2</span> );</span><br><span class="line">    NLME_GetCoordExtAddr ( buf );</span><br><span class="line">    To_string ( rftx.pMAC, buf, <span class="number">8</span> );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, <span class="string">"NWK:"</span>, osal_strlen ( <span class="string">"NWK:"</span> ) );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, rftx.myNWK, <span class="number">4</span> );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, <span class="string">"  MAC:"</span>, osal_strlen ( <span class="string">"  MAC:"</span> ) );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, rftx.myMAC, <span class="number">16</span> );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, <span class="string">"  p-NWK:"</span>, osal_strlen ( <span class="string">"  p-NWK:"</span> ) );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, rftx.pNWK, <span class="number">4</span> );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, <span class="string">"  p-MAC:"</span>, osal_strlen ( <span class="string">"  p-MAC:"</span> ) );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, rftx.pMAC, <span class="number">16</span> );</span><br><span class="line">    HalUARTWrite ( <span class="number">0</span>, changline, <span class="number">2</span> );</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">To_string</span> <span class="params">( uint8 *dest, <span class="keyword">char</span> *src, uint8 length )</span> </span>&#123;</span><br><span class="line">    uint8 *xad;</span><br><span class="line">    uint8 i = <span class="number">0</span>;</span><br><span class="line">    uint8 ch;</span><br><span class="line">    xad = src + length - <span class="number">1</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; length; i++, xad-- ) &#123;</span><br><span class="line">        ch = ( *xad &gt;&gt; <span class="number">4</span> ) &amp; <span class="number">0x0F</span>;</span><br><span class="line">        dest[i &lt;&lt; <span class="number">1</span>] = ch + ( ( ch &lt; <span class="number">10</span> ) ? <span class="string">'0'</span> : <span class="string">'7'</span> );</span><br><span class="line">        ch = *xad &amp; <span class="number">0x0F</span>;</span><br><span class="line">        dest[ ( i &lt;&lt; <span class="number">1</span> ) + <span class="number">1</span>] = ch + ( ( ch &lt; <span class="number">10</span> ) ? <span class="string">'0'</span> : <span class="string">'7'</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;注意<code>ZDO_ParseAddrRsp</code>函数的返回值为<code>ZDO_NwkIEEEAddrResp_t</code>类型，该结构体如下(<code>ZDObject.h</code>)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    uint8 status;</span><br><span class="line">    uint16 nwkAddr;</span><br><span class="line">    uint8 extAddr[Z_EXTADDR_LEN];</span><br><span class="line">    uint8 numAssocDevs;</span><br><span class="line">    uint8 startIndex;</span><br><span class="line">    uint16 devList[];</span><br><span class="line">&#125; ZDO_NwkIEEEAddrResp_t;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/02/06/CC2530和zigbee笔记/MAC地址查询/1.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/34/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><span class="page-number current">35</span><a class="page-number" href="/page/36/">36</a><span class="space">&hellip;</span><a class="page-number" href="/page/96/">96</a><a class="extend next" rel="next" href="/page/36/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">955</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
