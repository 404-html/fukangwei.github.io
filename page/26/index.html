<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="泥腿子出身">
<meta property="og:url" content="http://fukangwei.gitee.io/page/26/index.html">
<meta property="og:site_name" content="泥腿子出身">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="泥腿子出身">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/page/26/">





  <title>泥腿子出身</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泥腿子出身</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/Python语法/Pandas模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Python语法/Pandas模块/" itemprop="url">Pandas模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T10:03:42+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Pandas基本介绍"><a href="#Pandas基本介绍" class="headerlink" title="Pandas基本介绍"></a>Pandas基本介绍</h3><h4 id="Numpy和Pandas"><a href="#Numpy和Pandas" class="headerlink" title="Numpy和Pandas"></a>Numpy和Pandas</h4><p>&emsp;&emsp;如果用<code>python</code>的列表和字典来作比较，那么可以说<code>Numpy</code>是列表形式的，没有数值标签；而<code>Pandas</code>就是字典形式。<code>Pandas</code>是基于<code>Numpy</code>构建的，让<code>Numpy</code>为中心的应用变得更加简单。<br>&emsp;&emsp;要使用<code>pandas</code>，首先需要了解它主要的两个数据结构：<code>Series</code>和<code>DataFrame</code>。</p>
<h4 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, np.nan, <span class="number">44</span>, <span class="number">1</span>])</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>     <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>     <span class="number">3.0</span></span><br><span class="line"><span class="number">2</span>     <span class="number">6.0</span></span><br><span class="line"><span class="number">3</span>     NaN</span><br><span class="line"><span class="number">4</span>    <span class="number">44.0</span></span><br><span class="line"><span class="number">5</span>     <span class="number">1.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<p><code>Series</code>的字符串表现形式为：索引在左边，值在右边。由于我们没有为数据指定索引，于是会自动创建一个<code>0</code>到<code>N - 1</code>(<code>N</code>为长度)的整数型索引。</p>
<h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20160101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">4</span>), index=dates, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                   a         b         c         d</span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-01</span> <span class="number">-1.615754</span> <span class="number">-1.572751</span>  <span class="number">0.886368</span>  <span class="number">0.639823</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">0.592734</span> <span class="number">-1.439370</span> <span class="number">-0.880371</span>  <span class="number">0.193510</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-03</span>  <span class="number">1.584482</span>  <span class="number">0.016471</span>  <span class="number">0.420065</span>  <span class="number">1.685260</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">0.434318</span> <span class="number">-1.079135</span>  <span class="number">0.134948</span>  <span class="number">1.038391</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-05</span> <span class="number">-0.169911</span> <span class="number">-0.252141</span> <span class="number">-0.307869</span> <span class="number">-0.806533</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">0.763159</span>  <span class="number">0.038354</span> <span class="number">-0.827668</span> <span class="number">-0.031835</span></span><br></pre></td></tr></table></figure>
<p><code>DataFrame</code>是一个表格型的数据结构，它包含有一组有序的列，每列可以是不同的值类型(数值、字符串、布尔值等)。<code>DataFrame</code>既有行索引也有列索引，它可以被看做由<code>Series</code>组成的大字典。<br>&emsp;&emsp;我们可以根据每一个不同的索引来挑选数据，比如挑选<code>b</code>的元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="string">'b'</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-01</span>    <span class="number">0.266451</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">-0.714666</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">-0.300667</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-04</span>   <span class="number">-0.365430</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-05</span>   <span class="number">-1.703521</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-06</span>   <span class="number">-0.903908</span></span><br><span class="line">Freq: D, Name: b, dtype: float64</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;再创建一组没有给定行标签和列标签的数据<code>df1</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)))</span><br><span class="line">print(df1)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>  <span class="number">4</span>  <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2</span>  <span class="number">8</span>  <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>还有一种生成<code>df</code>的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'A'</span>: <span class="number">1.</span>,</span><br><span class="line">     <span class="string">'B'</span>: pd.Timestamp(<span class="string">'20130102'</span>),</span><br><span class="line">     <span class="string">'C'</span>: pd.Series(<span class="number">1</span>, index=list(range(<span class="number">4</span>)), dtype=<span class="string">'float32'</span>),</span><br><span class="line">     <span class="string">'D'</span>: np.array([<span class="number">3</span>] * <span class="number">4</span>, dtype=<span class="string">'int32'</span>),</span><br><span class="line">     <span class="string">'E'</span>: pd.Categorical([<span class="string">"test"</span>, <span class="string">"train"</span>, <span class="string">"test"</span>, <span class="string">"train"</span>]),</span><br><span class="line">     <span class="string">'F'</span>: <span class="string">'foo'</span>&#125;)</span><br><span class="line"></span><br><span class="line">print(df2)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     A          B    C  D      E    F</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">1</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br></pre></td></tr></table></figure>
<p>这种方法能对每一列的数据进行特殊对待。如果想要查看数据中的类型，我们可以用<code>dtype</code>这个属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.dtypes)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A           float64</span><br><span class="line">B    datetime64[ns]</span><br><span class="line">C           float32</span><br><span class="line">D             int32</span><br><span class="line">E          category</span><br><span class="line">F            object</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果想看对列的序号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.index)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Int64Index([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=<span class="string">'int64'</span>)</span><br></pre></td></tr></table></figure>
<p>同样，每种数据的名称也能看到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.columns)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Index([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>], dtype=<span class="string">'object'</span>)</span><br></pre></td></tr></table></figure>
<p>如果只想看所有<code>df2</code>的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.values)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'test'</span> <span class="string">'foo'</span>]</span><br><span class="line"> [<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'train'</span> <span class="string">'foo'</span>]</span><br><span class="line"> [<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'test'</span> <span class="string">'foo'</span>]</span><br><span class="line"> [<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'train'</span> <span class="string">'foo'</span>]]</span><br></pre></td></tr></table></figure>
<p>想知道数据的总结，可以用<code>describe</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.describe())</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">         A    C    D</span><br><span class="line">count  <span class="number">4.0</span>  <span class="number">4.0</span>  <span class="number">4.0</span></span><br><span class="line">mean   <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line">std    <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line">min    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">25</span>%    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">50</span>%    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">75</span>%    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line">max    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br></pre></td></tr></table></figure>
<p>如果想翻转数据，可以使用<code>transpose</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.T)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                     <span class="number">0</span>                    <span class="number">1</span>                    <span class="number">2</span>  \</span><br><span class="line">A                    <span class="number">1</span>                    <span class="number">1</span>                    <span class="number">1</span></span><br><span class="line">B  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">C                    <span class="number">1</span>                    <span class="number">1</span>                    <span class="number">1</span></span><br><span class="line">D                    <span class="number">3</span>                    <span class="number">3</span>                    <span class="number">3</span></span><br><span class="line">E                 test                train                 test</span><br><span class="line">F                  foo                  foo                  foo</span><br><span class="line">                     <span class="number">3</span></span><br><span class="line">A                    <span class="number">1</span></span><br><span class="line">B  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">C                    <span class="number">1</span></span><br><span class="line">D                    <span class="number">3</span></span><br><span class="line">E                train</span><br><span class="line">F                  foo</span><br></pre></td></tr></table></figure>
<p>如果想对数据的<code>index</code>进行排序并输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     F      E  D    C          B    A</span><br><span class="line"><span class="number">0</span>  foo   test  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  foo  train  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">2</span>  foo   test  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  foo  train  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>如果是对数据值排序输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.sort_values(by=<span class="string">'B'</span>))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     A          B    C  D      E    F</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">1</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br></pre></td></tr></table></figure>
<h3 id="Pandas选择数据"><a href="#Pandas选择数据" class="headerlink" title="Pandas选择数据"></a>Pandas选择数据</h3><p>&emsp;&emsp;我们建立了一个<code>6 * 4</code>的矩阵数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>, <span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>如果我们想选取<code>DataFrame</code>中的数据，可以使用下面两种方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="string">'A'</span>])</span><br><span class="line">print(df.A)</span><br></pre></td></tr></table></figure>
<p>执行结果都是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>     <span class="number">4</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>     <span class="number">8</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>    <span class="number">12</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>    <span class="number">16</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>    <span class="number">20</span></span><br><span class="line">Freq: D, Name: A, dtype: int32</span><br></pre></td></tr></table></figure>
<p>让选择跨越多行或多列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="number">0</span>:<span class="number">3</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df[<span class="string">'20130102'</span>:<span class="string">'20130104'</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">            A  B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">4</span>  <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>  <span class="number">8</span>  <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line">-----------------------</span><br><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br></pre></td></tr></table></figure>
<p>如果是<code>df[3:3]</code>，将会是一个空对象。后者选择<code>20130102</code>到<code>20130104</code>标签之间的数据，并且包括这两个标签。</p>
<h4 id="根据标签-loc"><a href="#根据标签-loc" class="headerlink" title="根据标签(loc)"></a>根据标签(loc)</h4><p>&emsp;&emsp;同样我们可以使用标签来选择数据，本示例主要通过标签名字选择某一行数据，或者通过选择某行或者所有行，然后选其中某一列或几列数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(df.loc[<span class="string">'20130102'</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.loc[:, [<span class="string">'A'</span>, <span class="string">'B'</span>]])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.loc[<span class="string">'20130102'</span>, [<span class="string">'A'</span>, <span class="string">'B'</span>]])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">A    <span class="number">4</span></span><br><span class="line">B    <span class="number">5</span></span><br><span class="line">C    <span class="number">6</span></span><br><span class="line">D    <span class="number">7</span></span><br><span class="line">Name: <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: int32</span><br><span class="line">-----------------------</span><br><span class="line">             A   B</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span></span><br><span class="line">-----------------------</span><br><span class="line">A    <span class="number">4</span></span><br><span class="line">B    <span class="number">5</span></span><br><span class="line">Name: <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: int32</span><br></pre></td></tr></table></figure>
<h4 id="根据序列-iloc"><a href="#根据序列-iloc" class="headerlink" title="根据序列(iloc)"></a>根据序列(iloc)</h4><p>&emsp;&emsp;我们也可以使用位置选择数据，例如选取某一个、连续选择或者跨行选择等操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(df.iloc[<span class="number">3</span>, <span class="number">1</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.iloc[<span class="number">3</span>:<span class="number">5</span>, <span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.iloc[[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>], <span class="number">1</span>:<span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">13</span></span><br><span class="line">-----------------------</span><br><span class="line">             B   C</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">13</span>  <span class="number">14</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">17</span>  <span class="number">18</span></span><br><span class="line">-----------------------</span><br><span class="line">             B   C</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">5</span>   <span class="number">6</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">13</span>  <span class="number">14</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">21</span>  <span class="number">22</span></span><br></pre></td></tr></table></figure>
<h4 id="根据混合条件-ix"><a href="#根据混合条件-ix" class="headerlink" title="根据混合条件(ix)"></a>根据混合条件(ix)</h4><p>&emsp;&emsp;我们也可以采用采用混合选择的方式，例如选择<code>A</code>和<code>C</code>两列，并选择前三行的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df.ix[:<span class="number">3</span>, [<span class="string">'A'</span>, <span class="string">'C'</span>]])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">            A   C</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0</span>   <span class="number">2</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">4</span>   <span class="number">6</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>  <span class="number">8</span>  <span class="number">10</span></span><br></pre></td></tr></table></figure>
<h4 id="通过判断的筛选"><a href="#通过判断的筛选" class="headerlink" title="通过判断的筛选"></a>通过判断的筛选</h4><p>&emsp;&emsp;最后可以采用判断指令(<code>Boolean indexing</code>)进行选择，可以约束某项条件，然后选择所有符合该条件的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df[df.A &gt; <span class="number">8</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas设置值"><a href="#Pandas设置值" class="headerlink" title="Pandas设置值"></a>Pandas设置值</h3><h4 id="创建数据"><a href="#创建数据" class="headerlink" title="创建数据"></a>创建数据</h4><p>&emsp;&emsp;我们可以根据自己的需求，用<code>pandas</code>更改数据里面的值，或者加上一些空的或者有数值的列。首先建立了一个<code>6 * 4</code>的矩阵数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>, <span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="根据位置设置-loc和iloc"><a href="#根据位置设置-loc和iloc" class="headerlink" title="根据位置设置(loc和iloc)"></a>根据位置设置(loc和iloc)</h4><p>&emsp;&emsp;我们可以利用索引或者标签确定需要修改值的位置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1111</span></span><br><span class="line">df.loc[<span class="string">'20130101'</span>, <span class="string">'B'</span>] = <span class="number">2222</span></span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>  <span class="number">2222</span>     <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>     <span class="number">9</span>  <span class="number">1111</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>    <span class="number">13</span>    <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>    <span class="number">17</span>    <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>    <span class="number">21</span>    <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="根据条件设置"><a href="#根据条件设置" class="headerlink" title="根据条件设置"></a>根据条件设置</h4><p>&emsp;&emsp;我们想要更改<code>B</code>中的数值，而更改的位置是取决于<code>A</code>的。对于<code>A</code>大于<code>4</code>的位置，更改<code>B</code>在相应位置上的数为<code>0</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.B[df.A &gt; <span class="number">4</span>] = <span class="number">0</span></span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A  B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>  <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>  <span class="number">0</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">0</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">0</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">0</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="按行或列设置"><a href="#按行或列设置" class="headerlink" title="按行或列设置"></a>按行或列设置</h4><p>&emsp;&emsp;如果需要对整列做批处理，例如加上一列<code>F</code>，并将<code>F</code>列全改为<code>NaN</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'F'</span>] = np.nan</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D   F</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span> NaN</span><br></pre></td></tr></table></figure>
<h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h4><p>&emsp;&emsp;用上面的方法也可以加上<code>Series</code>序列，但是长度必须对齐：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'E'</span>] = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], index=pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>))</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D  E</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>  <span class="number">1</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>  <span class="number">2</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span>  <span class="number">4</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span>  <span class="number">5</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span>  <span class="number">6</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas处理丢失数据"><a href="#Pandas处理丢失数据" class="headerlink" title="Pandas处理丢失数据"></a>Pandas处理丢失数据</h3><h4 id="创建含NaN的矩阵"><a href="#创建含NaN的矩阵" class="headerlink" title="创建含NaN的矩阵"></a>创建含NaN的矩阵</h4><p>&emsp;&emsp;有时我们导入或处理数据，会产生一些空的或者是<code>NaN</code>数据，如何删除或者是填补这些<code>NaN</code>数据就是今天所要提到的内容。建立了一个<code>6 * 4</code>的矩阵数据，并且把两个位置设置为空：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>, <span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line">df.iloc[<span class="number">0</span>, <span class="number">1</span>] = np.nan</span><br><span class="line">df.iloc[<span class="number">1</span>, <span class="number">2</span>] = np.nan</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   NaN   <span class="number">2.0</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5.0</span>   NaN   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9.0</span>  <span class="number">10.0</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13.0</span>  <span class="number">14.0</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="pd-dropna"><a href="#pd-dropna" class="headerlink" title="pd.dropna"></a>pd.dropna</h4><p>&emsp;&emsp;如果想直接去掉有<code>NaN</code>的行或列，可以使用<code>dropna</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = df.dropna(</span><br><span class="line">    axis=<span class="number">0</span>,  <span class="comment"># 0：对行进行操作；1：对列进行操作</span></span><br><span class="line">    how=<span class="string">'any'</span>  <span class="comment"># any：只要存在NaN就drop掉；all：必须全部是NaN才drop掉</span></span><br><span class="line">)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9.0</span>  <span class="number">10.0</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13.0</span>  <span class="number">14.0</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="pd-fillna"><a href="#pd-fillna" class="headerlink" title="pd.fillna"></a>pd.fillna</h4><p>&emsp;&emsp;如果是将<code>NaN</code>用其他值代替(比如代替成<code>0</code>)，则可以使用<code>fillna</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = df.fillna(value=<span class="number">0</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">0.0</span>   <span class="number">2.0</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5.0</span>   <span class="number">0.0</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9.0</span>  <span class="number">10.0</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13.0</span>  <span class="number">14.0</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="pd-isnull"><a href="#pd-isnull" class="headerlink" title="pd.isnull"></a>pd.isnull</h4><p>&emsp;&emsp;判断是否有缺失数据<code>NaN</code>，为<code>True</code>表示缺失数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df.isnull())</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                A      B      C      D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="keyword">False</span>   <span class="keyword">True</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="keyword">False</span>  <span class="keyword">False</span>   <span class="keyword">True</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>检测数据中是否存在<code>NaN</code>，如果存在就返回<code>True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(np.any(df.isnull()) == <span class="keyword">True</span>)  <span class="comment"># 结果为True</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas合并concat"><a href="#Pandas合并concat" class="headerlink" title="Pandas合并concat"></a>Pandas合并concat</h3><p>&emsp;&emsp;在处理多组数据时，往往会对数据进行合并处理。<code>concat</code>是一种基本的合并方式，而且<code>concat</code>中有很多参数可以调整，合并成你想要的数据形式：</p>
<h4 id="axis-合并方向"><a href="#axis-合并方向" class="headerlink" title="axis(合并方向)"></a>axis(合并方向)</h4><p>&emsp;&emsp;<code>axis = 0</code>是预设值，因此未设定任何参数时，函数默认<code>axis</code>为<code>0</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df3 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">2</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">res = pd.concat([df1, df2, df3], axis=<span class="number">0</span>)  <span class="comment"># concat纵向合并</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br></pre></td></tr></table></figure>
<h4 id="ignore-index-重置index"><a href="#ignore-index-重置index" class="headerlink" title="ignore_index(重置index)"></a>ignore_index(重置index)</h4><p>&emsp;&emsp;仔细观察会发现结果的<code>index</code>是<code>[0, 1, 2, 0, 1, 2, 0, 1, 2]</code>，若要将<code>index</code>重置，需要使用<code>ignore_index</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.concat([df1, df2, df3], axis=<span class="number">0</span>, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 将index_ignore设定为True</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">6</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">7</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">8</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br></pre></td></tr></table></figure>
<h4 id="join-合并方式"><a href="#join-合并方式" class="headerlink" title="join(合并方式)"></a>join(合并方式)</h4><p>&emsp;&emsp;<code>join=&#39;outer&#39;</code>为预设值，因此未设定任何参数时，函数默认<code>join</code>是<code>outer</code>。此方式是依照<code>column</code>来做纵向合并，有相同的<code>column</code>则上下合并在一起，其他独自的<code>column</code>各自成列，原本没有值的位置皆以<code>NaN</code>填充：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], index=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], index=[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">'outer'</span>)  <span class="comment"># 纵向“外”合并df1与df2</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d    e</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN</span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN</span><br><span class="line"><span class="number">2</span>  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>对于内合并，只有相同的<code>column</code>合并在一起，其他的会被抛弃：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">'inner'</span>)  <span class="comment"># 纵向“内”合并df1与df2</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----------------"</span>)</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">'inner'</span>, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 重置index并打印结果</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">     b    c    d</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">-----------------</span><br><span class="line">     b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<h4 id="join-axes-依照axes合并"><a href="#join-axes-依照axes合并" class="headerlink" title="join_axes(依照axes合并)"></a>join_axes(依照axes合并)</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], index=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], index=[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">1</span>, join_axes=[df1.index])  <span class="comment"># 依照df1.index进行横向合并</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------------------------"</span>)</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">1</span>)  <span class="comment"># 移除join_axes，并打印结果</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d    b    c    d    e</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN  NaN  NaN  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">--------------------------</span><br><span class="line">     a    b    c    d    b    c    d    e</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN  NaN  NaN  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  NaN  NaN  NaN  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<h4 id="append-添加数据"><a href="#append-添加数据" class="headerlink" title="append(添加数据)"></a>append(添加数据)</h4><p>&emsp;&emsp;<code>append</code>只有纵向合并，没有横向合并：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df3 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">res = df1.append(df2, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 将df2合并到df1的下面，以及重置index</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">res = df1.append([df2, df3], ignore_index=<span class="keyword">True</span>)  <span class="comment"># 合并多个df，将df2与df3合并至df1的下面，以及重置index</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">res = df1.append(s1, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 合并series，将s1合并至df1，以及重置index</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">-----------------------</span><br><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">6</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">7</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">8</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">-----------------------</span><br><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">2.0</span>  <span class="number">3.0</span>  <span class="number">4.0</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas合并merge"><a href="#Pandas合并merge" class="headerlink" title="Pandas合并merge"></a>Pandas合并merge</h3><p>&emsp;&emsp;<code>pandas</code>中的<code>merge</code>和<code>concat</code>类似，但主要是用于两组有<code>key column</code>的数据，通常也被用在<code>Database</code>的处理当中。</p>
<h4 id="依据一组key合并"><a href="#依据一组key合并" class="headerlink" title="依据一组key合并"></a>依据一组key合并</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'key'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>, <span class="string">'K3'</span>],</span><br><span class="line">     <span class="string">'A'</span>: [<span class="string">'A0'</span>, <span class="string">'A1'</span>, <span class="string">'A2'</span>, <span class="string">'A3'</span>],</span><br><span class="line">     <span class="string">'B'</span>: [<span class="string">'B0'</span>, <span class="string">'B1'</span>, <span class="string">'B2'</span>, <span class="string">'B3'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'key'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>, <span class="string">'K3'</span>],</span><br><span class="line">     <span class="string">'C'</span>: [<span class="string">'C0'</span>, <span class="string">'C1'</span>, <span class="string">'C2'</span>, <span class="string">'C3'</span>],</span><br><span class="line">     <span class="string">'D'</span>: [<span class="string">'D0'</span>, <span class="string">'D1'</span>, <span class="string">'D2'</span>, <span class="string">'D3'</span>]&#125;)</span><br><span class="line"></span><br><span class="line">print(left)</span><br><span class="line">print(<span class="string">"---------------"</span>)</span><br><span class="line">print(right)</span><br><span class="line">print(<span class="string">"---------------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=<span class="string">'key'</span>)  <span class="comment"># 依据“key column”合并</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    A   B key</span><br><span class="line"><span class="number">0</span>  A0  B0  K0</span><br><span class="line"><span class="number">1</span>  A1  B1  K1</span><br><span class="line"><span class="number">2</span>  A2  B2  K2</span><br><span class="line"><span class="number">3</span>  A3  B3  K3</span><br><span class="line">---------------</span><br><span class="line">    C   D key</span><br><span class="line"><span class="number">0</span>  C0  D0  K0</span><br><span class="line"><span class="number">1</span>  C1  D1  K1</span><br><span class="line"><span class="number">2</span>  C2  D2  K2</span><br><span class="line"><span class="number">3</span>  C3  D3  K3</span><br><span class="line">---------------</span><br><span class="line">    A   B key   C   D</span><br><span class="line"><span class="number">0</span>  A0  B0  K0  C0  D0</span><br><span class="line"><span class="number">1</span>  A1  B1  K1  C1  D1</span><br><span class="line"><span class="number">2</span>  A2  B2  K2  C2  D2</span><br><span class="line"><span class="number">3</span>  A3  B3  K3  C3  D3</span><br></pre></td></tr></table></figure>
<h4 id="依据两组key合并"><a href="#依据两组key合并" class="headerlink" title="依据两组key合并"></a>依据两组key合并</h4><p>&emsp;&emsp;合并时有<code>4</code>种方法，即<code>how = [&#39;left&#39;, &#39;right&#39;, &#39;outer&#39;, &#39;inner&#39;]</code>，预设值<code>how</code>为<code>inner</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">'key1'</span>: [<span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>],</span><br><span class="line">    <span class="string">'key2'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K0'</span>, <span class="string">'K1'</span>],</span><br><span class="line">    <span class="string">'A'</span>: [<span class="string">'A0'</span>, <span class="string">'A1'</span>, <span class="string">'A2'</span>, <span class="string">'A3'</span>],</span><br><span class="line">    <span class="string">'B'</span>: [<span class="string">'B0'</span>, <span class="string">'B1'</span>, <span class="string">'B2'</span>, <span class="string">'B3'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'key1'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>],</span><br><span class="line">     <span class="string">'key2'</span>: [<span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K0'</span>],</span><br><span class="line">     <span class="string">'C'</span>: [<span class="string">'C0'</span>, <span class="string">'C1'</span>, <span class="string">'C2'</span>, <span class="string">'C3'</span>],</span><br><span class="line">     <span class="string">'D'</span>: [<span class="string">'D0'</span>, <span class="string">'D1'</span>, <span class="string">'D2'</span>, <span class="string">'D3'</span>]&#125;)</span><br><span class="line">print(<span class="string">"--------left------"</span>)</span><br><span class="line">print(left)</span><br><span class="line">print(<span class="string">"--------right------"</span>)</span><br><span class="line">print(right)</span><br><span class="line">print(<span class="string">"--------inner合并------"</span>)</span><br><span class="line"><span class="comment"># 依据key1与key2的columns进行合并</span></span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'inner'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------outer合并------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'outer'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------left合并------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'left'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------right合并------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'right'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">--------left------</span><br><span class="line">    A   B key1 key2</span><br><span class="line"><span class="number">0</span>  A0  B0   K0   K0</span><br><span class="line"><span class="number">1</span>  A1  B1   K0   K1</span><br><span class="line"><span class="number">2</span>  A2  B2   K1   K0</span><br><span class="line"><span class="number">3</span>  A3  B3   K2   K1</span><br><span class="line">--------right------</span><br><span class="line">    C   D key1 key2</span><br><span class="line"><span class="number">0</span>  C0  D0   K0   K0</span><br><span class="line"><span class="number">1</span>  C1  D1   K1   K0</span><br><span class="line"><span class="number">2</span>  C2  D2   K1   K0</span><br><span class="line"><span class="number">3</span>  C3  D3   K2   K0</span><br><span class="line">--------inner合并------</span><br><span class="line">    A   B key1 key2   C   D</span><br><span class="line"><span class="number">0</span>  A0  B0   K0   K0  C0  D0</span><br><span class="line"><span class="number">1</span>  A2  B2   K1   K0  C1  D1</span><br><span class="line"><span class="number">2</span>  A2  B2   K1   K0  C2  D2</span><br><span class="line">--------outer合并------</span><br><span class="line">     A    B key1 key2    C    D</span><br><span class="line"><span class="number">0</span>   A0   B0   K0   K0   C0   D0</span><br><span class="line"><span class="number">1</span>   A1   B1   K0   K1  NaN  NaN</span><br><span class="line"><span class="number">2</span>   A2   B2   K1   K0   C1   D1</span><br><span class="line"><span class="number">3</span>   A2   B2   K1   K0   C2   D2</span><br><span class="line"><span class="number">4</span>   A3   B3   K2   K1  NaN  NaN</span><br><span class="line"><span class="number">5</span>  NaN  NaN   K2   K0   C3   D3</span><br><span class="line">--------left合并------</span><br><span class="line">    A   B key1 key2    C    D</span><br><span class="line"><span class="number">0</span>  A0  B0   K0   K0   C0   D0</span><br><span class="line"><span class="number">1</span>  A1  B1   K0   K1  NaN  NaN</span><br><span class="line"><span class="number">2</span>  A2  B2   K1   K0   C1   D1</span><br><span class="line"><span class="number">3</span>  A2  B2   K1   K0   C2   D2</span><br><span class="line"><span class="number">4</span>  A3  B3   K2   K1  NaN  NaN</span><br><span class="line">--------right合并------</span><br><span class="line">     A    B key1 key2   C   D</span><br><span class="line"><span class="number">0</span>   A0   B0   K0   K0  C0  D0</span><br><span class="line"><span class="number">1</span>   A2   B2   K1   K0  C1  D1</span><br><span class="line"><span class="number">2</span>   A2   B2   K1   K0  C2  D2</span><br><span class="line"><span class="number">3</span>  NaN  NaN   K2   K0  C3  D3</span><br></pre></td></tr></table></figure>
<h4 id="Indicator"><a href="#Indicator" class="headerlink" title="Indicator"></a>Indicator</h4><p>&emsp;&emsp;<code>indicator = True</code>会将合并的记录放在新的一列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">'col1'</span>: [<span class="number">0</span>, <span class="number">1</span>], <span class="string">'col_left'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">'col1'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="string">'col_right'</span>: [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">print(<span class="string">"-------df1-------"</span>)</span><br><span class="line">print(df1)</span><br><span class="line">print(<span class="string">"-------df2-------"</span>)</span><br><span class="line">print(df2)</span><br><span class="line">print(<span class="string">"-------启用indicator-------"</span>)</span><br><span class="line"><span class="comment"># 依据col1进行合并，并启用“indicator = True”</span></span><br><span class="line">res = pd.merge(df1, df2, on=<span class="string">'col1'</span>, how=<span class="string">'outer'</span>, indicator=<span class="keyword">True</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-------自定义名称-------"</span>)</span><br><span class="line"><span class="comment"># 自定义“indicator column”的名称</span></span><br><span class="line">res = pd.merge(df1, df2, on=<span class="string">'col1'</span>, how=<span class="string">'outer'</span>, indicator=<span class="string">'indicator_column'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-------df1-------</span><br><span class="line">   col1 col_left</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>        a</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>        b</span><br><span class="line">-------df2-------</span><br><span class="line">   col1  col_right</span><br><span class="line"><span class="number">0</span>     <span class="number">1</span>          <span class="number">2</span></span><br><span class="line"><span class="number">1</span>     <span class="number">2</span>          <span class="number">2</span></span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>          <span class="number">2</span></span><br><span class="line">-------启用indicator-------</span><br><span class="line">   col1 col_left  col_right      _merge</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>        a        NaN   left_only</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>        b        <span class="number">2.0</span>        both</span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>  right_only</span><br><span class="line"><span class="number">3</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>  right_only</span><br><span class="line">-------自定义名称-------</span><br><span class="line">   col1 col_left  col_right indicator_column</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>        a        NaN        left_only</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>        b        <span class="number">2.0</span>             both</span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>       right_only</span><br><span class="line"><span class="number">3</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>       right_only</span><br></pre></td></tr></table></figure>
<h4 id="依据index合并"><a href="#依据index合并" class="headerlink" title="依据index合并"></a>依据index合并</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'A'</span>: [<span class="string">'A0'</span>, <span class="string">'A1'</span>, <span class="string">'A2'</span>],</span><br><span class="line">     <span class="string">'B'</span>: [<span class="string">'B0'</span>, <span class="string">'B1'</span>, <span class="string">'B2'</span>]&#125;,</span><br><span class="line">    index=[<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>])</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'C'</span>: [<span class="string">'C0'</span>, <span class="string">'C2'</span>, <span class="string">'C3'</span>],</span><br><span class="line">     <span class="string">'D'</span>: [<span class="string">'D0'</span>, <span class="string">'D2'</span>, <span class="string">'D3'</span>]&#125;,</span><br><span class="line">    index=[<span class="string">'K0'</span>, <span class="string">'K2'</span>, <span class="string">'K3'</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="string">"-----left-----"</span>)</span><br><span class="line">print(left)</span><br><span class="line">print(<span class="string">"-----right-----"</span>)</span><br><span class="line">print(right)</span><br><span class="line">print(<span class="string">"-----outer合并-----"</span>)</span><br><span class="line">res = pd.merge(left, right, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----inner合并-----"</span>)</span><br><span class="line">res = pd.merge(left, right, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<h3 id="解决overlapping的问题"><a href="#解决overlapping的问题" class="headerlink" title="解决overlapping的问题"></a>解决overlapping的问题</h3><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">boys = pd.DataFrame(&#123;<span class="string">'k'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>], <span class="string">'age'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">girls = pd.DataFrame(&#123;<span class="string">'k'</span>: [<span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K3'</span>], <span class="string">'age'</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</span><br><span class="line"><span class="comment"># 使用suffixes解决overlapping的问题</span></span><br><span class="line">res = pd.merge(boys, girls, on=<span class="string">'k'</span>, suffixes=[<span class="string">'_boy'</span>, <span class="string">'_girl'</span>], how=<span class="string">'inner'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   age_boy   k  age_girl</span><br><span class="line"><span class="number">0</span>        <span class="number">1</span>  K0         <span class="number">4</span></span><br><span class="line"><span class="number">1</span>        <span class="number">1</span>  K0         <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h3 id="读取csv文件"><a href="#读取csv文件" class="headerlink" title="读取csv文件"></a>读取csv文件</h3><p>&emsp;&emsp;假设<code>csv</code>文件内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name,physics,python,math,english</span><br><span class="line">Google,<span class="number">100</span>,<span class="number">100</span>,<span class="number">25</span>,<span class="number">12</span></span><br><span class="line">Facebook,<span class="number">45</span>,<span class="number">54</span>,<span class="number">44</span>,<span class="number">88</span></span><br><span class="line">Twitter,<span class="number">54</span>,<span class="number">76</span>,<span class="number">13</span>,<span class="number">91</span></span><br><span class="line">Yahoo,<span class="number">54</span>,<span class="number">452</span>,<span class="number">26</span>,<span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>使用<code>Pandas</code>进行读取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">marks = pd.read_csv(<span class="string">"test.csv"</span>)</span><br><span class="line">print(marks)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       name  physics  python  math  english</span><br><span class="line"><span class="number">0</span>    Google      <span class="number">100</span>     <span class="number">100</span>    <span class="number">25</span>       <span class="number">12</span></span><br><span class="line"><span class="number">1</span>  Facebook       <span class="number">45</span>      <span class="number">54</span>    <span class="number">44</span>       <span class="number">88</span></span><br><span class="line"><span class="number">2</span>   Twitter       <span class="number">54</span>      <span class="number">76</span>    <span class="number">13</span>       <span class="number">91</span></span><br><span class="line"><span class="number">3</span>     Yahoo       <span class="number">54</span>     <span class="number">452</span>    <span class="number">26</span>      <span class="number">100</span></span><br></pre></td></tr></table></figure>
<h3 id="get-dummies"><a href="#get-dummies" class="headerlink" title="get_dummies"></a>get_dummies</h3><p>&emsp;&emsp;<code>pandas</code>使用<code>get_dummies</code>进行<code>one-hot</code>编码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">xiaoming = pd.DataFrame([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">'yellow'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>], columns=[<span class="string">'hat'</span>])</span><br><span class="line">print(xiaoming)</span><br><span class="line">print(<span class="string">"--------------"</span>)</span><br><span class="line">hat_ranks = pd.get_dummies(xiaoming[<span class="string">'hat'</span>], prefix=<span class="string">'hat'</span>)</span><br><span class="line">print(hat_ranks.head())</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        hat</span><br><span class="line">yellow    <span class="number">1</span></span><br><span class="line">red       <span class="number">2</span></span><br><span class="line">blue      <span class="number">3</span></span><br><span class="line">--------------</span><br><span class="line">        hat_1  hat_2  hat_3</span><br><span class="line">yellow      <span class="number">1</span>      <span class="number">0</span>      <span class="number">0</span></span><br><span class="line">red         <span class="number">0</span>      <span class="number">1</span>      <span class="number">0</span></span><br><span class="line">blue        <span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="keys函数"><a href="#keys函数" class="headerlink" title="keys函数"></a>keys函数</h3><p>&emsp;&emsp;Return a list of column names.</p>
<h3 id="Categorical函数"><a href="#Categorical函数" class="headerlink" title="Categorical函数"></a>Categorical函数</h3><p>&emsp;&emsp;该函数用于创建分组，主要有两种方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_categories = pd.Categorical([<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>])</span><br><span class="line">print(my_categories)  <span class="comment"># 输出“[foo, bar, baz, foo, bar]”</span></span><br><span class="line">categories = [<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]</span><br><span class="line">codes = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">my_cats_2 = pd.Categorical.from_codes(codes, categories, ordered=<span class="keyword">True</span>)</span><br><span class="line">print(my_cats_2)  <span class="comment"># 输出“[foo, bar, baz, foo, foo, bar]”</span></span><br></pre></td></tr></table></figure>
<h3 id="pandas-DataFrame-head"><a href="#pandas-DataFrame-head" class="headerlink" title="pandas.DataFrame.head"></a>pandas.DataFrame.head</h3><p>&emsp;&emsp;<code>DataFrame.head(n=5)</code>: Return the first <code>n</code> rows. This function returns the first <code>n</code> rows for the object based on position. It is useful for quickly testing if your object has the right type of data in it.<br>&emsp;&emsp;Examples:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(&#123;<span class="string">'animal'</span>:[<span class="string">'alligator'</span>, <span class="string">'bee'</span>, <span class="string">'falcon'</span>, <span class="string">'lion'</span>,</span><br><span class="line"><span class="meta">... </span>                   <span class="string">'monkey'</span>, <span class="string">'parrot'</span>, <span class="string">'shark'</span>, <span class="string">'whale'</span>, <span class="string">'zebra'</span>]&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df</span><br><span class="line">      animal</span><br><span class="line"><span class="number">0</span>  alligator</span><br><span class="line"><span class="number">1</span>        bee</span><br><span class="line"><span class="number">2</span>     falcon</span><br><span class="line"><span class="number">3</span>       lion</span><br><span class="line"><span class="number">4</span>     monkey</span><br><span class="line"><span class="number">5</span>     parrot</span><br><span class="line"><span class="number">6</span>      shark</span><br><span class="line"><span class="number">7</span>      whale</span><br><span class="line"><span class="number">8</span>      zebra</span><br></pre></td></tr></table></figure>
<p>Viewing the first <code>5</code> lines:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.head()</span><br><span class="line">      animal</span><br><span class="line"><span class="number">0</span>  alligator</span><br><span class="line"><span class="number">1</span>        bee</span><br><span class="line"><span class="number">2</span>     falcon</span><br><span class="line"><span class="number">3</span>       lion</span><br><span class="line"><span class="number">4</span>     monkey</span><br></pre></td></tr></table></figure>
<p>Viewing the first <code>n</code> lines (three in this case):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.head(<span class="number">3</span>)</span><br><span class="line">      animal</span><br><span class="line"><span class="number">0</span>  alligator</span><br><span class="line"><span class="number">1</span>        bee</span><br><span class="line"><span class="number">2</span>     falcon</span><br></pre></td></tr></table></figure>
<h3 id="pandas-factorize"><a href="#pandas-factorize" class="headerlink" title="pandas.factorize"></a>pandas.factorize</h3><p>&emsp;&emsp;<code>pandas.factorize(values, sort=False, order=None, na_sentinel=-1, size_hint=None)</code>: Encode the object as an enumerated type or categorical variable.<br>&emsp;&emsp;This method is useful for obtaining a numeric representation of an array when all that matters is identifying distinct <code>values</code>. <code>factorize</code> is available as both a <code>top-level</code> function <code>pandas.factorize()</code>, and as a method <code>Series.factorize()</code> and <code>Index.factorize()</code>.<br>&emsp;&emsp;Parameters:</p>
<ul>
<li><code>values</code>: <code>sequence</code>. A <code>1-D</code> <code>seqeunce</code>. Sequences that aren’t pandas objects are coereced to <code>ndarrays</code> before factorization.</li>
<li><code>sort</code>: <code>bool</code>, default <code>False</code>. Sort uniques and shuffle labels to maintain the relationship.</li>
<li><code>order</code>: Deprecated since <code>version 0.23.0</code>: This parameter has no effect and is deprecated.</li>
<li><code>na_sentinel</code>: <code>int</code>, default <code>-1</code>. Value to mark <code>not found</code>.</li>
<li><code>size_hint</code>: <code>int</code>, optional. Hint to the hashtable sizer.</li>
</ul>
<p>&emsp;&emsp;Returns:</p>
<ul>
<li><code>labels</code>: <code>ndarray</code>. An integer <code>ndarray</code> that’s an indexer into uniques. <code>uniques.take(labels)</code> will have the same values as <code>values</code>.</li>
<li><code>uniques</code>: <code>ndarray</code>, <code>Index</code>, or <code>Categorical</code>. The unique valid <code>values</code>. When <code>values</code> is <code>Categorical</code>, <code>uniques</code> is a <code>Categorical</code>. When <code>values</code> is some other pandas object, an <code>Index</code> is returned. Otherwise, a <code>1-D</code> <code>ndarray</code> is returned.</li>
</ul>
<p>&emsp;&emsp;<strong>Note</strong>: Even if there’s a missing value in <code>values</code>, <code>uniques</code> will not contain an entry for it.<br>&emsp;&emsp;<strong>Examples</strong>: These examples all show <code>factorize</code> as a <code>top-level</code> method like <code>pd.factorize(values)</code>. The results are identical for methods like <code>Series.factorize()</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize([<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">array([<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>], dtype=object)</span><br></pre></td></tr></table></figure>
<p>With <code>sort=True</code>, the uniques will be sorted, and labels will be shuffled so that the relationship is the maintained.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize([<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>], sort=<span class="keyword">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">array([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], dtype=object)</span><br></pre></td></tr></table></figure>
<p>Missing values are indicated in labels with <code>na_sentinel</code> (<code>-1</code> by default). Note that missing values are never included in uniques.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize([<span class="string">'b'</span>, <span class="keyword">None</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([ <span class="number">0</span>, <span class="number">-1</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">array([<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>], dtype=object)</span><br></pre></td></tr></table></figure>
<p>Thus far, we’ve only factorized lists (which are internally coerced to <code>NumPy</code> arrays). When factorizing <code>pandas</code> objects, the type of uniques will differ. For <code>Categoricals</code>, a <code>Categorical</code> is returned.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cat = pd.Categorical([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>], categories=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize(cat)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">[a, c]</span><br><span class="line">Categories (<span class="number">3</span>, object): [a, b, c]</span><br></pre></td></tr></table></figure>
<p>Notice that <code>b</code> is in <code>uniques.categories</code>, desipite not being present in <code>cat.values</code>. For all other pandas objects, an <code>Index</code> of the appropriate type is returned.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cat = pd.Series([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize(cat)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">Index([<span class="string">'a'</span>, <span class="string">'c'</span>], dtype=<span class="string">'object'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="pandas-crosstab"><a href="#pandas-crosstab" class="headerlink" title="pandas.crosstab"></a>pandas.crosstab</h3><p>&emsp;&emsp;<code>pandas.crosstab(index, columns, values=None, rownames=None, colnames=None, aggfunc=None, margins=False, margins_name=&#39;All&#39;, dropna=True, normalize=False)</code>: Compute a simple <code>cross-tabulation</code> of two (or more) factors. By default computes a frequency table of the factors unless an array of <code>values</code> and an aggregation function are passed.<br>&emsp;&emsp;Parameters:</p>
<ul>
<li><code>index</code>: <code>array-like</code>, <code>Series</code>, or list of <code>arrays/Series</code>. Values to group by in the rows.</li>
<li><code>columns</code>: <code>array-like</code>, <code>Series</code>, or list of <code>arrays/Series</code>. Values to group by in the columns.</li>
<li><code>values</code>: <code>array-like</code>, optional. Array of <code>values</code> to aggregate according to the factors. Requires <code>aggfunc</code> be specified.</li>
<li><code>aggfunc</code>: function, optional. If specified, requires <code>values</code> be specified as well.</li>
<li><code>rownames</code>: <code>sequence</code>, default <code>None</code>. If passed, must match number of row arrays passed.</li>
<li><code>colnames</code>: <code>sequence</code>, default <code>None</code>. If passed, must match number of column arrays passed.</li>
<li><code>margins</code>: <code>boolean</code>, default <code>False</code>. Add <code>row/column</code> margins (<code>subtotals</code>).</li>
<li><code>margins_name</code>: <code>string</code>, default <code>All</code>. Name of the <code>row/column</code> that will contain the totals when margins is <code>True</code>.</li>
<li><code>dropna</code>: <code>boolean</code>, default <code>True</code>. Do not include columns whose entries are all <code>NaN</code>.</li>
<li><code>normalize</code>: <code>boolean</code>, {<code>all</code>, <code>index</code>, <code>columns</code>}, or {<code>0</code>, <code>1</code>}, default <code>False</code>. Normalize by dividing all values by the sum of <code>values</code>.</li>
</ul>
<ol>
<li>If passed <code>all</code> or <code>True</code>, will normalize over all values.</li>
<li>If passed <code>index</code> will normalize over each row.</li>
<li>If passed <code>columns</code> will normalize over each column.</li>
<li>If <code>margins</code> is <code>True</code>, will also normalize margin values.</li>
</ol>
<p>&emsp;&emsp;Any <code>Series</code> passed will have their name attributes used unless row or column names for the <code>cross-tabulation</code> are specified.<br>&emsp;&emsp;Any input passed containing <code>Categorical</code> data will have all of its categories included in the <code>cross-tabulation</code>, even if the actual data does not contain any instances of a particular category.<br>&emsp;&emsp;In the event that there aren’t overlapping indexes, an empty <code>DataFrame</code> will be returned.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.array([<span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"bar"</span>,</span><br><span class="line"><span class="meta">... </span>              <span class="string">"bar"</span>, <span class="string">"bar"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>], dtype=object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = np.array([<span class="string">"one"</span>, <span class="string">"one"</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"one"</span>, <span class="string">"one"</span>,</span><br><span class="line"><span class="meta">... </span>              <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"two"</span>, <span class="string">"two"</span>, <span class="string">"one"</span>], dtype=object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = np.array([<span class="string">"dull"</span>, <span class="string">"dull"</span>, <span class="string">"shiny"</span>, <span class="string">"dull"</span>, <span class="string">"dull"</span>, <span class="string">"shiny"</span>,</span><br><span class="line"><span class="meta">... </span>              <span class="string">"shiny"</span>, <span class="string">"dull"</span>, <span class="string">"shiny"</span>, <span class="string">"shiny"</span>, <span class="string">"shiny"</span>], dtype=object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pd.crosstab(a, [b, c], rownames=[<span class="string">'a'</span>], colnames=[<span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">b   one        two</span><br><span class="line">c   dull shiny dull shiny</span><br><span class="line">a</span><br><span class="line">bar    <span class="number">1</span>     <span class="number">2</span>    <span class="number">1</span>     <span class="number">0</span></span><br><span class="line">foo    <span class="number">2</span>     <span class="number">2</span>    <span class="number">1</span>     <span class="number">2</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo = pd.Categorical([<span class="string">'a'</span>, <span class="string">'b'</span>], categories=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar = pd.Categorical([<span class="string">'d'</span>, <span class="string">'e'</span>], categories=[<span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>])</span><br><span class="line"><span class="comment"># 'c' and 'f' are not represented in the data,</span></span><br><span class="line"><span class="comment"># but they still will be counted in the output</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>crosstab(foo, bar)</span><br><span class="line">col_0  d  e  f</span><br><span class="line">row_0</span><br><span class="line">a      <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">b      <span class="number">0</span>  <span class="number">1</span>  <span class="number">0</span></span><br><span class="line">c      <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/itertools模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/itertools模块/" itemprop="url">itertools模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T20:31:27+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python</code>提供了一个非常棒的模块用于创建自定义的迭代器，这个模块就是<code>itertools</code>。<code>itertools</code>提供的工具相当高效且节省内存，使用这些工具，你将能够创建自己定制的迭代器用于高效率的循环。</p>
<h3 id="无限迭代器"><a href="#无限迭代器" class="headerlink" title="无限迭代器"></a>无限迭代器</h3><p>&emsp;&emsp;<code>itertools</code>包自带了三个可以无限迭代的迭代器，这意味着当你使用它们时，需要知道到底是最终会停止迭代器，还是需要无限地迭代下去。这些无限迭代器在生成数字或者在长度未知的可迭代对象(<code>iterables</code>)中循环时相当有用。</p>
<h4 id="count-初值-0-步长-1"><a href="#count-初值-0-步长-1" class="headerlink" title="count(初值=0, 步长=1)"></a>count(初值=0, 步长=1)</h4><p>&emsp;&emsp;<code>count</code>迭代器会返回从传入的起始参数开始的均匀间隔的数值。<code>count</code>也可以接收指定的步长参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> count(<span class="number">18</span>):</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">19</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;另一种控制无限迭代器输出的方式是使用<code>itertools</code>的子模块<code>islice</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> islice, count</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(<span class="number">10</span>), <span class="number">5</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure>
<p><code>islice</code>的第二个参数控制何时停止迭代，其含义并不是<code>达到数字5时停止</code>，而是<code>当迭代了5次之后停止</code>。</p>
<h4 id="cycle-可迭代对象"><a href="#cycle-可迭代对象" class="headerlink" title="cycle(可迭代对象)"></a>cycle(可迭代对象)</h4><p>&emsp;&emsp;<code>itertools</code>中的<code>cycle</code>迭代器允许你创建一个能在一组值间无限循环的迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> cycle</span><br><span class="line">​</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cycle(<span class="string">'XYZ'</span>):</span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(item)</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X</span><br><span class="line">Y</span><br><span class="line">Z</span><br><span class="line">X</span><br><span class="line">Y</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;你也可以用<code>Python</code>内建的<code>next</code>函数对<code>itertools</code>创建的迭代器进行循环：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>polys = [<span class="string">'triangle'</span>, <span class="string">'square'</span>, <span class="string">'pentagon'</span>, <span class="string">'rectangle'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iterator = cycle(polys)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'triangle'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'square'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'pentagon'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'rectangle'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'triangle'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'square'</span></span><br></pre></td></tr></table></figure>
<p>上面的代码中，我们创建一个简单的多边形组成的列表，然后传入<code>cycle</code>。我们用一个变量存储新建的迭代器，然后将这个变量传入<code>next</code>函数。每一次调用<code>next</code>，都将返回迭代器中的下一个值。由于迭代器是无限的，我们可以一直调用<code>next</code>而永远不会到尽头。</p>
<h4 id="repeat-对象-次数"><a href="#repeat-对象-次数" class="headerlink" title="repeat(对象[, 次数])"></a>repeat(对象[, 次数])</h4><p>&emsp;&emsp;<code>repeat</code>迭代器会一遍遍地返回传入的对象直至永远，除非你设定了<code>times</code>参数。这与<code>cycle</code>非常相像，除了<code>repeat</code>不会在多个值之间循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> repeat</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repeat(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">repeat(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iterator = repeat(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  Python Shell, prompt <span class="number">21</span>, line <span class="number">1</span></span><br><span class="line">builtins.StopIteration:</span><br></pre></td></tr></table></figure>
<p>先导入<code>repeat</code>，然后设定其重复五次。接着连续六次调用<code>next</code>函数，观察它是否工作正常。当运行这段代码，将引发<code>StopIteration</code>，因为最后一次调用<code>next</code>函数时，迭代器中的值已经全部返回了。</p>
<h3 id="可终止的迭代器"><a href="#可终止的迭代器" class="headerlink" title="可终止的迭代器"></a>可终止的迭代器</h3><p>&emsp;&emsp;多数用<code>itertools</code>创建的迭代器并不是无限的。为了对于输出的可读的结果，我们将使用<code>Python</code>内建列表存储。如果不使用列表，你将只能打印出<code>itertools</code>对象。</p>
<h4 id="accumulate-可迭代对象-函数"><a href="#accumulate-可迭代对象-函数" class="headerlink" title="accumulate(可迭代对象[, 函数])"></a>accumulate(可迭代对象[, 函数])</h4><p>&emsp;&emsp;<code>accumulate</code>迭代器将返回累计求和结果，或者传入两个参数的话，由传入的函数累积计算的结果。默认设定为相加。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> accumulate</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(accumulate(range(<span class="number">10</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">28</span>, <span class="number">36</span>, <span class="number">45</span>]</span><br></pre></td></tr></table></figure>
<p>导入了<code>accumulate</code>，然后传入<code>10</code>个数字(<code>0</code>至<code>9</code>)。迭代器将传入数字依次累加，所以第一个是<code>0</code>，第二个是<code>0 + 1</code>，第三个是<code>1 + 2</code>，以此类推。现在导入<code>operator</code>模块，然后添加进去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(accumulate(range(<span class="number">1</span>, <span class="number">5</span>), operator.mul))</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>]</span><br></pre></td></tr></table></figure>
<p>这里传入了数字<code>1</code>至<code>4</code>到<code>accumulate</code>迭代器中，还传入了一个函数<code>operator.mul</code>，这个函数将接收的参数相乘。</p>
<h4 id="chain-可迭代对象"><a href="#chain-可迭代对象" class="headerlink" title="chain(*可迭代对象)"></a>chain(*可迭代对象)</h4><p>&emsp;&emsp;<code>chain</code>迭代器能够将多个可迭代对象合并成一个更长的可迭代对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">​</span><br><span class="line">cmd = [<span class="string">'ls'</span>, <span class="string">'/some/dir'</span>]</span><br><span class="line">numbers = list(range(<span class="number">5</span>))</span><br><span class="line">my_list = list(chain([<span class="string">'foo'</span>, <span class="string">'bar'</span>], cmd, numbers))</span><br><span class="line">print(my_list)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'ls'</span>, <span class="string">'/some/dir'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>实际上不使用<code>itertools</code>，也有其他方法能够实现这一要求：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list = [<span class="string">'foo'</span>, <span class="string">'bar'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list += cmd + numbers</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list</span><br><span class="line">[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'ls'</span>, <span class="string">'/some/dir'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<h4 id="chain-from-iterable-可迭代对象"><a href="#chain-from-iterable-可迭代对象" class="headerlink" title="chain.from_iterable(可迭代对象)"></a>chain.from_iterable(可迭代对象)</h4><p>&emsp;&emsp;你也可以用<code>chain</code>的一个方法，叫做<code>from_iterable</code>，这个方法与直接用<code>chain</code>有些细微的差别。不同于直接传入一系列可迭代对象，你必须传入一个嵌套的列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numbers = list(range(<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cmd = [<span class="string">'ls'</span>, <span class="string">'/some/dir'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chain.from_iterable(cmd, numbers)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  Python Shell, prompt <span class="number">66</span>, line <span class="number">1</span></span><br><span class="line">builtins.TypeError: from_iterable() takes exactly one argument (<span class="number">2</span> given)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(chain.from_iterable([cmd, numbers]))</span><br><span class="line">[<span class="string">'ls'</span>, <span class="string">'/some/dir'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>我们尝试传入两个列表，但却出现了<code>TypeError</code>。为了修正这个错误，我们将<code>cmd</code>和<code>numbers</code>放入一个列表中，将这个嵌套的列表传入<code>from_iterable</code>。</p>
<h4 id="compress-数据-选择器"><a href="#compress-数据-选择器" class="headerlink" title="compress(数据, 选择器)"></a>compress(数据, 选择器)</h4><p>&emsp;&emsp;子模块<code>compress</code>在用一个可迭代对象过滤另一个可迭代对象时十分有用，这是通过将作为选择器的可迭代对象取为布尔值列表来实现的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> compress</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters = <span class="string">'ABCDEFG'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bools = [<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(compress(letters, bools))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>]</span><br></pre></td></tr></table></figure>
<p><code>compress</code>函数将交替查看两个可迭代对象。先检查第一个可迭代对象，然后是第二个，如果第二个的元素为<code>True</code>，则保留第一个对应元素；如果为<code>False</code>，则丢弃第一个对应元素。</p>
<h4 id="dropwhile-断言-可迭代对象"><a href="#dropwhile-断言-可迭代对象" class="headerlink" title="dropwhile(断言, 可迭代对象)"></a>dropwhile(断言, 可迭代对象)</h4><p>&emsp;&emsp;<code>itertools</code>还提供了迭代器<code>dropwhile</code>，只要过滤器判定是<code>True</code>，<code>dropwhile</code>迭代器就会排除这些元素。因此，在出现断言为<code>False</code>之前，你不会看到任何输出结果。这可能导致启动时间非常长，这点应当注意。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> dropwhile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(dropwhile(<span class="keyword">lambda</span> x: x &lt; <span class="number">5</span>, [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">1</span>]))</span><br><span class="line">[<span class="number">6</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>先导入<code>dropwhile</code>，然后传入一个简单的<code>lambda</code>声明的函数：如果<code>x</code>小于<code>5</code>，<code>lambda</code>将返回<code>True</code>，否则返回<code>False</code>。<code>dropwhile</code>将遍历整个列表，然后将每个元素传入<code>lambda</code>。如果<code>lambda</code>返回<code>True</code>，则舍弃该值。一旦遇到了数字<code>6</code>，<code>lambda</code>将返回<code>False</code>，因此将保留数字<code>6</code>以及之后余下的元素。<br>&emsp;&emsp;当然也可以采用一般的函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> dropwhile</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than_five</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x &gt; <span class="number">5</span></span><br><span class="line">​</span><br><span class="line">my_list = list(dropwhile(greater_than_five, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>]))</span><br><span class="line">print(my_list)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<h4 id="filterfalse-断言-可迭代对象"><a href="#filterfalse-断言-可迭代对象" class="headerlink" title="filterfalse(断言, 可迭代对象)"></a>filterfalse(断言, 可迭代对象)</h4><p>&emsp;&emsp;<code>itertools</code>中的<code>filterfalse</code>函数与<code>dropwhile</code>非常类似，只是<code>filterfalse</code>返回断言为<code>False</code>的那些值，而不是舍弃断言为<code>True</code>的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> filterfalse</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than_five</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x &gt; <span class="number">5</span></span><br><span class="line">​</span><br><span class="line">my_list = list(filterfalse(greater_than_five, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>]))</span><br><span class="line">print(my_list)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>如果整数值小于<code>5</code>，这个整数将保留下来，否则将被舍弃。注意到，这里的结果仅有<code>1</code>、<code>2</code>和<code>3</code>。与<code>dropwhile</code>不同，<code>filterfalse</code>将对全部的值进行条件判断。</p>
<h4 id="groupby-可迭代对象-键-None"><a href="#groupby-可迭代对象-键-None" class="headerlink" title="groupby(可迭代对象, 键=None)"></a>groupby(可迭代对象, 键=None)</h4><p>&emsp;&emsp;将<code>key</code>函数作用于原循环器的各个元素，根据<code>key</code>函数结果，将拥有相同函数结果的元素分到一个新的循环器。每个新的循环器以函数返回结果为标签。<br>&emsp;&emsp;这就好像一群人的身高作为循环器，我们可以使用这样一个<code>key</code>函数：如果身高大于<code>180</code>，返回<code>tall</code>；如果身高低于<code>160</code>，返回<code>short</code>；中间的返回<code>middle</code>。最终，所有身高将分为三个循环器，即<code>tall</code>、<code>short</code>、<code>middle</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">height_class</span><span class="params">(h)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> h &gt; <span class="number">180</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'tall'</span></span><br><span class="line">    <span class="keyword">elif</span> h &lt; <span class="number">160</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'short'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'middle'</span></span><br><span class="line">​</span><br><span class="line">friends = [<span class="number">191</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">165</span>, <span class="number">170</span>, <span class="number">177</span>, <span class="number">181</span>, <span class="number">182</span>, <span class="number">190</span>]</span><br><span class="line">friends = sorted(friends, key=height_class)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m, n <span class="keyword">in</span> groupby(friends, key=height_class):</span><br><span class="line">    print(m, list(n))</span><br><span class="line">    print(<span class="string">"---------"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">middle [<span class="number">165</span>, <span class="number">170</span>, <span class="number">177</span>]</span><br><span class="line">---------</span><br><span class="line">short [<span class="number">158</span>, <span class="number">159</span>]</span><br><span class="line">---------</span><br><span class="line">tall [<span class="number">191</span>, <span class="number">181</span>, <span class="number">182</span>, <span class="number">190</span>]</span><br><span class="line">---------</span><br></pre></td></tr></table></figure>
<p><code>groupby</code>的功能类似于<code>UNIX</code>中的<code>uniq</code>命令。分组之前需要使用<code>sorted</code>对原循环器的元素，根据<code>key</code>函数进行排序，让同组元素先在位置上靠拢。</p>
<h4 id="islice-可迭代变量-起始值-终止值-步长"><a href="#islice-可迭代变量-起始值-终止值-步长" class="headerlink" title="islice(可迭代变量, 起始值, 终止值[, 步长])"></a>islice(可迭代变量, 起始值, 终止值[, 步长])</h4><p>&emsp;&emsp;<code>islice</code>是一个返回可迭代对象选定元素的迭代器。简而言之，<code>islice</code>所做的是利用可迭代对象的索引实现切片，然后以迭代器的形式返回所选元素。实际上<code>islice</code>有两种实现方式，一种是<code>itertools.islice(iterable, stop)</code>，还有一种更符合<code>Python</code>惯例的形式：<code>islice(iterable, start, stop[, step])</code>。来看看第一种形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> islice</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iterator = islice(<span class="string">'123456'</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'1'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'2'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'3'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'4'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  Python Shell, prompt <span class="number">15</span>, line <span class="number">1</span></span><br><span class="line">builtins.StopIteration:</span><br></pre></td></tr></table></figure>
<p>在以上的代码中，我们传入了一个<code>6</code>个字符组成的字符串以及终止参数<code>4</code>给<code>isilce</code>。这表示<code>islice</code>返回的迭代器将包含传入字符串的前<code>4</code>个字符。为了验证，我们连续四次调用<code>next</code>函数。<code>Python</code>能够智能地识别是否只有<code>2</code>个传入参数，若是，则第二个参数就取为终止参数。<br>&emsp;&emsp;我们再试试传入三个参数来验证是否可以同时传入起始值和终止值。<code>count</code>工具可以帮助我们解释这一概念：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> islice</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(), <span class="number">3</span>, <span class="number">7</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>这里我们调用了<code>count</code>，并指定<code>islice</code>从<code>3</code>开始，到<code>7</code>时结束。这和使用<code>slice</code>效果是一样的，不同之处在于传入的是迭代器，返回的是新的迭代器。</p>
<h4 id="starmap-函数-可迭代对象"><a href="#starmap-函数-可迭代对象" class="headerlink" title="starmap(函数, 可迭代对象)"></a>starmap(函数, 可迭代对象)</h4><p>&emsp;&emsp;<code>starmap</code>工具能够创建一个用传入的函数和可迭代对象计算的迭代器。如文档中所言，<code>map</code>和<code>starmap</code>的区别正如<code>function(a, b)</code>和<code>function(*c)</code>的区别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> starmap</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> starmap(add, [(<span class="number">2</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">5</span>)]):</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>这里先创建了一个接受两个参数的求和函数，接下来创建了一个<code>for</code>循环，并调用<code>starmap</code>函数。<code>starmap</code>函数的第一个传入参数是创建的求和函数，第二个传入参数是元组构成的列表。<code>starmap</code>函数接着会将每一个元组传入求和函数，然后将结果返回到迭代器。</p>
<h4 id="takewhile-断言-可迭代对象"><a href="#takewhile-断言-可迭代对象" class="headerlink" title="takewhile(断言, 可迭代对象)"></a>takewhile(断言, 可迭代对象)</h4><p>&emsp;&emsp;<code>takewhile</code>模块与<code>dropwhile</code>迭代器刚好相反。<code>takewhile</code>所创建的迭代器，一旦可迭代对象的断言或过滤器结果为<code>True</code>，就返回元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> takewhile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(takewhile(<span class="keyword">lambda</span> x: x &lt; <span class="number">5</span>, [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">1</span>]))</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>运行<code>takewhile</code>时传入了一个<code>lambda</code>函数和一个列表，输出的仅是可迭代对象的前两个整数元素。因为<code>1</code>和<code>4</code>都小于<code>5</code>，而<code>6</code>大于<code>5</code>，一旦<code>takewhile</code>遇到<code>6</code>，判定条件结果将是<code>False</code>，可迭代对象余下的元素将会被忽略。</p>
<h4 id="tee-可迭代对象-n-2"><a href="#tee-可迭代对象-n-2" class="headerlink" title="tee(可迭代对象, n=2)"></a>tee(可迭代对象, n=2)</h4><p>&emsp;&emsp;<code>tee</code>工具能够从一个可迭代对象创建n个迭代器，这意味着你能够用一个可迭代对象创建多个迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> tee</span><br><span class="line">​</span><br><span class="line">data = <span class="string">'ABC'</span></span><br><span class="line">iter1, iter2 = tee(data)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> iter1:</span><br><span class="line">    print(item)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"----------"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> iter2:</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line">----------</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br></pre></td></tr></table></figure>
<p>这里创建了一个<code>5</code>个字母组成的字符串，然后传入<code>tee</code>。由于<code>tee</code>的默认参数是<code>2</code>，所以用两个变量接收<code>tee</code>返回的两个迭代器。最后，分别遍历了这两个迭代器，并打印出它们的内容。如你所见，它们的内容是相同的。</p>
<h4 id="zip-longest-可迭代对象-填充值-None"><a href="#zip-longest-可迭代对象-填充值-None" class="headerlink" title="zip_longest(*可迭代对象, 填充值=None)"></a>zip_longest(*可迭代对象, 填充值=None)</h4><p>&emsp;&emsp;<code>zip_longest</code>迭代器可以用于将两个可迭代对象配对。如果可迭代对象的长度不同，也可以传入填充值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> zip_longest(<span class="string">'ABCD'</span>, <span class="string">'xy'</span>, fillvalue=<span class="string">'BLANK'</span>):</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">'A'</span>, <span class="string">'x'</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="string">'y'</span>)</span><br><span class="line">(<span class="string">'C'</span>, <span class="string">'BLANK'</span>)</span><br><span class="line">(<span class="string">'D'</span>, <span class="string">'BLANK'</span>)</span><br></pre></td></tr></table></figure>
<p>先导入<code>zip_longest</code>，然后传入两个需要配对的字符串。你会发现，第一个字符串有<code>4</code>个字符，而第二个只有<code>2</code>个字符。我们还传入了填充值<code>BLANK</code>。当遍历并打印的时候，会看到返回的是元组。前两个元组是分别来自两个字符串第一个和第二个字母的组合，后两个则插入了填充值。<br>&emsp;&emsp;需要注意的是，如果传入<code>zip_longest</code>的可迭代对象是无限的，那么你应该用类似<code>islice</code>的工具在外部处理函数，以便控制调用的次数。</p>
<h3 id="组合生成器"><a href="#组合生成器" class="headerlink" title="组合生成器"></a>组合生成器</h3><p>&emsp;&emsp;<code>itertools</code>库提供了四个可用于生成数据排列和组合的迭代器。</p>
<h4 id="combinations-可迭代对象-r"><a href="#combinations-可迭代对象-r" class="headerlink" title="combinations(可迭代对象, r)"></a>combinations(可迭代对象, r)</h4><p>&emsp;&emsp;如果你需要生成数据的组合，<code>Python</code>已经为你准备了<code>itertools.combinations</code>。<code>combinations</code>能够让你通过有一定长度的可迭代对象创建一个迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(combinations(<span class="string">'WXYZ'</span>, <span class="number">2</span>))</span><br><span class="line">[(<span class="string">'W'</span>, <span class="string">'X'</span>), (<span class="string">'W'</span>, <span class="string">'Y'</span>), (<span class="string">'W'</span>, <span class="string">'Z'</span>), (<span class="string">'X'</span>, <span class="string">'Y'</span>), (<span class="string">'X'</span>, <span class="string">'Z'</span>), (<span class="string">'Y'</span>, <span class="string">'Z'</span>)]</span><br></pre></td></tr></table></figure>
<p>当你运行这段代码时会发现，<code>combinations</code>返回组合是元组。为了使输出结果更具可读性，可以遍历迭代器将元组组合成字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> combinations(<span class="string">'WXYZ'</span>, <span class="number">2</span>):</span><br><span class="line">    print(<span class="string">''</span>.join(item))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WX</span><br><span class="line">WY</span><br><span class="line">WZ</span><br><span class="line">XY</span><br><span class="line">XZ</span><br><span class="line">YZ</span><br></pre></td></tr></table></figure>
<p>注意，<code>combinations</code>函数得到的组合是依循词典顺序的，因而如果传入的可迭代对象已经排序，那么你得到的组合元组也将是按序的。还有一点值得注意，<code>combinations</code>函数不会将每个单独的元素自己跟自己组合。</p>
<h4 id="combinations-with-replacement-可迭代对象-r"><a href="#combinations-with-replacement-可迭代对象-r" class="headerlink" title="combinations_with_replacement(可迭代对象, r)"></a>combinations_with_replacement(可迭代对象, r)</h4><p>&emsp;&emsp;<code>combinationa_with_replacement</code>迭代器与<code>combinations</code>非常类似。唯一的区别是，它会创建元素自己与自己的组合。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations_with_replacement</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> combinations_with_replacement(<span class="string">'WXYZ'</span>, <span class="number">2</span>):</span><br><span class="line">    print(<span class="string">''</span>.join(item))</span><br></pre></td></tr></table></figure>
<h4 id="product-可迭代对象-重复-1"><a href="#product-可迭代对象-重复-1" class="headerlink" title="product(*可迭代对象, 重复=1)"></a>product(*可迭代对象, 重复=1)</h4><p>&emsp;&emsp;<code>product</code>用于根据一系列输入的可迭代对象计算笛卡尔积。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>arrays = [(<span class="number">-1</span>,<span class="number">1</span>), (<span class="number">-3</span>,<span class="number">3</span>), (<span class="number">-5</span>,<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cp = list(product(*arrays))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cp</span><br><span class="line">[(<span class="number">-1</span>, <span class="number">-3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">-1</span>, <span class="number">-3</span>, <span class="number">5</span>),</span><br><span class="line"> (<span class="number">-1</span>, <span class="number">3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">-1</span>, <span class="number">3</span>, <span class="number">5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">-3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">-3</span>, <span class="number">5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)]</span><br></pre></td></tr></table></figure>
<p>先导入<code>product</code>，然后创建一个元组构成的列表，用变量<code>arrays</code>储存，接下来将这些数组传入<code>product</code>函数，然后调用。你应该注意到，我们调用时使用了<code>*arrays</code>，这会使传入的列表被拆解，依次应用于<code>product</code>函数。这意味着你传入的将是三个变量而不是一个。</p>
<h4 id="permutations-可迭代变量-r"><a href="#permutations-可迭代变量-r" class="headerlink" title="permutations(可迭代变量, r)"></a>permutations(可迭代变量, r)</h4><p>&emsp;&emsp;<code>permutation</code>能够返回由传入的可迭代对象的元素构成的长度为<code>r</code>的排列。与<code>combination</code>函数类似，<code>permutation</code>将以词典序输出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> permutations(<span class="string">'WXYZ'</span>, <span class="number">2</span>):</span><br><span class="line">    print(<span class="string">''</span>.join(item))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WX</span><br><span class="line">WY</span><br><span class="line">WZ</span><br><span class="line">XW</span><br><span class="line">XY</span><br><span class="line">XZ</span><br><span class="line">YW</span><br><span class="line">YX</span><br><span class="line">YZ</span><br><span class="line">ZW</span><br><span class="line">ZX</span><br><span class="line">ZY</span><br></pre></td></tr></table></figure>
<p>容易发现，输出结果比<code>combinations</code>的输出结果长一些。<code>permutation</code>函数将遍历字符串的所有排列，但当输入元素是唯一的时候，不会让这个元素自己和自己排列。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/错误和异常/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/错误和异常/" itemprop="url">错误和异常</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T19:42:03+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python</code>有两种错误很容易辨认：语法错误和异常。<code>Python</code>标准异常总结如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>异常</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>断言语句(<code>assert</code>)失败</td>
</tr>
<tr>
<td><code>AttributeError</code></td>
<td>尝试访问未知的对象属性</td>
</tr>
<tr>
<td><code>EOFError</code></td>
<td>用户输入文件末尾标志<code>EOF</code>(<code>Ctrl + d</code>)</td>
</tr>
<tr>
<td><code>FloatingPointError</code></td>
<td>浮点计算错误</td>
</tr>
<tr>
<td><code>GeneratorExit</code></td>
<td><code>generator.close</code>方法被调用的时候</td>
</tr>
<tr>
<td><code>ImportError</code></td>
<td>导入模块失败的时候</td>
</tr>
<tr>
<td><code>IndexError</code></td>
<td>索引超出序列的范围</td>
</tr>
<tr>
<td><code>KeyError</code></td>
<td>字典中查找一个不存在的关键字</td>
</tr>
<tr>
<td><code>KeyboardInterrupt</code></td>
<td>用户输入中断键(<code>Ctrl + c</code>)</td>
</tr>
<tr>
<td><code>MemoryError</code></td>
<td>内存溢出(可通过删除对象释放内存)</td>
</tr>
<tr>
<td><code>NameError</code></td>
<td>尝试访问一个不存在的变量</td>
</tr>
<tr>
<td><code>NotImplementedError</code></td>
<td>尚未实现的方法</td>
</tr>
<tr>
<td><code>OSError</code></td>
<td>操作系统产生的异常(例如打开一个不存在的文件)</td>
</tr>
<tr>
<td><code>OverflowError</code></td>
<td>数值运算超出最大限制</td>
</tr>
<tr>
<td><code>ReferenceError</code></td>
<td>弱引用(<code>weak reference</code>)试图访问一个已经被垃圾回收机制回收了的对象</td>
</tr>
<tr>
<td><code>RuntimeError</code></td>
<td>一般的运行时错误</td>
</tr>
<tr>
<td><code>StopIteration</code></td>
<td>迭代器没有更多的值</td>
</tr>
<tr>
<td><code>SyntaxError</code></td>
<td><code>Python</code>的语法错误</td>
</tr>
<tr>
<td><code>IndentationError</code></td>
<td>缩进错误</td>
</tr>
<tr>
<td><code>TabError</code></td>
<td><code>Tab</code>和空格混合使用</td>
</tr>
<tr>
<td><code>SystemError</code></td>
<td><code>Python</code>编译器系统错误</td>
</tr>
<tr>
<td><code>SystemExit</code></td>
<td><code>Python</code>编译器进程被关闭</td>
</tr>
<tr>
<td><code>TypeError</code></td>
<td>不同类型间的无效操作</td>
</tr>
<tr>
<td><code>UnboundLocalError</code></td>
<td>访问一个未初始化的本地变量(<code>NameError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeError</code></td>
<td><code>Unicode</code>相关的错误(<code>ValueError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeEncodeError</code></td>
<td><code>Unicode</code>编码时的错误(<code>UnicodeError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeDecodeError</code></td>
<td><code>Unicode</code>解码时的错误(<code>UnicodeError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeTranslateError</code></td>
<td><code>Unicode</code>转换时的错误(<code>UnicodeError</code>的子类)</td>
</tr>
<tr>
<td><code>ValueError</code></td>
<td>传入无效的参数</td>
</tr>
<tr>
<td><code>ZeroDivisionError</code></td>
<td>除数为零</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;以下是<code>Python</code>内置异常类的层次结构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">BaseException</span><br><span class="line">+-- SystemExit</span><br><span class="line">+-- KeyboardInterrupt</span><br><span class="line">+-- GeneratorExit</span><br><span class="line">+-- Exception</span><br><span class="line">      +-- StopIteration</span><br><span class="line">      +-- ArithmeticError</span><br><span class="line">      |    +-- FloatingPointError</span><br><span class="line">      |    +-- OverflowError</span><br><span class="line">      |    +-- ZeroDivisionError</span><br><span class="line">      +-- AssertionError</span><br><span class="line">      +-- AttributeError</span><br><span class="line">      +-- BufferError</span><br><span class="line">      +-- EOFError</span><br><span class="line">      +-- ImportError</span><br><span class="line">      +-- LookupError</span><br><span class="line">      |    +-- IndexError</span><br><span class="line">      |    +-- KeyError</span><br><span class="line">      +-- MemoryError</span><br><span class="line">      +-- NameError</span><br><span class="line">      |    +-- UnboundLocalError</span><br><span class="line">      +-- OSError</span><br><span class="line">      |    +-- BlockingIOError</span><br><span class="line">      |    +-- ChildProcessError</span><br><span class="line">      |    +-- ConnectionError</span><br><span class="line">      |    |    +-- BrokenPipeError</span><br><span class="line">      |    |    +-- ConnectionAbortedError</span><br><span class="line">      |    |    +-- ConnectionRefusedError</span><br><span class="line">      |    |    +-- ConnectionResetError</span><br><span class="line">      |    +-- FileExistsError</span><br><span class="line">      |    +-- FileNotFoundError</span><br><span class="line">      |    +-- InterruptedError</span><br><span class="line">      |    +-- IsADirectoryError</span><br><span class="line">      |    +-- NotADirectoryError</span><br><span class="line">      |    +-- PermissionError</span><br><span class="line">      |    +-- ProcessLookupError</span><br><span class="line">      |    +-- TimeoutError</span><br><span class="line">      +-- ReferenceError</span><br><span class="line">      +-- RuntimeError</span><br><span class="line">      |    +-- NotImplementedError</span><br><span class="line">      +-- SyntaxError</span><br><span class="line">      |    +-- IndentationError</span><br><span class="line">      |         +-- TabError</span><br><span class="line">      +-- SystemError</span><br><span class="line">      +-- TypeError</span><br><span class="line">      +-- ValueError</span><br><span class="line">      |    +-- UnicodeError</span><br><span class="line">      |         +-- UnicodeDecodeError</span><br><span class="line">      |         +-- UnicodeEncodeError</span><br><span class="line">      |         +-- UnicodeTranslateError</span><br><span class="line">      +-- Warning</span><br><span class="line">           +-- DeprecationWarning</span><br><span class="line">           +-- PendingDeprecationWarning</span><br><span class="line">           +-- RuntimeWarning</span><br><span class="line">           +-- SyntaxWarning</span><br><span class="line">           +-- UserWarning</span><br><span class="line">           +-- FutureWarning</span><br><span class="line">           +-- ImportWarning</span><br><span class="line">           +-- UnicodeWarning</span><br><span class="line">           +-- BytesWarning</span><br><span class="line">           +-- ResourceWarning</span><br></pre></td></tr></table></figure>
<h3 id="语法错误"><a href="#语法错误" class="headerlink" title="语法错误"></a>语法错误</h3><p>&emsp;&emsp;<code>Python</code>的语法错误称之为<code>解析错误</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="keyword">True</span> print(<span class="string">'Hello world'</span>)</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
<p>这个例子中，函数<code>print</code>被检查到有错误，是它前面缺少了一个冒号<code>:</code>。<br>&emsp;&emsp;即便<code>Python</code>程序的语法是正确的，在运行它的时候，也有可能发生错误。运行期检测到的错误被称为<code>异常</code>。大多数的异常都不会被程序处理，都以错误信息的形式展现在这里：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> * (<span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#7&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="number">10</span> * (<span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line">ZeroDivisionError: division by zero</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">4</span> + spam*<span class="number">3</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#8&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="number">4</span> + spam*<span class="number">3</span></span><br><span class="line">NameError: name <span class="string">'spam'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'2'</span> + <span class="number">2</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#9&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="string">'2'</span> + <span class="number">2</span></span><br><span class="line">TypeError: must be str, <span class="keyword">not</span> int</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;异常以不同的类型出现，这些类型都作为信息的一部分打印出来，例子中的类型有<code>ZeroDivisionError</code>、<code>NameError</code>和<code>TypeError</code>。错误信息的前面部分显示了异常发生的上下文，并以调用栈的形式显示具体信息。</p>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><p>&emsp;&emsp;以下示例让用户输入一个合法的整数，但是允许用户中断这个程序(使用<code>Ctrl - C</code>或者操作系统提供的方法)。用户的中断信息会引发一个<code>KeyboardInterrupt</code>异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = int(input(<span class="string">"Please enter a number: "</span>))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        print(<span class="string">"Oops! That was no valid number. Try again!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>try</code>语句按照如下方式工作：</p>
<ul>
<li>首先执行<code>try</code>子句(在关键字<code>try</code>和<code>except</code>之间的语句)。</li>
<li>如果没有异常发生，忽略<code>except</code>子句，<code>try</code>子句执行后结束。如果在执行<code>try</code>子句的过程中发生了异常，那么<code>try</code>子句余下的部分将被忽略。如果异常的类型和<code>except</code>之后的名称相符，那么对应的<code>except</code>子句将被执行。最后执行<code>try</code>语句之后的代码。</li>
<li>如果一个异常没有与任何的<code>except</code>匹配，那么这个异常将会传递给上层的<code>try</code>中。</li>
</ul>
<p>&emsp;&emsp;一个<code>try</code>语句可能包含多个<code>except</code>子句，分别来处理不同的特定的异常，最多只有一个分支会被执行。处理程序将只针对对应的<code>try</code>子句中的异常进行处理，而不是其他的<code>try</code>的处理程序中的异常。一个<code>except</code>子句可以同时处理多个异常，这些异常将被放在一个括号里成为一个元组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> (RuntimeError, TypeError, NameError):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;最后一个<code>except</code>子句可以忽略异常的名称，它将被当作通配符使用。你可以使用这种方法打印一个错误信息，然后再次把异常抛出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = open(<span class="string">'myfile.txt'</span>)</span><br><span class="line">    s = f.readline()</span><br><span class="line">    i = int(s.strip())</span><br><span class="line"><span class="keyword">except</span> OSError <span class="keyword">as</span> err:</span><br><span class="line">    print(<span class="string">"OS error: &#123;0&#125;"</span>.format(err))</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    print(<span class="string">"Could not convert data to an integer."</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Unexpected error:"</span>, sys.exc_info()[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>try except</code>语句还有一个可选的<code>else</code>子句，如果使用这个子句，那么必须放在所有的<code>except</code>子句之后。这个子句将在<code>try</code>子句没有发生任何异常的时候执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = open(arg, <span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">except</span> IOError:</span><br><span class="line">        print(<span class="string">'cannot open'</span>, arg)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(arg, <span class="string">'has'</span>, len(f.readlines()), <span class="string">'lines'</span>)</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<p>使用<code>else</code>子句比把所有的语句都放在<code>try</code>子句里面要好，这样可以避免一些意想不到的，而<code>except</code>又没有捕获的异常。<br>&emsp;&emsp;异常处理并不仅仅处理那些直接发生在<code>try</code>子句中的异常，而且还能处理子句中调用的函数(甚至间接调用的函数)里抛出的异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">this_fails</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">1</span> / <span class="number">0</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    this_fails()</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> err:</span><br><span class="line">    print(<span class="string">'Handling run-time error:'</span>, err)</span><br></pre></td></tr></table></figure>
<p>上述代码抛出如下异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Handling run-time error: int division <span class="keyword">or</span> modulo by zero</span><br></pre></td></tr></table></figure>
<h3 id="抛出异常"><a href="#抛出异常" class="headerlink" title="抛出异常"></a>抛出异常</h3><p>&emsp;&emsp;<code>Python</code>使用<code>raise</code>语句抛出一个指定的异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#13&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line">NameError: HiThere</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>raise</code>唯一的参数指定了要被抛出的异常，它必须是一个异常的实例或者是异常的类(也就是<code>Exception</code>的子类)。如果你只想知道这是否抛出了一个异常，并不想去处理它，那么一个简单的<code>raise</code>语句就可以再次把它抛出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line"><span class="keyword">except</span> NameError:</span><br><span class="line">    print(<span class="string">'An exception flew by!'</span>)</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p>上述代码抛出如下异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:\Users\fukangwei\Desktop\work_space\test.py"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line">NameError: HiThere</span><br></pre></td></tr></table></figure>
<h3 id="用户自定义异常"><a href="#用户自定义异常" class="headerlink" title="用户自定义异常"></a>用户自定义异常</h3><p>&emsp;&emsp;你可以通过创建一个新的<code>exception</code>类来拥有自己的异常。异常应该继承自<code>Exception</code>类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> repr(self.value)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> MyError(<span class="number">2</span> * <span class="number">2</span>)</span><br><span class="line"><span class="keyword">except</span> MyError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'My exception occurred, value:'</span>, e.value)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My exception occurred, value: <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，类<code>Exception</code>默认的<code>__init__</code>方法被覆盖。<br>&emsp;&emsp;当创建一个模块有可能抛出多种不同的异常时，一种通常的做法是为这个包建立一个基础异常类，然后基于这个基础类为不同的错误情况创建不同的子类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Error</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="string">""" Base class for exceptions in this module """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputError</span><span class="params">(Error)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Exception raised for errors in the input. Attributes:</span></span><br><span class="line"><span class="string">    expression -- input expression in which the error occurred</span></span><br><span class="line"><span class="string">    message -- explanation of the error</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, expression, message)</span>:</span></span><br><span class="line">        self.expression = expression</span><br><span class="line">        self.message = message</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransitionError</span><span class="params">(Error)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Raised when an operation attempts a state transition that's not allowed. Attributes:</span></span><br><span class="line"><span class="string">    previous -- state at beginning of transition</span></span><br><span class="line"><span class="string">    next -- attempted new state</span></span><br><span class="line"><span class="string">    message -- explanation of why the specific transition is not allowed</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, previous, next, message)</span>:</span></span><br><span class="line">        self.previous = previous</span><br><span class="line">        self.next = next</span><br><span class="line">        self.message = message</span><br></pre></td></tr></table></figure>
<p>大多数异常的名字都以<code>Error</code>结尾，和标准的异常命名规则一样。</p>
<h3 id="定义清理行为"><a href="#定义清理行为" class="headerlink" title="定义清理行为"></a>定义清理行为</h3><p>&emsp;&emsp;<code>try</code>语句还有另外一个可选的子句，它定义了无论在任何情况下都会执行的清理行为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> KeyboardInterrupt</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">'Goodbye, world!'</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Goodbye, world!</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/Users/fukangwei/PycharmProjects/untitled1/hello.py"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">raise</span> KeyboardInterrupt</span><br><span class="line">KeyboardInterrupt</span><br></pre></td></tr></table></figure>
<p>以上示例不管<code>try</code>子句里面有没有发生异常，<code>finally</code>子句都会执行。<br>&emsp;&emsp;如果一个异常在<code>try</code>子句里(或者在<code>except</code>和<code>else</code>子句里)被抛出，而又没有任何的<code>except</code>把它截住，那么这个异常会在<code>finally</code>子句执行后再次被抛出。下面是一个更加复杂的例子(在同一个<code>try</code>语句里包含<code>except</code>和<code>finally</code>子句)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = x / y</span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">        print(<span class="string">"division by zero!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"result is"</span>, result)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">"executing finally clause"</span>)</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>divide(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">result <span class="keyword">is</span> <span class="number">2.0</span></span><br><span class="line">executing <span class="keyword">finally</span> clause</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>divide(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">division by zero!</span><br><span class="line">executing <span class="keyword">finally</span> clause</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>divide(<span class="string">"2"</span>, <span class="string">"1"</span>)</span><br><span class="line">executing <span class="keyword">finally</span> clause</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "&lt;stdin&gt;", line 1, in ?</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">3</span>, <span class="keyword">in</span> divide</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> /: <span class="string">'str'</span> <span class="keyword">and</span> <span class="string">'str'</span></span><br></pre></td></tr></table></figure>
<h3 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h3><p>&emsp;&emsp;<code>Python</code>的<code>assert</code>断言是声明其布尔值必须为真的判定，如果发生异常，就说明该表达示为假。可以理解<code>assert</code>断言语句为<code>raise-if-not</code>，用来测试表示式，其返回值为假时，就会触发异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> expression [, arguments]</span><br></pre></td></tr></table></figure>
<p><code>assert</code>的异常参数其实就是在断言表达式后添加字符串信息，用来解释断言并更好地指明出现问题的位置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> len(lists) &gt;= <span class="number">5</span>, <span class="string">'列表元素个数小于5'</span></span><br><span class="line"><span class="keyword">assert</span> <span class="number">2</span> == <span class="number">1</span>, <span class="string">'2不等于1'</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/six模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/six模块/" itemprop="url">six模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T17:38:51+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Six-Python-2-and-3-Compatibility-Library"><a href="#Six-Python-2-and-3-Compatibility-Library" class="headerlink" title="Six: Python 2 and 3 Compatibility Library"></a>Six: Python 2 and 3 Compatibility Library</h3><p>&emsp;&emsp;<code>six</code> provides simple utilities for wrapping over differences between <code>Python 2</code> and <code>Python 3</code>. It is intended to support codebases that work on both <code>Python 2</code> and <code>Python 3</code> without modification. <code>six</code> consists of only one <code>Python</code> file, so it is painless to copy into a project.<br>&emsp;&emsp;The name <code>six</code>, comes from the fact that <code>2 * 3</code> equals <code>6</code>. Why not addition? Multiplication is more powerful, and, anyway, <code>five</code> has already been snatched away by the (admittedly now moribund) <code>Zope Five project</code>.</p>
<h3 id="Package-contents"><a href="#Package-contents" class="headerlink" title="Package contents"></a>Package contents</h3><ul>
<li><code>six.PY2</code>: A boolean indicating if the code is running on <code>Python 2</code>.</li>
<li><code>six.PY3</code>: A boolean indicating if the code is running on <code>Python 3</code>.</li>
</ul>
<h3 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h3><p>&emsp;&emsp;<code>six</code> provides constants that may differ between <code>Python</code> versions. Ones ending <code>_types</code> are mostly useful as the second argument to <code>isinstance</code> or <code>issubclass</code>.</p>
<ul>
<li><code>six.class_types</code>: Possible class types. In <code>Python 2</code>, this encompasses <code>old-style</code> and <code>new-style</code> classes. In <code>Python 3</code>, this is just <code>new-styles</code>.</li>
<li><code>six.integer_types</code>: Possible integer types. In <code>Python 2</code>, this is <code>long</code> and <code>int</code>, and in <code>Python 3</code>, just <code>int</code>.</li>
<li><code>six.string_types</code>: Possible types for text data. This is <code>basestring()</code> in <code>Python 2</code> and <code>str</code> in <code>Python 3</code>.</li>
<li><code>six.text_type</code>: Type for representing (<code>Unicode</code>) textual data. This is <code>unicode()</code> in <code>Python 2</code> and <code>str</code> in <code>Python 3</code>.</li>
<li><code>six.binary_type</code>: Type for representing binary data. This is <code>str</code> in <code>Python 2</code> and <code>bytes</code> in <code>Python 3</code>.</li>
<li><code>six.MAXSIZE</code>: The maximum size of a container like <code>list</code> or <code>dict</code>. This is equivalent to <code>sys.maxsize</code> in <code>Python 2.6</code> and later (including <code>3.x</code>). <strong>Note</strong>: this is temptingly similar to, but not the same as <code>sys.maxint</code> in <code>Python 2</code>. There is no direct equivalent to <code>sys.maxint</code> in <code>Python 3</code> because its integer type has no limits aside from memory.</li>
</ul>
<p>&emsp;&emsp;Here’s example usage of the module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> six</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dispatch_types</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(value, six.integer_types):</span><br><span class="line">        handle_integer(value)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(value, six.class_types):</span><br><span class="line">        handle_class(value)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(value, six.string_types):</span><br><span class="line">        handle_string(value)</span><br></pre></td></tr></table></figure>
<h3 id="Object-model-compatibility"><a href="#Object-model-compatibility" class="headerlink" title="Object model compatibility"></a>Object model compatibility</h3><p>&emsp;&emsp;<code>Python 3</code> renamed the attributes of several interpreter data structures. The following accessors are available. Note that the recommended way to inspect functions and methods is the stdlib inspect module.<br>&emsp;&emsp;<code>six.get_unbound_function(meth)</code>: Get the function out of unbound method <code>meth</code>. In <code>Python 3</code>, unbound methods don’t exist, so this function just returns <code>meth</code> unchanged. Example usage:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six <span class="keyword">import</span> get_unbound_function</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">method_function = get_unbound_function(X.method)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>six.get_method_function(meth)</code>: Get the function out of method object <code>meth</code>.<br>&emsp;&emsp;<code>six.get_method_self(meth)</code>: Get the self of bound method <code>meth</code>.<br>&emsp;&emsp;<code>six.get_function_closure(func)</code>: Get the closure (list of cells) associated with <code>func</code>. This is equivalent to <code>func.__closure__</code> on <code>Python 2.6+</code> and <code>func.func_closure</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.get_function_code(func)</code>: Get the code object associated with <code>func</code>. This is equivalent to <code>func.__code__</code> on <code>Python 2.6+</code> and <code>func.func_code</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.get_function_defaults(func)</code>: Get the defaults <code>tuple</code> associated with <code>func</code>. This is equivalent to <code>func.__defaults__</code> on <code>Python 2.6+</code> and <code>func.func_defaults</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.get_function_globals(func)</code>: Get the globals of <code>func</code>. This is equivalent to <code>func.__globals__</code> on <code>Python 2.6+</code> and <code>func.func_globals</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.next(it)</code> or <code>six.advance_iterator(it)</code>: Get the next item of iterator <code>it</code>. <code>StopIteration</code> is raised if the iterator is exhausted. This is a replacement for calling <code>it.next()</code> in <code>Python 2</code> and <code>next(it)</code> in <code>Python 3</code>. <code>Python 2.6</code> and above have a builtin next function, so <code>six&#39;s</code> version is only necessary for <code>Python 2.5</code> compatibility.<br>&emsp;&emsp;<code>six.callable(obj)</code>: Check if <code>obj</code> can be called. Note callable has returned in <code>Python 3.2</code>, so using <code>six&#39;s</code> version is only necessary when supporting <code>Python 3.0</code> or <code>3.1</code>.<br>&emsp;&emsp;<code>six.iterkeys(dictionary, **kwargs)</code>: Returns an iterator over <code>dictionary&#39;s</code> keys. This replaces <code>dictionary.iterkeys()</code> on <code>Python 2</code> and <code>dictionary.keys()</code> on <code>Python 3</code>. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.itervalues(dictionary, **kwargs)</code>: Returns an iterator over <code>dictionary&#39;s</code> values. This replaces <code>dictionary.itervalues()</code> on <code>Python 2</code> and <code>dictionary.values()</code> on <code>Python 3</code>. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.iteritems(dictionary, **kwargs)</code>: Returns an iterator over <code>dictionary&#39;s</code> items. This replaces <code>dictionary.iteritems()</code> on <code>Python 2</code> and <code>dictionary.items()</code> on <code>Python 3</code>. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.iterlists(dictionary, **kwargs)</code>: Calls <code>dictionary.iterlists()</code> on <code>Python 2</code> and <code>dictionary.lists()</code> on <code>Python 3</code>. No builtin Python mapping type has such a method; this method is intended for use with <code>multi-valued</code> dictionaries like Werkzeug’s. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.viewkeys(dictionary)</code>: Return a view over <code>dictionary&#39;s</code> keys. This replaces <code>dict.viewkeys()</code> on <code>Python 2.7</code> and <code>dict.keys()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.viewvalues(dictionary)</code>: Return a view over <code>dictionary&#39;s</code> values. This replaces <code>dict.viewvalues()</code> on <code>Python 2.7</code> and <code>dict.values()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.viewitems(dictionary)</code>: Return a view over <code>dictionary&#39;s</code> items. This replaces <code>dict.viewitems()</code> on <code>Python 2.7</code> and <code>dict.items()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.create_bound_method(func, obj)</code>: Return a method object wrapping <code>func</code> and bound to <code>obj</code>. On both <code>Python 2</code> and <code>3</code>, this will return a <code>types.MethodType</code> object. The reason this wrapper exists is that on <code>Python 2</code>, the <code>MethodType</code> constructor requires the obj’s class to be passed.<br>&emsp;&emsp;<code>six.create_unbound_method(func, cls)</code>: Return an unbound method object wrapping <code>func</code>. In <code>Python 2</code>, this will return a <code>types.MethodType</code> object. In <code>Python 3</code>, unbound methods do not exist and this wrapper will simply return <code>func</code>.<br>&emsp;&emsp;<code>class six.Iterator</code>: A class for making portable iterators. The intention is that it be subclassed and subclasses provide a <code>__next__</code> method. In <code>Python 2</code>, Iterator has one method: <code>next</code>. It simply delegates to <code>__next__</code>. An alternate way to do this would be to simply alias <code>next</code> to <code>__next__</code>. However, this interacts badly with subclasses that override <code>__next__</code>. Iterator is empty on <code>Python 3</code> (In fact, it is just aliased to object).<br>&emsp;&emsp;<code>six.wraps(wrapped, assigned=functools.WRAPPER_ASSIGNMENTS, updated=functools.WRAPPER_UPDATES)</code>: This is exactly the <code>functools.wraps()</code> decorator, but it sets the <code>__wrapped__</code> attribute on what it decorates as <code>functools.wraps()</code> does on <code>Python</code> versions after <code>3.2</code>.</p>
<h3 id="Syntax-compatibility"><a href="#Syntax-compatibility" class="headerlink" title="Syntax compatibility"></a>Syntax compatibility</h3><p>&emsp;&emsp;These functions smooth over operations which have different syntaxes between <code>Python 2</code> and <code>3</code>.<br>&emsp;&emsp;<code>six.exec_(code, globals=None, locals=None)</code>: Execute <code>code</code> in the scope of <code>globals</code> and <code>locals</code>. <code>code</code> can be a string or a code object. If <code>globals</code> or <code>locals</code> are not given, they will default to the scope of the caller. If just <code>globals</code> is given, it will also be used as <code>locals</code>.<br>&emsp;&emsp;<strong>Note</strong>: <code>Python 3&#39;s</code> <code>exec()</code> doesn’t take keyword arguments, so calling <code>exec()</code> with them should be avoided.<br>&emsp;&emsp;<code>six.print_(*args, *, file=sys.stdout, end=&quot;\n&quot;, sep=&quot; &quot;, flush=False)</code>: Print <code>args</code> into <code>file</code>. Each argument will be separated with <code>sep</code> and <code>end</code> will be written to the file after the last argument is printed. If <code>flush</code> is <code>true</code>, <code>file.flush()</code> will be called after all data is written.<br>&emsp;&emsp;<strong>Note</strong>: In <code>Python 2</code>, this function imitates <code>Python 3&#39;s</code> <code>print()</code> by not having softspace support. If you don’t know what that is, you’re probably ok.<br>&emsp;&emsp;<code>six.raise_from(exc_value, exc_value_from)</code>: Raise an exception from a context. On <code>Python 3</code>, this is equivalent to raise <code>exc_value</code> from <code>exc_value_from</code>. On <code>Python 2</code>, which does not support exception chaining, it is equivalent to raise <code>exc_value</code>.<br>&emsp;&emsp;<code>six.reraise(exc_type, exc_value, exc_traceback=None)</code>: Reraise an exception, possibly with a different traceback. In the simple case, <code>reraise(*sys.exc_info())</code> with an active exception (in an except block) reraises the current exception with the last traceback. A different traceback can be specified with the <code>exc_traceback</code> parameter. Note that since the exception reraising is done within the <code>reraise()</code> function, <code>Python</code> will attach the call frame of <code>reraise()</code> to whatever traceback is raised.<br>&emsp;&emsp;<code>six.with_metaclass(metaclass, *bases)</code>: Create a new class with base classes <code>bases</code> and <code>metaclass</code>. This is designed to be used in class declarations like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six <span class="keyword">import</span> with_metaclass</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(with_metaclass<span class="params">(Meta, Base)</span>)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>Another way to set a <code>metaclass</code> on a class is with the <code>add_metaclass()</code> decorator.<br>&emsp;&emsp;<code>six.add_metaclass(metaclass)</code>: Class decorator that replaces a <code>normally-constructed</code> class with a <code>metaclass-constructed</code> one. Example usage:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@add_metaclass(Meta)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>That code produces a class equivalent to</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object, metaclass=Meta)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>on <code>Python 3</code> or</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    __metaclass__ = Meta</span><br></pre></td></tr></table></figure>
<p>on <code>Python 2</code>.<br>&emsp;&emsp;Note that class decorators require <code>Python 2.6</code>. However, the effect of the decorator can be emulated on <code>Python 2.5</code> like so:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">MyClass = add_metaclass(Meta)(MyClass)</span><br></pre></td></tr></table></figure>
<h3 id="Binary-and-text-data"><a href="#Binary-and-text-data" class="headerlink" title="Binary and text data"></a>Binary and text data</h3><p>&emsp;&emsp;<code>Python 3</code> enforces the distinction between byte strings and text strings far more rigorously than <code>Python 2</code> does; binary data cannot be automatically coerced to or from text data. <code>six</code> provides several functions to assist in classifying string data in all <code>Python</code> versions.<br>&emsp;&emsp;<code>six.b(data)</code>: A <code>fake</code> bytes literal. <code>data</code> should always be a normal string literal. In <code>Python 2</code>, <code>b()</code> returns a <code>8-bit</code> string. In <code>Python 3</code>, <code>data</code> is encoded with the <code>latin-1</code> encoding to bytes.<br>&emsp;&emsp;<strong>Note</strong>: Since all <code>Python versions 2.6</code> and after support the <code>b</code> prefix, code without <code>2.5</code> support doesn’t need <code>b()</code>.<br>&emsp;&emsp;<code>six.u(text)</code>: A <code>fake</code> unicode literal. <code>text</code> should always be a normal string literal. In <code>Python 2</code>, <code>u()</code> returns unicode, and in <code>Python 3</code>, a string. Also, in <code>Python 2</code>, the string is decoded with the <code>unicode-escape</code> codec, which allows unicode escapes to be used in it.<br>&emsp;&emsp;<strong>Note</strong>: In <code>Python 3.3</code>, the <code>u</code> prefix has been reintroduced. Code that only supports <code>Python 3</code> versions of <code>3.3</code> and higher thus does not need <code>u()</code>.<br>&emsp;&emsp;<strong>Note</strong>: On <code>Python 2</code>, <code>u()</code> doesn’t know what the encoding of the literal is. Each byte is converted directly to the unicode codepoint of the same value. Because of this, it’s only safe to use <code>u()</code> with strings of <code>ASCII</code> data.<br>&emsp;&emsp;<code>six.unichr(c)</code>: Return the Unicode string representing the codepoint <code>c</code>. This is equivalent to <code>unichr()</code> on <code>Python 2</code> and <code>chr()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.int2byte(i)</code>: Converts <code>i</code> to a byte. <code>i</code> must be in <code>range(0, 256)</code>. This is equivalent to <code>chr()</code> in <code>Python 2</code> and <code>bytes((i,))</code> in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.byte2int(bs)</code>: Converts the first byte of <code>bs</code> to an integer. This is equivalent to <code>ord(bs[0])</code> on <code>Python 2</code> and <code>bs[0]</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.indexbytes(buf, i)</code>: Return the byte at index <code>i</code> of <code>buf</code> as an integer. This is equivalent to indexing a bytes object in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.iterbytes(buf)</code>: Return an iterator over bytes in <code>buf</code> as integers. This is equivalent to a bytes object iterator in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.StringIO</code>: This is a fake file object for textual data. It’s an alias for <code>StringIO.StringIO</code> in <code>Python 2</code> and <code>io.StringIO</code> in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.BytesIO</code>: This is a fake file object for binary data. In <code>Python 2</code>, it’s an alias for <code>StringIO.StringIO</code>, but in <code>Python 3</code>, it’s an alias for <code>io.BytesIO</code>.<br>&emsp;&emsp;<code>six.python_2_unicode_compatible</code>: A class decorator that takes a class defining a <code>__str__</code> method. On <code>Python 3</code>, the decorator does nothing. On <code>Python 2</code>, it aliases the <code>__str__</code> method to <code>__unicode__</code> and creates a new <code>__str__</code> method that returns the result of <code>__unicode__()</code> encoded with <code>UTF-8</code>.</p>
<h3 id="unittest-assertions"><a href="#unittest-assertions" class="headerlink" title="unittest assertions"></a>unittest assertions</h3><p>&emsp;&emsp;<code>six</code> contains compatibility shims for unittest assertions that have been renamed. The parameters are the same as their aliases, but you must pass the test method as the first argument. For example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> six</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAssertCountEqual</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        six.assertCountEqual(self, (<span class="number">1</span>, <span class="number">2</span>), [<span class="number">2</span>, <span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>Note these functions are only available on <code>Python 2.7</code> or later.<br>&emsp;&emsp;<code>six.assertCountEqual()</code>: Alias for <code>assertCountEqual()</code> on <code>Python 3</code> and <code>assertItemsEqual()</code> on <code>Python 2</code>.<br>&emsp;&emsp;<code>six.assertRaisesRegex()</code>: Alias for <code>assertRaisesRegex()</code> on <code>Python 3</code> and <code>assertRaisesRegexp()</code> on <code>Python 2</code>.<br>&emsp;&emsp;<code>six.assertRegex()</code>: Alias for <code>assertRegex()</code> on <code>Python 3</code> and <code>assertRegexpMatches()</code> on <code>Python 2</code>.</p>
<h3 id="Renamed-modules-and-attributes-compatibility"><a href="#Renamed-modules-and-attributes-compatibility" class="headerlink" title="Renamed modules and attributes compatibility"></a>Renamed modules and attributes compatibility</h3><p>&emsp;&emsp;<code>Python 3</code> reorganized the standard library and moved several functions to different modules. <code>six</code> provides a consistent interface to them through the fake <code>six.moves</code> module. For example, to load the module for parsing <code>HTML</code> on <code>Python 2</code> or <code>3</code>, write:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> html_parser</span><br></pre></td></tr></table></figure>
<p>Similarly, to get the function to reload modules, which was moved from the builtin module to the imp module, use:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> reload_module</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;For the most part, <code>six.moves</code> aliases are the names of the modules in <code>Python 3</code>. When the new <code>Python 3</code> name is a package, the components of the name are separated by underscores. For example, <code>html.parser</code> becomes <code>html_parser</code>. In some cases where several modules have been combined, the <code>Python 2</code> name is retained. This is so the appropriate modules can be found when running on <code>Python 2</code>. For example, <code>BaseHTTPServer</code> which is in <code>http.server</code> in <code>Python 3</code> is aliased as <code>BaseHTTPServer</code>.<br>&emsp;&emsp;Some modules which had two implementations have been merged in <code>Python 3</code>. For example, <code>cPickle</code> no longer exists in <code>Python 3</code>; it was merged with <code>pickle</code>. In these cases, fetching the fast version will load the fast one on <code>Python 2</code> and the merged module in <code>Python 3</code>.<br>&emsp;&emsp;The <code>urllib</code>, <code>urllib2</code>, and <code>urlparse</code> modules have been combined in the <code>urllib</code> package in <code>Python 3</code>. The <code>six.moves.urllib</code> package is a <code>version-independent</code> location for this functionality; its structure mimics the structure of the <code>Python 3</code> <code>urllib</code> package.<br>&emsp;&emsp;<strong>Note</strong>: In order to make imports of the form:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six.moves.cPickle <span class="keyword">import</span> loads</span><br></pre></td></tr></table></figure>
<p>work, <code>six</code> places special proxy objects in <code>sys.modules</code>. These proxies lazily load the underlying module when an attribute is fetched. This will fail if the underlying module is not available in the <code>Python</code> interpreter. For example, <code>sys.modules[&quot;six.moves.winreg&quot;].LoadKey</code> would fail on any <code>non-Windows</code> platform. Unfortunately, some applications try to load attributes on every module in <code>sys.modules</code>. <code>six</code> mitigates this problem for some applications by pretending attributes on unimportable modules do not exist. This hack does not work in every case, though. If you are encountering problems with the lazy modules and don’t use any from imports directly from <code>six.moves</code> modules, you can workaround the issue by removing the <code>six</code> proxy modules:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d = [name <span class="keyword">for</span> name <span class="keyword">in</span> sys.modules <span class="keyword">if</span> name.startswith(<span class="string">"six.moves."</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> d:</span><br><span class="line">    <span class="keyword">del</span> sys.modules[name]</span><br></pre></td></tr></table></figure>
<h3 id="Advanced-Customizing-renames"><a href="#Advanced-Customizing-renames" class="headerlink" title="Advanced - Customizing renames"></a>Advanced - Customizing renames</h3><p>&emsp;&emsp;It is possible to add additional names to the <code>six.moves</code> namespace.<br>&emsp;&emsp;<code>six.add_move(item)</code>: Add <code>item</code> to the <code>six.moves</code> mapping. <code>item</code> should be a <code>MovedAttribute</code> or <code>MovedModule</code> instance.<br>&emsp;&emsp;<code>six.remove_move(name)</code>: Remove the <code>six.moves</code> mapping called <code>name</code>. <code>name</code> should be a string. Instances of the following classes can be passed to <code>add_move()</code>. Neither have any public members.<br>&emsp;&emsp;<code>class six.MovedModule(name, old_mod, new_mod)</code>: Create a mapping for <code>six.moves</code> called <code>name</code> that references different modules in <code>Python 2</code> and <code>3</code>. <code>old_mod</code> is the name of the <code>Python 2</code> module. <code>new_mod</code> is the name of the <code>Python 3</code> module.<br>&emsp;&emsp;<code>class six.MovedAttribute(name, old_mod, new_mod, old_attr=None, new_attr=None)</code>: Create a mapping for <code>six.moves</code> called <code>name</code> that references different attributes in <code>Python 2</code> and <code>3</code>. <code>old_mod</code> is the name of the <code>Python 2</code> module. <code>new_mod</code> is the name of the <code>Python 3</code> module. If <code>new_attr</code> is not given, it defaults to <code>old_attr</code>. If neither is given, they both default to name.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/psutil模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/psutil模块/" itemprop="url">psutil模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T17:08:38+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;用<code>Python</code>编写脚本简化日常的运维工作是<code>Python</code>的一个重要用途。在<code>Linux</code>下，有许多系统命令可以让我们时刻监控系统运行的状态，如<code>ps</code>、<code>top</code>、<code>free</code>等。要获取这些系统信息，<code>Python</code>可以通过<code>subprocess</code>模块调用并获取结果。但这样做显得很麻烦，尤其是要写很多解析代码。<br>&emsp;&emsp;在<code>Python</code>中获取系统信息的另一个好办法是使用<code>psutil</code>这个第三方模块。顾名思义，<code>psutil</code>等于<code>process and system utilities</code>，它不仅可以通过一两行代码实现系统监控，还可以跨平台使用，支持<code>Linux</code>、<code>UNIX</code>、<code>OSX</code>、<code>Windows</code>等，是系统管理员和运维小伙伴的必备模块。</p>
<h3 id="获取CPU信息"><a href="#获取CPU信息" class="headerlink" title="获取CPU信息"></a>获取CPU信息</h3><p>&emsp;&emsp;先来获取<code>CPU</code>的信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> psutil</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.cpu_count()  <span class="comment"># CPU逻辑数量</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.cpu_count(logical=<span class="keyword">False</span>)  <span class="comment"># CPU物理核心</span></span><br><span class="line"><span class="number">2</span>  <span class="comment"># “2”说明是双核超线程，“4”则是4核非超线程</span></span><br></pre></td></tr></table></figure>
<p>统计<code>CPU</code>的<code>用户/系统/空闲时间</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.cpu_times()</span><br><span class="line">scputimes(user=<span class="number">10963.31</span>, nice=<span class="number">0.0</span>, system=<span class="number">5138.67</span>, idle=<span class="number">356102.45</span>)</span><br></pre></td></tr></table></figure>
<p>查看<code>CPU</code>使用率，每秒刷新一次，累计<code>10</code>次(类似于<code>top</code>命令)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line"><span class="meta">... </span>    psutil.cpu_percent(interval=<span class="number">1</span>, percpu=<span class="keyword">True</span>)</span><br><span class="line">...</span><br><span class="line">[<span class="number">14.0</span>, <span class="number">4.0</span>, <span class="number">4.0</span>, <span class="number">4.0</span>]</span><br><span class="line">[<span class="number">12.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">3.0</span>]</span><br><span class="line">[<span class="number">8.0</span>, <span class="number">4.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>]</span><br><span class="line">[<span class="number">12.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>]</span><br><span class="line">[<span class="number">18.8</span>, <span class="number">5.1</span>, <span class="number">5.9</span>, <span class="number">5.0</span>]</span><br><span class="line">[<span class="number">10.9</span>, <span class="number">5.0</span>, <span class="number">4.0</span>, <span class="number">3.0</span>]</span><br><span class="line">[<span class="number">12.0</span>, <span class="number">5.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>]</span><br><span class="line">[<span class="number">15.0</span>, <span class="number">5.0</span>, <span class="number">4.0</span>, <span class="number">4.0</span>]</span><br><span class="line">[<span class="number">19.0</span>, <span class="number">5.0</span>, <span class="number">5.0</span>, <span class="number">4.0</span>]</span><br><span class="line">[<span class="number">9.0</span>, <span class="number">3.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>]</span><br></pre></td></tr></table></figure>
<h3 id="获取内存信息"><a href="#获取内存信息" class="headerlink" title="获取内存信息"></a>获取内存信息</h3><p>&emsp;&emsp;使用<code>psutil</code>获取物理内存和交换内存信息，分别使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.virtual_memory()</span><br><span class="line">svmem(total=<span class="number">8589934592</span>, available=<span class="number">2866520064</span>, percent=<span class="number">66.6</span>, used=<span class="number">7201386496</span>, \</span><br><span class="line"><span class="meta">... </span>  free=<span class="number">216178688</span>, active=<span class="number">3342192640</span>, inactive=<span class="number">2650341376</span>, wired=<span class="number">1208852480</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.swap_memory()</span><br><span class="line">sswap(total=<span class="number">1073741824</span>, used=<span class="number">150732800</span>, free=<span class="number">923009024</span>, percent=<span class="number">14.0</span>, sin=<span class="number">10705981440</span>, sout=<span class="number">40353792</span>)</span><br></pre></td></tr></table></figure>
<p>返回的是字节为单位的整数，可以看到总内存大小是<code>8589934592</code>(<code>8GB</code>)，已用<code>7201386496</code>(<code>6.7GB</code>)，使用了<code>66.6%</code>，而交换区大小是<code>1073741824</code>(<code>1GB</code>)。</p>
<h3 id="获取磁盘信息"><a href="#获取磁盘信息" class="headerlink" title="获取磁盘信息"></a>获取磁盘信息</h3><p>&emsp;&emsp;可以通过<code>psutil</code>获取磁盘分区、磁盘使用率和磁盘<code>IO</code>信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.disk_partitions()  <span class="comment"># 磁盘分区信息</span></span><br><span class="line">[sdiskpart(device=<span class="string">'/dev/disk1'</span>, mountpoint=<span class="string">'/'</span>, fstype=<span class="string">'hfs'</span>, \</span><br><span class="line"><span class="meta">... </span>       opts=<span class="string">'rw,local,rootfs,dovolfs,journaled,multilabel'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.disk_usage(<span class="string">'/'</span>) <span class="comment"># 磁盘使用情况</span></span><br><span class="line">sdiskusage(total=<span class="number">998982549504</span>, used=<span class="number">390880133120</span>, free=<span class="number">607840272384</span>, percent=<span class="number">39.1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.disk_io_counters()  <span class="comment"># 磁盘IO</span></span><br><span class="line">sdiskio(read_count=<span class="number">988513</span>, write_count=<span class="number">274457</span>, read_bytes=<span class="number">14856830464</span>, \</span><br><span class="line"><span class="meta">... </span>    write_bytes=<span class="number">17509420032</span>, read_time=<span class="number">2228966</span>, write_time=<span class="number">1618405</span>)</span><br></pre></td></tr></table></figure>
<p>可以看到，磁盘<code>/</code>的总容量是<code>998982549504</code>(<code>930GB</code>)，使用了<code>39.1%</code>。文件格式是<code>HFS</code>，<code>opts</code>中包含<code>rw</code>表示可读写，<code>journaled</code>表示支持日志。</p>
<h3 id="获取网络信息"><a href="#获取网络信息" class="headerlink" title="获取网络信息"></a>获取网络信息</h3><p>&emsp;&emsp;<code>psutil</code>可以获取网络接口和网络连接信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.net_io_counters()  <span class="comment"># 获取网络读写字节/包的个数</span></span><br><span class="line">snetio(bytes_sent=<span class="number">3885744870</span>, bytes_recv=<span class="number">10357676702</span>, packets_sent=<span class="number">10613069</span>, \</span><br><span class="line"><span class="meta">... </span>   packets_recv=<span class="number">10423357</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.net_if_addrs()  <span class="comment"># 获取网络接口信息</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">'lo0'</span>: [snic(family=&lt;AddressFamily.AF_INET: <span class="number">2</span>&gt;, address=<span class="string">'127.0.0.1'</span>, netmask=<span class="string">'255.0.0.0'</span>), ...],</span><br><span class="line">  <span class="string">'en1'</span>: [snic(family=&lt;AddressFamily.AF_INET: <span class="number">2</span>&gt;, address=<span class="string">'10.0.1.80'</span>, netmask=<span class="string">'255.255.255.0'</span>), ...],</span><br><span class="line">  <span class="string">'en0'</span>: [...],</span><br><span class="line">  <span class="string">'en2'</span>: [...],</span><br><span class="line">  <span class="string">'bridge0'</span>: [...]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.net_if_stats()  <span class="comment"># 获取网络接口状态</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">'lo0'</span>: snicstats(isup=<span class="keyword">True</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_UNKNOWN: <span class="number">0</span>&gt;, speed=<span class="number">0</span>, mtu=<span class="number">16384</span>),</span><br><span class="line">  <span class="string">'en0'</span>: snicstats(isup=<span class="keyword">True</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_UNKNOWN: <span class="number">0</span>&gt;, speed=<span class="number">0</span>, mtu=<span class="number">1500</span>),</span><br><span class="line">  <span class="string">'en1'</span>: snicstats(...),</span><br><span class="line">  <span class="string">'en2'</span>: snicstats(...),</span><br><span class="line">  <span class="string">'bridge0'</span>: snicstats(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要获取当前网络连接信息，使用<code>net_connections</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.net_connections()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">PermissionError: [Errno <span class="number">1</span>] Operation <span class="keyword">not</span> permitted</span><br><span class="line">​</span><br><span class="line">During handling of the above exception, another exception occurred:</span><br><span class="line">​</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">psutil.AccessDenied: psutil.AccessDenied (pid=<span class="number">3847</span>)</span><br></pre></td></tr></table></figure>
<p>你可能会得到一个<code>AccessDenied</code>错误，原因是<code>psutil</code>获取信息也是要走系统接口，而获取网络连接信息需要<code>root</code>权限。这种情况下，可以退出<code>Python</code>交互环境，用<code>sudo</code>重新启动：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> psutil</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.net_connections()</span><br><span class="line">[</span><br><span class="line">    sconn(fd=<span class="number">83</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, laddr=addr(ip=<span class="string">'::127.0.0.1'</span>, port=<span class="number">62911</span>), \</span><br><span class="line">    raddr=addr(ip=<span class="string">'::127.0.0.1'</span>, port=<span class="number">3306</span>), status=<span class="string">'ESTABLISHED'</span>, pid=<span class="number">3725</span>), \</span><br><span class="line">    sconn(fd=<span class="number">84</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, laddr=addr(ip=<span class="string">'::127.0.0.1'</span>, port=<span class="number">62905</span>), \</span><br><span class="line">    raddr=addr(ip=<span class="string">'::127.0.0.1'</span>, port=<span class="number">3306</span>), status=<span class="string">'ESTABLISHED'</span>, pid=<span class="number">3725</span>),</span><br><span class="line">    sconn(fd=<span class="number">93</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, laddr=addr(ip=<span class="string">'::'</span>, port=<span class="number">8080</span>), \</span><br><span class="line">    raddr=(), status=<span class="string">'LISTEN'</span>, pid=<span class="number">3725</span>), sconn(fd=<span class="number">103</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, \</span><br><span class="line">    laddr=addr(ip=<span class="string">'::127.0.0.1'</span>, port=<span class="number">62918</span>), raddr=addr(ip=<span class="string">'::127.0.0.1'</span>, port=<span class="number">3306</span>), \</span><br><span class="line">               status=<span class="string">'ESTABLISHED'</span>, pid=<span class="number">3725</span>),</span><br><span class="line">    sconn(fd=<span class="number">105</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, ..., pid=<span class="number">3725</span>),</span><br><span class="line">    sconn(fd=<span class="number">106</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, ..., pid=<span class="number">3725</span>),</span><br><span class="line">    sconn(fd=<span class="number">107</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">30</span>&gt;, type=<span class="number">1</span>, ..., pid=<span class="number">3725</span>),</span><br><span class="line">    ...</span><br><span class="line">    sconn(fd=<span class="number">27</span>, family=&lt;AddressFamily.AF_INET: <span class="number">2</span>&gt;, type=<span class="number">2</span>, ..., pid=<span class="number">1</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="获取进程信息"><a href="#获取进程信息" class="headerlink" title="获取进程信息"></a>获取进程信息</h3><p>&emsp;&emsp;通过<code>psutil</code>可以获取到所有进程的详细信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.pids()  <span class="comment"># 所有进程ID</span></span><br><span class="line">[<span class="number">3865</span>, <span class="number">3864</span>, <span class="number">3863</span>, <span class="number">3856</span>, <span class="number">3855</span>, <span class="number">3853</span>, <span class="number">3776</span>, ..., <span class="number">45</span>, <span class="number">44</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = psutil.Process(<span class="number">3776</span>)  <span class="comment"># 获取指定进程(ID = 3776)，其实就是当前Python交互环境</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.name()  <span class="comment"># 进程名称</span></span><br><span class="line"><span class="string">'python3.6'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.exe()  <span class="comment"># 进程exe路径</span></span><br><span class="line"><span class="string">'/Users/michael/anaconda3/bin/python3.6'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.cwd()  <span class="comment"># 进程工作目录</span></span><br><span class="line"><span class="string">'/Users/michael'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.cmdline()  <span class="comment"># 进程启动的命令行</span></span><br><span class="line">[<span class="string">'python3'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.ppid()  <span class="comment"># 父进程ID</span></span><br><span class="line"><span class="number">3765</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.parent()  <span class="comment"># 父进程</span></span><br><span class="line">&lt;psutil.Process(pid=<span class="number">3765</span>, name=<span class="string">'bash'</span>) at <span class="number">4503144040</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.children()  <span class="comment"># 子进程列表</span></span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.status()  <span class="comment"># 进程状态</span></span><br><span class="line"><span class="string">'running'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.username()  <span class="comment"># 进程用户名</span></span><br><span class="line"><span class="string">'michael'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.create_time()  <span class="comment"># 进程创建时间</span></span><br><span class="line"><span class="number">1511052731.120333</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.terminal()  <span class="comment"># 进程终端</span></span><br><span class="line"><span class="string">'/dev/ttys002'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.cpu_times()  <span class="comment"># 进程使用的CPU时间</span></span><br><span class="line">pcputimes(user=<span class="number">0.081150144</span>, system=<span class="number">0.053269812</span>, children_user=<span class="number">0.0</span>, children_system=<span class="number">0.0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.memory_info()  <span class="comment"># 进程使用的内存</span></span><br><span class="line">pmem(rss=<span class="number">8310784</span>, vms=<span class="number">2481725440</span>, pfaults=<span class="number">3207</span>, pageins=<span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.open_files()  <span class="comment"># 进程打开的文件</span></span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.connections()  <span class="comment"># 进程相关网络连接</span></span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.num_threads()  <span class="comment"># 进程的线程数量</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.threads()  <span class="comment"># 所有线程信息</span></span><br><span class="line">[pthread(id=<span class="number">1</span>, user_time=<span class="number">0.090318</span>, system_time=<span class="number">0.062736</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.environ()  <span class="comment"># 进程环境变量</span></span><br><span class="line">&#123;<span class="string">'SHELL'</span>: <span class="string">'/bin/bash'</span>, <span class="string">'PATH'</span>: <span class="string">'/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:...'</span>, \</span><br><span class="line"> <span class="string">'PWD'</span>: <span class="string">'/Users/michael'</span>, <span class="string">'LANG'</span>: <span class="string">'zh_CN.UTF-8'</span>, ...&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.terminate()  <span class="comment"># 结束进程</span></span><br><span class="line">Terminated: <span class="number">15</span> &lt;-- 自己把自己结束了</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>psutil</code>还提供了一个<code>test</code>函数，可以模拟出<code>ps</code>命令的效果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> psutil</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>psutil.test()</span><br><span class="line">USER         PID %MEM     VSZ     RSS TTY           START    TIME  COMMAND</span><br><span class="line">root           0 24.0 74270628 2016380 ?             Nov18   40:51  kernel_task</span><br><span class="line">root           1  0.1 2494140    9484 ?             Nov18   01:39  launchd</span><br><span class="line">root          44  0.4 2519872   36404 ?             Nov18   02:02  UserEventAgent</span><br><span class="line">root          45    ? 2474032    1516 ?             Nov18   00:14  syslogd</span><br><span class="line">root          47  0.1 2504768    8912 ?             Nov18   00:03  kextd</span><br><span class="line">root          48  0.1 2505544    4720 ?             Nov18   00:19  fseventsd</span><br><span class="line">_appleeven    52  0.1 2499748    5024 ?             Nov18   00:00  appleeventsd</span><br><span class="line">root          53  0.1 2500592    6132 ?             Nov18   00:02  configd</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/multiprocessing模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/multiprocessing模块/" itemprop="url">multiprocessing模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T16:54:23+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python</code>提供了多进程包<code>multiprocessing</code>，它支持子进程调度、通信以及共享内存，执行不同形式的同步，提供了<code>Process</code>、<code>Lock</code>等组件。<br>&emsp;&emsp;多进程和多线程区别：多线程使用的是<code>CPU</code>的一个核，适合<code>IO</code>密集型任务；多进程使用的是<code>CPU</code>的多个核，适合运算密集型任务。</p>
<h3 id="multiprocessing的方法"><a href="#multiprocessing的方法" class="headerlink" title="multiprocessing的方法"></a>multiprocessing的方法</h3><p>&emsp;&emsp;<code>multiprocessing</code>的方法如下：</p>
<ul>
<li><code>cpu_count</code>：统计<code>cpu</code>总数。</li>
<li><code>active_children</code>：获取所有子进程。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line">​</span><br><span class="line">p = multiprocessing.cpu_count()</span><br><span class="line">m = multiprocessing.active_children()</span><br><span class="line">​</span><br><span class="line">print(p)  <span class="comment"># 输出“8”</span></span><br><span class="line">print(m)  <span class="comment"># 输出“[]”</span></span><br></pre></td></tr></table></figure>
<h3 id="Process进程"><a href="#Process进程" class="headerlink" title="Process进程"></a>Process进程</h3><p>&emsp;&emsp;创建一个<code>Process</code>对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p = multiprocessing.Precess(target=worker, args=(<span class="number">2</span>,))</span><br></pre></td></tr></table></figure>
<p>参数<code>target</code>是函数名字，<code>args</code>是函数需要的的参数，以<code>tuple</code>形式传入。<br>&emsp;&emsp;<code>Process</code>的常用方法如下：</p>
<ul>
<li><code>is_alive</code>：判断进程是否存活。</li>
<li><code>run</code>：启动进程。</li>
<li><code>start</code>：启动进程，会自动调用<code>run</code>方法。</li>
<li><code>join(timeout=)</code>：等待进程结束或者直到超时。</li>
</ul>
<p>&emsp;&emsp;<code>Process</code>的常用属性如下：</p>
<ul>
<li><code>name</code>：进程名字。</li>
<li><code>pid</code>：进程的<code>pid</code>。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(interval)</span>:</span></span><br><span class="line">    print(<span class="string">"interval is"</span>, interval)</span><br><span class="line">    time.sleep(interval)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p = multiprocessing.Process(target=worker, args=(<span class="number">5</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    print(p.is_alive())</span><br><span class="line">    p.join(timeout=<span class="number">3</span>)  <span class="comment"># 只等待3秒，如果进程还没结束，则向下执行print(p.name)</span></span><br><span class="line">    print(p.name)</span><br><span class="line">    print(p.pid)</span><br><span class="line">    print(<span class="string">"This is end"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">True</span></span><br><span class="line">interval <span class="keyword">is</span> <span class="number">5</span></span><br><span class="line">Process<span class="number">-1</span></span><br><span class="line"><span class="number">9572</span></span><br><span class="line">This <span class="keyword">is</span> end</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;多进程示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(name, interval)</span>:</span></span><br><span class="line">    print(<span class="string">"&#123;0&#125; start"</span>.format(name))</span><br><span class="line">    time.sleep(interval)</span><br><span class="line">    print(<span class="string">"&#123;0&#125; end"</span>.format(name))</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"main start"</span>)</span><br><span class="line">    print(<span class="string">"The computer has &#123;0&#125; core"</span>.format(multiprocessing.cpu_count()))</span><br><span class="line">​</span><br><span class="line">    p1 = multiprocessing.Process(target=worker, args=(<span class="string">"worker"</span>, <span class="number">2</span>))</span><br><span class="line">    p2 = multiprocessing.Process(target=worker, args=(<span class="string">"worker"</span>, <span class="number">3</span>))</span><br><span class="line">    p3 = multiprocessing.Process(target=worker, args=(<span class="string">"worker"</span>, <span class="number">4</span>))</span><br><span class="line">​</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"The pid of &#123;0&#125; is &#123;1&#125;"</span>.format(p.name, p.pid))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">main start</span><br><span class="line">The computer has <span class="number">8</span> core</span><br><span class="line">worker start</span><br><span class="line">The pid of Process<span class="number">-1</span> <span class="keyword">is</span> <span class="number">5400</span></span><br><span class="line">The pid of Process<span class="number">-2</span> <span class="keyword">is</span> <span class="number">3492</span></span><br><span class="line">The pid of Process<span class="number">-3</span> <span class="keyword">is</span> <span class="number">11348</span></span><br><span class="line">main end</span><br><span class="line">worker start</span><br><span class="line">worker start</span><br><span class="line">worker end</span><br><span class="line">worker end</span><br><span class="line">worker end</span><br></pre></td></tr></table></figure>
<p>这说明启动的多个进程之间都是相互独立存在的。</p>
<h3 id="lock组件"><a href="#lock组件" class="headerlink" title="lock组件"></a>lock组件</h3><p>&emsp;&emsp;当我们使用多进程来读写文件时，需要用到锁机制进行控制读写流程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(number, value, lock)</span>:</span></span><br><span class="line">    lock.acquire()  <span class="comment"># 获取锁</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">"init, member = &#123;1&#125;"</span>.format(value, number))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">            number += value</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            print(<span class="string">"add &#123;0&#125;, number = &#123;1&#125;"</span>.format(value, number))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        lock.release()  <span class="comment"># 释放锁</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    lock = multiprocessing.Lock()  <span class="comment"># 定义锁</span></span><br><span class="line">    number = <span class="number">0</span></span><br><span class="line">​</span><br><span class="line">    p1 = multiprocessing.Process(target=add, args=(number, <span class="number">1</span>, lock))</span><br><span class="line">    p3 = multiprocessing.Process(target=add, args=(number, <span class="number">3</span>, lock))</span><br><span class="line">​</span><br><span class="line">    p1.start()</span><br><span class="line">    p3.start()</span><br><span class="line">​</span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main end</span><br><span class="line">init, member = <span class="number">0</span></span><br><span class="line">add <span class="number">1</span>, number = <span class="number">1</span></span><br><span class="line">add <span class="number">1</span>, number = <span class="number">2</span></span><br><span class="line">init, member = <span class="number">0</span></span><br><span class="line">add <span class="number">3</span>, number = <span class="number">3</span></span><br><span class="line">add <span class="number">3</span>, number = <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>对于进程<code>1</code>和进程<code>3</code>，谁先抢到锁，则另一个进程只能等待抢到者执行完之后才能执行。</p>
<h3 id="共享内存"><a href="#共享内存" class="headerlink" title="共享内存"></a>共享内存</h3><p>&emsp;&emsp;<code>multiprocessing</code>提供了<code>Value</code>和<code>Array</code>模块来实现共享内存的读写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(number, value1, lock)</span>:</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">"init, member = &#123;1&#125;"</span>.format(value1, number.value))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">            number.value += value1</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            print(<span class="string">"add &#123;0&#125;, number = &#123;1&#125;"</span>.format(value1, number.value))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        lock.release()</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    lock = multiprocessing.Lock()</span><br><span class="line">    number = multiprocessing.Value(<span class="string">"i"</span>, <span class="number">0</span>)</span><br><span class="line">​</span><br><span class="line">    p1 = multiprocessing.Process(target=add, args=(number, <span class="number">1</span>, lock))</span><br><span class="line">    p3 = multiprocessing.Process(target=add, args=(number, <span class="number">3</span>, lock))</span><br><span class="line">​</span><br><span class="line">    p1.start()</span><br><span class="line">    p3.start()</span><br><span class="line">​</span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main end</span><br><span class="line">init, member = <span class="number">0</span></span><br><span class="line">add <span class="number">1</span>, number = <span class="number">1</span></span><br><span class="line">add <span class="number">1</span>, number = <span class="number">2</span></span><br><span class="line">init, member = <span class="number">2</span></span><br><span class="line">add <span class="number">3</span>, number = <span class="number">5</span></span><br><span class="line">add <span class="number">3</span>, number = <span class="number">8</span></span><br></pre></td></tr></table></figure>
<h3 id="多进程Manager"><a href="#多进程Manager" class="headerlink" title="多进程Manager"></a>多进程Manager</h3><p>&emsp;&emsp;<code>Python</code>提供了强大的<code>Manage</code>专门用来做数据共享的，其支持的类型非常多，包括<code>Value</code>、<code>Array</code>、<code>list</code>、<code>dict</code>、<code>Queue</code>、<code>Lock</code>等：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(d, L)</span>:</span></span><br><span class="line">    L += range(<span class="number">11</span>, <span class="number">16</span>)  <span class="comment"># 返回一个列表序列的特殊写法</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">        key = <span class="string">"key &#123;0&#125;"</span>.format(i)</span><br><span class="line">        value = <span class="string">"value &#123;0&#125;"</span>.format(i)</span><br><span class="line">        d[key] = value</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    manager = multiprocessing.Manager()</span><br><span class="line">    L = manager.list()</span><br><span class="line">    d = manager.dict()</span><br><span class="line">    p = multiprocessing.Process(target=worker, args=(d, L))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">​</span><br><span class="line">    print(d)</span><br><span class="line">    print(L)</span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'key 1'</span>: <span class="string">'value 1'</span>, <span class="string">'key 2'</span>: <span class="string">'value 2'</span>&#125;</span><br><span class="line">[<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]</span><br><span class="line">main end</span><br></pre></td></tr></table></figure>
<h3 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h3><p>&emsp;&emsp;<code>Pool</code>可以提供指定数量的进程供用户调用，当有新的请求提交到<code>pool</code>中时，如果池还没有满，那么就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程。<br>&emsp;&emsp;进程有阻塞和非阻塞两种类型：</p>
<ul>
<li><code>Pool.apply_async</code>：非阻塞型，进程可以同时执行。</li>
<li><code>Pool.apply</code>：阻塞型，一个进程结束并释放回进程池，下一个进程才可以开始。</li>
</ul>
<p>&emsp;&emsp;非阻塞型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(msg)</span>:</span></span><br><span class="line">    print(<span class="string">"start &#123;0&#125;"</span>.format(msg))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"end &#123;0&#125;"</span>.format(msg))</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"main start"</span>)</span><br><span class="line">    pool = multiprocessing.Pool(processes=<span class="number">3</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        msg = <span class="string">"hello &#123;0&#125;"</span>.format(i)</span><br><span class="line">        pool.apply_async(func=worker, args=(msg,))</span><br><span class="line">​</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br></pre></td></tr></table></figure>
<p>调用<code>join</code>之前，先调用<code>close</code>函数，否则会出错。执行完<code>close</code>后，如果没有新的进程加入到<code>pool</code>，则<code>join</code>函数等待所有子进程结束。执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main start</span><br><span class="line">start hello <span class="number">1</span></span><br><span class="line">start hello <span class="number">2</span></span><br><span class="line">start hello <span class="number">3</span></span><br><span class="line">end hello <span class="number">1</span></span><br><span class="line">start hello <span class="number">4</span></span><br><span class="line">end hello <span class="number">2</span></span><br><span class="line">end hello <span class="number">3</span></span><br><span class="line">end hello <span class="number">4</span></span><br><span class="line">main end</span><br></pre></td></tr></table></figure>
<p>一开始启动<code>3</code>个进程，之后先关闭一个进程，再补充另外一个进程进来，始终保持<code>3</code>个，直至结束。<br>&emsp;&emsp;阻塞型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(msg)</span>:</span></span><br><span class="line">    print(<span class="string">"start &#123;0&#125;"</span>.format(msg))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"end &#123;0&#125;"</span>.format(msg))</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"main start"</span>)</span><br><span class="line">    pool = multiprocessing.Pool(processes=<span class="number">3</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        msg = <span class="string">"hello &#123;0&#125;"</span>.format(i)</span><br><span class="line">        pool.apply(func=worker, args=(msg,))</span><br><span class="line">​</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main start</span><br><span class="line">start hello <span class="number">1</span></span><br><span class="line">end hello <span class="number">1</span></span><br><span class="line">start hello <span class="number">2</span></span><br><span class="line">end hello <span class="number">2</span></span><br><span class="line">start hello <span class="number">3</span></span><br><span class="line">end hello <span class="number">3</span></span><br><span class="line">start hello <span class="number">4</span></span><br><span class="line">end hello <span class="number">4</span></span><br><span class="line">main end</span><br></pre></td></tr></table></figure>
<p>每次只能启动一个进程，启动新进程前，需关闭老进程。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/h5py模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/h5py模块/" itemprop="url">h5py模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:47:38+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>h5py</code>文件是存放两类对象的容器，分别是数据集(<code>dataset</code>)和组(<code>group</code>)。<code>dataset</code>类似于<code>numpy</code>的数组；<code>group</code>则类似于<code>python</code>中的字典，有键(<code>key</code>)和值(<code>value</code>)。<code>键</code>就是组成员的名称，<code>值</code>就是组成员对象本身(组或者数据集)。<code>group</code>中可以存放<code>dataset</code>或者其他的<code>group</code>。下面来看如何创建组和数据集。<br>&emsp;&emsp;1. 创建一个<code>h5py</code>文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line">f = h5py.File(<span class="string">"myh5py.hdf5"</span>, <span class="string">"w"</span>)  <span class="comment"># 如果是读取文件的话，就把“w”换成“r”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;2. 创建<code>dataset</code>数据集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line">​</span><br><span class="line">f = h5py.File(<span class="string">"myh5py.hdf5"</span>, <span class="string">"w"</span>)</span><br><span class="line"><span class="comment"># “deset1”是数据集的name，(20,)代表数据集的shape，“i”代表的是数据集的元素类型</span></span><br><span class="line">f.create_dataset(<span class="string">"dset1"</span>, (<span class="number">20</span>,), <span class="string">'i'</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> f.keys():</span><br><span class="line">    print(key)</span><br><span class="line">    print(f[key].name)</span><br><span class="line">    print(f[key].shape)</span><br><span class="line">    print(f[key].value)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dset1</span><br><span class="line">/dset1</span><br><span class="line">(<span class="number">20</span>,)</span><br><span class="line">[<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>这里仅仅创建了一个存放<code>20</code>个整型元素的数据集，并没有赋值，默认全是<code>0</code>。如何赋值呢？看下面的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line">f = h5py.File(<span class="string">"myh5py.hdf5"</span>, <span class="string">"w"</span>)</span><br><span class="line">d1 = f.create_dataset(<span class="string">"dset1"</span>, (<span class="number">20</span>,), <span class="string">'i'</span>)</span><br><span class="line">d1[...] = np.arange(<span class="number">20</span>)  <span class="comment"># 赋值</span></span><br><span class="line"><span class="comment"># 或者可以直接按照下面的方式创建数据集并赋值</span></span><br><span class="line">f[<span class="string">"dset2"</span>] = np.arange(<span class="number">15</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> f.keys():</span><br><span class="line">    print(f[key].name)</span><br><span class="line">    print(f[key].value)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/dset1</span><br><span class="line">[ <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span>]</span><br><span class="line">/dset2</span><br><span class="line">[ <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span>]</span><br></pre></td></tr></table></figure>
<p>如果我们有现成的<code>numpy</code>数组，那么就可以在创建数据集的时候赋值，此时就不必指定数据的类型和形状，只需要把数组名传给参数<code>data</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line">f = h5py.File(<span class="string">"myh5py.hdf5"</span>, <span class="string">"w"</span>)</span><br><span class="line">a = np.arange(<span class="number">20</span>)</span><br><span class="line">d1 = f.create_dataset(<span class="string">"dset1"</span>, data=a)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> f.keys():</span><br><span class="line">    print(f[key].name)</span><br><span class="line">    print(f[key].value)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dset1</span><br><span class="line">[ <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;3. 创建<code>group</code>组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line">f = h5py.File(<span class="string">"myh5py.hdf5"</span>, <span class="string">"w"</span>)</span><br><span class="line">g1 = f.create_group(<span class="string">"bar"</span>)  <span class="comment"># 创建一个名为bar的组</span></span><br><span class="line"><span class="comment"># 在bar这个组里面分别创建name为dset1和dset2的数据集并赋值</span></span><br><span class="line">g1[<span class="string">"dset1"</span>] = np.arange(<span class="number">10</span>)</span><br><span class="line">g1[<span class="string">"dset2"</span>] = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> g1.keys():</span><br><span class="line">    print(g1[key].name)</span><br><span class="line">    print(g1[key].value)</span><br></pre></td></tr></table></figure>
<p>注意观察数据集<code>dset1</code>和<code>dset2</code>的名字是不是有点和前面的不一样，如果是直接创建数据集，不在任何组里面，那么它的名字就是<code>/+名字</code>；现在这两个数据集都在<code>bar</code>这个<code>group</code>里面，名字就变成了<code>/bar+/名字</code>，是不是有点文件夹的感觉。</p>
<hr>
<h3 id="Core-concepts"><a href="#Core-concepts" class="headerlink" title="Core concepts"></a>Core concepts</h3><p>&emsp;&emsp;An <code>HDF5</code> file is a container for two kinds of objects: datasets, which are <code>array-like</code> collections of data, and groups, which are <code>folder-like</code> containers that hold datasets and other groups. The most fundamental thing to remember when using <code>h5py</code> is: Groups work like dictionaries, and datasets work like <code>NumPy</code> arrays.<br>&emsp;&emsp;Suppose someone has sent you a <code>HDF5</code> file, <code>mytestfile.hdf5</code>. The very first thing you’ll need to do is to open the file for reading:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> h5py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = h5py.File(<span class="string">'mytestfile.hdf5'</span>, <span class="string">'r'</span>)</span><br></pre></td></tr></table></figure>
<p>The <code>File</code> object is your starting point. What is stored in this file? Remember <code>h5py.File</code> acts like a Python dictionary, thus we can check the keys:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.keys()</span><br><span class="line">[<span class="string">u'mydataset'</span>]</span><br></pre></td></tr></table></figure>
<p>Based on our observation, there is one data set, mydataset in the file. Let us examine the data set as a Dataset object:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset = f[<span class="string">'mydataset'</span>]</span><br></pre></td></tr></table></figure>
<p>The object we obtained isn’t an array, but an <code>HDF5</code> dataset. Like <code>NumPy</code> arrays, datasets have both a shape and a data type:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.shape</span><br><span class="line">(<span class="number">100</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.dtype</span><br><span class="line">dtype(<span class="string">'int32'</span>)</span><br></pre></td></tr></table></figure>
<p>They also support <code>array-style</code> slicing. This is how you read and write data from a dataset in the file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset[...] = np.arange(<span class="number">100</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset[<span class="number">0</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset[<span class="number">10</span>]</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset[<span class="number">0</span>:<span class="number">100</span>:<span class="number">10</span>]</span><br><span class="line">array([ <span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">90</span>])</span><br></pre></td></tr></table></figure>
<h3 id="Appendix-Creating-a-file"><a href="#Appendix-Creating-a-file" class="headerlink" title="Appendix: Creating a file"></a>Appendix: Creating a file</h3><p>&emsp;&emsp;At this point, you may wonder how <code>mytestdata.hdf5</code> is created. We can create a file by setting the mode to <code>w</code> when the <code>File</code> object is initialized. Some other modes are a (for <code>read/write/create</code> access), and <code>r+</code> (for <code>read/write</code> access). A full list of file access modes and their meanings is at <code>File</code> Objects.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> h5py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = h5py.File(<span class="string">"mytestfile.hdf5"</span>, <span class="string">"w"</span>)</span><br></pre></td></tr></table></figure>
<p>The <code>File</code> object has a couple of methods which look interesting. One of them is <code>create_dataset</code>, which as the name suggests, creates a data set of given shape and dtype:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset = f.create_dataset(<span class="string">"mydataset"</span>, (<span class="number">100</span>,), dtype=<span class="string">'i'</span>)</span><br><span class="line">The File object <span class="keyword">is</span> a context manager; so the following code works too:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> h5py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> h5py.File(<span class="string">"mytestfile.hdf5"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    dset = f.create_dataset(<span class="string">"mydataset"</span>, (<span class="number">100</span>,), dtype=<span class="string">'i'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Groups-and-hierarchical-organization"><a href="#Groups-and-hierarchical-organization" class="headerlink" title="Groups and hierarchical organization"></a>Groups and hierarchical organization</h3><p>&emsp;&emsp;<code>HDF</code> stands for <code>Hierarchical Data Format</code>. Every object in an <code>HDF5</code> file has a name, and they’re arranged in a <code>POSIX-style</code> hierarchy with <code>/-separators</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.name</span><br><span class="line"><span class="string">u'/mydataset'</span></span><br></pre></td></tr></table></figure>
<p>The <code>folders</code> in this system are called groups. The <code>File</code> object we created is itself a group, in this case the root group, named <code>/</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.name</span><br><span class="line"><span class="string">u'/'</span></span><br></pre></td></tr></table></figure>
<p>Creating a subgroup is accomplished via the <code>aptly-named</code> <code>create_group</code>. But we need to open the file in <code>read/write</code> mode first:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = h5py.File(<span class="string">'mydataset.hdf5'</span>, <span class="string">'r+'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>grp = f.create_group(<span class="string">"subgroup"</span>)</span><br></pre></td></tr></table></figure>
<p>All Group objects also have the <code>create_*</code> methods like <code>File</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset2 = grp.create_dataset(<span class="string">"another_dataset"</span>, (<span class="number">50</span>,), dtype=<span class="string">'f'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset2.name</span><br><span class="line"><span class="string">u'/subgroup/another_dataset'</span></span><br></pre></td></tr></table></figure>
<p>By the way, you don’t have to create all the intermediate groups manually. Specifying a full path works just fine:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset3 = f.create_dataset(<span class="string">'subgroup2/dataset_three'</span>, (<span class="number">10</span>,), dtype=<span class="string">'i'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset3.name</span><br><span class="line"><span class="string">u'/subgroup2/dataset_three'</span></span><br></pre></td></tr></table></figure>
<p>Groups support most of the Python <code>dictionary-style</code> interface. You retrieve objects in the file using the <code>item-retrieval</code> syntax:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dataset_three = f[<span class="string">'subgroup2/dataset_three'</span>]</span><br><span class="line">Iterating over a group provides the names of its members: </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> name <span class="keyword">in</span> f:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> name</span><br><span class="line">mydataset</span><br><span class="line">subgroup</span><br><span class="line">subgroup2</span><br></pre></td></tr></table></figure>
<p>Membership testing also uses names:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"mydataset"</span> <span class="keyword">in</span> f</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"somethingelse"</span> <span class="keyword">in</span> f</span><br><span class="line"><span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>You can even use full path names:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"subgroup/another_dataset"</span> <span class="keyword">in</span> f</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<p>There are also the familiar <code>keys()</code>, <code>values()</code>, <code>items()</code> and <code>iter()</code> methods, as well as <code>get()</code>.<br>&emsp;&emsp;Since iterating over a group only yields its <code>directly-attached</code> members, iterating over an entire file is accomplished with the Group methods <code>visit()</code> and <code>visititems()</code>, which take a callable:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">printname</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> name</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.visit(printname)</span><br><span class="line">mydataset</span><br><span class="line">subgroup</span><br><span class="line">subgroup/another_dataset</span><br><span class="line">subgroup2</span><br><span class="line">subgroup2/dataset_three</span><br></pre></td></tr></table></figure>
<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>&emsp;&emsp;One of the best features of <code>HDF5</code> is that you can store metadata right next to the data it describes. All groups and datasets support attached named bits of data called attributes.<br>&emsp;&emsp;Attributes are accessed through the attrs proxy object, which again implements the dictionary interface:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.attrs[<span class="string">'temperature'</span>] = <span class="number">99.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.attrs[<span class="string">'temperature'</span>]</span><br><span class="line"><span class="number">99.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'temperature'</span> <span class="keyword">in</span> dset.attrs</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/argparse模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/argparse模块/" itemprop="url">argparse模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:02:32+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>argparse</code>是<code>Python</code>内置的一个用于命令项选项与参数解析的模块，通过在程序中定义好我们需要的参数，<code>argparse</code>将会从<code>sys.argv</code>中解析出这些参数，并自动生成帮助和使用信息。</p>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><p>&emsp;&emsp;先来看一个简单示例，主要有三个步骤：创建<code>ArgumentParser</code>对象；调用<code>add_argument</code>方法添加参数；使用<code>parse_args</code>解析添加的参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">​</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">'integer'</span>, type=int, help=<span class="string">'display an integer'</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(args.integer)</span><br></pre></td></tr></table></figure>
<p>将上面的代码保存为文件<code>my_test.py</code>，并在终端运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ python my_test.py</span><br><span class="line">usage: my_test.py [-h] <span class="built_in">integer</span></span><br><span class="line">my_test.py: error: the following arguments are required: <span class="built_in">integer</span></span><br><span class="line">$ python my_test.py abcd</span><br><span class="line">usage: my_test.py [-h] <span class="built_in">integer</span></span><br><span class="line">my_test.py: error: argument <span class="built_in">integer</span>: invalid int value: <span class="string">'abcd'</span></span><br><span class="line">$ python my_test.py -h</span><br><span class="line">usage: my_test.py [-h] <span class="built_in">integer</span></span><br><span class="line">​</span><br><span class="line">positional arguments:</span><br><span class="line">  <span class="built_in">integer</span>     display an <span class="built_in">integer</span></span><br><span class="line">​</span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --<span class="built_in">help</span>  show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">$ python my_test.py 10</span><br><span class="line">10</span><br></pre></td></tr></table></figure>
<h3 id="定位参数"><a href="#定位参数" class="headerlink" title="定位参数"></a>定位参数</h3><p>&emsp;&emsp;上面的示例其实就演示了定位参数的使用，我们再来看一个例子(计算一个数的平方)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">​</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, help=<span class="string">"display a square of a given number"</span>, type=int)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(args.square ** <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python my_test.py 9</span><br><span class="line">81</span><br></pre></td></tr></table></figure>
<h3 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h3><p>&emsp;&emsp;所谓可选参数，就是命令行参数是可选的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">​</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"--square"</span>, help=<span class="string">"display a square of a given number"</span>, type=int)</span><br><span class="line">parser.add_argument(<span class="string">"--cubic"</span>, help=<span class="string">"display a cubic of a given number"</span>, type=int)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> args.square:</span><br><span class="line">    print(args.square ** <span class="number">2</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> args.cubic:</span><br><span class="line">    print(args.cubic ** <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ python my_test.py --h</span><br><span class="line">usage: my_test.py [-h] [--square SQUARE] [--cubic CUBIC]</span><br><span class="line">​</span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --<span class="built_in">help</span>       show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">  --square SQUARE  display a square of a given number</span><br><span class="line">  --cubic CUBIC    display a cubic of a given number</span><br><span class="line">$ python my_test.py --square 8</span><br><span class="line">64</span><br><span class="line">$ python my_test.py --cubic 8</span><br><span class="line">512</span><br><span class="line">$ python my_test.py 8</span><br><span class="line">usage: my_test.py [-h] [--square SQUARE] [--cubic CUBIC]</span><br><span class="line">my_test.py: error: unrecognized arguments: 8</span><br><span class="line">$ python my_test.py  <span class="comment"># 没有输出</span></span><br></pre></td></tr></table></figure>
<h3 id="混合使用"><a href="#混合使用" class="headerlink" title="混合使用"></a>混合使用</h3><p>&emsp;&emsp;定位参数和选项参数可以混合使用，下面一个例子输出给定整数序列的和或最大值(默认)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">​</span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">'Process some integers.'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'integers'</span>, metavar=<span class="string">'N'</span>, type=int, nargs=<span class="string">'+'</span>, \</span><br><span class="line">                    help=<span class="string">'an integer for the accumulator'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--sum'</span>, dest=<span class="string">'accumulate'</span>, action=<span class="string">'store_const'</span>, const=sum, \</span><br><span class="line">                    default=max, help=<span class="string">'sum the integers (default: find the max)'</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(args.accumulate(args.integers))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ python my_test.py</span><br><span class="line">usage: my_test.py [-h] [--sum] N [N ...]</span><br><span class="line">my_test.py: error: the following arguments are required: N</span><br><span class="line">$ python my_test.py 1 2 3 4</span><br><span class="line">4</span><br><span class="line">$ python my_test.py 1 2 3 4 --sum</span><br><span class="line">10</span><br></pre></td></tr></table></figure>
<h3 id="add-argument方法"><a href="#add-argument方法" class="headerlink" title="add_argument方法"></a>add_argument方法</h3><p>&emsp;&emsp;<code>add_argument</code>方法定义如何解析命令行参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArgumentParser.add_argument(</span><br><span class="line">    name <span class="keyword">or</span> flags [, action] [, nargs] [, const] [, default] [, type] \</span><br><span class="line">    [, choices] [, required] [, help] [, metavar] [, dest])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>name or flags</code>：这是必须的参数，它接受选项参数或者是位置参数：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'-f'</span>, <span class="string">'--foo'</span>)  <span class="comment"># 选项参数</span></span><br><span class="line">parser.add_argument(<span class="string">'bar'</span>)  <span class="comment"># 位置参数</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>nargs</code>：当选项后接受多个或者<code>0</code>个参数时需要使用这个来指定，比如<code>-u</code>选项接受<code>2</code>个参数：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, nargs=<span class="number">2</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u a b'</span>.split())  </span><br><span class="line">Namespace(u=[<span class="string">'a'</span>, <span class="string">'b'</span>])</span><br></pre></td></tr></table></figure>
<p>当选项接受<code>1</code>个或者不需要参数时，指定<code>nargs=&#39;?&#39;</code>；当没有参数时，会从<code>default</code>中取值。对于选项参数有一个额外的情况，就是出现选项而后面没有跟具体参数，那么会从<code>const</code>中取值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, nargs=<span class="string">'?'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">Namespace(u=<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u a'</span>.split())</span><br><span class="line">Namespace(u=<span class="string">'a'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, nargs=<span class="string">'?'</span>, default=<span class="string">'d'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'A'</span>, nargs=<span class="string">'?'</span>, default=<span class="string">'e'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">Namespace(A=<span class="string">'e'</span>, u=<span class="string">'d'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u'</span>.split())</span><br><span class="line">Namespace(A=<span class="string">'e'</span>, u=<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, nargs=<span class="string">'?'</span>, default=<span class="string">'d'</span>, const=<span class="string">'s'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'A'</span>, nargs=<span class="string">'?'</span>, default=<span class="string">'T'</span>, const=<span class="string">'P'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">Namespace(A=<span class="string">'T'</span>, u=<span class="string">'d'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u'</span>.split())</span><br><span class="line">Namespace(A=<span class="string">'T'</span>, u=<span class="string">'s'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'A'</span>.split())</span><br><span class="line">Namespace(A=<span class="string">'A'</span>, u=<span class="string">'d'</span>)</span><br></pre></td></tr></table></figure>
<p>而对于后面需要跟多个参数的情况，例如<code>-foo a1 a2 a3...</code>，则需要设置<code>nargs=&#39;*&#39;</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, nargs=<span class="string">'*'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u a b c d e'</span>.split())</span><br><span class="line">Namespace(u=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br></pre></td></tr></table></figure>
<p><code>nargs=&#39;+&#39;</code>和<code>nargs=&#39;*&#39;</code>一样，但是当<code>nargs=&#39;+&#39;</code>时，如果没有参数，位置参数会报错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'u'</span>, nargs=<span class="string">'+'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">usage: [-h] u [u ...] : error: too few arguments</span><br></pre></td></tr></table></figure>
<p>而<code>*</code>会使用默认值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'u'</span>, nargs=<span class="string">'*'</span>, default=<span class="string">'e'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">Namespace(u=<span class="string">'e'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>default</code>：当参数需要默认值时，由这个参数指定，默认为<code>None</code>。当<code>default=argparse.SUPPRESS</code>时，不使用任何值：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'u'</span>, nargs=<span class="string">'*'</span>, default=argparse.SUPPRESS)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">Namespace()</span><br></pre></td></tr></table></figure>
<ul>
<li><code>type</code>：使用这个参数可以转换输入参数的具体类型。该参数可以关联到某个自定义的处理函数，这种函数通常用来检查值的范围以及合法性：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, type=int)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'f'</span>, type=file)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u 2 aa'</span>.split())</span><br><span class="line">Namespace(f=<span class="string">'aa'</span>, mode <span class="string">'r'</span> at <span class="number">0x8b4ee38</span>&gt;, u=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>choices</code>：这个参数用来检查输入参数的范围：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, type=int, choices=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u 3'</span>.split())</span><br><span class="line">Namespace(u=<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'-u 4'</span>.split())</span><br><span class="line">usage: [-h] [-u &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>&#125;] : error: argument -u: invalid choice: <span class="number">4</span> (choose <span class="keyword">from</span> <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>required</code>：当某个选项指定需要在命令中出现时，使用这个参数：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, required=<span class="keyword">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">''</span>.split())</span><br><span class="line">usage: [-h] -u U : error: argument -u <span class="keyword">is</span> required</span><br></pre></td></tr></table></figure>
<ul>
<li><code>help</code>：使用这个参数描述选项作用：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'-u'</span>, required=<span class="keyword">True</span>, default=<span class="string">'wowo'</span>,</span><br><span class="line"><span class="meta">... </span>help=<span class="string">'%(prog)s for test sth(default: %(default)s)'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.print_help()</span><br><span class="line">usage: [-h] -u U</span><br><span class="line">​</span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help  show this help message <span class="keyword">and</span> exit</span><br><span class="line">  -u U        <span class="keyword">for</span> test sth(default: wowo)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>dest</code>：这个参数相当于把位置或者选项关联到一个特定的名字：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'--str'</span>, nargs=<span class="string">'*'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'--str a b c'</span>.split())</span><br><span class="line">Namespace(str=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'--str'</span>, nargs=<span class="string">'*'</span>, dest=<span class="string">'myname'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.parse_args(<span class="string">'--str a b c'</span>.split())</span><br><span class="line">Namespace(myname=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>metavar</code>：这个参数用于<code>help</code>信息输出：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'--str'</span>, nargs=<span class="string">'*'</span>, metavar=<span class="string">'AAA'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.print_help()</span><br><span class="line">usage: [-h] [--str [AAA [AAA ...]]]</span><br><span class="line">​</span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message <span class="keyword">and</span> exit</span><br><span class="line">  --str [AAA [AAA ...]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.add_argument(<span class="string">'str'</span>, nargs=<span class="string">'*'</span>, metavar=<span class="string">'AAA'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parser.print_help()</span><br><span class="line">usage: [-h] [AAA [AAA ...]]</span><br><span class="line">​</span><br><span class="line">positional arguments:</span><br><span class="line">  AAA</span><br><span class="line">​</span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help  show this help message <span class="keyword">and</span> exit</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/logging模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/logging模块/" itemprop="url">logging模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T14:17:18+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;将日志打印到屏幕：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">​</span><br><span class="line">logging.debug(<span class="string">'debug message'</span>)</span><br><span class="line">logging.info(<span class="string">'info message'</span>)</span><br><span class="line">logging.warning(<span class="string">'warn message'</span>)</span><br><span class="line">logging.error(<span class="string">'error message'</span>)</span><br><span class="line">logging.critical(<span class="string">'critical message'</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:warn message</span><br><span class="line">ERROR:root:error message</span><br><span class="line">CRITICAL:root:critical message</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>logging</code>将日志打印到屏幕，日志级别为<code>WARNING</code>(只有日志级别高于<code>WARNING</code>的日志信息才会输出)。日志级别大小关系为<code>CRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUG &gt; NOTSET</code>，当然也可以自己定义日志级别。日志级别如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>级别</th>
<th>何时使用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DEBUG</code></td>
<td>详细信息，调试问题时会感兴趣</td>
</tr>
<tr>
<td><code>INFO</code></td>
<td>表明事情按预期工作</td>
</tr>
<tr>
<td><code>WARNING</code></td>
<td>表明发生了一些意外，或者不久的将来会发生问题(例如磁盘满了)，软件还是在正常工作</td>
</tr>
<tr>
<td><code>ERROR</code></td>
<td>由于发生了严重的问题，软件已不能执行一些功能了</td>
</tr>
<tr>
<td><code>CRITICAL</code></td>
<td>严重错误，表明软件已不能继续运行了</td>
</tr>
</tbody>
</table>
</div>
<p>日志格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARINING : root           : warn message</span><br><span class="line">日志级别 : logger实例名称 : 日志消息内容</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过<code>logging.basicConfig</code>函数对日志的输出格式及方式做相关配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">​</span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.DEBUG, format=<span class="string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span>,</span><br><span class="line">    datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>, filename=<span class="string">'myapp.log'</span>, filemode=<span class="string">'w'</span>)</span><br><span class="line">logging.debug(<span class="string">'This is debug message'</span>)</span><br><span class="line">logging.info(<span class="string">'This is info message'</span>)</span><br><span class="line">logging.warning(<span class="string">'This is warning message'</span>)</span><br></pre></td></tr></table></figure>
<p>在执行目录下生成<code>myapp.log</code>文件，其内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">59</span> hello.py[line:<span class="number">11</span>] DEBUG This <span class="keyword">is</span> debug message</span><br><span class="line">Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">59</span> hello.py[line:<span class="number">12</span>] INFO This <span class="keyword">is</span> info message</span><br><span class="line">Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">59</span> hello.py[line:<span class="number">13</span>] WARNING This <span class="keyword">is</span> warning message</span><br></pre></td></tr></table></figure>
<p><code>logging.basicConfig</code>函数各参数如下：</p>
<ul>
<li><code>filename</code>：指定日志文件名。</li>
<li><code>filemode</code>：和<code>file</code>函数意义相同，指定日志文件的打开模式，即<code>w</code>或<code>a</code>。</li>
<li><code>format</code>：指定输出的格式和内容，<code>format</code>可以输出很多有用信息：</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>格式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%(levelno)s</code></td>
<td>打印日志级别的数值</td>
</tr>
<tr>
<td><code>%(levelname)s</code></td>
<td>打印日志级别名称</td>
</tr>
<tr>
<td><code>%(pathname)s</code></td>
<td>打印当前执行程序的路径，其实就是<code>sys.argv[0]</code></td>
</tr>
<tr>
<td><code>%(filename)s</code></td>
<td>打印当前执行程序名</td>
</tr>
<tr>
<td><code>%(funcName)s</code></td>
<td>打印日志的当前函数</td>
</tr>
<tr>
<td><code>%(lineno)d</code></td>
<td>打印日志的当前行号</td>
</tr>
<tr>
<td><code>%(asctime)s</code></td>
<td>打印日志的时间</td>
</tr>
<tr>
<td><code>%(thread)d</code></td>
<td>打印线程<code>ID</code></td>
</tr>
<tr>
<td><code>%(threadName)s</code></td>
<td>打印线程名称</td>
</tr>
<tr>
<td><code>%(process)d</code></td>
<td>打印进程<code>ID</code></td>
</tr>
<tr>
<td><code>%(message)s</code></td>
<td>打印日志信息</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>datefmt</code>：指定时间格式，同<code>time.strftime</code>。</li>
<li><code>level</code>：设置日志级别，默认为<code>logging.WARNING</code>。</li>
<li><code>stream</code>：指定将日志的输出流，可以指定输出到<code>sys.stderr</code>、<code>sys.stdout</code>或者文件，默认输出到<code>sys.stderr</code>。当<code>stream</code>和<code>filename</code>同时指定时，<code>stream</code>被忽略。</li>
</ul>
<p>&emsp;&emsp;几个重要的概念如下：</p>
<ul>
<li><code>Logger</code>：记录器，显示了应用程序代码能直接使用的接口。</li>
<li><code>Handler</code>：处理器，将(记录器产生的)日志记录发送至合适的目的地。</li>
<li><code>Filter</code>：过滤器，提供了更好的粒度控制，它可以决定输出哪些日志记录。</li>
<li><code>Formatter</code>：格式化器，指明了最终输出中日志记录的布局。</li>
</ul>
<h3 id="Logger记录器"><a href="#Logger记录器" class="headerlink" title="Logger记录器"></a>Logger记录器</h3><p>&emsp;&emsp;<code>Logger</code>是一个树形层级结构，在使用接口<code>debug</code>、<code>info</code>、<code>warn</code>、<code>error</code>、<code>critical</code>之前必须创建<code>Logger</code>实例，即创建一个记录器。如果没有显式地进行创建，则默认创建一个<code>root logger</code>，并应用默认的日志级别(<code>WARN</code>)、处理器<code>Handler</code>(<code>StreamHandler</code>，就是将日志信息打印输出在标准输出上)和格式化器<code>Formatter</code>(默认的格式即为第一个简单使用程序中输出的格式)。<br>&emsp;&emsp;创建方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger = logging.getLogger(logger_name)</span><br></pre></td></tr></table></figure>
<p>创建<code>Logger</code>实例后，可以使用以下方法进行日志级别设置、增加处理器<code>Handler</code>。</p>
<ul>
<li><code>logger.setLevel(logging.ERROR)</code>：设置日志级别为<code>ERROR</code>，即只有日志级别大于等于<code>ERROR</code>的日志才会输出。</li>
<li><code>logger.addHandler(handler_name)</code>：为<code>Logger</code>实例增加一个处理器。</li>
<li><code>logger.removeHandler(handler_name)</code>：为<code>Logger</code>实例删除一个处理器</li>
</ul>
<h3 id="Handler处理器"><a href="#Handler处理器" class="headerlink" title="Handler处理器"></a>Handler处理器</h3><p>&emsp;&emsp;<code>Handler</code>处理器类型有很多种，比较常用的有三个：<code>StreamHandler</code>、<code>FileHandler</code>和<code>NullHandler</code>。<br>&emsp;&emsp;<code>StreamHandler</code>的创建方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh = logging.StreamHandler(stream=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>创建<code>StreamHandler</code>后，可以通过使用以下方法设置日志级别、设置格式化器<code>Formatter</code>、增加或删除过滤器<code>Filter</code>：</p>
<ul>
<li><code>ch.setLevel(logging.WARN)</code>：指定日志级别，低于<code>WARN</code>级别的日志将被忽略。</li>
<li><code>ch.setFormatter(formatter_name)</code>：设置一个格式化器<code>formatter</code>。</li>
<li><code>ch.addFilter(filter_name)</code>：增加一个过滤器，可以增加多个。</li>
<li><code>ch.removeFilter(filter_name)</code>：删除一个过滤器。</li>
</ul>
<p>&emsp;&emsp;<code>FileHandler</code>的创建方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fh = logging.FileHandler(filename, mode=<span class="string">'a'</span>, encoding=<span class="keyword">None</span>, delay=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>NullHandler</code>类位于核心<code>logging</code>包，不做任何的格式化或者输出。本质上它是个<code>什么都不做</code>的<code>handler</code>，由库开发者使用。</p>
<h3 id="Formatter格式化器"><a href="#Formatter格式化器" class="headerlink" title="Formatter格式化器"></a>Formatter格式化器</h3><p>&emsp;&emsp;使用<code>Formatter</code>对象设置日志信息最后的规则、结构和内容，默认的时间格式为<code>%Y-%m-%d %H:%M:%S</code>。创建方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">formatter = logging.Formatter(fmt=<span class="keyword">None</span>, datefmt=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>其中<code>fmt</code>是消息的格式化字符串，<code>datefmt</code>是日期字符串。如果不指明<code>fmt</code>，将使用<code>%(message)s</code>；如果不指明<code>datefmt</code>，将使用<code>ISO8601</code>日期格式。</p>
<hr>
<p>&emsp;&emsp;将日志同时输出到文件和屏幕：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">​</span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.DEBUG, format=<span class="string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span>,</span><br><span class="line">    datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>, filename=<span class="string">'myapp.log'</span>, filemode=<span class="string">'w'</span>)</span><br><span class="line"><span class="comment"># 定义一个StreamHandler，将INFO级别或更高的日志信息打印到标准错误，并将其添加到当前的日志处理对象</span></span><br><span class="line">console = logging.StreamHandler()</span><br><span class="line">console.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(name)-12s: %(levelname)-8s %(message)s'</span>)</span><br><span class="line">console.setFormatter(formatter)</span><br><span class="line">logging.getLogger(<span class="string">''</span>).addHandler(console)</span><br><span class="line">logging.debug(<span class="string">'This is debug message'</span>)</span><br><span class="line">logging.info(<span class="string">'This is info message'</span>)</span><br><span class="line">logging.warning(<span class="string">'This is warning message'</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果是在屏幕上打印：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root        : INFO     This <span class="keyword">is</span> info message</span><br><span class="line">root        : WARNING  This <span class="keyword">is</span> warning message</span><br></pre></td></tr></table></figure>
<p>在执行目录下生成<code>myapp.log</code>文件，其内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">58</span> hello.py[line:<span class="number">19</span>] DEBUG This <span class="keyword">is</span> debug message</span><br><span class="line">Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">58</span> hello.py[line:<span class="number">20</span>] INFO This <span class="keyword">is</span> info message</span><br><span class="line">Fri, <span class="number">08</span> Dec <span class="number">2017</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">58</span> hello.py[line:<span class="number">21</span>] WARNING This <span class="keyword">is</span> warning message</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>logging</code>之日志回滚：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> RotatingFileHandler</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 定义一个RotatingFileHandler，最多备份5个日志文件，每个日志文件最大10M</span></span><br><span class="line">Rthandler = RotatingFileHandler(<span class="string">'myapp.log'</span>, maxBytes=<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>, backupCount=<span class="number">5</span>)</span><br><span class="line">Rthandler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(name)-12s: %(levelname)-8s %(message)s'</span>)</span><br><span class="line">Rthandler.setFormatter(formatter)</span><br><span class="line">logging.getLogger(<span class="string">''</span>).addHandler(Rthandler)</span><br></pre></td></tr></table></figure>
<p>从上例和本例可以看出，<code>logging</code>有一个日志处理的主对象，其它处理方式都是通过<code>addHandler</code>添加进去的。<code>logging</code>的几种<code>handle</code>方式如下：</p>
<ul>
<li><code>logging.StreamHandler</code>：日志输出到流，可以是<code>sys.stderr</code>、<code>sys.stdout</code>或者文件。</li>
<li><code>logging.FileHandler</code>：日志输出到文件</li>
<li><code>logging.handlers.SocketHandler</code>：远程输出日志到<code>TCP/IP sockets</code>。</li>
<li><code>logging.handlers.DatagramHandler</code>：远程输出日志到<code>UDP sockets</code>。</li>
<li><code>logging.handlers.SMTPHandler</code>：远程输出日志到邮件地址。</li>
<li><code>logging.handlers.SysLogHandler</code>：日志输出到<code>syslog</code>。</li>
<li><code>logging.handlers.NTEventLogHandler</code>：远程输出日志到<code>Windows NT/2000/XP</code>的事件日志。</li>
<li><code>logging.handlers.MemoryHandler</code>：日志输出到内存中的指定<code>buffer</code>。</li>
<li><code>logging.handlers.HTTPHandler</code>：通过<code>GET</code>或<code>POST</code>远程输出到<code>HTTP</code>服务器。</li>
</ul>
<p>以下是日志回滚方式，经常使用<code>RotatingFileHandler</code>和<code>TimedRotatingFileHandler</code>：</p>
<ul>
<li>logging.handlers.BaseRotatingHandler</li>
<li>logging.handlers.RotatingFileHandler</li>
<li>logging.handlers.TimedRotatingFileHandler</li>
</ul>
<p>由于<code>StreamHandler</code>和<code>FileHandler</code>是常用的日志处理方式，所以直接包含在<code>logging</code>模块中，而其他方式则包含在<code>logging.handlers</code>模块中。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Android/Intent/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Android/Intent/" itemprop="url">Intent</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T10:20:19+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Android</code>中提供了<code>Intent</code>机制来协助应用间的交互与通讯。<code>Intent</code>负责对应用中一次操作的动作以及附加数据进行描述，<code>Android</code>则根据此<code>Intent</code>的描述，负责找到对应的组件，将<code>Intent</code>传递给调用的组件，并完成组件的调用。<br>&emsp;&emsp;<code>Intent</code>不仅可用于应用程序之间，也可用于应用程序内部的<code>Activity</code>或<code>Service</code>之间的交互。因此<code>Intent</code>在这里起着一个媒体中介的作用，专门提供组件互相调用的相关信息，实现调用者与被调用者之间的解耦。<code>SDK</code>给出了<code>Intent</code>作用的表现形式：</p>
<ul>
<li>通过<code>startActivity</code>或<code>Activity.startActivityForResult</code>启动一个<code>Activity</code>。</li>
<li>通过<code>startService</code>启动一个服务，或者通过<code>bindService</code>和后台服务交互。</li>
<li>通过广播方法(比如<code>sendBroadcast</code>、<code>sendOrderedBroadcast</code>和<code>sendStickyBroadcast</code>)发给<code>broadcast receivers</code>。</li>
</ul>
<h3 id="Intent属性的设置"><a href="#Intent属性的设置" class="headerlink" title="Intent属性的设置"></a>Intent属性的设置</h3><h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><p>&emsp;&emsp;<code>SDK</code>中定义了一些标准的动作，<code>Action</code>就是表示了要执行操作的字符串(比如查看或选择)，其对应着<code>Intent Filter</code>中的<code>action</code>标签<code>&lt;action /&gt;</code>。常见的<code>Activity Action Intent</code>常量如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>常量名称</th>
<th>常量值</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACTION_MAIN</code></td>
<td><code>android.intent.action.MAIN</code></td>
<td>应用程序入口</td>
</tr>
<tr>
<td><code>ACTION_VIEW</code></td>
<td><code>android.intent.action.VIEW</code></td>
<td>显示数据给用户</td>
</tr>
<tr>
<td><code>ACTION_ATTACH_DATA</code></td>
<td><code>android.intent.action.ATTACH_DATA</code></td>
<td>指明附加信息给其他地方的一些数据</td>
</tr>
<tr>
<td><code>ACTION_EDIT</code></td>
<td><code>android.intent.action.EDIT</code></td>
<td>显示可编辑的数据</td>
</tr>
<tr>
<td><code>ACTION_PICK</code></td>
<td><code>android.intent.action.PICK</code></td>
<td>选择数据</td>
</tr>
<tr>
<td><code>ACTION_CHOOSER</code></td>
<td><code>android.intent.action.CHOOSER</code></td>
<td>显示一个<code>Activity</code>选择器</td>
</tr>
<tr>
<td><code>ACTION_GET_CONTENT</code></td>
<td><code>android.intent.action.GET_CONTENT</code></td>
<td>获得内容</td>
</tr>
<tr>
<td><code>ACTION_DIAL</code></td>
<td><code>android.intent.action.GET_CONTENT</code></td>
<td>显示打电话面板</td>
</tr>
<tr>
<td><code>ACITON_CALL</code></td>
<td><code>android.intent.action.DIAL</code></td>
<td>直接打电话</td>
</tr>
<tr>
<td><code>ACTION_SEND</code></td>
<td><code>android.intent.action.SEND</code></td>
<td>直接发短信</td>
</tr>
<tr>
<td><code>ACTION_SENDTO</code></td>
<td><code>android.intent.action.SENDTO</code></td>
<td>选择发短信</td>
</tr>
<tr>
<td><code>ACTION_ANSWER</code></td>
<td><code>android.intent.action.ANSWER</code></td>
<td>应答电话</td>
</tr>
<tr>
<td><code>ACTION_INSERT</code></td>
<td><code>android.intent.action.INSERT</code></td>
<td>插入数据</td>
</tr>
<tr>
<td><code>ACTION_DELETE</code></td>
<td><code>android.intent.action.DELETE</code></td>
<td>删除数据</td>
</tr>
<tr>
<td><code>ACTION_RUN</code></td>
<td><code>android.intent.action.RUN</code></td>
<td>运行数据</td>
</tr>
<tr>
<td><code>ACTION_SYNC</code></td>
<td><code>android.intent.action.SYNC</code></td>
<td>同步数据</td>
</tr>
<tr>
<td><code>ACTION_PICK_ACTIVITY</code></td>
<td><code>android.intent.action.PICK_ACTIVITY</code></td>
<td>选择<code>Activity</code></td>
</tr>
<tr>
<td><code>ACTION_SEARCH</code></td>
<td><code>android.intent.action.SEARCH</code></td>
<td>搜索</td>
</tr>
<tr>
<td><code>ACTION_WEB_SEARCH</code></td>
<td><code>android.intent.action.WEB_SEARCH</code></td>
<td><code>Web</code>搜索</td>
</tr>
<tr>
<td><code>ACTION_FACTORY_TEST</code></td>
<td><code>android.intent.action.FACTORY_TEST</code></td>
<td>工厂测试入口点</td>
</tr>
</tbody>
</table>
</div>
<p>常见的<code>BroadcastIntent Action</code>常量如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>常量名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACTION_TIME_TICK</code></td>
<td>系统时间每过一分钟发出的广播</td>
</tr>
<tr>
<td><code>ACTION_TIME_CHANGED</code></td>
<td>系统时间通过设置发生了变化</td>
</tr>
<tr>
<td><code>ACTION_TIMEZONE_CHANGED</code></td>
<td>时区改变</td>
</tr>
<tr>
<td><code>ACTION_BOOT_COMPLETED</code></td>
<td>系统启动完毕</td>
</tr>
<tr>
<td><code>ACTION_PACKAGE_ADDED</code></td>
<td>新的应用程序<code>apk</code>包安装完毕</td>
</tr>
<tr>
<td><code>ACTION_PACKAGE_CHANGED</code></td>
<td>现有应用程序<code>apk</code>包改变</td>
</tr>
<tr>
<td><code>ACTION_PACKAGE_REMOVED</code></td>
<td>现有应用程序<code>apk</code>包被删除</td>
</tr>
<tr>
<td><code>ACTION_UID_REMOVED</code></td>
<td>用户<code>id</code>被删除</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h4><p>&emsp;&emsp;此处所说的<code>Intent</code>中的<code>data</code>指的是<code>URI</code>对象和数据的<code>MIME</code>类型，其对应着<code>Intent Filter</code>中的<code>data</code>标签<code>&lt;data /&gt;</code>。<br>&emsp;&emsp;一个完整的<code>URI</code>由<code>scheme</code>、<code>host</code>、<code>port</code>、<code>path</code>组成，格式是<code>&lt;scheme&gt;://&lt;host&gt;:&lt;port&gt;/&lt;path&gt;</code>，例如<code>content://com.example.project:200/folder/subfolder/etc</code>。<code>URI</code>就像一个数据链接，组件可以根据此<code>URI</code>获得最终的数据来源。通常将<code>URI</code>和<code>action</code>结合使用，比如我们将<code>action</code>设置为<code>ACTION_VIEW</code>，应该提供将要被编辑修改的文档的<code>URI</code>。<br>&emsp;&emsp;当创建了一个<code>Intent</code>对象的时候，除了指定<code>URI</code>之外，指定数据的<code>MIME</code>类型也很重要。例如一个<code>Activity</code>能够显示图片，但是不能够播放视频，显示图片的<code>URI</code>和播放视频的<code>URI</code>可能很类似，为了不让<code>Android</code>误将一个含有视频<code>URI</code>的<code>Intent</code>对象传递给一个只能显示图片的<code>Activity</code>，我们需要在该<code>Activity</code>的<code>Intent Filter</code>中指定MIME类型为图片(例如<code>&lt;data android:mimeType=&quot;image/*&quot; ... /&gt;</code>)，并且还要给<code>Intent</code>对象设置对应的图片类型的<code>MIME</code>，这样<code>Android</code>就会基于<code>URI</code>和<code>MIME</code>类型将<code>Intent</code>传递给符合条件的组件。有个特例，如果<code>URI</code>使用的是<code>content:</code>协议，那么这就说明<code>URI</code>所提供的数据将来自于本地设备，即数据由<code>ContentProvider</code>提供，这种情况下<code>Android</code>会根据<code>URI</code>自动推断出<code>MIME</code>类型，此种情况我们无需再自己指定<code>MIME</code>类型。<br>&emsp;&emsp;<code>Intent</code>的<code>Action</code>和<code>Data</code>属性匹配如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Action属性</th>
<th>Data属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACTION_VIEW</code></td>
<td><code>content://contacts/people/1</code></td>
<td>显示<code>id</code>为<code>1</code>的联系人信息</td>
</tr>
<tr>
<td><code>ACTION_DIAL</code></td>
<td><code>content://contacts/people/1</code></td>
<td>将<code>id</code>为<code>1</code>的联系人电话号码显示在拨号界面中</td>
</tr>
<tr>
<td><code>ACITON_VIEW</code></td>
<td><code>tel:123</code></td>
<td>显示电话为<code>123</code>的联系人信息</td>
</tr>
<tr>
<td><code>ACTION_VIEW</code></td>
<td><code>http://www.google.com</code></td>
<td>在浏览器中浏览该网站</td>
</tr>
<tr>
<td><code>ACTION_VIEW</code></td>
<td><code>file://sdcard/mymusic.mp3</code></td>
<td>播放<code>MP3</code></td>
</tr>
<tr>
<td><code>ACTION_VIEW</code></td>
<td><code>geo:39.2456,116.3523</code></td>
<td>显示地图</td>
</tr>
</tbody>
</table>
</div>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>&emsp;&emsp;<code>type</code>是数据类型，用于显式指定<code>Intent</code>的数据类型<code>MIME</code>。一般<code>Intent</code>的数据类型能够根据数据本身进行判定，但是通过设置这个属性，可以强制采用显式指定的类型而不再进行推导。</p>
<h4 id="category"><a href="#category" class="headerlink" title="category"></a>category</h4><p>&emsp;&emsp;<code>category</code>包含了关于组件如何处理<code>Intent</code>的一些其他信息。例如<code>LAUNCHER_CATEGORY</code>表示<code>Intent</code>的接受者应该在<code>Launcher</code>中作为顶级应用出现；而<code>ALTERNATIVE_CATEGORY</code>表示当前的<code>Intent</code>是一系列的可选动作中的一个，这些动作可以在同一块数据上执行。其他的<code>category</code>如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Constant</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CATEGORY_BROWSABLE</code></td>
<td>The target activity can be safely invoked by the browser to display data referenced by a link. For example, an image or an <code>e-mail</code> message.</td>
</tr>
<tr>
<td><code>CATEGORY_GADGET</code></td>
<td>The activity can be embedded inside of another activity that hosts gadgets.</td>
</tr>
<tr>
<td><code>CATEGORY_HOME</code></td>
<td>The activity displays the home screen, the first screen the user sees when the device is turned on or when the <code>HOME</code> key is pressed.</td>
</tr>
<tr>
<td><code>CATEGORY_LAUNCHER</code></td>
<td>The activity can be the initial activity of a task and is listed in the <code>top-level</code> application launcher.</td>
</tr>
<tr>
<td><code>CATEGORY_PREFERENCE</code></td>
<td>The target activity is a preference panel.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="component"><a href="#component" class="headerlink" title="component"></a>component</h4><p>&emsp;&emsp;<code>component</code>(组件)指定<code>Intent</code>的目标组件的类名称。通常<code>Android</code>会根据<code>Intent</code>中包含的其它属性的信息，比如<code>action</code>、<code>data</code>、<code>type</code>、<code>category</code>进行查找，最终找到一个与之匹配的目标组件。但是如果<code>component</code>这个属性有指定的话，将直接使用它指定的组件，而不再执行上述查找过程。指定了这个属性以后，<code>Intent</code>的其它所有属性都是可选的。</p>
<h4 id="extras"><a href="#extras" class="headerlink" title="extras"></a>extras</h4><p>&emsp;&emsp;<code>extras</code>(附加信息)是其它所有附加信息的集合。使用<code>extras</code>可以为组件提供扩展信息，比如如果要执行<code>发送电子邮件</code>这个动作，可以将电子邮件的标题、正文等保存在<code>extras</code>里，传给电子邮件发送组件。有的<code>Intent</code>需要靠<code>URI</code>携带数据，有的<code>Intent</code>是靠<code>extras</code>携带数据信息。<br>&emsp;&emsp;你可以通过调用<code>Intent</code>对象的各种重载的<code>putExtra(key,value)</code>方法向<code>Intent</code>中加入各种<code>键值对</code>形式的额外数据，也可以直接创建一个<code>Bundle</code>对象，向该<code>Bundle</code>对象传入很多<code>键值对</code>，然后通过调用<code>Intent</code>对象的<code>putExtras(Bundle)</code>方法将其这些键值对设置到<code>Intent</code>对象中。</p>
<h3 id="显式和隐式Intent"><a href="#显式和隐式Intent" class="headerlink" title="显式和隐式Intent"></a>显式和隐式Intent</h3><p>&emsp;&emsp;理解<code>Intent</code>的关键之一是理解清楚<code>Intent</code>的两种基本用法：一种是显式的<code>Intent</code>，即在构造<code>Intent</code>对象时就指定接收者；另一种是隐式的<code>Intent</code>，即<code>Intent</code>的发送者在构造<code>Intent</code>对象时，并不知道也不关心接收者是谁，有利于降低发送者和接收者之间的耦合。<br>&emsp;&emsp;对于显式<code>Intent</code>，<code>Android</code>不需要去做解析，因为目标组件已经很明确；<code>Android</code>需要解析的是那些隐式<code>Intent</code>，通过解析，将<code>Intent</code>映射给可以处理此<code>Intent</code>的<code>Activity</code>、<code>IntentReceiver</code>或<code>Service</code>。<br>&emsp;&emsp;显式的<code>Intent</code>：如果<code>Intent</code>中明确包含了要启动的组件的完整类名(包名及类名)，那么这个<code>Intent</code>就是<code>explict</code>(显式的)。使用显式<code>Intent</code>最典型的情形是在你自己的<code>App</code>中启动一个组件，因为你自己肯定知道自己的要启动的组件的类名。比如，为了响应用户操作通过显式的<code>Intent</code>在你的<code>App</code>中启动一个<code>Activity</code>或启动一个<code>Service</code>下载文件。<br>&emsp;&emsp;隐式的<code>Intent</code>：如果<code>Intent</code>没有包含要启动的组件的完整类名，那么这个<code>Intent</code>就是<code>implict</code>(隐式的)。虽然隐式的<code>Intent</code>没有指定要启动的组件的类名，但是一般情况下，隐式的<code>Intent</code>都要指定需要执行的<code>action</code>。通常情况下，隐式的<code>Intent</code>只用在当我们想在自己的<code>App</code>中通过<code>Intent</code>启动另一个<code>App</code>组件的时候，让另一个<code>App</code>组件接收并处理该<code>Intent</code>。例如你想在地图上给用户显示一个位置，但是你的<code>App</code>又不支持地图展示，这时你可以将位置信息放入到一个<code>Intent</code>中，然后给它指定相应的<code>action</code>，通过这样隐式的<code>Intent</code>请求其他的地图型的<code>App</code>(例如<code>Google Map</code>)来在地图中展示一个指定的位置。隐式的<code>Intent</code>也体现了<code>Android</code>的一种设计哲学：我自己的<code>App</code>无需包罗万象所有功能，可以通过与其他<code>App</code>组合起来，给用户提供很好的用户体验。而连接自己的<code>App</code>与其他<code>App</code>的纽带就是隐式<code>Intent</code>。<br>&emsp;&emsp;当创建了一个显式<code>Intent</code>去启动<code>Activity</code>或<code>Service</code>的时候，系统会立即启动<code>Intent</code>中所指定的组件。<br>&emsp;&emsp;当创建了一个隐式<code>Intent</code>去使用的时候，<code>Android</code>系统会将该隐式<code>Intent</code>所包含的信息与设备上其他所有<code>App</code>的<code>manifest</code>文件中注册组件的<code>Intent Filters</code>进行对比过滤，从中找出满足能够接收处理该隐式<code>Intent</code>的<code>App</code>和对应的组件。如果有多个<code>App</code>中的某个组件都符合条件，那么<code>Android</code>会弹出一个对话框让用户选择需要启动哪个<code>App</code>。</p>
<h3 id="Intent-Filter"><a href="#Intent-Filter" class="headerlink" title="Intent Filter"></a>Intent Filter</h3><p>&emsp;&emsp;<code>Intent Filter</code>即<code>Intent</code>过滤器，一个组件可以包含<code>0</code>个或多个<code>Intent Filter</code>。<code>Intent Filter</code>是写在<code>App</code>的<code>manifest</code>文件中的，其通过设置<code>action</code>或<code>uri</code>数据类型等指明了组件能够处理接收的<code>Intent</code>的类型。如果你给你的<code>Activity</code>设置了<code>Intent Filter</code>，那么这就使得其他的<code>App</code>有可能通过隐式<code>Intent</code>启动你的这个<code>Activity</code>。反之，如果你的<code>Activity</code>不包含任何<code>Intent Filter</code>，那么该<code>Activity</code>只能通过显式<code>Intent</code>启动。由于我们一般不会暴露出我们组件的完整类名，所以这种情况下，其他的<code>App</code>基本就不可能通过<code>Intent</code>启动我们的<code>Activity</code>了(因为它们不知道该<code>Activity</code>的完整类名)，只能由我们自己的<code>App</code>通过显式<code>Intent</code>启动。</p>
<hr>
<h3 id="启动第三方程序"><a href="#启动第三方程序" class="headerlink" title="启动第三方程序"></a>启动第三方程序</h3><p>&emsp;&emsp;可以使用<code>ComponentName</code>启动另一个组件，例如<code>MainActivity.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.littlefool.myapplication;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> android.content.ComponentName;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button = findViewById(R.id.button_first);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">                ComponentName componentName = <span class="keyword">new</span> ComponentName(</span><br><span class="line">                        <span class="string">"com.example.littlefool.myapplication"</span>,</span><br><span class="line">                        <span class="string">"com.example.littlefool.myapplication.Main3Activity"</span>);</span><br><span class="line">                intent.setComponent(componentName);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Main3Activity.java</code>如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.littlefool.myapplication;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main3Activity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ComponentName</code>的第一个参数是包的名称，第二个参数是包中的组件名称。</p>
<hr>
<h3 id="返回HOME界面"><a href="#返回HOME界面" class="headerlink" title="返回HOME界面"></a>返回HOME界面</h3><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button = findViewById(R.id.button_first);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">                intent.setAction(intent.ACTION_MAIN);</span><br><span class="line">                intent.addCategory(intent.CATEGORY_HOME);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="隐式Intent调用启动浏览器"><a href="#隐式Intent调用启动浏览器" class="headerlink" title="隐式Intent调用启动浏览器"></a>隐式Intent调用启动浏览器</h3><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button = findViewById(R.id.button_first);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">                intent.setAction(intent.ACTION_VIEW);</span><br><span class="line">                intent.setData(Uri.parse(<span class="string">"https://www.google.com"</span>));</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Intent-Filter的应用"><a href="#Intent-Filter的应用" class="headerlink" title="Intent Filter的应用"></a>Intent Filter的应用</h3><p>&emsp;&emsp;<code>Java</code>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button = findViewById(R.id.button_first);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">                intent.setAction(intent.ACTION_VIEW);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AndroidManifest.xml</code>增加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".Main3Activity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/25/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><span class="space">&hellip;</span><a class="page-number" href="/page/95/">95</a><a class="extend next" rel="next" href="/page/27/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">943</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
