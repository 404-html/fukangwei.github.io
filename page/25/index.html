<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="暴徒">
<meta property="og:url" content="http://fukangwei.gitee.io/page/25/index.html">
<meta property="og:site_name" content="暴徒">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="暴徒">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/page/25/">





  <title>暴徒</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">暴徒</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/深度学习/Keras之顺序模型/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/深度学习/Keras之顺序模型/" itemprop="url">Keras之顺序模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T16:28:48+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;顺序模型是多个网络层的线性堆叠，也就是<code>一条路走到黑</code>。你可以通过将层的列表传递给<code>Sequential</code>的构造函数，来创建一个<code>Sequential</code>模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Activation</span><br><span class="line">​</span><br><span class="line">model = Sequential([</span><br><span class="line">    Dense(<span class="number">32</span>, input_shape=(<span class="number">784</span>,)),</span><br><span class="line">    Activation(<span class="string">'relu'</span>),</span><br><span class="line">    Dense(<span class="number">10</span>),</span><br><span class="line">    Activation(<span class="string">'softmax'</span>),</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>也可以使用<code>add</code>函数将各层添加到模型中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, input_dim=<span class="number">784</span>))</span><br><span class="line">model.add(Activation(<span class="string">'relu'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="指定输入数据的尺寸"><a href="#指定输入数据的尺寸" class="headerlink" title="指定输入数据的尺寸"></a>指定输入数据的尺寸</h3><p>&emsp;&emsp;模型需要知道它所期望的输入的尺寸。出于这个原因，顺序模型中的第一层(只有第一层，因为下面的层可以自动地推断尺寸)需要接收关于其输入尺寸的信息。有几种方法来做到这一点：</p>
<ul>
<li>传递一个<code>input_shape</code>参数给第一层。它是一个表示尺寸的元组(一个整数或<code>None</code>的元组，其中<code>None</code>表示可能为任何正整数)。在<code>input_shape</code>中不包含数据的<code>batch</code>大小。</li>
<li>某些<code>2D</code>层(例如<code>Dense</code>)支持通过参数<code>input_dim</code>指定输入尺寸；某些<code>3D</code>时序层支持<code>input_dim</code>和<code>input_length</code>参数。</li>
<li>如果你需要为输入指定一个固定的<code>batch</code>大小(这对<code>stateful RNNs</code>很有用)，可以传递一个<code>batch_size</code>参数给一个层。如果你同时将<code>batch_size = 32</code>和<code>input_shape = (6, 8)</code>传递给一个层，那么每一批输入的尺寸就为<code>(32, 6, 8)</code>。</li>
</ul>
<p>因此下面的代码片段是等价的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, input_shape=(<span class="number">784</span>,)))</span><br><span class="line"><span class="comment"># ------------------</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, input_dim=<span class="number">784</span>))</span><br></pre></td></tr></table></figure>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>&emsp;&emsp;在训练模型之前，您需要配置学习过程，这是通过<code>compile</code>方法完成的，它接收三个参数：</p>
<ul>
<li>优化器<code>optimizer</code>：它可以是现有优化器的字符串标识符，例如<code>rmsprop</code>或<code>adagrad</code>，也可以是<code>Optimizer</code>类的实例。</li>
<li>损失函数<code>loss</code>：该参数为模型试图最小化的目标函数。它可以是现有损失函数的字符串标识符，例如<code>categorical_crossentropy</code>或<code>mse</code>，也可以是一个目标函数。</li>
<li>评估标准<code>metrics</code>：对于任何分类问题，你都希望将其设置为<code>metrics = [&#39;accuracy&#39;]</code>。评估标准可以是现有的标准的字符串标识符，也可以是自定义的评估标准函数。评估标准应该返回单个张量，或一个完成<code>metric_name -&gt; metric_value</code>映射的字典。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'categorical_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])  <span class="comment"># 多分类问题</span></span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'binary_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])  <span class="comment"># 二分类问题</span></span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'mse'</span>)  <span class="comment"># 均方误差回归问题</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> keras.backend <span class="keyword">as</span> K</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean_pred</span><span class="params">(y_true, y_pred)</span>:</span>  <span class="comment"># 自定义评估标准函数</span></span><br><span class="line">    <span class="keyword">return</span> K.mean(y_pred)</span><br><span class="line">​</span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'binary_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>, mean_pred])</span><br></pre></td></tr></table></figure>
<h3 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h3><p>&emsp;&emsp;<code>Keras</code>模型在输入数据和标签的<code>Numpy</code>矩阵上进行训练。为了训练一个模型，你通常会使用<code>fit</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 二分类的单输入模型：</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, activation=<span class="string">'relu'</span>, input_dim=<span class="number">100</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>))</span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'binary_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.random.random((<span class="number">1000</span>, <span class="number">100</span>))</span><br><span class="line">labels = np.random.randint(<span class="number">2</span>, size=(<span class="number">1000</span>, <span class="number">1</span>))</span><br><span class="line">​</span><br><span class="line">model.fit(data, labels, epochs=<span class="number">10</span>, batch_size=<span class="number">32</span>)  <span class="comment"># 训练模型，以32个样本为一个batch进行迭代</span></span><br><span class="line"><span class="comment"># -----------------------------------------</span></span><br><span class="line"><span class="comment"># 10分类的单输入模型：</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, activation=<span class="string">'relu'</span>, input_dim=<span class="number">100</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>))</span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'categorical_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.random.random((<span class="number">1000</span>, <span class="number">100</span>))</span><br><span class="line">labels = np.random.randint(<span class="number">10</span>, size=(<span class="number">1000</span>, <span class="number">1</span>))</span><br><span class="line">​</span><br><span class="line">one_hot_labels = keras.utils.to_categorical(labels, num_classes=<span class="number">10</span>)  <span class="comment"># 将标签转换为分类的one-hot编码</span></span><br><span class="line">model.fit(data, one_hot_labels, epochs=<span class="number">10</span>, batch_size=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>&emsp;&emsp;这里有几个可以帮助你开始的例子。在<code>examples</code>目录中，你可以找到真实数据集的示例模型：</p>
<ul>
<li><code>CIFAR10</code>：小图片分类，具有实时数据增强的卷积神经网络(<code>CNN</code>)。</li>
<li><code>IMDB</code>：电影评论情感分类(基于词序列的<code>LSTM</code>)。</li>
<li><code>Reuters</code>：新闻主题分类(多层感知器<code>MLP</code>)。</li>
<li><code>MNIST</code>：手写数字分类(<code>MLP</code>和<code>CNN</code>)。</li>
</ul>
<p>&emsp;&emsp;基于多层感知器<code>MLP</code>的<code>softmax</code>多分类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Dropout, Activation</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> SGD</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line">x_train = np.random.random((<span class="number">1000</span>, <span class="number">20</span>))</span><br><span class="line">y_train = keras.utils.to_categorical(np.random.randint(<span class="number">10</span>, size=(<span class="number">1000</span>, <span class="number">1</span>)), num_classes=<span class="number">10</span>)</span><br><span class="line">x_test = np.random.random((<span class="number">100</span>, <span class="number">20</span>))</span><br><span class="line">y_test = keras.utils.to_categorical(np.random.randint(<span class="number">10</span>, size=(<span class="number">100</span>, <span class="number">1</span>)), num_classes=<span class="number">10</span>)</span><br><span class="line">​</span><br><span class="line">model = Sequential()</span><br><span class="line">​</span><br><span class="line"><span class="comment"># Dense(64)是一个具有64个隐藏神经元的全连接层。在第一层必须指定所期望的输入数据尺寸，这里是一个20维的向量</span></span><br><span class="line">model.add(Dense(<span class="number">64</span>, activation=<span class="string">'relu'</span>, input_dim=<span class="number">20</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(Dense(<span class="number">64</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>))</span><br><span class="line">​</span><br><span class="line">sgd = SGD(lr=<span class="number">0.01</span>, decay=<span class="number">1e-6</span>, momentum=<span class="number">0.9</span>, nesterov=<span class="keyword">True</span>)</span><br><span class="line">model.compile(loss=<span class="string">'categorical_crossentropy'</span>, optimizer=sgd, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">20</span>, batch_size=<span class="number">128</span>)</span><br><span class="line">score = model.evaluate(x_test, y_test, batch_size=<span class="number">128</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;基于多层感知器的二分类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Dropout</span><br><span class="line">​</span><br><span class="line">x_train = np.random.random((<span class="number">1000</span>, <span class="number">20</span>))</span><br><span class="line">y_train = np.random.randint(<span class="number">2</span>, size=(<span class="number">1000</span>, <span class="number">1</span>))</span><br><span class="line">x_test = np.random.random((<span class="number">100</span>, <span class="number">20</span>))</span><br><span class="line">y_test = np.random.randint(<span class="number">2</span>, size=(<span class="number">100</span>, <span class="number">1</span>))</span><br><span class="line">​</span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">64</span>, input_dim=<span class="number">20</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(Dense(<span class="number">64</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>))</span><br><span class="line">​</span><br><span class="line">model.compile(loss=<span class="string">'binary_crossentropy'</span>, optimizer=<span class="string">'rmsprop'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">20</span>, batch_size=<span class="number">128</span>)</span><br><span class="line">score = model.evaluate(x_test, y_test, batch_size=<span class="number">128</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;类似VGG的卷积神经网络：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Dropout, Flatten</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Conv2D, MaxPooling2D</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> SGD</span><br><span class="line">​</span><br><span class="line">x_train = np.random.random((<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>))</span><br><span class="line">y_train = keras.utils.to_categorical(np.random.randint(<span class="number">10</span>, size=(<span class="number">100</span>, <span class="number">1</span>)), num_classes=<span class="number">10</span>)</span><br><span class="line">x_test = np.random.random((<span class="number">20</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>))</span><br><span class="line">y_test = keras.utils.to_categorical(np.random.randint(<span class="number">10</span>, size=(<span class="number">20</span>, <span class="number">1</span>)), num_classes=<span class="number">10</span>)</span><br><span class="line">​</span><br><span class="line">model = Sequential()</span><br><span class="line"><span class="comment"># 输入是3通道“100*100”像素图像 -&gt; (100, 100, 3)张量。使用32个大小为“3 * 3”的卷积滤波器</span></span><br><span class="line">model.add(Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">'relu'</span>, input_shape=(<span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>)))</span><br><span class="line">model.add(Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(Dropout(<span class="number">0.25</span>))</span><br><span class="line">​</span><br><span class="line">model.add(Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(Dropout(<span class="number">0.25</span>))</span><br><span class="line">​</span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">256</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>))</span><br><span class="line">​</span><br><span class="line">sgd = SGD(lr=<span class="number">0.01</span>, decay=<span class="number">1e-6</span>, momentum=<span class="number">0.9</span>, nesterov=<span class="keyword">True</span>)</span><br><span class="line">model.compile(loss=<span class="string">'categorical_crossentropy'</span>, optimizer=sgd)</span><br><span class="line">​</span><br><span class="line">model.fit(x_train, y_train, batch_size=<span class="number">32</span>, epochs=<span class="number">10</span>)</span><br><span class="line">score = model.evaluate(x_test, y_test, batch_size=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;基于<code>1D</code>卷积的序列分类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Dropout</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Embedding</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Conv1D, GlobalAveragePooling1D, MaxPooling1D</span><br><span class="line">​</span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Conv1D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">'relu'</span>, input_shape=(seq_length, <span class="number">100</span>)))</span><br><span class="line">model.add(Conv1D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling1D(<span class="number">3</span>))</span><br><span class="line">model.add(Conv1D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(Conv1D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(GlobalAveragePooling1D())</span><br><span class="line">model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>))</span><br><span class="line">​</span><br><span class="line">model.compile(loss=<span class="string">'binary_crossentropy'</span>, optimizer=<span class="string">'rmsprop'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.fit(x_train, y_train, batch_size=<span class="number">16</span>, epochs=<span class="number">10</span>)</span><br><span class="line">score = model.evaluate(x_test, y_test, batch_size=<span class="number">16</span>)</span><br></pre></td></tr></table></figure>
<h3 id="基于栈式LSTM的序列分类"><a href="#基于栈式LSTM的序列分类" class="headerlink" title="基于栈式LSTM的序列分类"></a>基于栈式LSTM的序列分类</h3><p>&emsp;&emsp;在这个模型中，我们将<code>3</code>个<code>LSTM</code>层叠在一起，使该模型能够学习更高层次的时域特征表示。前两个<code>LSTM</code>返回完整的输出序列，但最后一个只返回输出序列的最后一步，从而降低了时间维度(也就是将输入序列转换成单个向量)。</p>
<p><img src="/2019/02/11/深度学习/Keras之顺序模型/1.png" height="296" width="336"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> LSTM, Dense</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line">data_dim = <span class="number">16</span></span><br><span class="line">timesteps = <span class="number">8</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line">​</span><br><span class="line"><span class="comment"># 期望输入数据尺寸：(batch_size, timesteps, data_dim)</span></span><br><span class="line">model = Sequential()</span><br><span class="line"><span class="comment"># 返回维度为32的向量序列</span></span><br><span class="line">model.add(LSTM(<span class="number">32</span>, return_sequences=<span class="keyword">True</span>, input_shape=(timesteps, data_dim)))</span><br><span class="line">model.add(LSTM(<span class="number">32</span>, return_sequences=<span class="keyword">True</span>))  <span class="comment"># 返回维度为32的向量序列</span></span><br><span class="line">model.add(LSTM(<span class="number">32</span>))  <span class="comment"># 返回维度为32的单个向量</span></span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>))</span><br><span class="line">​</span><br><span class="line">model.compile(loss=<span class="string">'categorical_crossentropy'</span>, optimizer=<span class="string">'rmsprop'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 生成模拟训练数据</span></span><br><span class="line">x_train = np.random.random((<span class="number">1000</span>, timesteps, data_dim))</span><br><span class="line">y_train = np.random.random((<span class="number">1000</span>, num_classes))</span><br><span class="line"><span class="comment"># 生成模拟验证数据</span></span><br><span class="line">x_val = np.random.random((<span class="number">100</span>, timesteps, data_dim))</span><br><span class="line">y_val = np.random.random((<span class="number">100</span>, num_classes))</span><br><span class="line">​</span><br><span class="line">model.fit(x_train, y_train, batch_size=<span class="number">64</span>, epochs=<span class="number">5</span>, validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure>
<h3 id="带有状态-stateful-的相同的栈式LSTM模型"><a href="#带有状态-stateful-的相同的栈式LSTM模型" class="headerlink" title="带有状态(stateful)的相同的栈式LSTM模型"></a>带有状态(stateful)的相同的栈式LSTM模型</h3><p>&emsp;&emsp;有状态的循环神经网络模型(<code>stateful LSTM</code>)中，在一个<code>batch</code>的样本处理完成后，其内部状态(<code>记忆</code>)会被记录并作为下一个<code>batch</code>的样本的初始状态。这允许处理更长的序列，同时保持计算复杂度的可控性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> LSTM, Dense</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">​</span><br><span class="line">data_dim = <span class="number">16</span></span><br><span class="line">timesteps = <span class="number">8</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line">batch_size = <span class="number">32</span></span><br><span class="line">​</span><br><span class="line"><span class="comment"># 期望输入数据尺寸: (batch_size, timesteps, data_dim)。请注意，我们必须提供完整的batch_input_shape，因为网络是有状态的</span></span><br><span class="line"><span class="comment"># 第k批数据的第i个样本是第“k - 1”批数据的第i个样本的后续</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(LSTM(<span class="number">32</span>, return_sequences=<span class="keyword">True</span>, stateful=<span class="keyword">True</span>, batch_input_shape=(batch_size, timesteps, data_dim)))</span><br><span class="line">model.add(LSTM(<span class="number">32</span>, return_sequences=<span class="keyword">True</span>, stateful=<span class="keyword">True</span>))</span><br><span class="line">model.add(LSTM(<span class="number">32</span>, stateful=<span class="keyword">True</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>))</span><br><span class="line">​</span><br><span class="line">model.compile(loss=<span class="string">'categorical_crossentropy'</span>, optimizer=<span class="string">'rmsprop'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 生成模拟训练数据</span></span><br><span class="line">x_train = np.random.random((batch_size * <span class="number">10</span>, timesteps, data_dim))</span><br><span class="line">y_train = np.random.random((batch_size * <span class="number">10</span>, num_classes))</span><br><span class="line"><span class="comment"># 生成模拟验证数据</span></span><br><span class="line">x_val = np.random.random((batch_size * <span class="number">3</span>, timesteps, data_dim))</span><br><span class="line">y_val = np.random.random((batch_size * <span class="number">3</span>, num_classes))</span><br><span class="line">​</span><br><span class="line">model.fit(x_train, y_train, batch_size=batch_size, epochs=<span class="number">5</span>, shuffle=<span class="keyword">False</span>, validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Sequential顺序模型API"><a href="#Sequential顺序模型API" class="headerlink" title="Sequential顺序模型API"></a>Sequential顺序模型API</h3><p>&emsp;&emsp;常用的<code>Sequential</code>属性为<code>model.layers</code>，它是添加到模型的层的列表。</p>
<h4 id="add"><a href="#add" class="headerlink" title="add"></a>add</h4><p>&emsp;&emsp;该函数向模型中添加一个层：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(self, layer)  <span class="comment"># 参数layer是Layer对象</span></span><br></pre></td></tr></table></figure>
<h4 id="pop"><a href="#pop" class="headerlink" title="pop"></a>pop</h4><p>&emsp;&emsp;该函数弹出模型最后的一层，无返回值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop(self)</span><br></pre></td></tr></table></figure>
<h4 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h4><p>&emsp;&emsp;该函数用于配置训练模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile(</span><br><span class="line">    self, optimizer, loss, metrics=<span class="keyword">None</span>, sample_weight_mode=<span class="keyword">None</span>,</span><br><span class="line">    weighted_metrics=<span class="keyword">None</span>, target_tensors=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>optimizer</code>：字符串(预定义优化器名)或者优化器对象。</li>
<li><code>loss</code>：字符串(预定义损失函数名)或目标函数。如果模型具有多个输出，则可以通过传递损失函数的字典或列表，在每个输出上使用不同的损失。模型将最小化的损失值将是所有单个损失的总和。</li>
<li><code>metrics</code>：在训练和测试期间的模型评估标准，通常你会使用<code>metrics = [&#39;accuracy&#39;]</code>。要为多输出模型的不同输出指定不同的评估标准，还可以传递一个字典，如<code>metrics = {&#39;output_a&#39;：&#39;accuracy&#39;}</code>。</li>
<li><code>sample_weight_mode</code>：如果你需要执行按时间步采样权重(<code>2D</code>权重)，请将其设置为<code>temporal</code>。默认为<code>None</code>，为采样权重(<code>1D</code>)。如果模型有多个输出，则可以通过传递<code>mode</code>的字典或列表，以在每个输出上使用不同的<code>sample_weight_mode</code>。</li>
<li><code>weighted_metrics</code>：在训练和测试期间，由<code>sample_weight</code>或<code>class_weight</code>评估和加权的度量标准列表。</li>
<li><code>target_tensors</code>: 默认情况下，<code>Keras</code>将为模型的目标创建一个占位符，该占位符在训练过程中将被目标数据代替。相反，如果你想使用自己的目标张量(反过来说，<code>Keras</code>在训练期间不会载入这些目标张量的外部<code>Numpy</code>数据)，您可以通过<code>target_tensors</code>参数指定它们。目标张量可以是一个单独的张量(对应于单输出模型)，也可以是一个张量列表，或者一个<code>name -&gt; tensor</code>的张量字典。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, input_shape=(<span class="number">500</span>,)))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>))</span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>, loss=<span class="string">'categorical_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br></pre></td></tr></table></figure>
<h4 id="fit"><a href="#fit" class="headerlink" title="fit"></a>fit</h4><p>&emsp;&emsp;该函数的作用是以固定数量的轮次(数据集上的迭代)训练模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fit(</span><br><span class="line">    self, x=<span class="keyword">None</span>, y=<span class="keyword">None</span>, batch_size=<span class="keyword">None</span>, epochs=<span class="number">1</span>, verbose=<span class="number">1</span>,</span><br><span class="line">    callbacks=<span class="keyword">None</span>, validation_split=<span class="number">0.0</span>, validation_data=<span class="keyword">None</span>,</span><br><span class="line">    shuffle=<span class="keyword">True</span>, class_weight=<span class="keyword">None</span>, sample_weight=<span class="keyword">None</span>, initial_epoch=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>x</code>：训练数据的<code>Numpy</code>数组。如果模型中的输入层被命名，你也可以传递一个字典，将输入层名称映射到<code>Numpy</code>数组。如果从本地框架张量馈送(例如<code>TensorFlow</code>数据张量)数据，<code>x</code>可以是<code>None</code>。</li>
<li><code>y</code>：目标(<code>标签</code>)数据的<code>Numpy</code>数组。如果模型中的输出层被命名，你也可以传递一个字典，将输出层名称映射到<code>Numpy</code>数组。如果从本地框架张量馈送(例如<code>TensorFlow</code>数据张量)数据，<code>y</code>可以是<code>None</code>。</li>
<li><code>batch_size</code>：整数或<code>None</code>，指定进行梯度下降时每个<code>batch</code>包含的样本数。训练时，一个<code>batch</code>的样本会被计算一次梯度下降，使目标函数优化一步。</li>
<li><code>epochs</code>：整数，训练模型迭代轮次。一个轮次是在整个<code>x</code>或<code>y</code>上的一轮迭代。请注意，与<code>initial_epoch</code>一起，<code>epochs</code>被理解为<code>最终轮次</code>。模型并不是训练了<code>epochs</code>轮，而是到第<code>epochs</code>轮停止训练。</li>
<li><code>verbose</code>：日志显示模式，<code>0</code>为不在标准输出流输出日志信息，<code>1</code>为输出进度条记录，<code>2</code>为每个<code>epoch</code>输出一行记录。</li>
<li><code>callbacks</code>：<code>list</code>，其中的元素是<code>keras.callbacks.Callback</code>的对象。这个<code>list</code>中的回调函数将会在训练过程中的适当时机被调用。</li>
<li><code>validation_split</code>：<code>0</code>和<code>1</code>之间的浮点数，用来指定训练集的一定比例数据作为验证集。验证集将不参与训练，并在每个<code>epoch</code>结束后测试的模型的指标，如损失函数、精确度等。注意，<code>validation_split</code>的划分在<code>shuffle</code>之前，因此如果你的数据本身是有序的，需要先手工打乱再指定<code>validation_split</code>，否则可能会出现验证集样本不均匀。</li>
<li><code>validation_data</code>：元组<code>(x_val, y_val)</code>或元组<code>(x_val, y_val, val_sample_weights)</code>，是指定的验证集。这个参数会覆盖<code>validation_split</code>。</li>
<li><code>shuffle</code>：布尔值(是否在每轮迭代之前混洗数据)或者字符串(<code>batch</code>)。一般为布尔值，表示是否在训练过程中随机打乱输入样本的顺序。若为字符串<code>batch</code>，则是用来处理<code>HDF5</code>数据的特殊情况，它将在<code>batch</code>内部将数据打乱。</li>
<li><code>class_weight</code>：字典，将不同的类别映射为不同的权值，该参数用来在训练过程中调整损失函数(只能用于训练)。</li>
<li><code>sample_weight</code>：权值的<code>numpy array</code>，用于在训练时调整损失函数(仅用于训练)。可以传递一个<code>1D</code>的与样本等长的向量用于对样本进行1对1的加权，或者在面对时序数据时，传递一个的形式为<code>(samples, sequence_length)</code>的矩阵来为每个时间步上的样本赋不同的权。这种情况下请确定在编译模型时添加了<code>sample_weight_mode=&#39;temporal&#39;</code>。</li>
<li><code>initial_epoch</code>：从该参数指定的<code>epoch</code>开始训练，有助于恢复之前的训练。</li>
<li><code>fit</code>函数返回一个<code>History</code>的对象，其<code>History.history</code>属性记录了损失函数和其他指标的数值随<code>epoch</code>变化的情况，如果有验证集的话，也包含了验证集的这些指标变化情况。</li>
</ul>
<h4 id="evaluate"><a href="#evaluate" class="headerlink" title="evaluate"></a>evaluate</h4><p>&emsp;&emsp;本函数按<code>batch</code>计算在某些输入数据上模型的误差：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evaluate(self, x=<span class="keyword">None</span>, y=<span class="keyword">None</span>, batch_size=<span class="keyword">None</span>, verbose=<span class="number">1</span>, sample_weight=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>x</code>：输入数据，<code>Numpy</code>数组或列表(如果模型有多输入)。如果从本地框架张量馈送(例如<code>TensorFlow</code>数据张量)数据，<code>x</code>可以是<code>None</code>。</li>
<li><code>y</code>：标签，<code>Numpy</code>数组。如果从本地框架张量馈送(例如<code>TensorFlow</code>数据张量)数据，<code>y</code>可以是<code>None</code>。</li>
<li><code>batch_size</code>：整数，每次梯度更新的样本数。</li>
<li><code>verbose</code>：日志显示模式，<code>0</code>或<code>1</code>。</li>
<li><code>sample_weight</code>：样本权重，<code>Numpy</code>数组。</li>
</ul>
<p>本函数返回一个测试误差的标量值(如果模型没有其他评价指标)，或一个标量的<code>list</code>(如果模型还有其他的评价指标)。<code>model.metrics_names</code>将给出<code>list</code>中各个值的含义。</p>
<h4 id="predict"><a href="#predict" class="headerlink" title="predict"></a>predict</h4><p>&emsp;&emsp;该函数的作用是为输入样本生成输出预测：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predict(self, x, batch_size=<span class="keyword">None</span>, verbose=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>该函数返回预测的<code>Numpy</code>数组。</p>
<h4 id="train-on-batch"><a href="#train-on-batch" class="headerlink" title="train_on_batch"></a>train_on_batch</h4><p>&emsp;&emsp;该函数在一个<code>batch</code>的数据上进行一次参数更新：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_on_batch(self, x, y, class_weight=<span class="keyword">None</span>, sample_weight=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>该函数返回标量训练误差(如果模型没有评估指标)或标量列表(如果模型计算其他指标)。属性<code>model.metrics_names</code>将提供标量输出的显示标签。</p>
<h4 id="test-on-batch"><a href="#test-on-batch" class="headerlink" title="test_on_batch"></a>test_on_batch</h4><p>&emsp;&emsp;该函数本函数在一个<code>batch</code>的样本上对模型进行评估：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_on_batch(self, x, y, sample_weight=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>该函数返回标量测试误差(如果模型没有评估指标)或标量列表(如果模型计算其他指标)。属性<code>model.metrics_names</code>将提供标量输出的显示标签。</p>
<h4 id="predict-on-batch"><a href="#predict-on-batch" class="headerlink" title="predict_on_batch"></a>predict_on_batch</h4><p>&emsp;&emsp;该函数的作用是返回一个<code>batch</code>样本上的模型预测值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predict_on_batch(self, x)</span><br></pre></td></tr></table></figure>
<p>参数<code>x</code>是输入数据，<code>Numpy</code>数组或列表(如果模型有多输入)。该函数返回预测值的<code>Numpy</code>数组。</p>
<h4 id="fit-generator"><a href="#fit-generator" class="headerlink" title="fit_generator"></a>fit_generator</h4><p>&emsp;&emsp;该函数利用<code>Python</code>的生成器，逐个生成数据的<code>batch</code>并进行训练：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fit_generator(</span><br><span class="line">    self, generator, steps_per_epoch=<span class="keyword">None</span>, epochs=<span class="number">1</span>, verbose=<span class="number">1</span>, callbacks=<span class="keyword">None</span>,</span><br><span class="line">    validation_data=<span class="keyword">None</span>, validation_steps=<span class="keyword">None</span>, class_weight=<span class="keyword">None</span>, max_queue_size=<span class="number">10</span>,</span><br><span class="line">    workers=<span class="number">1</span>, use_multiprocessing=<span class="keyword">False</span>, shuffle=<span class="keyword">True</span>, initial_epoch=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>生成器与模型并行运行，以提高效率。例如，该函数允许我们在<code>CPU</code>上进行实时的数据提升，同时在<code>GPU</code>上进行模型训练。该函数返回一个<code>History</code>对象。</p>
<ul>
<li><code>generator</code>：一个生成器。生成器的输出应该为以下之一：</li>
</ul>
<ol>
<li>一个<code>(inputs, targets)</code>元组。</li>
<li>一个<code>(inputs, targets, sample_weights)</code>元组。所有的数组都必须包含同样数量的样本。生成器将无限地在数据集上循环。当运行到第<code>steps_per_epoch</code>时，记一个<code>epoch</code>结束。</li>
</ol>
<ul>
<li><code>steps_per_epoch</code>：在声明一个<code>epoch</code>完成并开始下一个<code>epoch</code>之前从<code>generator</code>产生的总步数(批次样本)。它通常应该等于你的数据集的样本数量除以批量大小。可选参数<code>Sequence</code>：如果未指定，将使用<code>len(generator)</code>作为步数。</li>
<li><code>epochs</code>：整数，数据的迭代总轮数。请注意，与<code>initial_epoch</code>一起，参数<code>epochs</code>应被理解为<code>最终轮数</code>。模型并不是训练了<code>epochs</code>轮，而是到第<code>epochs</code>轮停止训练。</li>
<li><code>verbose</code>：日志显示模式，<code>0</code>为不在标准输出流输出日志信息，<code>1</code>为输出进度条记录，<code>2</code>为每个<code>epoch</code>输出一行记录。</li>
<li><code>callbacks</code>：在训练时调用的一系列回调函数。</li>
<li><code>validation_data</code>：它可以是以下之一：</li>
</ul>
<ol>
<li>验证数据的生成器。</li>
<li>一个<code>(inputs, targets)</code>元组。</li>
<li>一个<code>(inputs, targets, sample_weights)</code>元组。</li>
</ol>
<ul>
<li><code>validation_steps</code>：当<code>validation_data</code>为生成器时，本参数指定验证集的生成器返回次数。它通常应该等于你的数据集的样本数量除以批量大小。可选参数<code>Sequence</code>：如果未指定，将使用<code>len(generator)</code>作为步数。</li>
<li><code>class_weight</code>：将类别映射为权重的字典。</li>
<li><code>max_queue_size</code>：生成器队列的最大尺寸。</li>
<li><code>workers</code>：使用的最大进程数量。</li>
<li><code>use_multiprocessing</code>：如果<code>True</code>，则使用基于进程的多线程。请注意，因为此实现依赖于多进程，所以不应将不可传递的参数传递给生成器，因为它们不能被轻易地传递给子进程。</li>
<li><code>shuffle</code>：是否在每轮迭代之前打乱<code>batch</code>的顺序，只能与<code>Sequence(keras.utils.Sequence)</code>实例同用。</li>
<li><code>initial_epoch</code>：从该参数指定的<code>epoch</code>开始训练，有助于恢复之前的训练。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_arrays_from_file</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        f = open(path)</span><br><span class="line">        <span class="comment"># create Numpy arrays of input data and labels, from each line in the file</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            x, y = process_line(line)</span><br><span class="line">            <span class="keyword">yield</span> (x, y)</span><br><span class="line">        f.close()</span><br><span class="line">​</span><br><span class="line">model.fit_generator(generate_arrays_from_file(<span class="string">'/my_file.txt'</span>), steps_per_epoch=<span class="number">1000</span>, epochs=<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h4 id="evaluate-generator"><a href="#evaluate-generator" class="headerlink" title="evaluate_generator"></a>evaluate_generator</h4><p>&emsp;&emsp;该函数的作用是在数据生成器上评估模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">evaluate_generator(</span><br><span class="line">    self, generator, steps=<span class="keyword">None</span>, max_queue_size=<span class="number">10</span>,</span><br><span class="line">    workers=<span class="number">1</span>, use_multiprocessing=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<p>这个生成器应返回与<code>test_on_batch</code>的输入数据相同类型的数据。</p>
<ul>
<li><code>generator</code>：生成器，生成<code>(inputs, targets)</code>或<code>(inputs, targets, sample_weights)</code>。</li>
<li><code>steps</code>：在停止之前，来自<code>generator</code>的总步数(样本批次数)。</li>
<li><code>max_queue_size</code>：生成器队列的最大尺寸。</li>
<li><code>workers</code>：使用的最大进程数量。</li>
<li><code>use_multiprocessing</code>：如果为<code>True</code>，则使用基于进程的多线程。请注意，因为此实现依赖于多进程，所以不应将不可传递的参数传递给生成器，因为它们不能被轻易地传递给子进程。</li>
</ul>
<p>该函数返回标量测试误差(如果模型没有评估指标)或标量列表(如果模型计算其他指标)。属性<code>model.metrics_names</code>将提供标量输出的显示标签。</p>
<h4 id="predict-generator"><a href="#predict-generator" class="headerlink" title="predict_generator"></a>predict_generator</h4><p>&emsp;&emsp;该函数的作用是为来自数据生成器的输入样本生成预测：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">predict_generator(</span><br><span class="line">    self, generator, steps=<span class="keyword">None</span>, max_queue_size=<span class="number">10</span>,</span><br><span class="line">    workers=<span class="number">1</span>, use_multiprocessing=<span class="keyword">False</span>, verbose=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>这个生成器应返回与<code>predict_on_batch</code>的输入数据相同类型的数据。该函数返回预测值的<code>Numpy</code>数组。</p>
<h4 id="get-layer"><a href="#get-layer" class="headerlink" title="get_layer"></a>get_layer</h4><p>&emsp;&emsp;该函数的作用是提取模型的某一层：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_layer(self, name=<span class="keyword">None</span>, index=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>根据网络层的名称或其索引返回该层。索引是基于水平图遍历的顺序(自下而上)。参数<code>name</code>是字符串，即层的名字；<code>index</code>是整数，即层的索引。该函数返回一个层实例。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/深度学习/Lenet模型/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/深度学习/Lenet模型/" itemprop="url">Lenet模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T16:17:14+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Lenet-5</code>是卷积神经网络中很适合入门的网络结构，它在<code>1998</code>年由<code>Yann LeCuu</code>等人在论文<code>Gradient-Based Learning Applied to Document Recognition</code>中提出，用于解决<code>mnist</code>数据集的字符识别问题。网络结构如下所示：</p>
<p><img src="/2019/02/11/深度学习/Lenet模型/1.png" height="186" width="701"></p>
<p>&emsp;&emsp;<code>Lenet-5</code>除了输入层外，由<code>7</code>层网络构成：</p>
<ul>
<li>卷积层<code>Conv1</code>：接受<code>32 * 32 * 1</code>的图像输入，本层包含<code>6</code>个大小为<code>5 * 5</code>，步长为<code>1 * 1</code>的卷积核。<code>padding</code>类型为<code>valid</code>(即没有<code>padding</code>)，输出神经元为<code>28 * 28 * 6</code>。</li>
<li>池化层<code>pooling</code>：对上一层的输出做<code>2 * 2</code>的<code>max pooling</code>，输出神经元形状为<code>14 * 14 * 6</code>。</li>
<li>卷积层<code>Conv2</code>：接受<code>14 * 14 * 6</code>的输入，本层有<code>16</code>个大小为<code>5 * 5</code>，步长为<code>1 * 1</code>的卷积核，同第一个卷积层。本层的<code>padding</code>类型为<code>valid</code>，输出神经元为<code>10 * 10 * 16</code>。</li>
<li>池化层：对上层输出做<code>2 * 2</code>的<code>max pooling</code>，输出神经元形状为<code>5 * 5 * 16</code>。</li>
<li>全连接层<code>fc1</code>：本层将上层的<code>5 * 5 * 16</code>神经元展开作为输入，本层包含<code>120</code>个神经元。</li>
<li>全连接层<code>fc2</code>：本层包含<code>84</code>个神经元。</li>
<li>输出层：本层包含<code>10</code>个神经元，分别代表数字<code>0</code>到<code>9</code>。</li>
</ul>
<p>前<code>7</code>层采用论文中使用的<code>tanh</code>激活函数，输出层论文采用的是<code>Guassian Connection</code>，以下代码采用的是<code>softmax</code>函数。<br>&emsp;&emsp;数据集来源于<code>kaggle</code>中的<code>Digit Recognizer</code>数字识别数据集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Input, Add, Conv2D, Dense, ZeroPadding2D, Activation, MaxPooling2D, Flatten</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> keras.utils <span class="keyword">import</span> to_categorical</span><br><span class="line">​</span><br><span class="line">train = np.loadtxt(<span class="string">'train.csv'</span>, delimiter=<span class="string">','</span>, skiprows=<span class="number">1</span>)</span><br><span class="line">data_train = train[:<span class="number">40000</span>]</span><br><span class="line">data_val = train[<span class="number">40000</span>:]</span><br><span class="line">data_test = np.loadtxt(<span class="string">'test.csv'</span>, delimiter=<span class="string">','</span>, skiprows=<span class="number">1</span>)</span><br><span class="line">​</span><br><span class="line">print(train.shape)</span><br><span class="line">print(data_train.shape)</span><br><span class="line">print(data_val.shape)</span><br><span class="line">print(data_test.shape)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">42000</span>, <span class="number">785</span>)</span><br><span class="line">(<span class="number">40000</span>, <span class="number">785</span>)</span><br><span class="line">(<span class="number">2000</span>, <span class="number">785</span>)</span><br><span class="line">(<span class="number">28000</span>, <span class="number">784</span>)</span><br></pre></td></tr></table></figure>
<p>定义模型，并进行训练：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lenet_5</span><span class="params">(input_shape=<span class="params">(<span class="number">32</span>, <span class="number">32</span>, <span class="number">1</span>)</span>)</span>:</span></span><br><span class="line">    X_input = Input(input_shape)</span><br><span class="line">    X = ZeroPadding2D((<span class="number">1</span>, <span class="number">1</span>))(X_input)</span><br><span class="line">    X = Conv2D(<span class="number">6</span>, (<span class="number">5</span>, <span class="number">5</span>), strides=(<span class="number">1</span>, <span class="number">1</span>), padding=<span class="string">'valid'</span>, name=<span class="string">'conv1'</span>)(X)</span><br><span class="line">    X = Activation(<span class="string">'tanh'</span>)(X)</span><br><span class="line">    X = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), strides=(<span class="number">2</span>, <span class="number">2</span>))(X)</span><br><span class="line">    X = Conv2D(<span class="number">6</span>, (<span class="number">5</span>, <span class="number">5</span>), strides=(<span class="number">1</span>, <span class="number">1</span>), padding=<span class="string">'valid'</span>, name=<span class="string">'conv2'</span>)(X)</span><br><span class="line">    X = Activation(<span class="string">'tanh'</span>)(X)</span><br><span class="line">    X = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), strides=(<span class="number">2</span>, <span class="number">2</span>))(X)</span><br><span class="line">    X = Flatten()(X)</span><br><span class="line">    X = Dense(<span class="number">120</span>, activation=<span class="string">'tanh'</span>, name=<span class="string">'fc1'</span>)(X)</span><br><span class="line">    X = Dense(<span class="number">84</span>, activation=<span class="string">'tanh'</span>, name=<span class="string">'fc2'</span>)(X)</span><br><span class="line">    X = Dense(<span class="number">10</span>, activation=<span class="string">'softmax'</span>)(X)</span><br><span class="line">    model = Model(inputs=X_input, outputs=X, name=<span class="string">'lenet_5'</span>)</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line">​</span><br><span class="line">model = lenet_5(input_shape=(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">model.compile(optimizer=<span class="string">'sgd'</span>, loss=<span class="string">'categorical_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">​</span><br><span class="line">X_train = data_train[:, <span class="number">1</span>:].reshape((data_train.shape[<span class="number">0</span>], <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">Y_train = to_categorical(data_train[:, <span class="number">0</span>])</span><br><span class="line">model.fit(X_train, Y_train, epochs=<span class="number">10</span>, batch_size=<span class="number">16</span>)</span><br><span class="line">​</span><br><span class="line">X_val = data_val[:, <span class="number">1</span>:].reshape((data_val.shape[<span class="number">0</span>], <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">Y_val = to_categorical(data_val[:, <span class="number">0</span>])</span><br><span class="line">preds = model.evaluate(X_val, Y_val)</span><br><span class="line">print(<span class="string">"Validation loss="</span> + str(preds[<span class="number">0</span>]))</span><br><span class="line">print(<span class="string">"Validation accuracy="</span> + str(preds[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/Node_JS/文件系统/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Node_JS/文件系统/" itemprop="url">文件系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T15:15:02+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Node.js</code>提供一组类似<code>UNIX</code>(<code>POSIX</code>)标准的文件操作<code>API</code>。<code>Node.js</code>导入文件系统模块(<code>fs</code>)语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="异步和同步"><a href="#异步和同步" class="headerlink" title="异步和同步"></a>异步和同步</h3><p>&emsp;&emsp;<code>Node.js</code>文件系统(<code>fs</code>)模块中的方法均有异步和同步版本，例如读取文件内容的函数有异步的<code>fs.readFile</code>和同步的<code>fs.readFileSync</code>。异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息(<code>error</code>)。<br>&emsp;&emsp;创建<code>input.txt</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">菜鸟教程官网地址：www.runoob.com</span><br><span class="line">文件读取实例</span><br></pre></td></tr></table></figure>
<p>创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="comment">// 异步读取</span></span><br><span class="line">fs.readFile(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"异步读取: "</span> + data.toString());</span><br><span class="line">&#125;);</span><br><span class="line">​</span><br><span class="line"><span class="comment">// 同步读取</span></span><br><span class="line"><span class="keyword">var</span> data = fs.readFileSync(<span class="string">'input.txt'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"同步读取: "</span> + data.toString());</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕。"</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">同步读取: 菜鸟教程官网地址：www.runoob.com</span><br><span class="line">文件读取实例</span><br><span class="line"></span><br><span class="line">程序执行完毕。</span><br><span class="line">异步读取: 菜鸟教程官网地址：www.runoob.com</span><br><span class="line">文件读取实例</span><br></pre></td></tr></table></figure>
<h3 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h3><p>&emsp;&emsp;以下为在异步模式下打开文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.open(path, flags[, mode], callback)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>path</code>：文件的路径。</li>
<li><code>flags</code>：文件打开的行为。</li>
<li><code>mode</code>：设置文件模式(权限)，文件创建默认权限为<code>0666</code>(可读可写)。</li>
<li><code>callback</code>：回调函数，带有两个参数，例如<code>callback(err, fd)</code>。</li>
</ul>
<p><code>flags</code>参数可以是以下值：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Flag</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>r</code></td>
<td>以读取模式打开文件。如果文件不存在，抛出异常</td>
</tr>
<tr>
<td><code>r+</code></td>
<td>以读写模式打开文件。如果文件不存在，抛出异常</td>
</tr>
<tr>
<td><code>rs</code></td>
<td>以同步的方式读取文件</td>
</tr>
<tr>
<td><code>rs+</code></td>
<td>以同步的方式读取和写入文件</td>
</tr>
<tr>
<td><code>w</code></td>
<td>以写入模式打开文件，如果文件不存在，则创建</td>
</tr>
<tr>
<td><code>wx</code></td>
<td>类似于<code>w</code>，但是如果文件路径存在，则文件写入失败</td>
</tr>
<tr>
<td><code>w+</code></td>
<td>以读写模式打开文件，如果文件不存在则创建</td>
</tr>
<tr>
<td><code>wx+</code></td>
<td>类似<code>w+</code>，但是如果文件路径存在，则文件读写失败</td>
</tr>
<tr>
<td><code>a</code></td>
<td>以追加模式打开文件，如果文件不存在则创建</td>
</tr>
<tr>
<td><code>ax</code></td>
<td>类似于<code>a</code>，但是如果文件路径存在，则文件追加失败</td>
</tr>
<tr>
<td><code>a+</code></td>
<td>以读取追加模式打开文件，如果文件不存在则创建</td>
</tr>
<tr>
<td><code>ax+</code></td>
<td>类似于<code>a+</code>，但是如果文件路径存在，则文件读取追加失败</td>
</tr>
</tbody>
</table>
</div>
<p>接下来创建<code>file.js</code>文件，并打开<code>input.txt</code>进行读写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="comment">// 异步打开文件</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开文件！"</span>);</span><br><span class="line">fs.open(<span class="string">'input.txt'</span>, <span class="string">'r+'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件打开成功！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">准备打开文件！</span><br><span class="line">文件打开成功！</span><br></pre></td></tr></table></figure>
<h3 id="获取文件信息"><a href="#获取文件信息" class="headerlink" title="获取文件信息"></a>获取文件信息</h3><p>&emsp;&emsp;以下为通过异步模式获取文件信息的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.stat(path, callback)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>path</code>：文件路径。</li>
<li><code>callback</code>：回调函数，带有两个参数，例如<code>callback(err, stats)</code>，<code>stats</code>是<code>fs.Stats</code>对象。</li>
</ul>
<p><code>fs.stat(path)</code>执行后，会将<code>stats</code>类的实例返回给其回调函数。可以通过<code>stats</code>类中的提供方法判断文件的相关属性。例如判断是否为文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">​</span><br><span class="line">fs.stat(<span class="string">'/Users/liuht/code/itbilu/demo/fs.js'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stats.isFile()); <span class="comment">// 输出true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>stats</code>类中的方法有：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stats.isFile()</code></td>
<td>如果是文件，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
<tr>
<td><code>stats.isDirectory()</code></td>
<td>如果是目录，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
<tr>
<td><code>stats.isBlockDevice()</code></td>
<td>如果是块设备，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
<tr>
<td><code>stats.isCharacterDevice()</code></td>
<td>如果是字符设备，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
<tr>
<td><code>stats.isSymbolicLink()</code></td>
<td>如果是软链接，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
<tr>
<td><code>stats.isFIFO()</code></td>
<td>如果是<code>FIFO</code>，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
<tr>
<td><code>stats.isSocket()</code></td>
<td>如果是<code>Socket</code>，返回<code>true</code>，否则返回<code>false</code></td>
</tr>
</tbody>
</table>
</div>
<p>接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开文件！"</span>);</span><br><span class="line">​</span><br><span class="line">fs.stat(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">console</span>.log(stats);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"读取文件信息成功！"</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="comment">// 检测文件类型</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"是否为文件(isFile) ? "</span> + stats.isFile());</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"是否为目录(isDirectory) ? "</span> + stats.isDirectory());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">准备打开文件！</span><br><span class="line">&#123; <span class="attr">dev</span>: <span class="number">16777220</span>,</span><br><span class="line">  mode: <span class="number">33188</span>,</span><br><span class="line">  nlink: <span class="number">1</span>,</span><br><span class="line">  uid: <span class="number">501</span>,</span><br><span class="line">  gid: <span class="number">20</span>,</span><br><span class="line">  rdev: <span class="number">0</span>,</span><br><span class="line">  blksize: <span class="number">4096</span>,</span><br><span class="line">  ino: <span class="number">40333161</span>,</span><br><span class="line">  size: <span class="number">61</span>,</span><br><span class="line">  blocks: <span class="number">8</span>,</span><br><span class="line">  atime: Mon Sep <span class="number">07</span> <span class="number">2015</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">55</span> GMT+<span class="number">0800</span> (CST),</span><br><span class="line">  mtime: Mon Sep <span class="number">07</span> <span class="number">2015</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">35</span> GMT+<span class="number">0800</span> (CST),</span><br><span class="line">  ctime: Mon Sep <span class="number">07</span> <span class="number">2015</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">35</span> GMT+<span class="number">0800</span> (CST) &#125;</span><br><span class="line">读取文件信息成功！</span><br><span class="line">是否为文件(isFile) ? <span class="literal">true</span></span><br><span class="line">是否为目录(isDirectory) ? <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><p>&emsp;&emsp;以下为异步模式下写入文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(file, data[, options], callback)</span><br></pre></td></tr></table></figure>
<p><code>writeFile</code>直接打开文件默认是<code>w</code>模式，所以如果文件存在，该方法写入的内容会覆盖旧的文件内容。</p>
<ul>
<li><code>file</code>：文件名或文件描述符。</li>
<li><code>data</code>：要写入文件的数据，可以是<code>String</code>(字符串)或<code>Buffer</code>(流)对象。</li>
<li><code>options</code>：该参数是一个对象，包含<code>{encoding, mode, flag}</code>，默认编码为<code>utf8</code>，模式为<code>0666</code>，<code>flag</code>为<code>w</code>。</li>
<li><code>callback</code>：回调函数，回调函数只包含错误信息参数(<code>err</code>)，在写入失败时返回。</li>
</ul>
<p>接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备写入文件"</span>);</span><br><span class="line">fs.writeFile(<span class="string">'input.txt'</span>, <span class="string">'我是通过fs.writeFile写入文件的内容'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"数据写入成功！"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"--------我是分割线-------------"</span>)；</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"读取写入的数据！"</span>);</span><br><span class="line">​</span><br><span class="line">    fs.readFile(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"异步读取文件数据: "</span> + data.toString());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">准备写入文件</span><br><span class="line">数据写入成功！</span><br><span class="line">--------我是分割线-------------</span><br><span class="line">读取写入的数据！</span><br><span class="line">异步读取文件数据: 我是通过fs.writeFile写入文件的内容</span><br></pre></td></tr></table></figure>
<h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><p>&emsp;&emsp;以下为异步模式下读取文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.read(fd, buffer, offset, length, position, callback)</span><br></pre></td></tr></table></figure>
<p>该方法使用了文件描述符来读取文件。</p>
<ul>
<li><code>fd</code>：通过<code>fs.open</code>方法返回的文件描述符。</li>
<li><code>buffer</code>：数据写入的缓冲区。</li>
<li><code>offset</code>：缓冲区写入的写入偏移量。</li>
<li><code>length</code>：要从文件中读取的字节数。</li>
<li><code>position</code>：文件读取的起始位置，如果<code>position</code>的值为<code>null</code>，则会从当前文件指针的位置读取。</li>
<li><code>callback</code>：回调函数，有三个参数，即<code>err</code>、<code>bytesRead</code>和<code>buffer</code>：<code>err</code>为错误信息，<code>bytesRead</code>表示读取的字节数，<code>buffer</code>为缓冲区对象。</li>
</ul>
<p><code>input.txt</code>文件内容为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">菜鸟教程官网地址：www.runoob.com</span><br></pre></td></tr></table></figure>
<p>接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开已存在的文件！"</span>);</span><br><span class="line">fs.open(<span class="string">'input.txt'</span>, <span class="string">'r+'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件打开成功！"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"准备读取文件："</span>);</span><br><span class="line">​</span><br><span class="line">    fs.read(fd, buf, <span class="number">0</span>, buf.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytes</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">console</span>.log(bytes + <span class="string">"字节被读取"</span>);</span><br><span class="line">​</span><br><span class="line">        <span class="comment">// 仅输出读取的字节</span></span><br><span class="line">        <span class="keyword">if</span>(bytes &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(buf.slice(<span class="number">0</span>, bytes).toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">准备打开已存在的文件！</span><br><span class="line">文件打开成功！</span><br><span class="line">准备读取文件：</span><br><span class="line"><span class="number">42</span>字节被读取</span><br><span class="line">菜鸟教程官网地址：www.runoob.com</span><br></pre></td></tr></table></figure>
<h3 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h3><p>&emsp;&emsp;以下为异步模式下关闭文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.close(fd, callback)</span><br></pre></td></tr></table></figure>
<p>该方法使用了文件描述符来读取文件。</p>
<ul>
<li><code>fd</code>：通过<code>fs.open</code>方法返回的文件描述符。</li>
<li><code>callback</code>：回调函数，没有参数。</li>
</ul>
<p><code>input.txt</code>文件内容为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">菜鸟教程官网地址：www.runoob.com</span><br></pre></td></tr></table></figure>
<p>接下来创建file.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="number">1024</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开文件！"</span>);</span><br><span class="line">fs.open(<span class="string">'input.txt'</span>, <span class="string">'r+'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件打开成功！"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"准备读取文件！"</span>);</span><br><span class="line">​</span><br><span class="line">    fs.read(fd, buf, <span class="number">0</span>, buf.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytes</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> (bytes &gt; <span class="number">0</span>) &#123; <span class="comment">/* 仅输出读取的字节 */</span></span><br><span class="line">            <span class="built_in">console</span>.log(buf.slice(<span class="number">0</span>, bytes).toString());</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        fs.close(fd, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123; <span class="comment">/* 关闭文件 */</span></span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"文件关闭成功"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">准备打开文件！</span><br><span class="line">文件打开成功！</span><br><span class="line">准备读取文件！</span><br><span class="line">菜鸟教程官网地址：www.runoob.com</span><br><span class="line">文件关闭成功</span><br></pre></td></tr></table></figure>
<h3 id="截取文件"><a href="#截取文件" class="headerlink" title="截取文件"></a>截取文件</h3><p>&emsp;&emsp;以下为异步模式下截取文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.ftruncate(fd, len, callback)</span><br></pre></td></tr></table></figure>
<p>该方法使用了文件描述符来读取文件。</p>
<p>fd：通过fs.open方法返回的文件描述符。<br>len：文件内容截取的长度。<br>callback：回调函数，没有参数。</p>
<p>input.txt文件内容为：<br>site:www.runoob.com<br>接下来创建file.js文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="number">1024</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开文件！"</span>);</span><br><span class="line">​</span><br><span class="line">fs.open(<span class="string">'input.txt'</span>, <span class="string">'r+'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件打开成功！"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"截取了10字节后的文件内容。"</span>);</span><br><span class="line">​</span><br><span class="line">    fs.ftruncate(fd, <span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123; <span class="comment">/* 截取文件 */</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;</span><br><span class="line">​</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"文件截取成功。"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"读取相同的文件"</span>);</span><br><span class="line"></span><br><span class="line">        fs.read(fd, buf, <span class="number">0</span>, buf.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytes</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125;</span><br><span class="line">​</span><br><span class="line">            <span class="keyword">if</span> (bytes &gt; <span class="number">0</span>) &#123; <span class="comment">/* 仅输出读取的字节 */</span></span><br><span class="line">                <span class="built_in">console</span>.log(buf.slice(<span class="number">0</span>, bytes).toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fs.close(fd, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123; <span class="comment">/* 关闭文件 */</span></span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(err);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"文件关闭成功！"</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">准备打开文件！</span><br><span class="line">文件打开成功！</span><br><span class="line">截取了<span class="number">10</span>字节后的文件内容。</span><br><span class="line">文件截取成功。</span><br><span class="line">读取相同的文件</span><br><span class="line">site:www.r</span><br><span class="line">文件关闭成功</span><br></pre></td></tr></table></figure>
<h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><p>&emsp;&emsp;以下为删除文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.unlink(path, callback)</span><br></pre></td></tr></table></figure>
<p>参数<code>path</code>是文件路径；<code>callback</code>是回调函数，没有参数。<br>&emsp;&emsp;<code>input.txt</code>文件内容为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:www.runoob.com</span><br></pre></td></tr></table></figure>
<p>接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备删除文件！"</span>);</span><br><span class="line">​</span><br><span class="line">fs.unlink(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件删除成功！"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">准备删除文件！</span><br><span class="line">文件删除成功！</span><br></pre></td></tr></table></figure>
<h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><p>&emsp;&emsp;以下为创建目录的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.mkdir(path[, mode], callback)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>path</code>：文件路径。</li>
<li><code>mode</code>：设置目录权限，默认为<code>0777</code>。</li>
<li><code>callback</code>：回调函数，没有参数。</li>
</ul>
<p>接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"创建目录“/tmp/test/”"</span>);</span><br><span class="line">​</span><br><span class="line">fs.mkdir(<span class="string">"/tmp/test/"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"目录创建成功"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建目录“/tmp/test/”</span><br><span class="line">目录创建成功</span><br></pre></td></tr></table></figure>
<h3 id="读取目录"><a href="#读取目录" class="headerlink" title="读取目录"></a>读取目录</h3><p>&emsp;&emsp;以下为读取目录的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.readdir(path, callback)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>path</code>：文件路径。</li>
<li><code>callback</code>：回调函数，回调函数带有两个参数<code>err</code>、<code>files</code>，其中<code>err</code>为错误信息，<code>files</code>为目录下的文件数组列表。</li>
</ul>
<p>接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"查看“/tmp”目录"</span>);</span><br><span class="line">​</span><br><span class="line">fs.readdir(<span class="string">"/tmp/"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">file</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(file);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看“/tmp”目录</span><br><span class="line">input.out</span><br><span class="line">output.out</span><br><span class="line">test</span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure>
<h3 id="删除目录"><a href="#删除目录" class="headerlink" title="删除目录"></a>删除目录</h3><p>&emsp;&emsp;以下为删除目录的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.rmdir(path, callback)</span><br></pre></td></tr></table></figure>
<p>参数<code>path</code>是文件路径；<code>callback</code>是回调函数，没有参数。<br>&emsp;&emsp;接下来创建<code>file.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">​</span><br><span class="line"><span class="comment">// 执行前创建一个空的“/tmp/test”目录</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"准备删除目录“/tmp/test”"</span>);</span><br><span class="line">​</span><br><span class="line">fs.rmdir(<span class="string">"/tmp/test"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"读取“/tmp”目录"</span>);</span><br><span class="line">  </span><br><span class="line">    fs.readdir(<span class="string">"/tmp/"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">file</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(file);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node file.js</span><br><span class="line">准备删除目录“/tmp/test”</span><br><span class="line">读取“/tmp”目录</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="文件模块方法参考手册"><a href="#文件模块方法参考手册" class="headerlink" title="文件模块方法参考手册"></a>文件模块方法参考手册</h3><p>&emsp;&emsp;以下为<code>Node.js</code>文件模块种的方法列表：</p>
<ul>
<li><code>fs.rename(oldPath, newPath, callback)</code>：异步<code>rename</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.ftruncate(fd, len, callback)</code>：异步<code>ftruncate</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.ftruncateSync(fd, len)</code>：同步<code>ftruncate</code>。</li>
<li><code>fs.truncate(path, len, callback)</code>：异步<code>truncate</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.truncateSync(path, len)</code>：同步<code>truncate</code>。</li>
<li><code>fs.chown(path, uid, gid, callback)</code>：异步<code>chown</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.chownSync(path, uid, gid)</code>：同步<code>chown</code>。</li>
<li><code>fs.fchown(fd, uid, gid, callback)</code>：异步<code>fchown</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.fchownSync(fd, uid, gid)</code>：同步<code>fchown</code>。</li>
<li><code>fs.lchown(path, uid, gid, callback)</code>：异步<code>lchown</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.lchownSync(path, uid, gid)</code>：同步<code>lchown</code>。</li>
<li><code>fs.chmod(path, mode, callback)</code>：异步<code>chmod</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.chmodSync(path, mode)</code>：同步<code>chmod</code>。</li>
<li><code>fs.fchmod(fd, mode, callback)</code>：异步<code>fchmod</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.fchmodSync(fd, mode)</code>：同步<code>fchmod</code>。</li>
<li><code>fs.lchmod(path, mode, callback)</code>：异步<code>lchmod</code>，回调函数没有参数，但可能抛出异常(<code>Only available on Mac OS X</code>)。</li>
<li><code>fs.lchmodSync(path, mode)</code>：同步<code>lchmod</code>。</li>
<li><code>fs.stat(path, callback)</code>：异步<code>stat</code>，回调函数有两个参数，即<code>err</code>和<code>stats</code>，<code>stats</code>是<code>fs.Stats</code>对象。</li>
<li><code>fs.lstat(path, callback)</code>：异步<code>lstat</code>，回调函数有两个参数，即<code>err</code>和<code>stats</code>，<code>stats</code>是<code>fs.Stats</code>对象。</li>
<li><code>fs.fstat(fd, callback)</code>：异步<code>fstat</code>，回调函数有两个参数，即<code>err</code>和<code>stats</code>，<code>stats</code>是<code>fs.Stats</code>对象。</li>
<li><code>fs.statSync(path)</code>：同步<code>stat</code>，返回<code>fs.Stats</code>的实例。</li>
<li><code>fs.lstatSync(path)</code>：同步<code>lstat</code>，返回<code>fs.Stats</code>的实例。</li>
<li><code>fs.fstatSync(fd)</code>：同步<code>fstat</code>，返回<code>fs.Stats</code>的实例。</li>
<li><code>fs.link(srcpath, dstpath, callback)</code>：异步<code>link</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.linkSync(srcpath, dstpath)</code>：同步<code>link</code>。</li>
<li><code>fs.symlink(srcpath, dstpath[, type], callback)</code>：异步<code>symlink</code>，回调函数没有参数，但可能抛出异常。<code>type</code>参数可以设置为<code>dir</code>、<code>file</code>或<code>junction</code>(默认为<code>file</code>)。</li>
<li><code>fs.symlinkSync(srcpath, dstpath[, type])</code>：同步<code>symlink</code>。</li>
<li><code>fs.readlink(path, callback)</code>：异步<code>readlink</code>，回调函数有两个参数，即<code>err</code>和<code>linkString</code>。</li>
<li><code>fs.realpath(path[, cache], callback)</code>：异步<code>realpath</code>，回调函数有两个参数，即<code>err</code>和<code>resolvedPath</code>。</li>
<li><code>fs.realpathSync(path[, cache])</code>：同步<code>realpath</code>，该函数返回绝对路径。</li>
<li><code>fs.unlink(path, callback)</code>：异步<code>unlink</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.unlinkSync(path)</code>：同步<code>unlink</code>。</li>
<li><code>fs.rmdir(path, callback)</code>：异步<code>rmdir</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.rmdirSync(path)</code>：同步<code>rmdir</code>。</li>
<li><code>fs.mkdir(path[, mode], callback)</code>：异步<code>mkdir</code>，回调函数没有参数，但可能抛出异常。<code>mode</code>的默认值是<code>0777</code>。</li>
<li><code>fs.mkdirSync(path[, mode])</code>：同步<code>mkdir</code>。</li>
<li><code>fs.readdir(path, callback)</code>：异步<code>readdir</code>，读取目录的内容。</li>
<li><code>fs.readdirSync(path)</code>：同步<code>readdir</code>，返回文件数组列表。</li>
<li><code>fs.close(fd, callback)</code>：异步<code>close</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.closeSync(fd)</code>：同步<code>close</code>。</li>
<li><code>fs.open(path, flags[, mode], callback)</code>：异步打开文件。</li>
<li><code>fs.openSync(path, flags[, mode])</code>：同步版的<code>fs.open</code>。</li>
<li><code>fs.utimesSync(path, atime, mtime)</code>：修改文件时间戳，通过文件路径<code>path</code>指定。</li>
<li><code>fs.futimesSync(fd, atime, mtime)</code>：修改文件时间戳，通过文件描述符<code>fd</code>指定。</li>
<li><code>fs.fsync(fd, callback)</code>：异步<code>fsync</code>，回调函数没有参数，但可能抛出异常。</li>
<li><code>fs.fsyncSync(fd)</code>：同步<code>fsync</code>。</li>
<li><code>fs.write(fd, buffer, offset, length[, position], callback)</code>：将缓冲区内容写入到通过文件描述符指定的文件。</li>
<li><code>fs.write(fd, data[, position[, encoding]], callback)</code>：通过文件描述符<code>fd</code>写入文件内容。</li>
<li><code>fs.writeSync(fd, buffer, offset, length[, position])</code>：同步版的<code>fs.write</code>。</li>
<li><code>fs.writeSync(fd, data[, position[, encoding]])</code>：同步版的<code>fs.write</code>。</li>
<li><code>fs.read(fd, buffer, offset, length, position, callback)</code>：通过文件描述符<code>fd</code>读取文件内容。</li>
<li><code>fs.readSync(fd, buffer, offset, length, position)</code>：同步版的<code>fs.read</code>。</li>
<li><code>fs.readFile(filename[, options], callback)</code>：异步读取文件内容。</li>
<li><code>fs.writeFile(filename, data[, options], callback)</code>：异步写入文件内容。</li>
<li><code>fs.writeFileSync(filename, data[, options])</code>：同步版的<code>fs.writeFile</code>。</li>
<li><code>fs.appendFile(filename, data[, options], callback)</code>：异步追加文件内容。</li>
<li><code>fs.appendFileSync(filename, data[, options])</code>：同步版的<code>fs.appendFile</code>。</li>
<li><code>fs.watchFile(filename[, options], listener)</code>：查看文件的修改。</li>
<li><code>fs.unwatchFile(filename[, listener])</code>：停止查看<code>filename</code>的修改。</li>
<li><code>fs.watch(filename[, options][, listener])</code>：查看<code>filename</code>的修改，<code>filename</code>可以是文件或目录。该函数返回<code>fs.FSWatcher</code>对象。</li>
<li><code>fs.exists(path, callback)</code>：检测给定的路径是否存在。</li>
<li><code>fs.existsSync(path)</code>：同步版的<code>fs.exists</code>。</li>
<li><code>fs.access(path[, mode], callback)</code>：测试指定路径用户权限。</li>
<li><code>fs.accessSync(path[, mode])</code>：同步版的<code>fs.access</code>。</li>
<li><code>fs.createReadStream(path[, options])</code>：返回<code>ReadStream</code>对象。</li>
<li><code>fs.createWriteStream(path[, options])</code>：返回<code>WriteStream</code>对象。</li>
<li><code>fs.symlink(srcpath, dstpath[, type], callback)</code>：异步<code>symlink</code>，回调函数没有参数，但可能抛出异常。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/Node_JS/全局对象/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Node_JS/全局对象/" itemprop="url">全局对象</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T12:27:59+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>JavaScript</code>有一个特殊的对象，称为全局对象(<code>Global Object</code>)，它及其所有属性都可以在程序的任何地方访问，即全局变量。<br>&emsp;&emsp;在浏览器<code>JavaScript</code>中，通常<code>window</code>是全局对象，而<code>Node.js</code>中的全局对象是<code>global</code>，所有全局变量(除了<code>global</code>本身以外)都是<code>global</code>对象的属性。在<code>Node.js</code>中，我们可以直接访问到<code>global</code>的属性，而不需要在应用中包含它。</p>
<h3 id="全局对象与全局变量"><a href="#全局对象与全局变量" class="headerlink" title="全局对象与全局变量"></a>全局对象与全局变量</h3><p>&emsp;&emsp;<code>global</code>最根本的作用是作为全局变量的宿主。按照<code>ECMAScript</code>的定义，满足以下条件的变量是全局变量：</p>
<ul>
<li>在最外层定义的变量。</li>
<li>全局对象的属性。</li>
<li>隐式定义的变量(未定义直接赋值的变量)。</li>
</ul>
<p>当你定义一个全局变量时，这个变量同时也会成为全局对象的属性，反之亦然。需要注意的是，在<code>Node.js</code>中，你不可能在最外层定义变量，因为所有用户代码都是属于当前模块的，而模块本身不是最外层上下文。<br>&emsp;&emsp;注意，永远使用<code>var</code>定义变量以避免引入全局变量，因为全局变量会污染命名空间，提高代码的耦合风险。</p>
<h4 id="filename"><a href="#filename" class="headerlink" title="__filename"></a>__filename</h4><p>&emsp;&emsp;<code>__filename</code>表示当前正在执行的脚本的文件名。它将输出文件所在位置的绝对路径，且和命令行参数所指定的文件名不一定相同。如果在模块中，返回的值是模块文件的路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__filename);</span><br></pre></td></tr></table></figure>
<p>执行结果:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\fukangwei\Desktop\workspace\nodejs\main.js</span><br></pre></td></tr></table></figure>
<h4 id="dirname"><a href="#dirname" class="headerlink" title="__dirname"></a>__dirname</h4><p>&emsp;&emsp;<code>__dirname</code>表示当前执行脚本所在的目录：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__dirname);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\fukangwei\Desktop\workspace\nodejs</span><br></pre></td></tr></table></figure>
<h3 id="setTimeout-cb-ms"><a href="#setTimeout-cb-ms" class="headerlink" title="setTimeout(cb, ms)"></a>setTimeout(cb, ms)</h3><p>&emsp;&emsp;<code>setTimeout(cb, ms)</code>全局函数在指定的毫秒(<code>ms</code>)数后执行指定函数(<code>cb</code>)，且只执行一次指定函数。该函数返回一个代表定时器的句柄值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello, World!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line">setTimeout(printHello, <span class="number">2000</span>); <span class="comment">// 两秒后执行以上函数</span></span><br></pre></td></tr></table></figure>
<h3 id="clearTimeout-t"><a href="#clearTimeout-t" class="headerlink" title="clearTimeout(t)"></a>clearTimeout(t)</h3><p>&emsp;&emsp;<code>clearTimeout(t)</code>全局函数用于停止一个之前通过<code>setTimeout</code>创建的定时器，参数<code>t</code>是通过<code>setTimeout</code>函数创建的定时器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello, World!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">var</span> t = setTimeout(printHello, <span class="number">2000</span>); <span class="comment">// 两秒后执行以上函数</span></span><br><span class="line">clearTimeout(t); <span class="comment">// 清除定时器</span></span><br></pre></td></tr></table></figure>
<h3 id="setInterval-cb-ms"><a href="#setInterval-cb-ms" class="headerlink" title="setInterval(cb, ms)"></a>setInterval(cb, ms)</h3><p>&emsp;&emsp;<code>setInterval(cb, ms)</code>全局函数在指定的毫秒(<code>ms</code>)数后执行指定函数(<code>cb</code>)。该函数返回一个代表定时器的句柄值，可以使用<code>clearInterval(t)</code>函数来清除定时器。<code>setInterval</code>方法会不停地调用函数，直到<code>clearInterval</code>被调用或窗口被关闭。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello, World!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line">setInterval(printHello, <span class="number">2000</span>); <span class="comment">// 两秒后执行以上函数</span></span><br></pre></td></tr></table></figure>
<p>以上程序每隔两秒就会输出一次<code>Hello, World!</code>，且会永久执行下去，直到你按下<code>Ctrl + c</code>按钮。</p>
<h3 id="console"><a href="#console" class="headerlink" title="console"></a>console</h3><p>&emsp;&emsp;<code>console</code>用于提供控制台标准输出，它是由<code>Internet Explorer</code>的<code>JScript</code>引擎提供的调试工具，后来逐渐成为浏览器的实施标准。<code>Node.js</code>沿用了这个标准，提供与习惯行为一致的<code>console</code>对象，用于向标准输出流(<code>stdout</code>)或标准错误流(<code>stderr</code>)输出字符。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hello world'</span>); <span class="comment">// 输出“Hello world”</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'byvoid%diovyb'</span>); <span class="comment">// 输出“byvoid%diovyb”</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'byvoid%diovyb'</span>, <span class="number">1991</span>); <span class="comment">// 输出“byvoid1991iovyb”</span></span><br></pre></td></tr></table></figure>
<h4 id="console-log-data-…"><a href="#console-log-data-…" class="headerlink" title="console.log([data][, …])"></a>console.log([data][, …])</h4><p>&emsp;&emsp;向标准输出流打印字符并以换行符结束。<code>console.log</code>接收若干个参数，如果只有一个参数，则输出这个参数的字符串形式；如果有多个参数，则以类似于<code>C</code>语言<code>printf</code>命令的格式输出。第一个参数是一个字符串，如果没有参数，只打印一个换行。</p>
<h4 id="console-info-data-…"><a href="#console-info-data-…" class="headerlink" title="console.info([data][, …])"></a>console.info([data][, …])</h4><p>&emsp;&emsp;该命令的作用是返回信息性消息，这个命令与<code>console.log</code>差别并不大，除了在<code>chrome</code>中只会输出文字外，其余的会显示一个蓝色的惊叹号。</p>
<h4 id="console-error-data-…"><a href="#console-error-data-…" class="headerlink" title="console.error([data][, …])"></a>console.error([data][, …])</h4><p>&emsp;&emsp;输出错误消息的。控制台在出现错误时会显示是红色的叉子。</p>
<h4 id="console-warn-data-…"><a href="#console-warn-data-…" class="headerlink" title="console.warn([data][, …])"></a>console.warn([data][, …])</h4><p>&emsp;&emsp;输出警告消息。控制台出现有黄色的惊叹号。</p>
<h4 id="console-dir-obj-options"><a href="#console-dir-obj-options" class="headerlink" title="console.dir(obj[, options])"></a>console.dir(obj[, options])</h4><p>&emsp;&emsp;用来对一个对象进行检查(<code>inspect</code>)，并以易于阅读和打印的格式显示。</p>
<h4 id="console-time-label"><a href="#console-time-label" class="headerlink" title="console.time(label)"></a>console.time(label)</h4><p>&emsp;&emsp;输出时间，表示计时开始。</p>
<h4 id="console-timeEnd-label"><a href="#console-timeEnd-label" class="headerlink" title="console.timeEnd(label)"></a>console.timeEnd(label)</h4><p>&emsp;&emsp;结束时间，表示计时结束：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.info(<span class="string">"程序开始执行："</span>);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">"获取数据"</span>);</span><br><span class="line"><span class="comment">/* 执行一些代码 */</span></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'获取数据'</span>);</span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">"程序执行完毕"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">程序开始执行：</span><br><span class="line">获取数据: <span class="number">0.069</span>ms</span><br><span class="line">程序执行完毕</span><br></pre></td></tr></table></figure>
<h4 id="console-assert-value-message-…"><a href="#console-assert-value-message-…" class="headerlink" title="console.assert(value[, message][, …])"></a>console.assert(value[, message][, …])</h4><p>&emsp;&emsp;用于判断某个表达式或变量是否为真。该函数接收两个参数，第一个参数是表达式，第二个参数是字符串。只有当第一个参数为<code>false</code>时，才会输出第二个参数，否则不会有任何结果。</p>
<h4 id="console-trace"><a href="#console-trace" class="headerlink" title="console.trace"></a>console.trace</h4><p>&emsp;&emsp;向标准错误流输出当前的调用栈：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.trace();</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Trace</span><br><span class="line">    at <span class="built_in">Object</span>.&lt;anonymous&gt; (C:\Users\fukangwei\Desktop\workspace\nodejs\main.js:<span class="number">1</span>:<span class="number">71</span>)</span><br><span class="line">    at Module._compile (<span class="built_in">module</span>.js:<span class="number">652</span>:<span class="number">30</span>)</span><br><span class="line">    at <span class="built_in">Object</span>.Module._extensions..js (<span class="built_in">module</span>.js:<span class="number">663</span>:<span class="number">10</span>)</span><br><span class="line">    at Module.load (<span class="built_in">module</span>.js:<span class="number">565</span>:<span class="number">32</span>)</span><br><span class="line">    at tryModuleLoad (<span class="built_in">module</span>.js:<span class="number">505</span>:<span class="number">12</span>)</span><br><span class="line">    at <span class="built_in">Function</span>.Module._load (<span class="built_in">module</span>.js:<span class="number">497</span>:<span class="number">3</span>)</span><br><span class="line">    at <span class="built_in">Function</span>.Module.runMain (<span class="built_in">module</span>.js:<span class="number">693</span>:<span class="number">10</span>)</span><br><span class="line">    at startup (bootstrap_node.js:<span class="number">191</span>:<span class="number">16</span>)</span><br><span class="line">    at bootstrap_node.js:<span class="number">612</span>:<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h3 id="process"><a href="#process" class="headerlink" title="process"></a>process</h3><p>&emsp;&emsp;<code>process</code>是一个全局变量，即<code>global</code>对象的属性。它用于描述当前<code>Node.js</code>进程状态的对象，提供了一个与操作系统的简单接口。</p>
<h4 id="exit"><a href="#exit" class="headerlink" title="exit"></a>exit</h4><p>&emsp;&emsp;当进程准备退出时触发。</p>
<h4 id="beforeExit"><a href="#beforeExit" class="headerlink" title="beforeExit"></a>beforeExit</h4><p>&emsp;&emsp;当<code>node</code>清空事件循环，并且没有其他安排时触发这个事件。通常来说，当没有进程安排时<code>node</code>退出，但是<code>beforeExit</code>的监听器可以异步调用，这样<code>node</code>就会继续执行。</p>
<h4 id="uncaughtException"><a href="#uncaughtException" class="headerlink" title="uncaughtException"></a>uncaughtException</h4><p>&emsp;&emsp;当一个异常冒泡回到事件循环，触发这个事件。如果给异常添加了监视器，默认的操作(打印堆栈跟踪信息并退出)就不会发生。</p>
<h4 id="Signal事件"><a href="#Signal事件" class="headerlink" title="Signal事件"></a>Signal事件</h4><p>&emsp;&emsp;当进程接收到信号时就触发。信号列表详见标准的<code>POSIX</code>信号名，例如<code>SIGINT</code>、<code>SIGUSR1</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 以下代码永远不会执行</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"该代码不会执行"</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'退出码为:'</span>, code);</span><br><span class="line">&#125;);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行结束"</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">程序执行结束</span><br><span class="line">退出码为: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="退出状态码"><a href="#退出状态码" class="headerlink" title="退出状态码"></a>退出状态码</h4><p>&emsp;&emsp;退出状态码如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>状态码</th>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1</code></td>
<td><code>Uncaught Fatal Exception</code></td>
<td>有未捕获异常，并且没有被域或<code>uncaughtException</code>处理函数处理</td>
</tr>
<tr>
<td><code>2</code></td>
<td><code>Unused</code></td>
<td>保留</td>
</tr>
<tr>
<td><code>3</code></td>
<td><code>Internal JavaScript Parse Error</code></td>
<td><code>JavaScript</code>的源码启动<code>Node</code>进程时引起解析错误。非常罕见，仅会在开发<code>Node</code>时才会有</td>
</tr>
<tr>
<td><code>4</code></td>
<td><code>Internal JavaScript Evaluation Failure</code></td>
<td><code>JavaScript</code>的源码启动<code>Node</code>进程，评估时返回函数失败。非常罕见，仅会在开发<code>Node</code>时才会有</td>
</tr>
<tr>
<td><code>5</code></td>
<td><code>Fatal Error</code></td>
<td><code>V8</code>里致命的不可恢复的错误。通常会打印到<code>stderr</code>，内容为<code>FATAL ERROR</code></td>
</tr>
<tr>
<td><code>6</code></td>
<td><code>Non-function Internal Exception Handler</code></td>
<td>未捕获异常，内部异常处理函数不知为何设置为<code>on-function</code>，并且不能被调用</td>
</tr>
<tr>
<td><code>7</code></td>
<td><code>Internal Exception Handler Run-Time Failure</code></td>
<td>未捕获的异常，并且异常处理函数处理时自己抛出了异常。例如，如果<code>process.on(&#39;uncaughtException&#39;)</code>或<code>domain.on(&#39;error&#39;)</code>抛出了异常</td>
</tr>
<tr>
<td><code>8</code></td>
<td><code>Unused</code></td>
<td>保留</td>
</tr>
<tr>
<td><code>9</code></td>
<td><code>Invalid Argument</code></td>
<td>可能是给了未知的参数，或者给的参数没有值</td>
</tr>
<tr>
<td><code>10</code></td>
<td><code>Internal JavaScript Run-Time Failure</code></td>
<td><code>JavaScript</code>的源码启动<code>Node</code>进程时抛出错误，非常罕见，仅会在开发<code>Node</code>时才会有</td>
</tr>
<tr>
<td><code>12</code></td>
<td><code>Invalid Debug Argument</code></td>
<td>设置了参数<code>--debug</code>和/或<code>--debug-brk</code>，但是选择了错误端口</td>
</tr>
<tr>
<td><code>128</code></td>
<td><code>Signal Exits</code></td>
<td>如果<code>Node</code>接收到致命信号，比如<code>SIGKILL</code>或<code>SIGHUP</code>，那么退出代码就是<code>128</code>加信号代码。这是标准的<code>Unix</code>做法，退出信号代码放在高位</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Process属性"><a href="#Process属性" class="headerlink" title="Process属性"></a>Process属性</h4><p>&emsp;&emsp;<code>Process</code>提供了很多有用的属性，便于我们更好的控制系统的交互：</p>
<ul>
<li><code>stdout</code>：标准输出流。</li>
<li><code>stderr</code>：标准错误流。</li>
<li><code>stdin</code>：标准输入流。</li>
<li><code>argv</code>：<code>argv</code>属性返回一个数组，由命令行执行脚本时的各个参数组成。它的第一个成员总是<code>node</code>，第二个成员是脚本文件名，其余成员是脚本文件的参数。</li>
<li><code>execPath</code>：返回执行当前脚本的<code>Node</code>二进制文件的绝对路径。</li>
<li><code>execArgv</code>：返回一个数组，成员是命令行下执行脚本时，在<code>Node</code>可执行文件与脚本文件之间的命令行参数。</li>
<li><code>env</code>：返回一个对象，成员为当前<code>shell</code>的环境变量。</li>
<li><code>exitCode</code>：进程退出时的代码，如果进程优通过<code>process.exit</code>退出，不需要指定退出码。</li>
<li><code>version</code>：<code>Node</code>的版本，比如<code>v0.10.18</code>。</li>
<li><code>versions</code>：一个属性，包含了<code>node</code>的版本和依赖。</li>
<li><code>config</code>：一个包含用来编译当前<code>node</code>执行文件的<code>javascript</code>配置选项的对象。它与运行<code>./configure</code>脚本生成的<code>config.gypi</code>文件相同。</li>
<li><code>pid</code>：当前进程的进程号。</li>
<li><code>title</code>：进程名，默认值为<code>node</code>，可以自定义该值。</li>
<li><code>arch</code>：当前<code>CPU</code>的架构，有<code>arm</code>、<code>ia32</code>或者<code>x64</code>等。</li>
<li><code>platform</code>：运行程序所在的平台系统，有<code>darwin</code>、<code>freebsd</code>、<code>linux</code>、<code>sunos</code>或<code>win32</code>等。</li>
<li><code>mainModule</code>：<code>require.main</code>的备选方法。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">process.stdout.write(<span class="string">"Hello World!"</span> + <span class="string">"\n"</span>); <span class="comment">// 输出到终端</span></span><br><span class="line">​</span><br><span class="line">process.argv.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">val, index, array</span>) </span>&#123; <span class="comment">// 通过参数读取</span></span><br><span class="line">    <span class="built_in">console</span>.log(index + <span class="string">': '</span> + val);</span><br><span class="line">&#125;);</span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(process.execPath); <span class="comment">// 获取执行路径</span></span><br><span class="line"><span class="built_in">console</span>.log(process.platform); <span class="comment">// 平台信息</span></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line"><span class="number">0</span>: C:\Program Files\nodejs\node.exe</span><br><span class="line"><span class="number">1</span>: C:\Users\little fool\Desktop\WorkSpace\server.js</span><br><span class="line">C:\Program Files\nodejs\node.exe</span><br><span class="line">win32</span><br></pre></td></tr></table></figure>
<h3 id="方法参考手册"><a href="#方法参考手册" class="headerlink" title="方法参考手册"></a>方法参考手册</h3><p>&emsp;&emsp;<code>Process</code>提供了很多有用的方法，便于我们更好的控制系统的交互。</p>
<h4 id="abort"><a href="#abort" class="headerlink" title="abort"></a>abort</h4><p>&emsp;&emsp;这将导致<code>node</code>触发<code>abort</code>事件，会让<code>node</code>退出并生成一个核心文件。</p>
<h4 id="chdir-directory"><a href="#chdir-directory" class="headerlink" title="chdir(directory)"></a>chdir(directory)</h4><p>&emsp;&emsp;改变当前工作进程的目录，如果操作失败，则抛出异常。</p>
<h4 id="cwd"><a href="#cwd" class="headerlink" title="cwd"></a>cwd</h4><p>&emsp;&emsp;返回当前进程的工作目录。</p>
<h4 id="exit-code"><a href="#exit-code" class="headerlink" title="exit([code])"></a>exit([code])</h4><p>&emsp;&emsp;使用指定的<code>code</code>结束进程。如果忽略，将会使用<code>code 0</code>。</p>
<h4 id="getgid"><a href="#getgid" class="headerlink" title="getgid"></a>getgid</h4><p>&emsp;&emsp;获取进程的群组标识。获取到的是群组的数字<code>id</code>，而不是名字。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="setgid-id"><a href="#setgid-id" class="headerlink" title="setgid(id)"></a>setgid(id)</h4><p>&emsp;&emsp;设置进程的群组标识。可以接收数字<code>ID</code>或者群组名，如果指定了群组名，会阻塞等待解析为数字<code>ID</code>。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="getuid"><a href="#getuid" class="headerlink" title="getuid"></a>getuid</h4><p>&emsp;&emsp;获取进程的用户标识。这是数字的用户<code>id</code>，不是用户名。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="setuid-id"><a href="#setuid-id" class="headerlink" title="setuid(id)"></a>setuid(id)</h4><p>&emsp;&emsp;设置进程的用户标识。接收数字<code>ID</code>或字符串名字，如果指定了群组名，会阻塞等待解析为数字<code>ID</code>。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="getgroups"><a href="#getgroups" class="headerlink" title="getgroups"></a>getgroups</h4><p>&emsp;&emsp;返回进程的群组<code>ID</code>数组。<code>POSIX</code>系统没有保证一定有，但是<code>Node.js</code>保证有。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="setgroups-groups"><a href="#setgroups-groups" class="headerlink" title="setgroups(groups)"></a>setgroups(groups)</h4><p>&emsp;&emsp;设置进程的群组<code>ID</code>。这是授权操作，所以你需要有<code>root</code>权限，或者有<code>CAP_SETGID</code>能力。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="initgroups-user-extra-group"><a href="#initgroups-user-extra-group" class="headerlink" title="initgroups(user, extra_group)"></a>initgroups(user, extra_group)</h4><p>&emsp;&emsp;读取<code>/etc/group</code>，并初始化群组访问列表，使用成员所在的所有群组。这是授权操作，所以你需要有<code>root</code>权限，或者有<code>CAP_SETGID</code>能力。注意，这个函数仅在<code>POSIX</code>平台上可用。</p>
<h4 id="kill-pid-signal"><a href="#kill-pid-signal" class="headerlink" title="kill(pid[, signal])"></a>kill(pid[, signal])</h4><p>&emsp;&emsp;发送信号给进程，<code>pid</code>是进程<code>id</code>，并且<code>signal</code>是发送的信号的字符串描述。信号名是字符串，比如<code>SIGINT</code>或<code>SIGHUP</code>。如果忽略，信号会是<code>SIGTERM</code>。</p>
<h4 id="memoryUsage"><a href="#memoryUsage" class="headerlink" title="memoryUsage"></a>memoryUsage</h4><p>&emsp;&emsp;返回一个对象，描述了<code>Node</code>进程所用的内存状况，单位为字节：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'当前目录: '</span> + process.cwd()); <span class="comment">// 输出当前目录</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'当前版本: '</span> + process.version); <span class="comment">// 输出当前版本</span></span><br><span class="line"><span class="built_in">console</span>.log(process.memoryUsage()); <span class="comment">// 输出内存使用情况</span></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当前目录: C:\Users\little fool\Desktop\WorkSpace</span><br><span class="line">当前版本: v8<span class="number">.11</span><span class="number">.3</span></span><br><span class="line">&#123; <span class="attr">rss</span>: <span class="number">21651456</span>,</span><br><span class="line">  heapTotal: <span class="number">7159808</span>,</span><br><span class="line">  heapUsed: <span class="number">4461928</span>,</span><br><span class="line">  external: <span class="number">8224</span> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="nextTick-callback"><a href="#nextTick-callback" class="headerlink" title="nextTick(callback)"></a>nextTick(callback)</h4><p>&emsp;&emsp;一旦当前事件循环结束，调用回到函数。</p>
<h4 id="umask-mask"><a href="#umask-mask" class="headerlink" title="umask([mask])"></a>umask([mask])</h4><p>&emsp;&emsp;设置或读取进程文件的掩码。子进程从父进程继承掩码，如果<code>mask</code>参数有效，返回旧的掩码；否则，返回当前掩码。</p>
<h4 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h4><p>&emsp;&emsp;返回<code>Node</code>已经运行的秒数。</p>
<h4 id="hrtime"><a href="#hrtime" class="headerlink" title="hrtime"></a>hrtime</h4><p>&emsp;&emsp;返回当前进程的高分辨时间，形式为<code>[seconds, nanoseconds]</code>数组，它是相对于过去的任意事件。该值与日期无关，因此不受时钟漂移的影响。主要用途是可以通过精确的时间间隔，来衡量程序的性能。你可以将之前的结果传递给当前的<code>process.hrtime</code>，它会返回两者间的时间差，用来基准和测量时间间隔。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/Python语法/字典/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Python语法/字典/" itemprop="url">字典</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T11:43:47+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;字典来源于映射关系：</p>
<p><img src="/2019/02/11/Python语法/字典/1.jpg" height="170" width="173"></p>
<p>注意，字典不是序列类型，而是映射类型。不使用字典的索引(很麻烦)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brand = [<span class="string">"李宁"</span>, <span class="string">"耐克"</span>, <span class="string">"阿迪达斯"</span>, <span class="string">"鱼C工作室"</span>]</span><br><span class="line">slogan = [<span class="string">"一切皆有可能"</span>, <span class="string">"Just do it"</span>, <span class="string">"Impossible is nothing"</span>, <span class="string">"让编程改变世界"</span>]</span><br><span class="line">print(<span class="string">"鱼C工作室的口号是："</span>, slogan[brand.index(<span class="string">"鱼C工作室"</span>)])  <span class="comment"># 结果为“鱼C工作室的口号是：让编程改变世界”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;创建和访问字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dict1 = &#123;</span><br><span class="line">    <span class="string">"李宁"</span>: <span class="string">"一切皆有可能"</span>, <span class="string">"耐克"</span>: <span class="string">"Just do it"</span>,</span><br><span class="line">    <span class="string">"阿迪达斯"</span>: <span class="string">"Impossible is nothing"</span>, <span class="string">"鱼C工作室"</span>: <span class="string">"让编程改变世界"</span></span><br><span class="line">&#125;</span><br><span class="line">print(<span class="string">"鱼C工作室的口号是："</span>, dict1[<span class="string">"鱼C工作室"</span>])  <span class="comment"># 结果为“鱼C工作室的口号是：让编程改变世界”</span></span><br><span class="line">dict2 = &#123;<span class="number">1</span>: <span class="string">"one"</span>, <span class="number">2</span>: <span class="string">"two"</span>, <span class="number">3</span>: <span class="string">"three"</span>&#125;</span><br><span class="line">dict2  <span class="comment"># 结果为&#123;1: 'one', 2: 'two', 3: 'three'&#125;</span></span><br><span class="line">dict2[<span class="number">2</span>]  <span class="comment"># 结果为“two”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;特殊用法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dict3 = dict(((<span class="string">"F"</span>, <span class="number">70</span>), (<span class="string">"i"</span>, <span class="number">105</span>), (<span class="string">"s"</span>, <span class="number">115</span>), (<span class="string">"h"</span>, <span class="number">104</span>)))</span><br><span class="line">dict3  <span class="comment"># 结果为&#123;'i': 105, 's': 115, 'h': 104, 'F': 70&#125;</span></span><br><span class="line">dict4 = dict(小=<span class="string">"little"</span>, 付=<span class="string">"fool"</span>)</span><br><span class="line">dict4  <span class="comment"># 结果为&#123;'付': 'fool', '小': 'little'&#125;</span></span><br><span class="line">dict4 = dict(小=<span class="string">"little"</span>, <span class="string">"付"</span> = <span class="string">"fool"</span>)  <span class="comment"># 结果为“出错”</span></span><br><span class="line">dict4[<span class="string">"付"</span>] = <span class="string">"fu"</span>  <span class="comment"># 更改字典数据</span></span><br><span class="line">dict4  <span class="comment"># 结果为&#123;'付': 'fu', '小': 'little'&#125;</span></span><br><span class="line">dict4[<span class="string">"康"</span>] = <span class="string">"kang"</span>  <span class="comment"># 增加字典数据</span></span><br><span class="line">dict4  <span class="comment"># 结果为&#123;'付': 'fu', '小': 'little', '康': 'kang'&#125;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>dict</code>是<code>Python</code>的工厂函数(类型)，<code>str</code>、<code>int</code>、<code>list</code>和<code>tuple</code>都是工厂函数。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict.fromkeys(S[, v]) -&gt; New dict with keys from S and values equal to v(v defaults to None)</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">dict1 = &#123;&#125;</span><br><span class="line">dict1.fromkeys((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))  <span class="comment"># 结果为&#123;1: None, 2: None, 3: None&#125;</span></span><br><span class="line">dict1.fromkeys((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), <span class="string">"number"</span>)  <span class="comment"># 结果为&#123;1: 'number', 2: 'number', 3: 'number'&#125;</span></span><br><span class="line"><span class="comment"># 结果为&#123;1: ('one', 'two', 'three'), 2: ('one', 'two', 'three'), 3: ('one', 'two', 'three')&#125;</span></span><br><span class="line">dict1.fromkeys((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), (<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>))</span><br><span class="line">dict1.fromkeys((<span class="number">1</span>, <span class="number">3</span>), <span class="string">"数字"</span>)  <span class="comment"># 结果为&#123;1: '数字', 3: '数字'&#125;</span></span><br><span class="line">dict1 = dict1.fromkeys(range(<span class="number">32</span>), <span class="string">"赞"</span>)  <span class="comment"># 结果为&#123;0: '赞', 1: '赞', 2: '赞', 3: '赞', ..., 30: '赞', 31: '赞'&#125;</span></span><br><span class="line"><span class="comment"># ---------------------------------</span></span><br><span class="line"><span class="keyword">for</span> eachKey <span class="keyword">in</span> dict1.keys():</span><br><span class="line">    print(eachKey)  <span class="comment"># 结果为打印从0到31的数字</span></span><br><span class="line"><span class="keyword">for</span> eachValue <span class="keyword">in</span> dict1.values():</span><br><span class="line">    print(eachValue)  <span class="comment"># 结果为打印32个“赞”字</span></span><br><span class="line"><span class="keyword">for</span> eachitem <span class="keyword">in</span> dict1.items():</span><br><span class="line">    print(eachitem)  <span class="comment"># 结果为打印“(0, '赞')、(1, '赞')、(2, '赞')、...、(31, '赞')”</span></span><br><span class="line"><span class="comment"># ---------------------------------</span></span><br><span class="line">print(dict1[<span class="number">31</span>])  <span class="comment"># 结果为“赞”</span></span><br><span class="line">print(dict1[<span class="number">32</span>])  <span class="comment"># 结果为“出错”</span></span><br><span class="line">print(dict1.get(<span class="number">32</span>))  <span class="comment"># 结果为None</span></span><br><span class="line">dict1.get(<span class="number">32</span>, <span class="string">"木有"</span>)  <span class="comment"># 结果为“木有”</span></span><br><span class="line">dict1.get(<span class="number">31</span>, <span class="string">"木有"</span>)  <span class="comment"># 结果为“赞”</span></span><br><span class="line"><span class="number">31</span> <span class="keyword">in</span> dict1  <span class="comment"># 结果为True</span></span><br><span class="line"><span class="number">32</span> <span class="keyword">in</span> dict1  <span class="comment"># 结果为False</span></span><br><span class="line"><span class="comment"># ---------------------------------</span></span><br><span class="line">print(dict1[<span class="number">31</span>])  <span class="comment"># 结果为“赞”</span></span><br><span class="line">print(dict1[<span class="number">32</span>])  <span class="comment"># 结果为“出错”</span></span><br><span class="line">print(dict1.get(<span class="number">32</span>))  <span class="comment"># 结果为None</span></span><br><span class="line">dict1.get(<span class="number">32</span>, <span class="string">"木有"</span>)  <span class="comment"># 结果为“木有”</span></span><br><span class="line">dict1.get(<span class="number">31</span>, <span class="string">"木有"</span>)  <span class="comment"># 结果为“赞”</span></span><br><span class="line"><span class="number">31</span> <span class="keyword">in</span> dict1  <span class="comment"># 结果为True</span></span><br><span class="line"><span class="number">32</span> <span class="keyword">in</span> dict1  <span class="comment"># 结果为False</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>Python</code>的拷贝：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="number">1</span>: <span class="string">"one"</span>, <span class="number">2</span>: <span class="string">"two"</span>, <span class="number">3</span>: <span class="string">"three"</span>&#125;</span><br><span class="line">b = a.copy()  <span class="comment"># 浅拷贝</span></span><br><span class="line">c = a</span><br><span class="line">c  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three'&#125;</span></span><br><span class="line">a  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three'&#125;</span></span><br><span class="line">b  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three'&#125;</span></span><br><span class="line">id(a)  <span class="comment"># 得到41703384</span></span><br><span class="line">id(b)  <span class="comment"># 得到41704144</span></span><br><span class="line">id(c)  <span class="comment"># 得到41703384</span></span><br><span class="line">c[<span class="number">4</span>] = <span class="string">"four"</span></span><br><span class="line">c  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three', 4: 'four'&#125;</span></span><br><span class="line">a  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three', 4: 'four'&#125;</span></span><br><span class="line">b  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three'&#125;</span></span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line">a  <span class="comment"># 得到&#123;1: 'one', 2: 'two', 3: 'three', 4: 'four'&#125;</span></span><br><span class="line">a.pop(<span class="number">2</span>)  <span class="comment"># 得到“two”</span></span><br><span class="line">a  <span class="comment"># 得到&#123;1: 'one', 3: 'three', 4: 'four'&#125;</span></span><br><span class="line">a.popitem()  <span class="comment"># 得到(1, 'one')</span></span><br><span class="line">a.setdefault(<span class="string">"小白"</span>)</span><br><span class="line">a  <span class="comment"># 得到&#123;3: 'three', 4: 'four', '小白': None&#125;</span></span><br><span class="line">a.setdefault(<span class="number">5</span>, <span class="string">"five"</span>)  <span class="comment"># 得到“five”</span></span><br><span class="line">a  <span class="comment"># 得到&#123;3: 'three', 4: 'four', 5: 'five', '小白': None&#125;</span></span><br><span class="line">b = &#123;<span class="string">"小白"</span>: <span class="string">"狗"</span>&#125;</span><br><span class="line">a.update(b)</span><br><span class="line">a  <span class="comment"># 得到&#123;3: 'three', 4: 'four', 5: 'five', '小白': '狗'&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="删除字典元素"><a href="#删除字典元素" class="headerlink" title="删除字典元素"></a>删除字典元素</h3><p>&emsp;&emsp;能删单一的元素，也能清空字典，清空只需一项操作。删除一个字典用<code>del</code>命令：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dict = &#123;<span class="string">'Name'</span>: <span class="string">'Runoob'</span>, <span class="string">'Age'</span>: <span class="number">7</span>, <span class="string">'Class'</span>: <span class="string">'First'</span>&#125;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">del</span> dict[<span class="string">'Name'</span>]  <span class="comment"># 删除键“Name”</span></span><br><span class="line">dict.clear()  <span class="comment"># 清空字典</span></span><br><span class="line"><span class="keyword">del</span> dict  <span class="comment"># 删除字典</span></span><br><span class="line">​</span><br><span class="line">print(<span class="string">"dict['Age']: "</span>, dict[<span class="string">'Age'</span>])</span><br><span class="line">print(<span class="string">"dict['School']: "</span>, dict[<span class="string">'School'</span>])</span><br></pre></td></tr></table></figure>
<p>但这会引发一个异常，因为用执行<code>del</code>操作后字典不再存在：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"test.py"</span>, line <span class="number">9</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"dict['Age']: "</span>, dict[<span class="string">'Age'</span>])</span><br><span class="line">TypeError: <span class="string">'type'</span> object <span class="keyword">is</span> <span class="keyword">not</span> subscriptable</span><br></pre></td></tr></table></figure>
<h3 id="字典键的特性"><a href="#字典键的特性" class="headerlink" title="字典键的特性"></a>字典键的特性</h3><p>&emsp;&emsp;字典值可以是任何的<code>python</code>对象，既可以是标准的对象，也可以是用户定义的，但键不行。两个重要的点需要记住：</p>
<p>不允许同一个键出现两次。创建时如果同一个键被赋值两次，后一个值会被记住，如下实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dict = &#123;<span class="string">'Name'</span>: <span class="string">'Runoob'</span>, <span class="string">'Age'</span>: <span class="number">7</span>, <span class="string">'Name'</span>: <span class="string">'小菜鸟'</span>&#125;</span><br><span class="line">print(<span class="string">"dict['Name']:"</span>, dict[<span class="string">'Name'</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict[<span class="string">'Name'</span>]: 小菜鸟</span><br></pre></td></tr></table></figure>
<p>键必须不可变，所以可以用数字，字符串或元组充当，而用列表就不行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dict = &#123;[<span class="string">'Name'</span>]: <span class="string">'Runoob'</span>, <span class="string">'Age'</span>: <span class="number">7</span>&#125;</span><br><span class="line">print(<span class="string">"dict['Name']: "</span>, dict[<span class="string">'Name'</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"test.py"</span>, line <span class="number">3</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    dict = &#123;[<span class="string">'Name'</span>]: <span class="string">'Runoob'</span>, <span class="string">'Age'</span>: <span class="number">7</span>&#125;</span><br><span class="line">TypeError: unhashable type: <span class="string">'list'</span></span><br></pre></td></tr></table></figure>
<h3 id="字典内置函数和方法"><a href="#字典内置函数和方法" class="headerlink" title="字典内置函数和方法"></a>字典内置函数和方法</h3><p>&emsp;&emsp;<code>Python</code>字典包含了以下内置函数：</p>
<ul>
<li><code>len(dict)</code>：计算字典元素个数，即键的总数。</li>
<li><code>str(dict)</code>：输出字典，以可打印的字符串表示。</li>
<li><code>type(variable)</code>：返回输入的变量类型，如果变量是字典，就返回字典类型。</li>
</ul>
<p>&emsp;&emsp;<code>Python</code>字典包含了以下内置方法：</p>
<ul>
<li><code>radiansdict.clear()</code>：删除字典内所有元素。</li>
<li><code>radiansdict.copy()</code>：返回一个字典的浅复制。</li>
<li><code>radiansdict.fromkeys()</code>：创建一个新字典，以序列<code>seq</code>中元素做字典的键，<code>val</code>为字典所有键对应的初始值。</li>
<li><code>radiansdict.get(key, default=None)</code>：返回指定键的值，如果值不在字典中，返回<code>default</code>值。</li>
<li><code>key in dict</code>：如果键在字典<code>dict</code>里返回<code>true</code>，否则返回<code>false</code>。</li>
<li><code>radiansdict.items()</code>：以列表返回可遍历的元组数组。</li>
<li><code>radiansdict.keys()</code>：以列表返回一个字典所有的键。</li>
<li><code>radiansdict.setdefault(key, default=None)</code>：和<code>get</code>类似, 但如果键不存在于字典中，将会添加键并将值设为<code>default</code>。</li>
<li><code>radiansdict.update(dict2)</code>：把字典<code>dict2</code>的键值对更新到<code>dict</code>里。</li>
<li><code>radiansdict.values()</code>：以列表返回字典中的所有值。</li>
<li><code>pop(key[, default])</code>：删除字典给定键<code>key</code>所对应的值，返回值为被删除的值。<code>key</code>值必须给出，否则返回<code>default</code>值。</li>
<li><code>popitem()</code>：随机返回并删除字典中的一对键和值(一般删除末尾对)。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/Python语法/base64模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Python语法/base64模块/" itemprop="url">base64模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T11:34:05+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Base64</code>是一种用<code>64</code>个字符来表示任意二进制数据的方法。<br>&emsp;&emsp;用记事本打开<code>exe</code>、<code>jpg</code>、<code>pdf</code>这些文件时，我们都会看到一大堆乱码，因为二进制文件包含很多无法显示和打印的字符。如果要让记事本这样的文本处理软件能处理二进制数据，就需要一个二进制到字符串的转换方法。<code>Base64</code>是一种最常见的二进制编码方法。<br>&emsp;&emsp;<code>Base64</code>的原理很简单，首先准备一个包含<code>64</code>个字符的数组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, ... <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, ... <span class="string">'0'</span>, <span class="string">'1'</span>, ... <span class="string">'+'</span>, <span class="string">'/'</span>]</span><br></pre></td></tr></table></figure>
<p>然后对二进制数据进行处理，每<code>3</code>个字节一组，一共是<code>3 * 8 = 24bit</code>，划为<code>4</code>组，每组正好是<code>6</code>个<code>bit</code>：</p>
<p><img src="/2019/02/11/Python语法/base64模块/1.png" height="85" width="184"></p>
<p>这样就得到<code>4</code>个数字作为索引，然后查表获得相应的<code>4</code>个字符，就是编码后的字符串。所以<code>Base64</code>编码会把<code>3</code>字节的二进制数据编码为<code>4</code>字节的文本数据，长度增加了<code>33%</code>，好处是编码后的文本数据可以在邮件正文、网页等直接显示。<br>&emsp;&emsp;如果要编码的二进制数据不是<code>3</code>的倍数，最后会剩下<code>1</code>个或<code>2</code>个字节怎么办？<code>Base64</code>用<code>\x00</code>字节在末尾补足后，再在编码的末尾加上<code>1</code>个或<code>2</code>个<code>=</code>号，表示补了多少字节，解码时会自动去掉。<br>&emsp;&emsp;<code>Python</code>内置的<code>base64</code>模块可以直接进行<code>base64</code>的编解码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">b'binary\x00string'</span>)</span><br><span class="line"><span class="string">b'YmluYXJ5AHN0cmluZw=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(<span class="string">b'YmluYXJ5AHN0cmluZw=='</span>)</span><br><span class="line"><span class="string">b'binary\x00string'</span></span><br></pre></td></tr></table></figure>
<p>由于标准的<code>Base64</code>编码后可能出现字符<code>+</code>和<code>/</code>，在<code>URL</code>中就不能直接作为参数，所以又有一种<code>url safe</code>的<code>base64</code>编码，其实就是把字符<code>+</code>和<code>/</code>分别变成<code>-</code>和<code>_</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">b'i\xb7\x1d\xfb\xef\xff'</span>)</span><br><span class="line"><span class="string">b'abcd++//'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.urlsafe_b64encode(<span class="string">b'i\xb7\x1d\xfb\xef\xff'</span>)</span><br><span class="line"><span class="string">b'abcd--__'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.urlsafe_b64decode(<span class="string">b'abcd--__'</span>)</span><br><span class="line"><span class="string">b'i\xb7\x1d\xfb\xef\xff'</span></span><br></pre></td></tr></table></figure>
<p>还可以自己定义<code>64</code>个字符的排列顺序，这样就可以得到定义的<code>Base64</code>编码，不过通常情况下完全没有必要。<br>&emsp;&emsp;<code>Base64</code>是一种通过查表的编码方法，不能用于加密，即使使用自定义的编码表也不行。它适用于小段内容的编码，比如数字证书签名、<code>Cookie</code>的内容等。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/11/Python语法/Pandas模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Python语法/Pandas模块/" itemprop="url">Pandas模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T10:03:42+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Pandas基本介绍"><a href="#Pandas基本介绍" class="headerlink" title="Pandas基本介绍"></a>Pandas基本介绍</h3><h4 id="Numpy和Pandas"><a href="#Numpy和Pandas" class="headerlink" title="Numpy和Pandas"></a>Numpy和Pandas</h4><p>&emsp;&emsp;如果用<code>python</code>的列表和字典来作比较，那么可以说<code>Numpy</code>是列表形式的，没有数值标签；而<code>Pandas</code>就是字典形式。<code>Pandas</code>是基于<code>Numpy</code>构建的，让<code>Numpy</code>为中心的应用变得更加简单。<br>&emsp;&emsp;要使用<code>pandas</code>，首先需要了解它主要的两个数据结构：<code>Series</code>和<code>DataFrame</code>。</p>
<h4 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, np.nan, <span class="number">44</span>, <span class="number">1</span>])</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>     <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>     <span class="number">3.0</span></span><br><span class="line"><span class="number">2</span>     <span class="number">6.0</span></span><br><span class="line"><span class="number">3</span>     NaN</span><br><span class="line"><span class="number">4</span>    <span class="number">44.0</span></span><br><span class="line"><span class="number">5</span>     <span class="number">1.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<p><code>Series</code>的字符串表现形式为：索引在左边，值在右边。由于我们没有为数据指定索引，于是会自动创建一个<code>0</code>到<code>N - 1</code>(<code>N</code>为长度)的整数型索引。</p>
<h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20160101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">4</span>), index=dates, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                   a         b         c         d</span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-01</span> <span class="number">-1.615754</span> <span class="number">-1.572751</span>  <span class="number">0.886368</span>  <span class="number">0.639823</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">0.592734</span> <span class="number">-1.439370</span> <span class="number">-0.880371</span>  <span class="number">0.193510</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-03</span>  <span class="number">1.584482</span>  <span class="number">0.016471</span>  <span class="number">0.420065</span>  <span class="number">1.685260</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">0.434318</span> <span class="number">-1.079135</span>  <span class="number">0.134948</span>  <span class="number">1.038391</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-05</span> <span class="number">-0.169911</span> <span class="number">-0.252141</span> <span class="number">-0.307869</span> <span class="number">-0.806533</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">0.763159</span>  <span class="number">0.038354</span> <span class="number">-0.827668</span> <span class="number">-0.031835</span></span><br></pre></td></tr></table></figure>
<p><code>DataFrame</code>是一个表格型的数据结构，它包含有一组有序的列，每列可以是不同的值类型(数值、字符串、布尔值等)。<code>DataFrame</code>既有行索引也有列索引，它可以被看做由<code>Series</code>组成的大字典。<br>&emsp;&emsp;我们可以根据每一个不同的索引来挑选数据，比如挑选<code>b</code>的元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="string">'b'</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-01</span>    <span class="number">0.266451</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">-0.714666</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">-0.300667</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-04</span>   <span class="number">-0.365430</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-05</span>   <span class="number">-1.703521</span></span><br><span class="line"><span class="number">2016</span><span class="number">-01</span><span class="number">-06</span>   <span class="number">-0.903908</span></span><br><span class="line">Freq: D, Name: b, dtype: float64</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;再创建一组没有给定行标签和列标签的数据<code>df1</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)))</span><br><span class="line">print(df1)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>  <span class="number">4</span>  <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2</span>  <span class="number">8</span>  <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>还有一种生成<code>df</code>的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'A'</span>: <span class="number">1.</span>,</span><br><span class="line">     <span class="string">'B'</span>: pd.Timestamp(<span class="string">'20130102'</span>),</span><br><span class="line">     <span class="string">'C'</span>: pd.Series(<span class="number">1</span>, index=list(range(<span class="number">4</span>)), dtype=<span class="string">'float32'</span>),</span><br><span class="line">     <span class="string">'D'</span>: np.array([<span class="number">3</span>] * <span class="number">4</span>, dtype=<span class="string">'int32'</span>),</span><br><span class="line">     <span class="string">'E'</span>: pd.Categorical([<span class="string">"test"</span>, <span class="string">"train"</span>, <span class="string">"test"</span>, <span class="string">"train"</span>]),</span><br><span class="line">     <span class="string">'F'</span>: <span class="string">'foo'</span>&#125;)</span><br><span class="line"></span><br><span class="line">print(df2)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     A          B    C  D      E    F</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">1</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br></pre></td></tr></table></figure>
<p>这种方法能对每一列的数据进行特殊对待。如果想要查看数据中的类型，我们可以用<code>dtype</code>这个属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.dtypes)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A           float64</span><br><span class="line">B    datetime64[ns]</span><br><span class="line">C           float32</span><br><span class="line">D             int32</span><br><span class="line">E          category</span><br><span class="line">F            object</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果想看对列的序号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.index)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Int64Index([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=<span class="string">'int64'</span>)</span><br></pre></td></tr></table></figure>
<p>同样，每种数据的名称也能看到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.columns)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Index([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>], dtype=<span class="string">'object'</span>)</span><br></pre></td></tr></table></figure>
<p>如果只想看所有<code>df2</code>的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.values)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'test'</span> <span class="string">'foo'</span>]</span><br><span class="line"> [<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'train'</span> <span class="string">'foo'</span>]</span><br><span class="line"> [<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'test'</span> <span class="string">'foo'</span>]</span><br><span class="line"> [<span class="number">1.0</span> Timestamp(<span class="string">'2013-01-02 00:00:00'</span>) <span class="number">1.0</span> <span class="number">3</span> <span class="string">'train'</span> <span class="string">'foo'</span>]]</span><br></pre></td></tr></table></figure>
<p>想知道数据的总结，可以用<code>describe</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.describe())</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">         A    C    D</span><br><span class="line">count  <span class="number">4.0</span>  <span class="number">4.0</span>  <span class="number">4.0</span></span><br><span class="line">mean   <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line">std    <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line">min    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">25</span>%    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">50</span>%    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">75</span>%    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br><span class="line">max    <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">3.0</span></span><br></pre></td></tr></table></figure>
<p>如果想翻转数据，可以使用<code>transpose</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.T)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                     <span class="number">0</span>                    <span class="number">1</span>                    <span class="number">2</span>  \</span><br><span class="line">A                    <span class="number">1</span>                    <span class="number">1</span>                    <span class="number">1</span></span><br><span class="line">B  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">C                    <span class="number">1</span>                    <span class="number">1</span>                    <span class="number">1</span></span><br><span class="line">D                    <span class="number">3</span>                    <span class="number">3</span>                    <span class="number">3</span></span><br><span class="line">E                 test                train                 test</span><br><span class="line">F                  foo                  foo                  foo</span><br><span class="line">                     <span class="number">3</span></span><br><span class="line">A                    <span class="number">1</span></span><br><span class="line">B  <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">C                    <span class="number">1</span></span><br><span class="line">D                    <span class="number">3</span></span><br><span class="line">E                train</span><br><span class="line">F                  foo</span><br></pre></td></tr></table></figure>
<p>如果想对数据的<code>index</code>进行排序并输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     F      E  D    C          B    A</span><br><span class="line"><span class="number">0</span>  foo   test  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  foo  train  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">2</span>  foo   test  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  foo  train  <span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>如果是对数据值排序输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df2.sort_values(by=<span class="string">'B'</span>))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     A          B    C  D      E    F</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">1</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span> <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</span><br></pre></td></tr></table></figure>
<h3 id="Pandas选择数据"><a href="#Pandas选择数据" class="headerlink" title="Pandas选择数据"></a>Pandas选择数据</h3><p>&emsp;&emsp;我们建立了一个<code>6 * 4</code>的矩阵数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>, <span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>如果我们想选取<code>DataFrame</code>中的数据，可以使用下面两种方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="string">'A'</span>])</span><br><span class="line">print(df.A)</span><br></pre></td></tr></table></figure>
<p>执行结果都是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>     <span class="number">4</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>     <span class="number">8</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>    <span class="number">12</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>    <span class="number">16</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>    <span class="number">20</span></span><br><span class="line">Freq: D, Name: A, dtype: int32</span><br></pre></td></tr></table></figure>
<p>让选择跨越多行或多列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="number">0</span>:<span class="number">3</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df[<span class="string">'20130102'</span>:<span class="string">'20130104'</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">            A  B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">4</span>  <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>  <span class="number">8</span>  <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line">-----------------------</span><br><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br></pre></td></tr></table></figure>
<p>如果是<code>df[3:3]</code>，将会是一个空对象。后者选择<code>20130102</code>到<code>20130104</code>标签之间的数据，并且包括这两个标签。</p>
<h4 id="根据标签-loc"><a href="#根据标签-loc" class="headerlink" title="根据标签(loc)"></a>根据标签(loc)</h4><p>&emsp;&emsp;同样我们可以使用标签来选择数据，本示例主要通过标签名字选择某一行数据，或者通过选择某行或者所有行，然后选其中某一列或几列数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(df.loc[<span class="string">'20130102'</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.loc[:, [<span class="string">'A'</span>, <span class="string">'B'</span>]])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.loc[<span class="string">'20130102'</span>, [<span class="string">'A'</span>, <span class="string">'B'</span>]])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">A    <span class="number">4</span></span><br><span class="line">B    <span class="number">5</span></span><br><span class="line">C    <span class="number">6</span></span><br><span class="line">D    <span class="number">7</span></span><br><span class="line">Name: <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: int32</span><br><span class="line">-----------------------</span><br><span class="line">             A   B</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span></span><br><span class="line">-----------------------</span><br><span class="line">A    <span class="number">4</span></span><br><span class="line">B    <span class="number">5</span></span><br><span class="line">Name: <span class="number">2013</span><span class="number">-01</span><span class="number">-02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: int32</span><br></pre></td></tr></table></figure>
<h4 id="根据序列-iloc"><a href="#根据序列-iloc" class="headerlink" title="根据序列(iloc)"></a>根据序列(iloc)</h4><p>&emsp;&emsp;我们也可以使用位置选择数据，例如选取某一个、连续选择或者跨行选择等操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(df.iloc[<span class="number">3</span>, <span class="number">1</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.iloc[<span class="number">3</span>:<span class="number">5</span>, <span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">print(df.iloc[[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>], <span class="number">1</span>:<span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">13</span></span><br><span class="line">-----------------------</span><br><span class="line">             B   C</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">13</span>  <span class="number">14</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">17</span>  <span class="number">18</span></span><br><span class="line">-----------------------</span><br><span class="line">             B   C</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">5</span>   <span class="number">6</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">13</span>  <span class="number">14</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">21</span>  <span class="number">22</span></span><br></pre></td></tr></table></figure>
<h4 id="根据混合条件-ix"><a href="#根据混合条件-ix" class="headerlink" title="根据混合条件(ix)"></a>根据混合条件(ix)</h4><p>&emsp;&emsp;我们也可以采用采用混合选择的方式，例如选择<code>A</code>和<code>C</code>两列，并选择前三行的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df.ix[:<span class="number">3</span>, [<span class="string">'A'</span>, <span class="string">'C'</span>]])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">            A   C</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0</span>   <span class="number">2</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">4</span>   <span class="number">6</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>  <span class="number">8</span>  <span class="number">10</span></span><br></pre></td></tr></table></figure>
<h4 id="通过判断的筛选"><a href="#通过判断的筛选" class="headerlink" title="通过判断的筛选"></a>通过判断的筛选</h4><p>&emsp;&emsp;最后可以采用判断指令(<code>Boolean indexing</code>)进行选择，可以约束某项条件，然后选择所有符合该条件的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df[df.A &gt; <span class="number">8</span>])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas设置值"><a href="#Pandas设置值" class="headerlink" title="Pandas设置值"></a>Pandas设置值</h3><h4 id="创建数据"><a href="#创建数据" class="headerlink" title="创建数据"></a>创建数据</h4><p>&emsp;&emsp;我们可以根据自己的需求，用<code>pandas</code>更改数据里面的值，或者加上一些空的或者有数值的列。首先建立了一个<code>6 * 4</code>的矩阵数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>, <span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="根据位置设置-loc和iloc"><a href="#根据位置设置-loc和iloc" class="headerlink" title="根据位置设置(loc和iloc)"></a>根据位置设置(loc和iloc)</h4><p>&emsp;&emsp;我们可以利用索引或者标签确定需要修改值的位置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1111</span></span><br><span class="line">df.loc[<span class="string">'20130101'</span>, <span class="string">'B'</span>] = <span class="number">2222</span></span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>  <span class="number">2222</span>     <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>     <span class="number">9</span>  <span class="number">1111</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>    <span class="number">13</span>    <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>    <span class="number">17</span>    <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>    <span class="number">21</span>    <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="根据条件设置"><a href="#根据条件设置" class="headerlink" title="根据条件设置"></a>根据条件设置</h4><p>&emsp;&emsp;我们想要更改<code>B</code>中的数值，而更改的位置是取决于<code>A</code>的。对于<code>A</code>大于<code>4</code>的位置，更改<code>B</code>在相应位置上的数为<code>0</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.B[df.A &gt; <span class="number">4</span>] = <span class="number">0</span></span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A  B   C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>  <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>  <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>  <span class="number">0</span>  <span class="number">10</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">0</span>  <span class="number">14</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">0</span>  <span class="number">18</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">0</span>  <span class="number">22</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="按行或列设置"><a href="#按行或列设置" class="headerlink" title="按行或列设置"></a>按行或列设置</h4><p>&emsp;&emsp;如果需要对整列做批处理，例如加上一列<code>F</code>，并将<code>F</code>列全改为<code>NaN</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'F'</span>] = np.nan</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D   F</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span> NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span> NaN</span><br></pre></td></tr></table></figure>
<h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h4><p>&emsp;&emsp;用上面的方法也可以加上<code>Series</code>序列，但是长度必须对齐：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'E'</span>] = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], index=pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>))</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A   B   C   D  E</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>  <span class="number">1</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>  <span class="number">2</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13</span>  <span class="number">14</span>  <span class="number">15</span>  <span class="number">4</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17</span>  <span class="number">18</span>  <span class="number">19</span>  <span class="number">5</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span>  <span class="number">6</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas处理丢失数据"><a href="#Pandas处理丢失数据" class="headerlink" title="Pandas处理丢失数据"></a>Pandas处理丢失数据</h3><h4 id="创建含NaN的矩阵"><a href="#创建含NaN的矩阵" class="headerlink" title="创建含NaN的矩阵"></a>创建含NaN的矩阵</h4><p>&emsp;&emsp;有时我们导入或处理数据，会产生一些空的或者是<code>NaN</code>数据，如何删除或者是填补这些<code>NaN</code>数据就是今天所要提到的内容。建立了一个<code>6 * 4</code>的矩阵数据，并且把两个位置设置为空：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">'20130101'</span>, periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>, <span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line">df.iloc[<span class="number">0</span>, <span class="number">1</span>] = np.nan</span><br><span class="line">df.iloc[<span class="number">1</span>, <span class="number">2</span>] = np.nan</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   NaN   <span class="number">2.0</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5.0</span>   NaN   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9.0</span>  <span class="number">10.0</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13.0</span>  <span class="number">14.0</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="pd-dropna"><a href="#pd-dropna" class="headerlink" title="pd.dropna"></a>pd.dropna</h4><p>&emsp;&emsp;如果想直接去掉有<code>NaN</code>的行或列，可以使用<code>dropna</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = df.dropna(</span><br><span class="line">    axis=<span class="number">0</span>,  <span class="comment"># 0：对行进行操作；1：对列进行操作</span></span><br><span class="line">    how=<span class="string">'any'</span>  <span class="comment"># any：只要存在NaN就drop掉；all：必须全部是NaN才drop掉</span></span><br><span class="line">)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9.0</span>  <span class="number">10.0</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13.0</span>  <span class="number">14.0</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="pd-fillna"><a href="#pd-fillna" class="headerlink" title="pd.fillna"></a>pd.fillna</h4><p>&emsp;&emsp;如果是将<code>NaN</code>用其他值代替(比如代替成<code>0</code>)，则可以使用<code>fillna</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = df.fillna(value=<span class="number">0</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             A     B     C   D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>   <span class="number">0</span>   <span class="number">0.0</span>   <span class="number">2.0</span>   <span class="number">3</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>   <span class="number">4</span>   <span class="number">5.0</span>   <span class="number">0.0</span>   <span class="number">7</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>   <span class="number">8</span>   <span class="number">9.0</span>  <span class="number">10.0</span>  <span class="number">11</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">12</span>  <span class="number">13.0</span>  <span class="number">14.0</span>  <span class="number">15</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">16</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">20</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23</span></span><br></pre></td></tr></table></figure>
<h4 id="pd-isnull"><a href="#pd-isnull" class="headerlink" title="pd.isnull"></a>pd.isnull</h4><p>&emsp;&emsp;判断是否有缺失数据<code>NaN</code>，为<code>True</code>表示缺失数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df.isnull())</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                A      B      C      D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="keyword">False</span>   <span class="keyword">True</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="keyword">False</span>  <span class="keyword">False</span>   <span class="keyword">True</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>检测数据中是否存在<code>NaN</code>，如果存在就返回<code>True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(np.any(df.isnull()) == <span class="keyword">True</span>)  <span class="comment"># 结果为True</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas合并concat"><a href="#Pandas合并concat" class="headerlink" title="Pandas合并concat"></a>Pandas合并concat</h3><p>&emsp;&emsp;在处理多组数据时，往往会对数据进行合并处理。<code>concat</code>是一种基本的合并方式，而且<code>concat</code>中有很多参数可以调整，合并成你想要的数据形式：</p>
<h4 id="axis-合并方向"><a href="#axis-合并方向" class="headerlink" title="axis(合并方向)"></a>axis(合并方向)</h4><p>&emsp;&emsp;<code>axis = 0</code>是预设值，因此未设定任何参数时，函数默认<code>axis</code>为<code>0</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df3 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">2</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">res = pd.concat([df1, df2, df3], axis=<span class="number">0</span>)  <span class="comment"># concat纵向合并</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br></pre></td></tr></table></figure>
<h4 id="ignore-index-重置index"><a href="#ignore-index-重置index" class="headerlink" title="ignore_index(重置index)"></a>ignore_index(重置index)</h4><p>&emsp;&emsp;仔细观察会发现结果的<code>index</code>是<code>[0, 1, 2, 0, 1, 2, 0, 1, 2]</code>，若要将<code>index</code>重置，需要使用<code>ignore_index</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.concat([df1, df2, df3], axis=<span class="number">0</span>, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 将index_ignore设定为True</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">6</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">7</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">8</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br></pre></td></tr></table></figure>
<h4 id="join-合并方式"><a href="#join-合并方式" class="headerlink" title="join(合并方式)"></a>join(合并方式)</h4><p>&emsp;&emsp;<code>join=&#39;outer&#39;</code>为预设值，因此未设定任何参数时，函数默认<code>join</code>是<code>outer</code>。此方式是依照<code>column</code>来做纵向合并，有相同的<code>column</code>则上下合并在一起，其他独自的<code>column</code>各自成列，原本没有值的位置皆以<code>NaN</code>填充：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], index=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], index=[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">'outer'</span>)  <span class="comment"># 纵向“外”合并df1与df2</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d    e</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN</span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN</span><br><span class="line"><span class="number">2</span>  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>对于内合并，只有相同的<code>column</code>合并在一起，其他的会被抛弃：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">'inner'</span>)  <span class="comment"># 纵向“内”合并df1与df2</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----------------"</span>)</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">'inner'</span>, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 重置index并打印结果</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">     b    c    d</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">-----------------</span><br><span class="line">     b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<h4 id="join-axes-依照axes合并"><a href="#join-axes-依照axes合并" class="headerlink" title="join_axes(依照axes合并)"></a>join_axes(依照axes合并)</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], index=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], index=[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">1</span>, join_axes=[df1.index])  <span class="comment"># 依照df1.index进行横向合并</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------------------------"</span>)</span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">1</span>)  <span class="comment"># 移除join_axes，并打印结果</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d    b    c    d    e</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN  NaN  NaN  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">--------------------------</span><br><span class="line">     a    b    c    d    b    c    d    e</span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  NaN  NaN  NaN  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  NaN  NaN  NaN  NaN  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<h4 id="append-添加数据"><a href="#append-添加数据" class="headerlink" title="append(添加数据)"></a>append(添加数据)</h4><p>&emsp;&emsp;<code>append</code>只有纵向合并，没有横向合并：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">0</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df3 = pd.DataFrame(np.ones((<span class="number">3</span>, <span class="number">4</span>)) * <span class="number">1</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">res = df1.append(df2, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 将df2合并到df1的下面，以及重置index</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">res = df1.append([df2, df3], ignore_index=<span class="keyword">True</span>)  <span class="comment"># 合并多个df，将df2与df3合并至df1的下面，以及重置index</span></span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----------------------"</span>)</span><br><span class="line">res = df1.append(s1, ignore_index=<span class="keyword">True</span>)  <span class="comment"># 合并series，将s1合并至df1，以及重置index</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">-----------------------</span><br><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">6</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">7</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">8</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line">-----------------------</span><br><span class="line">     a    b    c    d</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">2.0</span>  <span class="number">3.0</span>  <span class="number">4.0</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas合并merge"><a href="#Pandas合并merge" class="headerlink" title="Pandas合并merge"></a>Pandas合并merge</h3><p>&emsp;&emsp;<code>pandas</code>中的<code>merge</code>和<code>concat</code>类似，但主要是用于两组有<code>key column</code>的数据，通常也被用在<code>Database</code>的处理当中。</p>
<h4 id="依据一组key合并"><a href="#依据一组key合并" class="headerlink" title="依据一组key合并"></a>依据一组key合并</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'key'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>, <span class="string">'K3'</span>],</span><br><span class="line">     <span class="string">'A'</span>: [<span class="string">'A0'</span>, <span class="string">'A1'</span>, <span class="string">'A2'</span>, <span class="string">'A3'</span>],</span><br><span class="line">     <span class="string">'B'</span>: [<span class="string">'B0'</span>, <span class="string">'B1'</span>, <span class="string">'B2'</span>, <span class="string">'B3'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'key'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>, <span class="string">'K3'</span>],</span><br><span class="line">     <span class="string">'C'</span>: [<span class="string">'C0'</span>, <span class="string">'C1'</span>, <span class="string">'C2'</span>, <span class="string">'C3'</span>],</span><br><span class="line">     <span class="string">'D'</span>: [<span class="string">'D0'</span>, <span class="string">'D1'</span>, <span class="string">'D2'</span>, <span class="string">'D3'</span>]&#125;)</span><br><span class="line"></span><br><span class="line">print(left)</span><br><span class="line">print(<span class="string">"---------------"</span>)</span><br><span class="line">print(right)</span><br><span class="line">print(<span class="string">"---------------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=<span class="string">'key'</span>)  <span class="comment"># 依据“key column”合并</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    A   B key</span><br><span class="line"><span class="number">0</span>  A0  B0  K0</span><br><span class="line"><span class="number">1</span>  A1  B1  K1</span><br><span class="line"><span class="number">2</span>  A2  B2  K2</span><br><span class="line"><span class="number">3</span>  A3  B3  K3</span><br><span class="line">---------------</span><br><span class="line">    C   D key</span><br><span class="line"><span class="number">0</span>  C0  D0  K0</span><br><span class="line"><span class="number">1</span>  C1  D1  K1</span><br><span class="line"><span class="number">2</span>  C2  D2  K2</span><br><span class="line"><span class="number">3</span>  C3  D3  K3</span><br><span class="line">---------------</span><br><span class="line">    A   B key   C   D</span><br><span class="line"><span class="number">0</span>  A0  B0  K0  C0  D0</span><br><span class="line"><span class="number">1</span>  A1  B1  K1  C1  D1</span><br><span class="line"><span class="number">2</span>  A2  B2  K2  C2  D2</span><br><span class="line"><span class="number">3</span>  A3  B3  K3  C3  D3</span><br></pre></td></tr></table></figure>
<h4 id="依据两组key合并"><a href="#依据两组key合并" class="headerlink" title="依据两组key合并"></a>依据两组key合并</h4><p>&emsp;&emsp;合并时有<code>4</code>种方法，即<code>how = [&#39;left&#39;, &#39;right&#39;, &#39;outer&#39;, &#39;inner&#39;]</code>，预设值<code>how</code>为<code>inner</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">'key1'</span>: [<span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>],</span><br><span class="line">    <span class="string">'key2'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K0'</span>, <span class="string">'K1'</span>],</span><br><span class="line">    <span class="string">'A'</span>: [<span class="string">'A0'</span>, <span class="string">'A1'</span>, <span class="string">'A2'</span>, <span class="string">'A3'</span>],</span><br><span class="line">    <span class="string">'B'</span>: [<span class="string">'B0'</span>, <span class="string">'B1'</span>, <span class="string">'B2'</span>, <span class="string">'B3'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'key1'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>],</span><br><span class="line">     <span class="string">'key2'</span>: [<span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K0'</span>],</span><br><span class="line">     <span class="string">'C'</span>: [<span class="string">'C0'</span>, <span class="string">'C1'</span>, <span class="string">'C2'</span>, <span class="string">'C3'</span>],</span><br><span class="line">     <span class="string">'D'</span>: [<span class="string">'D0'</span>, <span class="string">'D1'</span>, <span class="string">'D2'</span>, <span class="string">'D3'</span>]&#125;)</span><br><span class="line">print(<span class="string">"--------left------"</span>)</span><br><span class="line">print(left)</span><br><span class="line">print(<span class="string">"--------right------"</span>)</span><br><span class="line">print(right)</span><br><span class="line">print(<span class="string">"--------inner合并------"</span>)</span><br><span class="line"><span class="comment"># 依据key1与key2的columns进行合并</span></span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'inner'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------outer合并------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'outer'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------left合并------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'left'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"--------right合并------"</span>)</span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'right'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">--------left------</span><br><span class="line">    A   B key1 key2</span><br><span class="line"><span class="number">0</span>  A0  B0   K0   K0</span><br><span class="line"><span class="number">1</span>  A1  B1   K0   K1</span><br><span class="line"><span class="number">2</span>  A2  B2   K1   K0</span><br><span class="line"><span class="number">3</span>  A3  B3   K2   K1</span><br><span class="line">--------right------</span><br><span class="line">    C   D key1 key2</span><br><span class="line"><span class="number">0</span>  C0  D0   K0   K0</span><br><span class="line"><span class="number">1</span>  C1  D1   K1   K0</span><br><span class="line"><span class="number">2</span>  C2  D2   K1   K0</span><br><span class="line"><span class="number">3</span>  C3  D3   K2   K0</span><br><span class="line">--------inner合并------</span><br><span class="line">    A   B key1 key2   C   D</span><br><span class="line"><span class="number">0</span>  A0  B0   K0   K0  C0  D0</span><br><span class="line"><span class="number">1</span>  A2  B2   K1   K0  C1  D1</span><br><span class="line"><span class="number">2</span>  A2  B2   K1   K0  C2  D2</span><br><span class="line">--------outer合并------</span><br><span class="line">     A    B key1 key2    C    D</span><br><span class="line"><span class="number">0</span>   A0   B0   K0   K0   C0   D0</span><br><span class="line"><span class="number">1</span>   A1   B1   K0   K1  NaN  NaN</span><br><span class="line"><span class="number">2</span>   A2   B2   K1   K0   C1   D1</span><br><span class="line"><span class="number">3</span>   A2   B2   K1   K0   C2   D2</span><br><span class="line"><span class="number">4</span>   A3   B3   K2   K1  NaN  NaN</span><br><span class="line"><span class="number">5</span>  NaN  NaN   K2   K0   C3   D3</span><br><span class="line">--------left合并------</span><br><span class="line">    A   B key1 key2    C    D</span><br><span class="line"><span class="number">0</span>  A0  B0   K0   K0   C0   D0</span><br><span class="line"><span class="number">1</span>  A1  B1   K0   K1  NaN  NaN</span><br><span class="line"><span class="number">2</span>  A2  B2   K1   K0   C1   D1</span><br><span class="line"><span class="number">3</span>  A2  B2   K1   K0   C2   D2</span><br><span class="line"><span class="number">4</span>  A3  B3   K2   K1  NaN  NaN</span><br><span class="line">--------right合并------</span><br><span class="line">     A    B key1 key2   C   D</span><br><span class="line"><span class="number">0</span>   A0   B0   K0   K0  C0  D0</span><br><span class="line"><span class="number">1</span>   A2   B2   K1   K0  C1  D1</span><br><span class="line"><span class="number">2</span>   A2   B2   K1   K0  C2  D2</span><br><span class="line"><span class="number">3</span>  NaN  NaN   K2   K0  C3  D3</span><br></pre></td></tr></table></figure>
<h4 id="Indicator"><a href="#Indicator" class="headerlink" title="Indicator"></a>Indicator</h4><p>&emsp;&emsp;<code>indicator = True</code>会将合并的记录放在新的一列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">'col1'</span>: [<span class="number">0</span>, <span class="number">1</span>], <span class="string">'col_left'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">'col1'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="string">'col_right'</span>: [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">print(<span class="string">"-------df1-------"</span>)</span><br><span class="line">print(df1)</span><br><span class="line">print(<span class="string">"-------df2-------"</span>)</span><br><span class="line">print(df2)</span><br><span class="line">print(<span class="string">"-------启用indicator-------"</span>)</span><br><span class="line"><span class="comment"># 依据col1进行合并，并启用“indicator = True”</span></span><br><span class="line">res = pd.merge(df1, df2, on=<span class="string">'col1'</span>, how=<span class="string">'outer'</span>, indicator=<span class="keyword">True</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-------自定义名称-------"</span>)</span><br><span class="line"><span class="comment"># 自定义“indicator column”的名称</span></span><br><span class="line">res = pd.merge(df1, df2, on=<span class="string">'col1'</span>, how=<span class="string">'outer'</span>, indicator=<span class="string">'indicator_column'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-------df1-------</span><br><span class="line">   col1 col_left</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>        a</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>        b</span><br><span class="line">-------df2-------</span><br><span class="line">   col1  col_right</span><br><span class="line"><span class="number">0</span>     <span class="number">1</span>          <span class="number">2</span></span><br><span class="line"><span class="number">1</span>     <span class="number">2</span>          <span class="number">2</span></span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>          <span class="number">2</span></span><br><span class="line">-------启用indicator-------</span><br><span class="line">   col1 col_left  col_right      _merge</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>        a        NaN   left_only</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>        b        <span class="number">2.0</span>        both</span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>  right_only</span><br><span class="line"><span class="number">3</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>  right_only</span><br><span class="line">-------自定义名称-------</span><br><span class="line">   col1 col_left  col_right indicator_column</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>        a        NaN        left_only</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>        b        <span class="number">2.0</span>             both</span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>       right_only</span><br><span class="line"><span class="number">3</span>     <span class="number">2</span>      NaN        <span class="number">2.0</span>       right_only</span><br></pre></td></tr></table></figure>
<h4 id="依据index合并"><a href="#依据index合并" class="headerlink" title="依据index合并"></a>依据index合并</h4><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'A'</span>: [<span class="string">'A0'</span>, <span class="string">'A1'</span>, <span class="string">'A2'</span>],</span><br><span class="line">     <span class="string">'B'</span>: [<span class="string">'B0'</span>, <span class="string">'B1'</span>, <span class="string">'B2'</span>]&#125;,</span><br><span class="line">    index=[<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>])</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">'C'</span>: [<span class="string">'C0'</span>, <span class="string">'C2'</span>, <span class="string">'C3'</span>],</span><br><span class="line">     <span class="string">'D'</span>: [<span class="string">'D0'</span>, <span class="string">'D2'</span>, <span class="string">'D3'</span>]&#125;,</span><br><span class="line">    index=[<span class="string">'K0'</span>, <span class="string">'K2'</span>, <span class="string">'K3'</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="string">"-----left-----"</span>)</span><br><span class="line">print(left)</span><br><span class="line">print(<span class="string">"-----right-----"</span>)</span><br><span class="line">print(right)</span><br><span class="line">print(<span class="string">"-----outer合并-----"</span>)</span><br><span class="line">res = pd.merge(left, right, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">print(res)</span><br><span class="line">print(<span class="string">"-----inner合并-----"</span>)</span><br><span class="line">res = pd.merge(left, right, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<h3 id="解决overlapping的问题"><a href="#解决overlapping的问题" class="headerlink" title="解决overlapping的问题"></a>解决overlapping的问题</h3><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">boys = pd.DataFrame(&#123;<span class="string">'k'</span>: [<span class="string">'K0'</span>, <span class="string">'K1'</span>, <span class="string">'K2'</span>], <span class="string">'age'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">girls = pd.DataFrame(&#123;<span class="string">'k'</span>: [<span class="string">'K0'</span>, <span class="string">'K0'</span>, <span class="string">'K3'</span>], <span class="string">'age'</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</span><br><span class="line"><span class="comment"># 使用suffixes解决overlapping的问题</span></span><br><span class="line">res = pd.merge(boys, girls, on=<span class="string">'k'</span>, suffixes=[<span class="string">'_boy'</span>, <span class="string">'_girl'</span>], how=<span class="string">'inner'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   age_boy   k  age_girl</span><br><span class="line"><span class="number">0</span>        <span class="number">1</span>  K0         <span class="number">4</span></span><br><span class="line"><span class="number">1</span>        <span class="number">1</span>  K0         <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h3 id="读取csv文件"><a href="#读取csv文件" class="headerlink" title="读取csv文件"></a>读取csv文件</h3><p>&emsp;&emsp;假设<code>csv</code>文件内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name,physics,python,math,english</span><br><span class="line">Google,<span class="number">100</span>,<span class="number">100</span>,<span class="number">25</span>,<span class="number">12</span></span><br><span class="line">Facebook,<span class="number">45</span>,<span class="number">54</span>,<span class="number">44</span>,<span class="number">88</span></span><br><span class="line">Twitter,<span class="number">54</span>,<span class="number">76</span>,<span class="number">13</span>,<span class="number">91</span></span><br><span class="line">Yahoo,<span class="number">54</span>,<span class="number">452</span>,<span class="number">26</span>,<span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>使用<code>Pandas</code>进行读取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">marks = pd.read_csv(<span class="string">"test.csv"</span>)</span><br><span class="line">print(marks)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       name  physics  python  math  english</span><br><span class="line"><span class="number">0</span>    Google      <span class="number">100</span>     <span class="number">100</span>    <span class="number">25</span>       <span class="number">12</span></span><br><span class="line"><span class="number">1</span>  Facebook       <span class="number">45</span>      <span class="number">54</span>    <span class="number">44</span>       <span class="number">88</span></span><br><span class="line"><span class="number">2</span>   Twitter       <span class="number">54</span>      <span class="number">76</span>    <span class="number">13</span>       <span class="number">91</span></span><br><span class="line"><span class="number">3</span>     Yahoo       <span class="number">54</span>     <span class="number">452</span>    <span class="number">26</span>      <span class="number">100</span></span><br></pre></td></tr></table></figure>
<h3 id="get-dummies"><a href="#get-dummies" class="headerlink" title="get_dummies"></a>get_dummies</h3><p>&emsp;&emsp;<code>pandas</code>使用<code>get_dummies</code>进行<code>one-hot</code>编码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">xiaoming = pd.DataFrame([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">'yellow'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>], columns=[<span class="string">'hat'</span>])</span><br><span class="line">print(xiaoming)</span><br><span class="line">print(<span class="string">"--------------"</span>)</span><br><span class="line">hat_ranks = pd.get_dummies(xiaoming[<span class="string">'hat'</span>], prefix=<span class="string">'hat'</span>)</span><br><span class="line">print(hat_ranks.head())</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        hat</span><br><span class="line">yellow    <span class="number">1</span></span><br><span class="line">red       <span class="number">2</span></span><br><span class="line">blue      <span class="number">3</span></span><br><span class="line">--------------</span><br><span class="line">        hat_1  hat_2  hat_3</span><br><span class="line">yellow      <span class="number">1</span>      <span class="number">0</span>      <span class="number">0</span></span><br><span class="line">red         <span class="number">0</span>      <span class="number">1</span>      <span class="number">0</span></span><br><span class="line">blue        <span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="keys函数"><a href="#keys函数" class="headerlink" title="keys函数"></a>keys函数</h3><p>&emsp;&emsp;Return a list of column names.</p>
<h3 id="Categorical函数"><a href="#Categorical函数" class="headerlink" title="Categorical函数"></a>Categorical函数</h3><p>&emsp;&emsp;该函数用于创建分组，主要有两种方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_categories = pd.Categorical([<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>])</span><br><span class="line">print(my_categories)  <span class="comment"># 输出“[foo, bar, baz, foo, bar]”</span></span><br><span class="line">categories = [<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]</span><br><span class="line">codes = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">my_cats_2 = pd.Categorical.from_codes(codes, categories, ordered=<span class="keyword">True</span>)</span><br><span class="line">print(my_cats_2)  <span class="comment"># 输出“[foo, bar, baz, foo, foo, bar]”</span></span><br></pre></td></tr></table></figure>
<h3 id="pandas-DataFrame-head"><a href="#pandas-DataFrame-head" class="headerlink" title="pandas.DataFrame.head"></a>pandas.DataFrame.head</h3><p>&emsp;&emsp;<code>DataFrame.head(n=5)</code>: Return the first <code>n</code> rows. This function returns the first <code>n</code> rows for the object based on position. It is useful for quickly testing if your object has the right type of data in it.<br>&emsp;&emsp;Examples:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(&#123;<span class="string">'animal'</span>:[<span class="string">'alligator'</span>, <span class="string">'bee'</span>, <span class="string">'falcon'</span>, <span class="string">'lion'</span>,</span><br><span class="line"><span class="meta">... </span>                   <span class="string">'monkey'</span>, <span class="string">'parrot'</span>, <span class="string">'shark'</span>, <span class="string">'whale'</span>, <span class="string">'zebra'</span>]&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df</span><br><span class="line">      animal</span><br><span class="line"><span class="number">0</span>  alligator</span><br><span class="line"><span class="number">1</span>        bee</span><br><span class="line"><span class="number">2</span>     falcon</span><br><span class="line"><span class="number">3</span>       lion</span><br><span class="line"><span class="number">4</span>     monkey</span><br><span class="line"><span class="number">5</span>     parrot</span><br><span class="line"><span class="number">6</span>      shark</span><br><span class="line"><span class="number">7</span>      whale</span><br><span class="line"><span class="number">8</span>      zebra</span><br></pre></td></tr></table></figure>
<p>Viewing the first <code>5</code> lines:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.head()</span><br><span class="line">      animal</span><br><span class="line"><span class="number">0</span>  alligator</span><br><span class="line"><span class="number">1</span>        bee</span><br><span class="line"><span class="number">2</span>     falcon</span><br><span class="line"><span class="number">3</span>       lion</span><br><span class="line"><span class="number">4</span>     monkey</span><br></pre></td></tr></table></figure>
<p>Viewing the first <code>n</code> lines (three in this case):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.head(<span class="number">3</span>)</span><br><span class="line">      animal</span><br><span class="line"><span class="number">0</span>  alligator</span><br><span class="line"><span class="number">1</span>        bee</span><br><span class="line"><span class="number">2</span>     falcon</span><br></pre></td></tr></table></figure>
<h3 id="pandas-factorize"><a href="#pandas-factorize" class="headerlink" title="pandas.factorize"></a>pandas.factorize</h3><p>&emsp;&emsp;<code>pandas.factorize(values, sort=False, order=None, na_sentinel=-1, size_hint=None)</code>: Encode the object as an enumerated type or categorical variable.<br>&emsp;&emsp;This method is useful for obtaining a numeric representation of an array when all that matters is identifying distinct <code>values</code>. <code>factorize</code> is available as both a <code>top-level</code> function <code>pandas.factorize()</code>, and as a method <code>Series.factorize()</code> and <code>Index.factorize()</code>.<br>&emsp;&emsp;Parameters:</p>
<ul>
<li><code>values</code>: <code>sequence</code>. A <code>1-D</code> <code>seqeunce</code>. Sequences that aren’t pandas objects are coereced to <code>ndarrays</code> before factorization.</li>
<li><code>sort</code>: <code>bool</code>, default <code>False</code>. Sort uniques and shuffle labels to maintain the relationship.</li>
<li><code>order</code>: Deprecated since <code>version 0.23.0</code>: This parameter has no effect and is deprecated.</li>
<li><code>na_sentinel</code>: <code>int</code>, default <code>-1</code>. Value to mark <code>not found</code>.</li>
<li><code>size_hint</code>: <code>int</code>, optional. Hint to the hashtable sizer.</li>
</ul>
<p>&emsp;&emsp;Returns:</p>
<ul>
<li><code>labels</code>: <code>ndarray</code>. An integer <code>ndarray</code> that’s an indexer into uniques. <code>uniques.take(labels)</code> will have the same values as <code>values</code>.</li>
<li><code>uniques</code>: <code>ndarray</code>, <code>Index</code>, or <code>Categorical</code>. The unique valid <code>values</code>. When <code>values</code> is <code>Categorical</code>, <code>uniques</code> is a <code>Categorical</code>. When <code>values</code> is some other pandas object, an <code>Index</code> is returned. Otherwise, a <code>1-D</code> <code>ndarray</code> is returned.</li>
</ul>
<p>&emsp;&emsp;<strong>Note</strong>: Even if there’s a missing value in <code>values</code>, <code>uniques</code> will not contain an entry for it.<br>&emsp;&emsp;<strong>Examples</strong>: These examples all show <code>factorize</code> as a <code>top-level</code> method like <code>pd.factorize(values)</code>. The results are identical for methods like <code>Series.factorize()</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize([<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">array([<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>], dtype=object)</span><br></pre></td></tr></table></figure>
<p>With <code>sort=True</code>, the uniques will be sorted, and labels will be shuffled so that the relationship is the maintained.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize([<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>], sort=<span class="keyword">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">array([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], dtype=object)</span><br></pre></td></tr></table></figure>
<p>Missing values are indicated in labels with <code>na_sentinel</code> (<code>-1</code> by default). Note that missing values are never included in uniques.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize([<span class="string">'b'</span>, <span class="keyword">None</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([ <span class="number">0</span>, <span class="number">-1</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">array([<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>], dtype=object)</span><br></pre></td></tr></table></figure>
<p>Thus far, we’ve only factorized lists (which are internally coerced to <code>NumPy</code> arrays). When factorizing <code>pandas</code> objects, the type of uniques will differ. For <code>Categoricals</code>, a <code>Categorical</code> is returned.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cat = pd.Categorical([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>], categories=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize(cat)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">[a, c]</span><br><span class="line">Categories (<span class="number">3</span>, object): [a, b, c]</span><br></pre></td></tr></table></figure>
<p>Notice that <code>b</code> is in <code>uniques.categories</code>, desipite not being present in <code>cat.values</code>. For all other pandas objects, an <code>Index</code> of the appropriate type is returned.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cat = pd.Series([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels, uniques = pd.factorize(cat)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels</span><br><span class="line">array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uniques</span><br><span class="line">Index([<span class="string">'a'</span>, <span class="string">'c'</span>], dtype=<span class="string">'object'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="pandas-crosstab"><a href="#pandas-crosstab" class="headerlink" title="pandas.crosstab"></a>pandas.crosstab</h3><p>&emsp;&emsp;<code>pandas.crosstab(index, columns, values=None, rownames=None, colnames=None, aggfunc=None, margins=False, margins_name=&#39;All&#39;, dropna=True, normalize=False)</code>: Compute a simple <code>cross-tabulation</code> of two (or more) factors. By default computes a frequency table of the factors unless an array of <code>values</code> and an aggregation function are passed.<br>&emsp;&emsp;Parameters:</p>
<ul>
<li><code>index</code>: <code>array-like</code>, <code>Series</code>, or list of <code>arrays/Series</code>. Values to group by in the rows.</li>
<li><code>columns</code>: <code>array-like</code>, <code>Series</code>, or list of <code>arrays/Series</code>. Values to group by in the columns.</li>
<li><code>values</code>: <code>array-like</code>, optional. Array of <code>values</code> to aggregate according to the factors. Requires <code>aggfunc</code> be specified.</li>
<li><code>aggfunc</code>: function, optional. If specified, requires <code>values</code> be specified as well.</li>
<li><code>rownames</code>: <code>sequence</code>, default <code>None</code>. If passed, must match number of row arrays passed.</li>
<li><code>colnames</code>: <code>sequence</code>, default <code>None</code>. If passed, must match number of column arrays passed.</li>
<li><code>margins</code>: <code>boolean</code>, default <code>False</code>. Add <code>row/column</code> margins (<code>subtotals</code>).</li>
<li><code>margins_name</code>: <code>string</code>, default <code>All</code>. Name of the <code>row/column</code> that will contain the totals when margins is <code>True</code>.</li>
<li><code>dropna</code>: <code>boolean</code>, default <code>True</code>. Do not include columns whose entries are all <code>NaN</code>.</li>
<li><code>normalize</code>: <code>boolean</code>, {<code>all</code>, <code>index</code>, <code>columns</code>}, or {<code>0</code>, <code>1</code>}, default <code>False</code>. Normalize by dividing all values by the sum of <code>values</code>.</li>
</ul>
<ol>
<li>If passed <code>all</code> or <code>True</code>, will normalize over all values.</li>
<li>If passed <code>index</code> will normalize over each row.</li>
<li>If passed <code>columns</code> will normalize over each column.</li>
<li>If <code>margins</code> is <code>True</code>, will also normalize margin values.</li>
</ol>
<p>&emsp;&emsp;Any <code>Series</code> passed will have their name attributes used unless row or column names for the <code>cross-tabulation</code> are specified.<br>&emsp;&emsp;Any input passed containing <code>Categorical</code> data will have all of its categories included in the <code>cross-tabulation</code>, even if the actual data does not contain any instances of a particular category.<br>&emsp;&emsp;In the event that there aren’t overlapping indexes, an empty <code>DataFrame</code> will be returned.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.array([<span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"bar"</span>,</span><br><span class="line"><span class="meta">... </span>              <span class="string">"bar"</span>, <span class="string">"bar"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>, <span class="string">"foo"</span>], dtype=object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = np.array([<span class="string">"one"</span>, <span class="string">"one"</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"one"</span>, <span class="string">"one"</span>,</span><br><span class="line"><span class="meta">... </span>              <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"two"</span>, <span class="string">"two"</span>, <span class="string">"one"</span>], dtype=object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = np.array([<span class="string">"dull"</span>, <span class="string">"dull"</span>, <span class="string">"shiny"</span>, <span class="string">"dull"</span>, <span class="string">"dull"</span>, <span class="string">"shiny"</span>,</span><br><span class="line"><span class="meta">... </span>              <span class="string">"shiny"</span>, <span class="string">"dull"</span>, <span class="string">"shiny"</span>, <span class="string">"shiny"</span>, <span class="string">"shiny"</span>], dtype=object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pd.crosstab(a, [b, c], rownames=[<span class="string">'a'</span>], colnames=[<span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">b   one        two</span><br><span class="line">c   dull shiny dull shiny</span><br><span class="line">a</span><br><span class="line">bar    <span class="number">1</span>     <span class="number">2</span>    <span class="number">1</span>     <span class="number">0</span></span><br><span class="line">foo    <span class="number">2</span>     <span class="number">2</span>    <span class="number">1</span>     <span class="number">2</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo = pd.Categorical([<span class="string">'a'</span>, <span class="string">'b'</span>], categories=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar = pd.Categorical([<span class="string">'d'</span>, <span class="string">'e'</span>], categories=[<span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>])</span><br><span class="line"><span class="comment"># 'c' and 'f' are not represented in the data,</span></span><br><span class="line"><span class="comment"># but they still will be counted in the output</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>crosstab(foo, bar)</span><br><span class="line">col_0  d  e  f</span><br><span class="line">row_0</span><br><span class="line">a      <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">b      <span class="number">0</span>  <span class="number">1</span>  <span class="number">0</span></span><br><span class="line">c      <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/itertools模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/itertools模块/" itemprop="url">itertools模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T20:31:27+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python</code>提供了一个非常棒的模块用于创建自定义的迭代器，这个模块就是<code>itertools</code>。<code>itertools</code>提供的工具相当高效且节省内存，使用这些工具，你将能够创建自己定制的迭代器用于高效率的循环。</p>
<h3 id="无限迭代器"><a href="#无限迭代器" class="headerlink" title="无限迭代器"></a>无限迭代器</h3><p>&emsp;&emsp;<code>itertools</code>包自带了三个可以无限迭代的迭代器，这意味着当你使用它们时，需要知道到底是最终会停止迭代器，还是需要无限地迭代下去。这些无限迭代器在生成数字或者在长度未知的可迭代对象(<code>iterables</code>)中循环时相当有用。</p>
<h4 id="count-初值-0-步长-1"><a href="#count-初值-0-步长-1" class="headerlink" title="count(初值=0, 步长=1)"></a>count(初值=0, 步长=1)</h4><p>&emsp;&emsp;<code>count</code>迭代器会返回从传入的起始参数开始的均匀间隔的数值。<code>count</code>也可以接收指定的步长参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> count(<span class="number">18</span>):</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">19</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;另一种控制无限迭代器输出的方式是使用<code>itertools</code>的子模块<code>islice</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> islice, count</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(<span class="number">10</span>), <span class="number">5</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure>
<p><code>islice</code>的第二个参数控制何时停止迭代，其含义并不是<code>达到数字5时停止</code>，而是<code>当迭代了5次之后停止</code>。</p>
<h4 id="cycle-可迭代对象"><a href="#cycle-可迭代对象" class="headerlink" title="cycle(可迭代对象)"></a>cycle(可迭代对象)</h4><p>&emsp;&emsp;<code>itertools</code>中的<code>cycle</code>迭代器允许你创建一个能在一组值间无限循环的迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> cycle</span><br><span class="line">​</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cycle(<span class="string">'XYZ'</span>):</span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(item)</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X</span><br><span class="line">Y</span><br><span class="line">Z</span><br><span class="line">X</span><br><span class="line">Y</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;你也可以用<code>Python</code>内建的<code>next</code>函数对<code>itertools</code>创建的迭代器进行循环：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>polys = [<span class="string">'triangle'</span>, <span class="string">'square'</span>, <span class="string">'pentagon'</span>, <span class="string">'rectangle'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iterator = cycle(polys)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'triangle'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'square'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'pentagon'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'rectangle'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'triangle'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'square'</span></span><br></pre></td></tr></table></figure>
<p>上面的代码中，我们创建一个简单的多边形组成的列表，然后传入<code>cycle</code>。我们用一个变量存储新建的迭代器，然后将这个变量传入<code>next</code>函数。每一次调用<code>next</code>，都将返回迭代器中的下一个值。由于迭代器是无限的，我们可以一直调用<code>next</code>而永远不会到尽头。</p>
<h4 id="repeat-对象-次数"><a href="#repeat-对象-次数" class="headerlink" title="repeat(对象[, 次数])"></a>repeat(对象[, 次数])</h4><p>&emsp;&emsp;<code>repeat</code>迭代器会一遍遍地返回传入的对象直至永远，除非你设定了<code>times</code>参数。这与<code>cycle</code>非常相像，除了<code>repeat</code>不会在多个值之间循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> repeat</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repeat(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">repeat(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iterator = repeat(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  Python Shell, prompt <span class="number">21</span>, line <span class="number">1</span></span><br><span class="line">builtins.StopIteration:</span><br></pre></td></tr></table></figure>
<p>先导入<code>repeat</code>，然后设定其重复五次。接着连续六次调用<code>next</code>函数，观察它是否工作正常。当运行这段代码，将引发<code>StopIteration</code>，因为最后一次调用<code>next</code>函数时，迭代器中的值已经全部返回了。</p>
<h3 id="可终止的迭代器"><a href="#可终止的迭代器" class="headerlink" title="可终止的迭代器"></a>可终止的迭代器</h3><p>&emsp;&emsp;多数用<code>itertools</code>创建的迭代器并不是无限的。为了对于输出的可读的结果，我们将使用<code>Python</code>内建列表存储。如果不使用列表，你将只能打印出<code>itertools</code>对象。</p>
<h4 id="accumulate-可迭代对象-函数"><a href="#accumulate-可迭代对象-函数" class="headerlink" title="accumulate(可迭代对象[, 函数])"></a>accumulate(可迭代对象[, 函数])</h4><p>&emsp;&emsp;<code>accumulate</code>迭代器将返回累计求和结果，或者传入两个参数的话，由传入的函数累积计算的结果。默认设定为相加。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> accumulate</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(accumulate(range(<span class="number">10</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">28</span>, <span class="number">36</span>, <span class="number">45</span>]</span><br></pre></td></tr></table></figure>
<p>导入了<code>accumulate</code>，然后传入<code>10</code>个数字(<code>0</code>至<code>9</code>)。迭代器将传入数字依次累加，所以第一个是<code>0</code>，第二个是<code>0 + 1</code>，第三个是<code>1 + 2</code>，以此类推。现在导入<code>operator</code>模块，然后添加进去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(accumulate(range(<span class="number">1</span>, <span class="number">5</span>), operator.mul))</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>]</span><br></pre></td></tr></table></figure>
<p>这里传入了数字<code>1</code>至<code>4</code>到<code>accumulate</code>迭代器中，还传入了一个函数<code>operator.mul</code>，这个函数将接收的参数相乘。</p>
<h4 id="chain-可迭代对象"><a href="#chain-可迭代对象" class="headerlink" title="chain(*可迭代对象)"></a>chain(*可迭代对象)</h4><p>&emsp;&emsp;<code>chain</code>迭代器能够将多个可迭代对象合并成一个更长的可迭代对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">​</span><br><span class="line">cmd = [<span class="string">'ls'</span>, <span class="string">'/some/dir'</span>]</span><br><span class="line">numbers = list(range(<span class="number">5</span>))</span><br><span class="line">my_list = list(chain([<span class="string">'foo'</span>, <span class="string">'bar'</span>], cmd, numbers))</span><br><span class="line">print(my_list)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'ls'</span>, <span class="string">'/some/dir'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>实际上不使用<code>itertools</code>，也有其他方法能够实现这一要求：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list = [<span class="string">'foo'</span>, <span class="string">'bar'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list += cmd + numbers</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list</span><br><span class="line">[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'ls'</span>, <span class="string">'/some/dir'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<h4 id="chain-from-iterable-可迭代对象"><a href="#chain-from-iterable-可迭代对象" class="headerlink" title="chain.from_iterable(可迭代对象)"></a>chain.from_iterable(可迭代对象)</h4><p>&emsp;&emsp;你也可以用<code>chain</code>的一个方法，叫做<code>from_iterable</code>，这个方法与直接用<code>chain</code>有些细微的差别。不同于直接传入一系列可迭代对象，你必须传入一个嵌套的列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numbers = list(range(<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cmd = [<span class="string">'ls'</span>, <span class="string">'/some/dir'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chain.from_iterable(cmd, numbers)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  Python Shell, prompt <span class="number">66</span>, line <span class="number">1</span></span><br><span class="line">builtins.TypeError: from_iterable() takes exactly one argument (<span class="number">2</span> given)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(chain.from_iterable([cmd, numbers]))</span><br><span class="line">[<span class="string">'ls'</span>, <span class="string">'/some/dir'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>我们尝试传入两个列表，但却出现了<code>TypeError</code>。为了修正这个错误，我们将<code>cmd</code>和<code>numbers</code>放入一个列表中，将这个嵌套的列表传入<code>from_iterable</code>。</p>
<h4 id="compress-数据-选择器"><a href="#compress-数据-选择器" class="headerlink" title="compress(数据, 选择器)"></a>compress(数据, 选择器)</h4><p>&emsp;&emsp;子模块<code>compress</code>在用一个可迭代对象过滤另一个可迭代对象时十分有用，这是通过将作为选择器的可迭代对象取为布尔值列表来实现的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> compress</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters = <span class="string">'ABCDEFG'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bools = [<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(compress(letters, bools))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>]</span><br></pre></td></tr></table></figure>
<p><code>compress</code>函数将交替查看两个可迭代对象。先检查第一个可迭代对象，然后是第二个，如果第二个的元素为<code>True</code>，则保留第一个对应元素；如果为<code>False</code>，则丢弃第一个对应元素。</p>
<h4 id="dropwhile-断言-可迭代对象"><a href="#dropwhile-断言-可迭代对象" class="headerlink" title="dropwhile(断言, 可迭代对象)"></a>dropwhile(断言, 可迭代对象)</h4><p>&emsp;&emsp;<code>itertools</code>还提供了迭代器<code>dropwhile</code>，只要过滤器判定是<code>True</code>，<code>dropwhile</code>迭代器就会排除这些元素。因此，在出现断言为<code>False</code>之前，你不会看到任何输出结果。这可能导致启动时间非常长，这点应当注意。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> dropwhile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(dropwhile(<span class="keyword">lambda</span> x: x &lt; <span class="number">5</span>, [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">1</span>]))</span><br><span class="line">[<span class="number">6</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>先导入<code>dropwhile</code>，然后传入一个简单的<code>lambda</code>声明的函数：如果<code>x</code>小于<code>5</code>，<code>lambda</code>将返回<code>True</code>，否则返回<code>False</code>。<code>dropwhile</code>将遍历整个列表，然后将每个元素传入<code>lambda</code>。如果<code>lambda</code>返回<code>True</code>，则舍弃该值。一旦遇到了数字<code>6</code>，<code>lambda</code>将返回<code>False</code>，因此将保留数字<code>6</code>以及之后余下的元素。<br>&emsp;&emsp;当然也可以采用一般的函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> dropwhile</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than_five</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x &gt; <span class="number">5</span></span><br><span class="line">​</span><br><span class="line">my_list = list(dropwhile(greater_than_five, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>]))</span><br><span class="line">print(my_list)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<h4 id="filterfalse-断言-可迭代对象"><a href="#filterfalse-断言-可迭代对象" class="headerlink" title="filterfalse(断言, 可迭代对象)"></a>filterfalse(断言, 可迭代对象)</h4><p>&emsp;&emsp;<code>itertools</code>中的<code>filterfalse</code>函数与<code>dropwhile</code>非常类似，只是<code>filterfalse</code>返回断言为<code>False</code>的那些值，而不是舍弃断言为<code>True</code>的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> filterfalse</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than_five</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x &gt; <span class="number">5</span></span><br><span class="line">​</span><br><span class="line">my_list = list(filterfalse(greater_than_five, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>]))</span><br><span class="line">print(my_list)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>如果整数值小于<code>5</code>，这个整数将保留下来，否则将被舍弃。注意到，这里的结果仅有<code>1</code>、<code>2</code>和<code>3</code>。与<code>dropwhile</code>不同，<code>filterfalse</code>将对全部的值进行条件判断。</p>
<h4 id="groupby-可迭代对象-键-None"><a href="#groupby-可迭代对象-键-None" class="headerlink" title="groupby(可迭代对象, 键=None)"></a>groupby(可迭代对象, 键=None)</h4><p>&emsp;&emsp;将<code>key</code>函数作用于原循环器的各个元素，根据<code>key</code>函数结果，将拥有相同函数结果的元素分到一个新的循环器。每个新的循环器以函数返回结果为标签。<br>&emsp;&emsp;这就好像一群人的身高作为循环器，我们可以使用这样一个<code>key</code>函数：如果身高大于<code>180</code>，返回<code>tall</code>；如果身高低于<code>160</code>，返回<code>short</code>；中间的返回<code>middle</code>。最终，所有身高将分为三个循环器，即<code>tall</code>、<code>short</code>、<code>middle</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">height_class</span><span class="params">(h)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> h &gt; <span class="number">180</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'tall'</span></span><br><span class="line">    <span class="keyword">elif</span> h &lt; <span class="number">160</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'short'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'middle'</span></span><br><span class="line">​</span><br><span class="line">friends = [<span class="number">191</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">165</span>, <span class="number">170</span>, <span class="number">177</span>, <span class="number">181</span>, <span class="number">182</span>, <span class="number">190</span>]</span><br><span class="line">friends = sorted(friends, key=height_class)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m, n <span class="keyword">in</span> groupby(friends, key=height_class):</span><br><span class="line">    print(m, list(n))</span><br><span class="line">    print(<span class="string">"---------"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">middle [<span class="number">165</span>, <span class="number">170</span>, <span class="number">177</span>]</span><br><span class="line">---------</span><br><span class="line">short [<span class="number">158</span>, <span class="number">159</span>]</span><br><span class="line">---------</span><br><span class="line">tall [<span class="number">191</span>, <span class="number">181</span>, <span class="number">182</span>, <span class="number">190</span>]</span><br><span class="line">---------</span><br></pre></td></tr></table></figure>
<p><code>groupby</code>的功能类似于<code>UNIX</code>中的<code>uniq</code>命令。分组之前需要使用<code>sorted</code>对原循环器的元素，根据<code>key</code>函数进行排序，让同组元素先在位置上靠拢。</p>
<h4 id="islice-可迭代变量-起始值-终止值-步长"><a href="#islice-可迭代变量-起始值-终止值-步长" class="headerlink" title="islice(可迭代变量, 起始值, 终止值[, 步长])"></a>islice(可迭代变量, 起始值, 终止值[, 步长])</h4><p>&emsp;&emsp;<code>islice</code>是一个返回可迭代对象选定元素的迭代器。简而言之，<code>islice</code>所做的是利用可迭代对象的索引实现切片，然后以迭代器的形式返回所选元素。实际上<code>islice</code>有两种实现方式，一种是<code>itertools.islice(iterable, stop)</code>，还有一种更符合<code>Python</code>惯例的形式：<code>islice(iterable, start, stop[, step])</code>。来看看第一种形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> islice</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iterator = islice(<span class="string">'123456'</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'1'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'2'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'3'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line"><span class="string">'4'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(iterator)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  Python Shell, prompt <span class="number">15</span>, line <span class="number">1</span></span><br><span class="line">builtins.StopIteration:</span><br></pre></td></tr></table></figure>
<p>在以上的代码中，我们传入了一个<code>6</code>个字符组成的字符串以及终止参数<code>4</code>给<code>isilce</code>。这表示<code>islice</code>返回的迭代器将包含传入字符串的前<code>4</code>个字符。为了验证，我们连续四次调用<code>next</code>函数。<code>Python</code>能够智能地识别是否只有<code>2</code>个传入参数，若是，则第二个参数就取为终止参数。<br>&emsp;&emsp;我们再试试传入三个参数来验证是否可以同时传入起始值和终止值。<code>count</code>工具可以帮助我们解释这一概念：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> islice</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(), <span class="number">3</span>, <span class="number">7</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>这里我们调用了<code>count</code>，并指定<code>islice</code>从<code>3</code>开始，到<code>7</code>时结束。这和使用<code>slice</code>效果是一样的，不同之处在于传入的是迭代器，返回的是新的迭代器。</p>
<h4 id="starmap-函数-可迭代对象"><a href="#starmap-函数-可迭代对象" class="headerlink" title="starmap(函数, 可迭代对象)"></a>starmap(函数, 可迭代对象)</h4><p>&emsp;&emsp;<code>starmap</code>工具能够创建一个用传入的函数和可迭代对象计算的迭代器。如文档中所言，<code>map</code>和<code>starmap</code>的区别正如<code>function(a, b)</code>和<code>function(*c)</code>的区别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> starmap</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> starmap(add, [(<span class="number">2</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">5</span>)]):</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>这里先创建了一个接受两个参数的求和函数，接下来创建了一个<code>for</code>循环，并调用<code>starmap</code>函数。<code>starmap</code>函数的第一个传入参数是创建的求和函数，第二个传入参数是元组构成的列表。<code>starmap</code>函数接着会将每一个元组传入求和函数，然后将结果返回到迭代器。</p>
<h4 id="takewhile-断言-可迭代对象"><a href="#takewhile-断言-可迭代对象" class="headerlink" title="takewhile(断言, 可迭代对象)"></a>takewhile(断言, 可迭代对象)</h4><p>&emsp;&emsp;<code>takewhile</code>模块与<code>dropwhile</code>迭代器刚好相反。<code>takewhile</code>所创建的迭代器，一旦可迭代对象的断言或过滤器结果为<code>True</code>，就返回元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> takewhile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(takewhile(<span class="keyword">lambda</span> x: x &lt; <span class="number">5</span>, [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">1</span>]))</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>运行<code>takewhile</code>时传入了一个<code>lambda</code>函数和一个列表，输出的仅是可迭代对象的前两个整数元素。因为<code>1</code>和<code>4</code>都小于<code>5</code>，而<code>6</code>大于<code>5</code>，一旦<code>takewhile</code>遇到<code>6</code>，判定条件结果将是<code>False</code>，可迭代对象余下的元素将会被忽略。</p>
<h4 id="tee-可迭代对象-n-2"><a href="#tee-可迭代对象-n-2" class="headerlink" title="tee(可迭代对象, n=2)"></a>tee(可迭代对象, n=2)</h4><p>&emsp;&emsp;<code>tee</code>工具能够从一个可迭代对象创建n个迭代器，这意味着你能够用一个可迭代对象创建多个迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> tee</span><br><span class="line">​</span><br><span class="line">data = <span class="string">'ABC'</span></span><br><span class="line">iter1, iter2 = tee(data)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> iter1:</span><br><span class="line">    print(item)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"----------"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> iter2:</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line">----------</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br></pre></td></tr></table></figure>
<p>这里创建了一个<code>5</code>个字母组成的字符串，然后传入<code>tee</code>。由于<code>tee</code>的默认参数是<code>2</code>，所以用两个变量接收<code>tee</code>返回的两个迭代器。最后，分别遍历了这两个迭代器，并打印出它们的内容。如你所见，它们的内容是相同的。</p>
<h4 id="zip-longest-可迭代对象-填充值-None"><a href="#zip-longest-可迭代对象-填充值-None" class="headerlink" title="zip_longest(*可迭代对象, 填充值=None)"></a>zip_longest(*可迭代对象, 填充值=None)</h4><p>&emsp;&emsp;<code>zip_longest</code>迭代器可以用于将两个可迭代对象配对。如果可迭代对象的长度不同，也可以传入填充值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> zip_longest(<span class="string">'ABCD'</span>, <span class="string">'xy'</span>, fillvalue=<span class="string">'BLANK'</span>):</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">'A'</span>, <span class="string">'x'</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="string">'y'</span>)</span><br><span class="line">(<span class="string">'C'</span>, <span class="string">'BLANK'</span>)</span><br><span class="line">(<span class="string">'D'</span>, <span class="string">'BLANK'</span>)</span><br></pre></td></tr></table></figure>
<p>先导入<code>zip_longest</code>，然后传入两个需要配对的字符串。你会发现，第一个字符串有<code>4</code>个字符，而第二个只有<code>2</code>个字符。我们还传入了填充值<code>BLANK</code>。当遍历并打印的时候，会看到返回的是元组。前两个元组是分别来自两个字符串第一个和第二个字母的组合，后两个则插入了填充值。<br>&emsp;&emsp;需要注意的是，如果传入<code>zip_longest</code>的可迭代对象是无限的，那么你应该用类似<code>islice</code>的工具在外部处理函数，以便控制调用的次数。</p>
<h3 id="组合生成器"><a href="#组合生成器" class="headerlink" title="组合生成器"></a>组合生成器</h3><p>&emsp;&emsp;<code>itertools</code>库提供了四个可用于生成数据排列和组合的迭代器。</p>
<h4 id="combinations-可迭代对象-r"><a href="#combinations-可迭代对象-r" class="headerlink" title="combinations(可迭代对象, r)"></a>combinations(可迭代对象, r)</h4><p>&emsp;&emsp;如果你需要生成数据的组合，<code>Python</code>已经为你准备了<code>itertools.combinations</code>。<code>combinations</code>能够让你通过有一定长度的可迭代对象创建一个迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(combinations(<span class="string">'WXYZ'</span>, <span class="number">2</span>))</span><br><span class="line">[(<span class="string">'W'</span>, <span class="string">'X'</span>), (<span class="string">'W'</span>, <span class="string">'Y'</span>), (<span class="string">'W'</span>, <span class="string">'Z'</span>), (<span class="string">'X'</span>, <span class="string">'Y'</span>), (<span class="string">'X'</span>, <span class="string">'Z'</span>), (<span class="string">'Y'</span>, <span class="string">'Z'</span>)]</span><br></pre></td></tr></table></figure>
<p>当你运行这段代码时会发现，<code>combinations</code>返回组合是元组。为了使输出结果更具可读性，可以遍历迭代器将元组组合成字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> combinations(<span class="string">'WXYZ'</span>, <span class="number">2</span>):</span><br><span class="line">    print(<span class="string">''</span>.join(item))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WX</span><br><span class="line">WY</span><br><span class="line">WZ</span><br><span class="line">XY</span><br><span class="line">XZ</span><br><span class="line">YZ</span><br></pre></td></tr></table></figure>
<p>注意，<code>combinations</code>函数得到的组合是依循词典顺序的，因而如果传入的可迭代对象已经排序，那么你得到的组合元组也将是按序的。还有一点值得注意，<code>combinations</code>函数不会将每个单独的元素自己跟自己组合。</p>
<h4 id="combinations-with-replacement-可迭代对象-r"><a href="#combinations-with-replacement-可迭代对象-r" class="headerlink" title="combinations_with_replacement(可迭代对象, r)"></a>combinations_with_replacement(可迭代对象, r)</h4><p>&emsp;&emsp;<code>combinationa_with_replacement</code>迭代器与<code>combinations</code>非常类似。唯一的区别是，它会创建元素自己与自己的组合。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations_with_replacement</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> combinations_with_replacement(<span class="string">'WXYZ'</span>, <span class="number">2</span>):</span><br><span class="line">    print(<span class="string">''</span>.join(item))</span><br></pre></td></tr></table></figure>
<h4 id="product-可迭代对象-重复-1"><a href="#product-可迭代对象-重复-1" class="headerlink" title="product(*可迭代对象, 重复=1)"></a>product(*可迭代对象, 重复=1)</h4><p>&emsp;&emsp;<code>product</code>用于根据一系列输入的可迭代对象计算笛卡尔积。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>arrays = [(<span class="number">-1</span>,<span class="number">1</span>), (<span class="number">-3</span>,<span class="number">3</span>), (<span class="number">-5</span>,<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cp = list(product(*arrays))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cp</span><br><span class="line">[(<span class="number">-1</span>, <span class="number">-3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">-1</span>, <span class="number">-3</span>, <span class="number">5</span>),</span><br><span class="line"> (<span class="number">-1</span>, <span class="number">3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">-1</span>, <span class="number">3</span>, <span class="number">5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">-3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">-3</span>, <span class="number">5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">-5</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)]</span><br></pre></td></tr></table></figure>
<p>先导入<code>product</code>，然后创建一个元组构成的列表，用变量<code>arrays</code>储存，接下来将这些数组传入<code>product</code>函数，然后调用。你应该注意到，我们调用时使用了<code>*arrays</code>，这会使传入的列表被拆解，依次应用于<code>product</code>函数。这意味着你传入的将是三个变量而不是一个。</p>
<h4 id="permutations-可迭代变量-r"><a href="#permutations-可迭代变量-r" class="headerlink" title="permutations(可迭代变量, r)"></a>permutations(可迭代变量, r)</h4><p>&emsp;&emsp;<code>permutation</code>能够返回由传入的可迭代对象的元素构成的长度为<code>r</code>的排列。与<code>combination</code>函数类似，<code>permutation</code>将以词典序输出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> permutations(<span class="string">'WXYZ'</span>, <span class="number">2</span>):</span><br><span class="line">    print(<span class="string">''</span>.join(item))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WX</span><br><span class="line">WY</span><br><span class="line">WZ</span><br><span class="line">XW</span><br><span class="line">XY</span><br><span class="line">XZ</span><br><span class="line">YW</span><br><span class="line">YX</span><br><span class="line">YZ</span><br><span class="line">ZW</span><br><span class="line">ZX</span><br><span class="line">ZY</span><br></pre></td></tr></table></figure>
<p>容易发现，输出结果比<code>combinations</code>的输出结果长一些。<code>permutation</code>函数将遍历字符串的所有排列，但当输入元素是唯一的时候，不会让这个元素自己和自己排列。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/错误和异常/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/错误和异常/" itemprop="url">错误和异常</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T19:42:03+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python</code>有两种错误很容易辨认：语法错误和异常。<code>Python</code>标准异常总结如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>异常</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>断言语句(<code>assert</code>)失败</td>
</tr>
<tr>
<td><code>AttributeError</code></td>
<td>尝试访问未知的对象属性</td>
</tr>
<tr>
<td><code>EOFError</code></td>
<td>用户输入文件末尾标志<code>EOF</code>(<code>Ctrl + d</code>)</td>
</tr>
<tr>
<td><code>FloatingPointError</code></td>
<td>浮点计算错误</td>
</tr>
<tr>
<td><code>GeneratorExit</code></td>
<td><code>generator.close</code>方法被调用的时候</td>
</tr>
<tr>
<td><code>ImportError</code></td>
<td>导入模块失败的时候</td>
</tr>
<tr>
<td><code>IndexError</code></td>
<td>索引超出序列的范围</td>
</tr>
<tr>
<td><code>KeyError</code></td>
<td>字典中查找一个不存在的关键字</td>
</tr>
<tr>
<td><code>KeyboardInterrupt</code></td>
<td>用户输入中断键(<code>Ctrl + c</code>)</td>
</tr>
<tr>
<td><code>MemoryError</code></td>
<td>内存溢出(可通过删除对象释放内存)</td>
</tr>
<tr>
<td><code>NameError</code></td>
<td>尝试访问一个不存在的变量</td>
</tr>
<tr>
<td><code>NotImplementedError</code></td>
<td>尚未实现的方法</td>
</tr>
<tr>
<td><code>OSError</code></td>
<td>操作系统产生的异常(例如打开一个不存在的文件)</td>
</tr>
<tr>
<td><code>OverflowError</code></td>
<td>数值运算超出最大限制</td>
</tr>
<tr>
<td><code>ReferenceError</code></td>
<td>弱引用(<code>weak reference</code>)试图访问一个已经被垃圾回收机制回收了的对象</td>
</tr>
<tr>
<td><code>RuntimeError</code></td>
<td>一般的运行时错误</td>
</tr>
<tr>
<td><code>StopIteration</code></td>
<td>迭代器没有更多的值</td>
</tr>
<tr>
<td><code>SyntaxError</code></td>
<td><code>Python</code>的语法错误</td>
</tr>
<tr>
<td><code>IndentationError</code></td>
<td>缩进错误</td>
</tr>
<tr>
<td><code>TabError</code></td>
<td><code>Tab</code>和空格混合使用</td>
</tr>
<tr>
<td><code>SystemError</code></td>
<td><code>Python</code>编译器系统错误</td>
</tr>
<tr>
<td><code>SystemExit</code></td>
<td><code>Python</code>编译器进程被关闭</td>
</tr>
<tr>
<td><code>TypeError</code></td>
<td>不同类型间的无效操作</td>
</tr>
<tr>
<td><code>UnboundLocalError</code></td>
<td>访问一个未初始化的本地变量(<code>NameError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeError</code></td>
<td><code>Unicode</code>相关的错误(<code>ValueError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeEncodeError</code></td>
<td><code>Unicode</code>编码时的错误(<code>UnicodeError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeDecodeError</code></td>
<td><code>Unicode</code>解码时的错误(<code>UnicodeError</code>的子类)</td>
</tr>
<tr>
<td><code>UnicodeTranslateError</code></td>
<td><code>Unicode</code>转换时的错误(<code>UnicodeError</code>的子类)</td>
</tr>
<tr>
<td><code>ValueError</code></td>
<td>传入无效的参数</td>
</tr>
<tr>
<td><code>ZeroDivisionError</code></td>
<td>除数为零</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;以下是<code>Python</code>内置异常类的层次结构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">BaseException</span><br><span class="line">+-- SystemExit</span><br><span class="line">+-- KeyboardInterrupt</span><br><span class="line">+-- GeneratorExit</span><br><span class="line">+-- Exception</span><br><span class="line">      +-- StopIteration</span><br><span class="line">      +-- ArithmeticError</span><br><span class="line">      |    +-- FloatingPointError</span><br><span class="line">      |    +-- OverflowError</span><br><span class="line">      |    +-- ZeroDivisionError</span><br><span class="line">      +-- AssertionError</span><br><span class="line">      +-- AttributeError</span><br><span class="line">      +-- BufferError</span><br><span class="line">      +-- EOFError</span><br><span class="line">      +-- ImportError</span><br><span class="line">      +-- LookupError</span><br><span class="line">      |    +-- IndexError</span><br><span class="line">      |    +-- KeyError</span><br><span class="line">      +-- MemoryError</span><br><span class="line">      +-- NameError</span><br><span class="line">      |    +-- UnboundLocalError</span><br><span class="line">      +-- OSError</span><br><span class="line">      |    +-- BlockingIOError</span><br><span class="line">      |    +-- ChildProcessError</span><br><span class="line">      |    +-- ConnectionError</span><br><span class="line">      |    |    +-- BrokenPipeError</span><br><span class="line">      |    |    +-- ConnectionAbortedError</span><br><span class="line">      |    |    +-- ConnectionRefusedError</span><br><span class="line">      |    |    +-- ConnectionResetError</span><br><span class="line">      |    +-- FileExistsError</span><br><span class="line">      |    +-- FileNotFoundError</span><br><span class="line">      |    +-- InterruptedError</span><br><span class="line">      |    +-- IsADirectoryError</span><br><span class="line">      |    +-- NotADirectoryError</span><br><span class="line">      |    +-- PermissionError</span><br><span class="line">      |    +-- ProcessLookupError</span><br><span class="line">      |    +-- TimeoutError</span><br><span class="line">      +-- ReferenceError</span><br><span class="line">      +-- RuntimeError</span><br><span class="line">      |    +-- NotImplementedError</span><br><span class="line">      +-- SyntaxError</span><br><span class="line">      |    +-- IndentationError</span><br><span class="line">      |         +-- TabError</span><br><span class="line">      +-- SystemError</span><br><span class="line">      +-- TypeError</span><br><span class="line">      +-- ValueError</span><br><span class="line">      |    +-- UnicodeError</span><br><span class="line">      |         +-- UnicodeDecodeError</span><br><span class="line">      |         +-- UnicodeEncodeError</span><br><span class="line">      |         +-- UnicodeTranslateError</span><br><span class="line">      +-- Warning</span><br><span class="line">           +-- DeprecationWarning</span><br><span class="line">           +-- PendingDeprecationWarning</span><br><span class="line">           +-- RuntimeWarning</span><br><span class="line">           +-- SyntaxWarning</span><br><span class="line">           +-- UserWarning</span><br><span class="line">           +-- FutureWarning</span><br><span class="line">           +-- ImportWarning</span><br><span class="line">           +-- UnicodeWarning</span><br><span class="line">           +-- BytesWarning</span><br><span class="line">           +-- ResourceWarning</span><br></pre></td></tr></table></figure>
<h3 id="语法错误"><a href="#语法错误" class="headerlink" title="语法错误"></a>语法错误</h3><p>&emsp;&emsp;<code>Python</code>的语法错误称之为<code>解析错误</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="keyword">True</span> print(<span class="string">'Hello world'</span>)</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
<p>这个例子中，函数<code>print</code>被检查到有错误，是它前面缺少了一个冒号<code>:</code>。<br>&emsp;&emsp;即便<code>Python</code>程序的语法是正确的，在运行它的时候，也有可能发生错误。运行期检测到的错误被称为<code>异常</code>。大多数的异常都不会被程序处理，都以错误信息的形式展现在这里：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> * (<span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#7&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="number">10</span> * (<span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line">ZeroDivisionError: division by zero</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">4</span> + spam*<span class="number">3</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#8&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="number">4</span> + spam*<span class="number">3</span></span><br><span class="line">NameError: name <span class="string">'spam'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'2'</span> + <span class="number">2</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#9&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="string">'2'</span> + <span class="number">2</span></span><br><span class="line">TypeError: must be str, <span class="keyword">not</span> int</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;异常以不同的类型出现，这些类型都作为信息的一部分打印出来，例子中的类型有<code>ZeroDivisionError</code>、<code>NameError</code>和<code>TypeError</code>。错误信息的前面部分显示了异常发生的上下文，并以调用栈的形式显示具体信息。</p>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><p>&emsp;&emsp;以下示例让用户输入一个合法的整数，但是允许用户中断这个程序(使用<code>Ctrl - C</code>或者操作系统提供的方法)。用户的中断信息会引发一个<code>KeyboardInterrupt</code>异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = int(input(<span class="string">"Please enter a number: "</span>))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        print(<span class="string">"Oops! That was no valid number. Try again!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>try</code>语句按照如下方式工作：</p>
<ul>
<li>首先执行<code>try</code>子句(在关键字<code>try</code>和<code>except</code>之间的语句)。</li>
<li>如果没有异常发生，忽略<code>except</code>子句，<code>try</code>子句执行后结束。如果在执行<code>try</code>子句的过程中发生了异常，那么<code>try</code>子句余下的部分将被忽略。如果异常的类型和<code>except</code>之后的名称相符，那么对应的<code>except</code>子句将被执行。最后执行<code>try</code>语句之后的代码。</li>
<li>如果一个异常没有与任何的<code>except</code>匹配，那么这个异常将会传递给上层的<code>try</code>中。</li>
</ul>
<p>&emsp;&emsp;一个<code>try</code>语句可能包含多个<code>except</code>子句，分别来处理不同的特定的异常，最多只有一个分支会被执行。处理程序将只针对对应的<code>try</code>子句中的异常进行处理，而不是其他的<code>try</code>的处理程序中的异常。一个<code>except</code>子句可以同时处理多个异常，这些异常将被放在一个括号里成为一个元组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> (RuntimeError, TypeError, NameError):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;最后一个<code>except</code>子句可以忽略异常的名称，它将被当作通配符使用。你可以使用这种方法打印一个错误信息，然后再次把异常抛出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = open(<span class="string">'myfile.txt'</span>)</span><br><span class="line">    s = f.readline()</span><br><span class="line">    i = int(s.strip())</span><br><span class="line"><span class="keyword">except</span> OSError <span class="keyword">as</span> err:</span><br><span class="line">    print(<span class="string">"OS error: &#123;0&#125;"</span>.format(err))</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    print(<span class="string">"Could not convert data to an integer."</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Unexpected error:"</span>, sys.exc_info()[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>try except</code>语句还有一个可选的<code>else</code>子句，如果使用这个子句，那么必须放在所有的<code>except</code>子句之后。这个子句将在<code>try</code>子句没有发生任何异常的时候执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = open(arg, <span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">except</span> IOError:</span><br><span class="line">        print(<span class="string">'cannot open'</span>, arg)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(arg, <span class="string">'has'</span>, len(f.readlines()), <span class="string">'lines'</span>)</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<p>使用<code>else</code>子句比把所有的语句都放在<code>try</code>子句里面要好，这样可以避免一些意想不到的，而<code>except</code>又没有捕获的异常。<br>&emsp;&emsp;异常处理并不仅仅处理那些直接发生在<code>try</code>子句中的异常，而且还能处理子句中调用的函数(甚至间接调用的函数)里抛出的异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">this_fails</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">1</span> / <span class="number">0</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    this_fails()</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> err:</span><br><span class="line">    print(<span class="string">'Handling run-time error:'</span>, err)</span><br></pre></td></tr></table></figure>
<p>上述代码抛出如下异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Handling run-time error: int division <span class="keyword">or</span> modulo by zero</span><br></pre></td></tr></table></figure>
<h3 id="抛出异常"><a href="#抛出异常" class="headerlink" title="抛出异常"></a>抛出异常</h3><p>&emsp;&emsp;<code>Python</code>使用<code>raise</code>语句抛出一个指定的异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;pyshell#13&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line">NameError: HiThere</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>raise</code>唯一的参数指定了要被抛出的异常，它必须是一个异常的实例或者是异常的类(也就是<code>Exception</code>的子类)。如果你只想知道这是否抛出了一个异常，并不想去处理它，那么一个简单的<code>raise</code>语句就可以再次把它抛出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line"><span class="keyword">except</span> NameError:</span><br><span class="line">    print(<span class="string">'An exception flew by!'</span>)</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p>上述代码抛出如下异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:\Users\fukangwei\Desktop\work_space\test.py"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">raise</span> NameError(<span class="string">'HiThere'</span>)</span><br><span class="line">NameError: HiThere</span><br></pre></td></tr></table></figure>
<h3 id="用户自定义异常"><a href="#用户自定义异常" class="headerlink" title="用户自定义异常"></a>用户自定义异常</h3><p>&emsp;&emsp;你可以通过创建一个新的<code>exception</code>类来拥有自己的异常。异常应该继承自<code>Exception</code>类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> repr(self.value)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> MyError(<span class="number">2</span> * <span class="number">2</span>)</span><br><span class="line"><span class="keyword">except</span> MyError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'My exception occurred, value:'</span>, e.value)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My exception occurred, value: <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，类<code>Exception</code>默认的<code>__init__</code>方法被覆盖。<br>&emsp;&emsp;当创建一个模块有可能抛出多种不同的异常时，一种通常的做法是为这个包建立一个基础异常类，然后基于这个基础类为不同的错误情况创建不同的子类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Error</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="string">""" Base class for exceptions in this module """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputError</span><span class="params">(Error)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Exception raised for errors in the input. Attributes:</span></span><br><span class="line"><span class="string">    expression -- input expression in which the error occurred</span></span><br><span class="line"><span class="string">    message -- explanation of the error</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, expression, message)</span>:</span></span><br><span class="line">        self.expression = expression</span><br><span class="line">        self.message = message</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransitionError</span><span class="params">(Error)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Raised when an operation attempts a state transition that's not allowed. Attributes:</span></span><br><span class="line"><span class="string">    previous -- state at beginning of transition</span></span><br><span class="line"><span class="string">    next -- attempted new state</span></span><br><span class="line"><span class="string">    message -- explanation of why the specific transition is not allowed</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, previous, next, message)</span>:</span></span><br><span class="line">        self.previous = previous</span><br><span class="line">        self.next = next</span><br><span class="line">        self.message = message</span><br></pre></td></tr></table></figure>
<p>大多数异常的名字都以<code>Error</code>结尾，和标准的异常命名规则一样。</p>
<h3 id="定义清理行为"><a href="#定义清理行为" class="headerlink" title="定义清理行为"></a>定义清理行为</h3><p>&emsp;&emsp;<code>try</code>语句还有另外一个可选的子句，它定义了无论在任何情况下都会执行的清理行为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> KeyboardInterrupt</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">'Goodbye, world!'</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Goodbye, world!</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/Users/fukangwei/PycharmProjects/untitled1/hello.py"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">raise</span> KeyboardInterrupt</span><br><span class="line">KeyboardInterrupt</span><br></pre></td></tr></table></figure>
<p>以上示例不管<code>try</code>子句里面有没有发生异常，<code>finally</code>子句都会执行。<br>&emsp;&emsp;如果一个异常在<code>try</code>子句里(或者在<code>except</code>和<code>else</code>子句里)被抛出，而又没有任何的<code>except</code>把它截住，那么这个异常会在<code>finally</code>子句执行后再次被抛出。下面是一个更加复杂的例子(在同一个<code>try</code>语句里包含<code>except</code>和<code>finally</code>子句)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = x / y</span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">        print(<span class="string">"division by zero!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"result is"</span>, result)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">"executing finally clause"</span>)</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>divide(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">result <span class="keyword">is</span> <span class="number">2.0</span></span><br><span class="line">executing <span class="keyword">finally</span> clause</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>divide(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">division by zero!</span><br><span class="line">executing <span class="keyword">finally</span> clause</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>divide(<span class="string">"2"</span>, <span class="string">"1"</span>)</span><br><span class="line">executing <span class="keyword">finally</span> clause</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "&lt;stdin&gt;", line 1, in ?</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">3</span>, <span class="keyword">in</span> divide</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> /: <span class="string">'str'</span> <span class="keyword">and</span> <span class="string">'str'</span></span><br></pre></td></tr></table></figure>
<h3 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h3><p>&emsp;&emsp;<code>Python</code>的<code>assert</code>断言是声明其布尔值必须为真的判定，如果发生异常，就说明该表达示为假。可以理解<code>assert</code>断言语句为<code>raise-if-not</code>，用来测试表示式，其返回值为假时，就会触发异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> expression [, arguments]</span><br></pre></td></tr></table></figure>
<p><code>assert</code>的异常参数其实就是在断言表达式后添加字符串信息，用来解释断言并更好地指明出现问题的位置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> len(lists) &gt;= <span class="number">5</span>, <span class="string">'列表元素个数小于5'</span></span><br><span class="line"><span class="keyword">assert</span> <span class="number">2</span> == <span class="number">1</span>, <span class="string">'2不等于1'</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/six模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/six模块/" itemprop="url">six模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T17:38:51+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Six-Python-2-and-3-Compatibility-Library"><a href="#Six-Python-2-and-3-Compatibility-Library" class="headerlink" title="Six: Python 2 and 3 Compatibility Library"></a>Six: Python 2 and 3 Compatibility Library</h3><p>&emsp;&emsp;<code>six</code> provides simple utilities for wrapping over differences between <code>Python 2</code> and <code>Python 3</code>. It is intended to support codebases that work on both <code>Python 2</code> and <code>Python 3</code> without modification. <code>six</code> consists of only one <code>Python</code> file, so it is painless to copy into a project.<br>&emsp;&emsp;The name <code>six</code>, comes from the fact that <code>2 * 3</code> equals <code>6</code>. Why not addition? Multiplication is more powerful, and, anyway, <code>five</code> has already been snatched away by the (admittedly now moribund) <code>Zope Five project</code>.</p>
<h3 id="Package-contents"><a href="#Package-contents" class="headerlink" title="Package contents"></a>Package contents</h3><ul>
<li><code>six.PY2</code>: A boolean indicating if the code is running on <code>Python 2</code>.</li>
<li><code>six.PY3</code>: A boolean indicating if the code is running on <code>Python 3</code>.</li>
</ul>
<h3 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h3><p>&emsp;&emsp;<code>six</code> provides constants that may differ between <code>Python</code> versions. Ones ending <code>_types</code> are mostly useful as the second argument to <code>isinstance</code> or <code>issubclass</code>.</p>
<ul>
<li><code>six.class_types</code>: Possible class types. In <code>Python 2</code>, this encompasses <code>old-style</code> and <code>new-style</code> classes. In <code>Python 3</code>, this is just <code>new-styles</code>.</li>
<li><code>six.integer_types</code>: Possible integer types. In <code>Python 2</code>, this is <code>long</code> and <code>int</code>, and in <code>Python 3</code>, just <code>int</code>.</li>
<li><code>six.string_types</code>: Possible types for text data. This is <code>basestring()</code> in <code>Python 2</code> and <code>str</code> in <code>Python 3</code>.</li>
<li><code>six.text_type</code>: Type for representing (<code>Unicode</code>) textual data. This is <code>unicode()</code> in <code>Python 2</code> and <code>str</code> in <code>Python 3</code>.</li>
<li><code>six.binary_type</code>: Type for representing binary data. This is <code>str</code> in <code>Python 2</code> and <code>bytes</code> in <code>Python 3</code>.</li>
<li><code>six.MAXSIZE</code>: The maximum size of a container like <code>list</code> or <code>dict</code>. This is equivalent to <code>sys.maxsize</code> in <code>Python 2.6</code> and later (including <code>3.x</code>). <strong>Note</strong>: this is temptingly similar to, but not the same as <code>sys.maxint</code> in <code>Python 2</code>. There is no direct equivalent to <code>sys.maxint</code> in <code>Python 3</code> because its integer type has no limits aside from memory.</li>
</ul>
<p>&emsp;&emsp;Here’s example usage of the module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> six</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dispatch_types</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(value, six.integer_types):</span><br><span class="line">        handle_integer(value)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(value, six.class_types):</span><br><span class="line">        handle_class(value)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(value, six.string_types):</span><br><span class="line">        handle_string(value)</span><br></pre></td></tr></table></figure>
<h3 id="Object-model-compatibility"><a href="#Object-model-compatibility" class="headerlink" title="Object model compatibility"></a>Object model compatibility</h3><p>&emsp;&emsp;<code>Python 3</code> renamed the attributes of several interpreter data structures. The following accessors are available. Note that the recommended way to inspect functions and methods is the stdlib inspect module.<br>&emsp;&emsp;<code>six.get_unbound_function(meth)</code>: Get the function out of unbound method <code>meth</code>. In <code>Python 3</code>, unbound methods don’t exist, so this function just returns <code>meth</code> unchanged. Example usage:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six <span class="keyword">import</span> get_unbound_function</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">method_function = get_unbound_function(X.method)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>six.get_method_function(meth)</code>: Get the function out of method object <code>meth</code>.<br>&emsp;&emsp;<code>six.get_method_self(meth)</code>: Get the self of bound method <code>meth</code>.<br>&emsp;&emsp;<code>six.get_function_closure(func)</code>: Get the closure (list of cells) associated with <code>func</code>. This is equivalent to <code>func.__closure__</code> on <code>Python 2.6+</code> and <code>func.func_closure</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.get_function_code(func)</code>: Get the code object associated with <code>func</code>. This is equivalent to <code>func.__code__</code> on <code>Python 2.6+</code> and <code>func.func_code</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.get_function_defaults(func)</code>: Get the defaults <code>tuple</code> associated with <code>func</code>. This is equivalent to <code>func.__defaults__</code> on <code>Python 2.6+</code> and <code>func.func_defaults</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.get_function_globals(func)</code>: Get the globals of <code>func</code>. This is equivalent to <code>func.__globals__</code> on <code>Python 2.6+</code> and <code>func.func_globals</code> on <code>Python 2.5</code>.<br>&emsp;&emsp;<code>six.next(it)</code> or <code>six.advance_iterator(it)</code>: Get the next item of iterator <code>it</code>. <code>StopIteration</code> is raised if the iterator is exhausted. This is a replacement for calling <code>it.next()</code> in <code>Python 2</code> and <code>next(it)</code> in <code>Python 3</code>. <code>Python 2.6</code> and above have a builtin next function, so <code>six&#39;s</code> version is only necessary for <code>Python 2.5</code> compatibility.<br>&emsp;&emsp;<code>six.callable(obj)</code>: Check if <code>obj</code> can be called. Note callable has returned in <code>Python 3.2</code>, so using <code>six&#39;s</code> version is only necessary when supporting <code>Python 3.0</code> or <code>3.1</code>.<br>&emsp;&emsp;<code>six.iterkeys(dictionary, **kwargs)</code>: Returns an iterator over <code>dictionary&#39;s</code> keys. This replaces <code>dictionary.iterkeys()</code> on <code>Python 2</code> and <code>dictionary.keys()</code> on <code>Python 3</code>. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.itervalues(dictionary, **kwargs)</code>: Returns an iterator over <code>dictionary&#39;s</code> values. This replaces <code>dictionary.itervalues()</code> on <code>Python 2</code> and <code>dictionary.values()</code> on <code>Python 3</code>. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.iteritems(dictionary, **kwargs)</code>: Returns an iterator over <code>dictionary&#39;s</code> items. This replaces <code>dictionary.iteritems()</code> on <code>Python 2</code> and <code>dictionary.items()</code> on <code>Python 3</code>. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.iterlists(dictionary, **kwargs)</code>: Calls <code>dictionary.iterlists()</code> on <code>Python 2</code> and <code>dictionary.lists()</code> on <code>Python 3</code>. No builtin Python mapping type has such a method; this method is intended for use with <code>multi-valued</code> dictionaries like Werkzeug’s. <code>kwargs</code> are passed through to the underlying method.<br>&emsp;&emsp;<code>six.viewkeys(dictionary)</code>: Return a view over <code>dictionary&#39;s</code> keys. This replaces <code>dict.viewkeys()</code> on <code>Python 2.7</code> and <code>dict.keys()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.viewvalues(dictionary)</code>: Return a view over <code>dictionary&#39;s</code> values. This replaces <code>dict.viewvalues()</code> on <code>Python 2.7</code> and <code>dict.values()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.viewitems(dictionary)</code>: Return a view over <code>dictionary&#39;s</code> items. This replaces <code>dict.viewitems()</code> on <code>Python 2.7</code> and <code>dict.items()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.create_bound_method(func, obj)</code>: Return a method object wrapping <code>func</code> and bound to <code>obj</code>. On both <code>Python 2</code> and <code>3</code>, this will return a <code>types.MethodType</code> object. The reason this wrapper exists is that on <code>Python 2</code>, the <code>MethodType</code> constructor requires the obj’s class to be passed.<br>&emsp;&emsp;<code>six.create_unbound_method(func, cls)</code>: Return an unbound method object wrapping <code>func</code>. In <code>Python 2</code>, this will return a <code>types.MethodType</code> object. In <code>Python 3</code>, unbound methods do not exist and this wrapper will simply return <code>func</code>.<br>&emsp;&emsp;<code>class six.Iterator</code>: A class for making portable iterators. The intention is that it be subclassed and subclasses provide a <code>__next__</code> method. In <code>Python 2</code>, Iterator has one method: <code>next</code>. It simply delegates to <code>__next__</code>. An alternate way to do this would be to simply alias <code>next</code> to <code>__next__</code>. However, this interacts badly with subclasses that override <code>__next__</code>. Iterator is empty on <code>Python 3</code> (In fact, it is just aliased to object).<br>&emsp;&emsp;<code>six.wraps(wrapped, assigned=functools.WRAPPER_ASSIGNMENTS, updated=functools.WRAPPER_UPDATES)</code>: This is exactly the <code>functools.wraps()</code> decorator, but it sets the <code>__wrapped__</code> attribute on what it decorates as <code>functools.wraps()</code> does on <code>Python</code> versions after <code>3.2</code>.</p>
<h3 id="Syntax-compatibility"><a href="#Syntax-compatibility" class="headerlink" title="Syntax compatibility"></a>Syntax compatibility</h3><p>&emsp;&emsp;These functions smooth over operations which have different syntaxes between <code>Python 2</code> and <code>3</code>.<br>&emsp;&emsp;<code>six.exec_(code, globals=None, locals=None)</code>: Execute <code>code</code> in the scope of <code>globals</code> and <code>locals</code>. <code>code</code> can be a string or a code object. If <code>globals</code> or <code>locals</code> are not given, they will default to the scope of the caller. If just <code>globals</code> is given, it will also be used as <code>locals</code>.<br>&emsp;&emsp;<strong>Note</strong>: <code>Python 3&#39;s</code> <code>exec()</code> doesn’t take keyword arguments, so calling <code>exec()</code> with them should be avoided.<br>&emsp;&emsp;<code>six.print_(*args, *, file=sys.stdout, end=&quot;\n&quot;, sep=&quot; &quot;, flush=False)</code>: Print <code>args</code> into <code>file</code>. Each argument will be separated with <code>sep</code> and <code>end</code> will be written to the file after the last argument is printed. If <code>flush</code> is <code>true</code>, <code>file.flush()</code> will be called after all data is written.<br>&emsp;&emsp;<strong>Note</strong>: In <code>Python 2</code>, this function imitates <code>Python 3&#39;s</code> <code>print()</code> by not having softspace support. If you don’t know what that is, you’re probably ok.<br>&emsp;&emsp;<code>six.raise_from(exc_value, exc_value_from)</code>: Raise an exception from a context. On <code>Python 3</code>, this is equivalent to raise <code>exc_value</code> from <code>exc_value_from</code>. On <code>Python 2</code>, which does not support exception chaining, it is equivalent to raise <code>exc_value</code>.<br>&emsp;&emsp;<code>six.reraise(exc_type, exc_value, exc_traceback=None)</code>: Reraise an exception, possibly with a different traceback. In the simple case, <code>reraise(*sys.exc_info())</code> with an active exception (in an except block) reraises the current exception with the last traceback. A different traceback can be specified with the <code>exc_traceback</code> parameter. Note that since the exception reraising is done within the <code>reraise()</code> function, <code>Python</code> will attach the call frame of <code>reraise()</code> to whatever traceback is raised.<br>&emsp;&emsp;<code>six.with_metaclass(metaclass, *bases)</code>: Create a new class with base classes <code>bases</code> and <code>metaclass</code>. This is designed to be used in class declarations like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six <span class="keyword">import</span> with_metaclass</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(with_metaclass<span class="params">(Meta, Base)</span>)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>Another way to set a <code>metaclass</code> on a class is with the <code>add_metaclass()</code> decorator.<br>&emsp;&emsp;<code>six.add_metaclass(metaclass)</code>: Class decorator that replaces a <code>normally-constructed</code> class with a <code>metaclass-constructed</code> one. Example usage:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@add_metaclass(Meta)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>That code produces a class equivalent to</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object, metaclass=Meta)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>on <code>Python 3</code> or</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    __metaclass__ = Meta</span><br></pre></td></tr></table></figure>
<p>on <code>Python 2</code>.<br>&emsp;&emsp;Note that class decorators require <code>Python 2.6</code>. However, the effect of the decorator can be emulated on <code>Python 2.5</code> like so:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">MyClass = add_metaclass(Meta)(MyClass)</span><br></pre></td></tr></table></figure>
<h3 id="Binary-and-text-data"><a href="#Binary-and-text-data" class="headerlink" title="Binary and text data"></a>Binary and text data</h3><p>&emsp;&emsp;<code>Python 3</code> enforces the distinction between byte strings and text strings far more rigorously than <code>Python 2</code> does; binary data cannot be automatically coerced to or from text data. <code>six</code> provides several functions to assist in classifying string data in all <code>Python</code> versions.<br>&emsp;&emsp;<code>six.b(data)</code>: A <code>fake</code> bytes literal. <code>data</code> should always be a normal string literal. In <code>Python 2</code>, <code>b()</code> returns a <code>8-bit</code> string. In <code>Python 3</code>, <code>data</code> is encoded with the <code>latin-1</code> encoding to bytes.<br>&emsp;&emsp;<strong>Note</strong>: Since all <code>Python versions 2.6</code> and after support the <code>b</code> prefix, code without <code>2.5</code> support doesn’t need <code>b()</code>.<br>&emsp;&emsp;<code>six.u(text)</code>: A <code>fake</code> unicode literal. <code>text</code> should always be a normal string literal. In <code>Python 2</code>, <code>u()</code> returns unicode, and in <code>Python 3</code>, a string. Also, in <code>Python 2</code>, the string is decoded with the <code>unicode-escape</code> codec, which allows unicode escapes to be used in it.<br>&emsp;&emsp;<strong>Note</strong>: In <code>Python 3.3</code>, the <code>u</code> prefix has been reintroduced. Code that only supports <code>Python 3</code> versions of <code>3.3</code> and higher thus does not need <code>u()</code>.<br>&emsp;&emsp;<strong>Note</strong>: On <code>Python 2</code>, <code>u()</code> doesn’t know what the encoding of the literal is. Each byte is converted directly to the unicode codepoint of the same value. Because of this, it’s only safe to use <code>u()</code> with strings of <code>ASCII</code> data.<br>&emsp;&emsp;<code>six.unichr(c)</code>: Return the Unicode string representing the codepoint <code>c</code>. This is equivalent to <code>unichr()</code> on <code>Python 2</code> and <code>chr()</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.int2byte(i)</code>: Converts <code>i</code> to a byte. <code>i</code> must be in <code>range(0, 256)</code>. This is equivalent to <code>chr()</code> in <code>Python 2</code> and <code>bytes((i,))</code> in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.byte2int(bs)</code>: Converts the first byte of <code>bs</code> to an integer. This is equivalent to <code>ord(bs[0])</code> on <code>Python 2</code> and <code>bs[0]</code> on <code>Python 3</code>.<br>&emsp;&emsp;<code>six.indexbytes(buf, i)</code>: Return the byte at index <code>i</code> of <code>buf</code> as an integer. This is equivalent to indexing a bytes object in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.iterbytes(buf)</code>: Return an iterator over bytes in <code>buf</code> as integers. This is equivalent to a bytes object iterator in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.StringIO</code>: This is a fake file object for textual data. It’s an alias for <code>StringIO.StringIO</code> in <code>Python 2</code> and <code>io.StringIO</code> in <code>Python 3</code>.<br>&emsp;&emsp;<code>six.BytesIO</code>: This is a fake file object for binary data. In <code>Python 2</code>, it’s an alias for <code>StringIO.StringIO</code>, but in <code>Python 3</code>, it’s an alias for <code>io.BytesIO</code>.<br>&emsp;&emsp;<code>six.python_2_unicode_compatible</code>: A class decorator that takes a class defining a <code>__str__</code> method. On <code>Python 3</code>, the decorator does nothing. On <code>Python 2</code>, it aliases the <code>__str__</code> method to <code>__unicode__</code> and creates a new <code>__str__</code> method that returns the result of <code>__unicode__()</code> encoded with <code>UTF-8</code>.</p>
<h3 id="unittest-assertions"><a href="#unittest-assertions" class="headerlink" title="unittest assertions"></a>unittest assertions</h3><p>&emsp;&emsp;<code>six</code> contains compatibility shims for unittest assertions that have been renamed. The parameters are the same as their aliases, but you must pass the test method as the first argument. For example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> six</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAssertCountEqual</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        six.assertCountEqual(self, (<span class="number">1</span>, <span class="number">2</span>), [<span class="number">2</span>, <span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>Note these functions are only available on <code>Python 2.7</code> or later.<br>&emsp;&emsp;<code>six.assertCountEqual()</code>: Alias for <code>assertCountEqual()</code> on <code>Python 3</code> and <code>assertItemsEqual()</code> on <code>Python 2</code>.<br>&emsp;&emsp;<code>six.assertRaisesRegex()</code>: Alias for <code>assertRaisesRegex()</code> on <code>Python 3</code> and <code>assertRaisesRegexp()</code> on <code>Python 2</code>.<br>&emsp;&emsp;<code>six.assertRegex()</code>: Alias for <code>assertRegex()</code> on <code>Python 3</code> and <code>assertRegexpMatches()</code> on <code>Python 2</code>.</p>
<h3 id="Renamed-modules-and-attributes-compatibility"><a href="#Renamed-modules-and-attributes-compatibility" class="headerlink" title="Renamed modules and attributes compatibility"></a>Renamed modules and attributes compatibility</h3><p>&emsp;&emsp;<code>Python 3</code> reorganized the standard library and moved several functions to different modules. <code>six</code> provides a consistent interface to them through the fake <code>six.moves</code> module. For example, to load the module for parsing <code>HTML</code> on <code>Python 2</code> or <code>3</code>, write:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> html_parser</span><br></pre></td></tr></table></figure>
<p>Similarly, to get the function to reload modules, which was moved from the builtin module to the imp module, use:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> reload_module</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;For the most part, <code>six.moves</code> aliases are the names of the modules in <code>Python 3</code>. When the new <code>Python 3</code> name is a package, the components of the name are separated by underscores. For example, <code>html.parser</code> becomes <code>html_parser</code>. In some cases where several modules have been combined, the <code>Python 2</code> name is retained. This is so the appropriate modules can be found when running on <code>Python 2</code>. For example, <code>BaseHTTPServer</code> which is in <code>http.server</code> in <code>Python 3</code> is aliased as <code>BaseHTTPServer</code>.<br>&emsp;&emsp;Some modules which had two implementations have been merged in <code>Python 3</code>. For example, <code>cPickle</code> no longer exists in <code>Python 3</code>; it was merged with <code>pickle</code>. In these cases, fetching the fast version will load the fast one on <code>Python 2</code> and the merged module in <code>Python 3</code>.<br>&emsp;&emsp;The <code>urllib</code>, <code>urllib2</code>, and <code>urlparse</code> modules have been combined in the <code>urllib</code> package in <code>Python 3</code>. The <code>six.moves.urllib</code> package is a <code>version-independent</code> location for this functionality; its structure mimics the structure of the <code>Python 3</code> <code>urllib</code> package.<br>&emsp;&emsp;<strong>Note</strong>: In order to make imports of the form:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> six.moves.cPickle <span class="keyword">import</span> loads</span><br></pre></td></tr></table></figure>
<p>work, <code>six</code> places special proxy objects in <code>sys.modules</code>. These proxies lazily load the underlying module when an attribute is fetched. This will fail if the underlying module is not available in the <code>Python</code> interpreter. For example, <code>sys.modules[&quot;six.moves.winreg&quot;].LoadKey</code> would fail on any <code>non-Windows</code> platform. Unfortunately, some applications try to load attributes on every module in <code>sys.modules</code>. <code>six</code> mitigates this problem for some applications by pretending attributes on unimportable modules do not exist. This hack does not work in every case, though. If you are encountering problems with the lazy modules and don’t use any from imports directly from <code>six.moves</code> modules, you can workaround the issue by removing the <code>six</code> proxy modules:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d = [name <span class="keyword">for</span> name <span class="keyword">in</span> sys.modules <span class="keyword">if</span> name.startswith(<span class="string">"six.moves."</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> d:</span><br><span class="line">    <span class="keyword">del</span> sys.modules[name]</span><br></pre></td></tr></table></figure>
<h3 id="Advanced-Customizing-renames"><a href="#Advanced-Customizing-renames" class="headerlink" title="Advanced - Customizing renames"></a>Advanced - Customizing renames</h3><p>&emsp;&emsp;It is possible to add additional names to the <code>six.moves</code> namespace.<br>&emsp;&emsp;<code>six.add_move(item)</code>: Add <code>item</code> to the <code>six.moves</code> mapping. <code>item</code> should be a <code>MovedAttribute</code> or <code>MovedModule</code> instance.<br>&emsp;&emsp;<code>six.remove_move(name)</code>: Remove the <code>six.moves</code> mapping called <code>name</code>. <code>name</code> should be a string. Instances of the following classes can be passed to <code>add_move()</code>. Neither have any public members.<br>&emsp;&emsp;<code>class six.MovedModule(name, old_mod, new_mod)</code>: Create a mapping for <code>six.moves</code> called <code>name</code> that references different modules in <code>Python 2</code> and <code>3</code>. <code>old_mod</code> is the name of the <code>Python 2</code> module. <code>new_mod</code> is the name of the <code>Python 3</code> module.<br>&emsp;&emsp;<code>class six.MovedAttribute(name, old_mod, new_mod, old_attr=None, new_attr=None)</code>: Create a mapping for <code>six.moves</code> called <code>name</code> that references different attributes in <code>Python 2</code> and <code>3</code>. <code>old_mod</code> is the name of the <code>Python 2</code> module. <code>new_mod</code> is the name of the <code>Python 3</code> module. If <code>new_attr</code> is not given, it defaults to <code>old_attr</code>. If neither is given, they both default to name.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/94/">94</a><a class="extend next" rel="next" href="/page/26/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">939</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
