<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="泥腿子出身">
<meta property="og:url" content="http://fukangwei.gitee.io/page/27/index.html">
<meta property="og:site_name" content="泥腿子出身">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="泥腿子出身">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/page/27/">





  <title>泥腿子出身</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泥腿子出身</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Android/EditText输入框/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Android/EditText输入框/" itemprop="url">EditText输入框</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T10:10:24+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>EditText</code>和<code>TextView</code>非常类似，最大的区别是<code>EditText</code>可以接受用户输入。</p>
<h3 id="设置默认提示文本"><a href="#设置默认提示文本" class="headerlink" title="设置默认提示文本"></a>设置默认提示文本</h3><p>&emsp;&emsp;如下图：</p>
<p><img src="/2019/02/10/Android/EditText输入框/1.png"></p>
<p>这里只介绍默认提示文本的两个控制属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:hint=<span class="string">"默认提示文本"</span></span><br><span class="line">android:textColorHint=<span class="string">"#95A1AA"</span></span><br></pre></td></tr></table></figure>
<p>有时需要在文本编辑框中的左边添加图片，可以使用如下语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:drawableLeft=<span class="string">"图片路径"</span></span><br></pre></td></tr></table></figure>
<h3 id="获得焦点后全选组件内所有文本内容"><a href="#获得焦点后全选组件内所有文本内容" class="headerlink" title="获得焦点后全选组件内所有文本内容"></a>获得焦点后全选组件内所有文本内容</h3><p>&emsp;&emsp;当我们想在点击输入框获得焦点后，不是将光标移动到文本的开始或者结尾，而是获取到输入框中所有的文本内容的话！这个时候我们可以使用<code>selectAllOnFocus</code>属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:selectAllOnFocus=<span class="string">"true"</span></span><br></pre></td></tr></table></figure>
<h3 id="限制EditText输入类型"><a href="#限制EditText输入类型" class="headerlink" title="限制EditText输入类型"></a>限制EditText输入类型</h3><p>&emsp;&emsp;有时我们可能需要对输入的数据进行限制，比如输入电话号码的时候，你输入了一串字母，这显然是不符合我们预期的，而限制输入类型可以通过<code>inputType</code>属性来实现。比如限制只能为电话号码、密码(<code>textPassword</code>)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:inputType=<span class="string">"phone"</span></span><br></pre></td></tr></table></figure>
<p>可选参数如下(文本类型，多为大写、小写和数字符号)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">android:inputType=<span class="string">"none"</span>  </span><br><span class="line">android:inputType=<span class="string">"text"</span>  </span><br><span class="line">android:inputType=<span class="string">"textCapCharacters"</span>  </span><br><span class="line">android:inputType=<span class="string">"textCapWords"</span>  </span><br><span class="line">android:inputType=<span class="string">"textCapSentences"</span>  </span><br><span class="line">android:inputType=<span class="string">"textAutoCorrect"</span>  </span><br><span class="line">android:inputType=<span class="string">"textAutoComplete"</span>  </span><br><span class="line">android:inputType=<span class="string">"textMultiLine"</span>  </span><br><span class="line">android:inputType=<span class="string">"textImeMultiLine"</span>  </span><br><span class="line">android:inputType=<span class="string">"textNoSuggestions"</span>  </span><br><span class="line">android:inputType=<span class="string">"textUri"</span>  </span><br><span class="line">android:inputType=<span class="string">"textEmailAddress"</span>  </span><br><span class="line">android:inputType=<span class="string">"textEmailSubject"</span>  </span><br><span class="line">android:inputType=<span class="string">"textShortMessage"</span>  </span><br><span class="line">android:inputType=<span class="string">"textLongMessage"</span>  </span><br><span class="line">android:inputType=<span class="string">"textPersonName"</span>  </span><br><span class="line">android:inputType=<span class="string">"textPostalAddress"</span>  </span><br><span class="line">android:inputType=<span class="string">"textPassword"</span>  </span><br><span class="line">android:inputType=<span class="string">"textVisiblePassword"</span>  </span><br><span class="line">android:inputType=<span class="string">"textWebEditText"</span>  </span><br><span class="line">android:inputType=<span class="string">"textFilter"</span>  </span><br><span class="line">android:inputType=<span class="string">"textPhonetic"</span></span><br></pre></td></tr></table></figure>
<p>数值类型如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android:inputType=<span class="string">"number"</span>  </span><br><span class="line">android:inputType=<span class="string">"numberSigned"</span>  </span><br><span class="line">android:inputType=<span class="string">"numberDecimal"</span>  </span><br><span class="line">android:inputType=<span class="string">"phone"</span> <span class="comment">// 拨号键盘  </span></span><br><span class="line">android:inputType=<span class="string">"datetime"</span>  </span><br><span class="line">android:inputType=<span class="string">"date"</span> <span class="comment">// 日期键盘  </span></span><br><span class="line">android:inputType=<span class="string">"time"</span> <span class="comment">// 时间键盘</span></span><br></pre></td></tr></table></figure>
<h3 id="设置最小行、最多行、单行、多行以及自动换行"><a href="#设置最小行、最多行、单行、多行以及自动换行" class="headerlink" title="设置最小行、最多行、单行、多行以及自动换行"></a>设置最小行、最多行、单行、多行以及自动换行</h3><p>&emsp;&emsp;<code>EditText</code>默认是多行显示的，并且能够自动换行，即当一行显示不完时，它会自动换到第二行。<br>&emsp;&emsp;设置最小行的行数使用属性<code>android:minLines=&quot;3&quot;</code>，设置最大的行数使用属性<code>android:maxLines=&quot;3&quot;</code>，当输入内容超过<code>maxline</code>，文字会自动向上滚动。<br>&emsp;&emsp;很多时候我们可能要限制<code>EditText</code>只允许单行输入，而且不会滚动(比如上面的登陆界面的例子)，只需要设置<code>android:singleLine=&quot;true&quot;</code>。</p>
<h3 id="设置文字间隔，设置英文字母大写类型"><a href="#设置文字间隔，设置英文字母大写类型" class="headerlink" title="设置文字间隔，设置英文字母大写类型"></a>设置文字间隔，设置英文字母大写类型</h3><p>&emsp;&emsp;可以通过以下两个属性来设置字的间距：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:textScaleX=<span class="string">"1.5"</span> <span class="comment">//设置字与字的水平间隔</span></span><br><span class="line">android:textScaleY=<span class="string">"1.5"</span> <span class="comment">//设置字与字的垂直间隔</span></span><br></pre></td></tr></table></figure>
<p><code>EditText</code>还为我们提供了设置英文字母大写类型的属性<code>android:capitalize</code>(默认<code>none</code>)，提供了三个可选值：</p>
<ul>
<li><code>sentences</code>：仅第一个字母大写。</li>
<li><code>words</code>：每一个单词首字母大小，用空格区分单词。</li>
<li><code>characters</code>:每一个英文字母都大写。</li>
</ul>
<h3 id="控制EditText四周的间隔距离与内部文字与边框间的距离"><a href="#控制EditText四周的间隔距离与内部文字与边框间的距离" class="headerlink" title="控制EditText四周的间隔距离与内部文字与边框间的距离"></a>控制EditText四周的间隔距离与内部文字与边框间的距离</h3><p>&emsp;&emsp;我们使用<code>margin</code>相关属性增加组件相对其他控件的距离，比如<code>android:marginTop = &quot;5dp&quot;</code>，使用<code>padding</code>增加组件内文字和组件边框的距离，比如<code>android:paddingTop = &quot;5dp&quot;</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Android/SharedPreferences/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Android/SharedPreferences/" itemprop="url">SharedPreferences</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T09:54:55+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;在<code>Android</code>开发中，经常需要将少量简单类型数据保存在本地，例如用户设置。这些数据可能只是一两个字符串，一般选择使用<code>SharedPreferences</code>来保存。它使用<code>xml</code>文件存放数据，存放在<code>/data/data/&lt;package name&gt;/shared_prefs</code>目录下。</p>
<h3 id="存储数据"><a href="#存储数据" class="headerlink" title="存储数据"></a>存储数据</h3><p>&emsp;&emsp;保存数据一般分为四个步骤：</p>
<ol>
<li>使用<code>Activity</code>类的<code>getSharedPreferences</code>方法获得<code>SharedPreferences</code>对象。</li>
<li>使用<code>SharedPreferences</code>接口的<code>edit</code>获得<code>SharedPreferences.Editor</code>对象。</li>
<li>通过<code>SharedPreferences.Editor</code>接口的<code>putXXX</code>方法设置<code>key-value</code>对。</li>
<li>通过<code>SharedPreferences.Editor</code>接口的<code>commit</code>方法保存<code>key-value</code>对。</li>
</ol>
<p>注意，<code>putXXX</code>中<code>XXX</code>指的是数据类型，例如<code>int</code>、<code>boolean</code>、<code>float</code>、<code>long</code>、<code>String</code>、<code>StringSet</code>。</p>
<h3 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h3><p>&emsp;&emsp;读取数据一般分为两个步骤：</p>
<ol>
<li>使用<code>Activity</code>类的<code>getSharedPreferences</code>方法获得<code>SharedPreferences</code>对象。</li>
<li>通过<code>SharedPreferences</code>对象的<code>getXXX</code>方法获取数据。</li>
</ol>
<h3 id="使用的方法"><a href="#使用的方法" class="headerlink" title="使用的方法"></a>使用的方法</h3><h4 id="getSharedPreferences"><a href="#getSharedPreferences" class="headerlink" title="getSharedPreferences"></a>getSharedPreferences</h4><p>&emsp;&emsp;该函数用于获取<code>SharedPreferences</code>对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> SharedPreferences <span class="title">getSharedPreferences</span> <span class="params">(String name, <span class="keyword">int</span> mode)</span></span>;</span><br></pre></td></tr></table></figure>
<p>根据<code>name</code>查找<code>SharedPreferences</code>，若已经存在，则获取；若不存在，则创建一个新的。参数<code>name</code>是命名；参数<code>mode</code>是模式，包括如下选项：</p>
<ul>
<li><code>MODE_PRIVATE</code>：只能被自己的应用程序访问。</li>
<li><code>MODE_WORLD_READABLE</code>：除了自己访问外，还可以被其它应该程序读取。</li>
<li><code>MODE_WORLD_WRITEABLE</code>：除了自己访问外，还可以被其它应该程序读取和写入。</li>
</ul>
<p>若该<code>Activity</code>只需要创建一个<code>SharedPreferences</code>对象的时候，可以使用<code>getPreferences</code>方法，不需要为<code>SharedPreferences</code>对象命名，只要传入参数<code>mode</code>即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SharedPreferences <span class="title">getPreferences</span> <span class="params">(<span class="keyword">int</span> mode)</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h4><p>&emsp;&emsp;该函数用于获取<code>Editor</code>对象(由<code>SharedPreferences</code>对象调用)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">edit</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="putXXX"><a href="#putXXX" class="headerlink" title="putXXX"></a>putXXX</h4><p>&emsp;&emsp;写入数据使用如下函数(由<code>Editor</code>对象调用)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">putBoolean</span> <span class="params">(String key, <span class="keyword">boolean</span> value)</span></span>; <span class="comment">/* 写入boolean类型数据 */</span></span><br><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">putFloat</span> <span class="params">(String key, <span class="keyword">float</span> value)</span></span>; <span class="comment">/* 写入float类型数据 */</span></span><br><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">putInt</span> <span class="params">(String key, <span class="keyword">int</span> value)</span></span>; <span class="comment">/* 写入int类型数据 */</span></span><br><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">putLong</span> <span class="params">(String key, <span class="keyword">long</span> value)</span></span>; <span class="comment">/* 写入long类型数据 */</span></span><br><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">putString</span> <span class="params">(String key, String value)</span></span>; <span class="comment">/* 写入String类型数据 */</span></span><br><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">putStringSet</span> <span class="params">(String key, Set&lt;String&gt; values)</span></span>; <span class="comment">/* 写入Set&lt;String&gt;类型数据 */</span></span><br></pre></td></tr></table></figure>
<p>参数<code>key</code>是指定数据对应的<code>key</code>，<code>value</code>是指定的值。</p>
<h4 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h4><p>&emsp;&emsp;该函数用于移除指定<code>key</code>的数据(由<code>Editor</code>对象调用)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">remove</span> <span class="params">(String key)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数<code>key</code>是指定数据的<code>key</code>。</p>
<h4 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h4><p>&emsp;&emsp;该函数用于清空数据(由<code>Editor</code>对象调用)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> SharedPreferences.<span class="function">Editor <span class="title">clear</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h4><p>&emsp;&emsp;该函数用于提交数据(由<code>Editor</code>对象调用)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">commit</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="getXXX"><a href="#getXXX" class="headerlink" title="getXXX"></a>getXXX</h4><p>&emsp;&emsp;读取数据(由<code>SharedPreferences</code>对象调用)使用如下函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> Map&lt;String, ?&gt; getAll(); <span class="comment">/* 读取所有数据 */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">getBoolean</span> <span class="params">(String key, <span class="keyword">boolean</span> defValue)</span></span>; <span class="comment">/* 读取的数据为boolean类型 */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">float</span> <span class="title">getFloat</span> <span class="params">(String key, <span class="keyword">float</span> defValue)</span></span>; <span class="comment">/* 读取的数据为float类型 */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getInt</span> <span class="params">(String key, <span class="keyword">int</span> defValue)</span></span>; <span class="comment">/* 读取的数据为int类型 */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">long</span> <span class="title">getLong</span> <span class="params">(String key, <span class="keyword">long</span> defValue)</span></span>; <span class="comment">/* 读取的数据为long类型 */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> String <span class="title">getString</span> <span class="params">(String key, String defValue)</span></span>; <span class="comment">/* 读取的数据为String类型 */</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> Set&lt;String&gt; <span class="title">getStringSet</span> <span class="params">(String key, Set&lt;String&gt; defValues)</span></span>; <span class="comment">/* 读取的数据为Set&lt;String&gt;类型 */</span></span><br></pre></td></tr></table></figure>
<p>参数<code>key</code>是指定数据的<code>key</code>；对于参数<code>defValue</code>，当读取不到指定的数据时，使用的默认值<code>defValue</code>。</p>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.SharedPreferences;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SharedPreferencesTest"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String PREFS_NAME = <span class="string">"MyPrefsFile"</span>; <span class="comment">/* 保存数据SharedPreferences文件的名字 */</span></span><br><span class="line">​</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        saveUserInfo();</span><br><span class="line">        getUserInfo();</span><br><span class="line">        removeUserInfo();</span><br><span class="line">        getUserInfo();</span><br><span class="line">        clearUserInfo();</span><br><span class="line">        getUserInfo();</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveUserInfo</span><span class="params">()</span> </span>&#123; <span class="comment">/* 保存用户信息 */</span></span><br><span class="line">        SharedPreferences userInfo = getSharedPreferences(PREFS_NAME, MODE_PRIVATE);</span><br><span class="line">        SharedPreferences.Editor editor = userInfo.edit(); <span class="comment">/* 获取Editor */</span></span><br><span class="line">        editor.putString(<span class="string">"username"</span>, <span class="string">"一只猫的涵养"</span>); <span class="comment">/* 得到Editor后，写入需要保存的数据 */</span></span><br><span class="line">        editor.putInt(<span class="string">"age"</span>, <span class="number">20</span>);</span><br><span class="line">        editor.commit(); <span class="comment">/* 提交修改 */</span></span><br><span class="line">        Log.i(TAG, <span class="string">"保存用户信息成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getUserInfo</span><span class="params">()</span> </span>&#123; <span class="comment">/* 读取用户信息 */</span></span><br><span class="line">        SharedPreferences userInfo = getSharedPreferences(PREFS_NAME, MODE_PRIVATE);</span><br><span class="line">        String username = userInfo.getString(<span class="string">"username"</span>, <span class="keyword">null</span>); <span class="comment">/* 读取username */</span></span><br><span class="line">        <span class="keyword">int</span> age = userInfo.getInt(<span class="string">"age"</span>, <span class="number">0</span>); <span class="comment">/* 读取age */</span></span><br><span class="line">        Log.i(TAG, <span class="string">"读取用户信息"</span>);</span><br><span class="line">        Log.i(TAG, <span class="string">"username:"</span> + username + <span class="string">"， age:"</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeUserInfo</span><span class="params">()</span> </span>&#123; <span class="comment">/* 移除年龄数据 */</span></span><br><span class="line">        SharedPreferences userInfo = getSharedPreferences(PREFS_NAME, MODE_PRIVATE);</span><br><span class="line">        SharedPreferences.Editor editor = userInfo.edit(); <span class="comment">/* 获取Editor */</span></span><br><span class="line">        editor.remove(<span class="string">"age"</span>);</span><br><span class="line">        editor.commit();</span><br><span class="line">        Log.i(TAG, <span class="string">"移除年龄数据"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearUserInfo</span><span class="params">()</span> </span>&#123; <span class="comment">/* 清空数据 */</span></span><br><span class="line">        SharedPreferences userInfo = getSharedPreferences(PREFS_NAME, MODE_PRIVATE);</span><br><span class="line">        SharedPreferences.Editor editor = userInfo.edit(); <span class="comment">/* 获取Editor */</span></span><br><span class="line">        editor.clear();</span><br><span class="line">        editor.commit();</span><br><span class="line">        Log.i(TAG, <span class="string">"清空数据"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/属性访问和描述符/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/属性访问和描述符/" itemprop="url">属性访问和描述符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T09:34:43+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="属性访问"><a href="#属性访问" class="headerlink" title="属性访问"></a>属性访问</h3><p>&emsp;&emsp;一些与类相关的<code>BIF</code>(<code>Build-In Function</code>)如下：<br>&emsp;&emsp;1. <code>issubclass</code>函数原型如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">issubclass(class, classinfo)</span><br></pre></td></tr></table></figure>
<ul>
<li>一个类被认为是其自身的子类。</li>
<li><code>classinfo</code>可以是类对象组成的元组，只要<code>class</code>是其中任何一个候选类的子类，则返回True。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">issubclass(B, A)  <span class="comment"># 结果为True</span></span><br><span class="line">issubclass(B, B)  <span class="comment"># 结果为True</span></span><br><span class="line">issubclass(B, object)  <span class="comment"># 结果为True，object是所有类的基类</span></span><br><span class="line"><span class="comment"># ------------------------------</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">issubclass(B, C)  <span class="comment"># 结果为False</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;2. <code>isinstance</code>函数原型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isinstance(object, classinfo)</span><br></pre></td></tr></table></figure>
<ul>
<li>如果第一个参数不是对象，则永远返回<code>False</code>。</li>
<li>如果第二个参数不是类或由类对象组成的元组，会抛出一个<code>TypeError</code>异常。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b1 = B()</span><br><span class="line">isinstance(b1, B)  <span class="comment"># 结果为True</span></span><br><span class="line">isinstance(b1, A)  <span class="comment"># 结果为True</span></span><br><span class="line">isinstance(b1, C)  <span class="comment"># 结果为False</span></span><br><span class="line">isinstance(b1, (A, B, C))  <span class="comment"># 结果为True</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;3. <code>hasattr</code>函数原型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hasattr(object, name)</span><br></pre></td></tr></table></figure>
<p><code>object</code>是对象，<code>name</code>是属性名。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">​</span><br><span class="line">c1 = C()</span><br><span class="line">hasattr(c1, <span class="string">"x"</span>)  <span class="comment"># 结果为True</span></span><br><span class="line">hasattr(c1, x)  <span class="comment"># 结果为“出错”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;4. <code>getattr</code>函数原型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(object, name[, default])</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getattr(c1, <span class="string">"x"</span>)  <span class="comment"># 结果为0</span></span><br><span class="line">getattr(c1, <span class="string">"y"</span>)  <span class="comment"># 结果为“出错”</span></span><br><span class="line">getattr(c1, <span class="string">"y"</span>, <span class="string">"您访问的属性不存在..."</span>)  <span class="comment"># 结果为“您访问的属性不存在...”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;5. <code>setattr</code>函数原型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setattr(object, name, value)</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setattr(c1, <span class="string">"y"</span>, <span class="string">"fool"</span>)</span><br><span class="line">getattr(c1, <span class="string">"y"</span>, <span class="string">"您访问的属性不存在..."</span>)  <span class="comment"># 结果为“fool”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;6. <code>delattr</code>函数原型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delattr(object, name)</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delattr(c1, <span class="string">"y"</span>)</span><br><span class="line">delattr(c1, <span class="string">"y"</span>)  <span class="comment"># 结果为“出错”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;7. <code>property</code>函数原型如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">property(fget=<span class="keyword">None</span>, fset=<span class="keyword">None</span>, fdel=<span class="keyword">None</span>, doc=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.size = size</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getValue</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.size</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setValue</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.size = value</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delSize</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.size</span><br><span class="line">​</span><br><span class="line">    x = property(getValue, setValue, delSize)</span><br><span class="line">​</span><br><span class="line">c1 = C()</span><br><span class="line">c1.getValue()  <span class="comment"># 结果为10</span></span><br><span class="line">c1.x  <span class="comment"># 结果为10</span></span><br><span class="line">c1.x = <span class="number">18</span></span><br><span class="line">c1.x  <span class="comment"># 结果为18</span></span><br><span class="line">c1.size  <span class="comment"># 结果为18</span></span><br><span class="line">c1.getValue()  <span class="comment"># 结果为18</span></span><br><span class="line"><span class="keyword">del</span> c1.x</span><br><span class="line">c1.size  <span class="comment"># 结果为“出错”</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>__getattr__(self, name)</code>：定义当用户试图获取一个不存在的属性时的行为。</li>
<li><code>__getattribute__(self, name)</code>：定义当类的属性被访问时的行为。</li>
<li><code>__setattr__(self, name, value)</code>：定义当一个属性被设置时的行为。</li>
<li><code>__delattr__(self, name)</code>：定义当一个属性被删除时的行为。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">"getattr"</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">"getattribute"</span>)</span><br><span class="line">        <span class="keyword">return</span> super().__getattribute__(name)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        print(<span class="string">"setattr"</span>)</span><br><span class="line">        super().__setattr__(name, value)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">"delattr"</span>)</span><br><span class="line">        super().__delattr__(name)</span><br><span class="line">​</span><br><span class="line">c = C()</span><br><span class="line">c.x  <span class="comment"># 结果为getattribute、getattr</span></span><br><span class="line">c.x = <span class="number">1</span>  <span class="comment"># 结果为setattr</span></span><br><span class="line">c.x  <span class="comment"># 结果为getattribute、1</span></span><br><span class="line"><span class="keyword">del</span> c.x  <span class="comment"># 结果为delattr</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;写一个矩形类，默认有宽和高两个属性值；如果为一个叫<code>square</code>的属性赋值，那么说明这是一个正方形，值就是正方形的边长，此时宽和高都应该等于边长。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reactangle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, width=<span class="number">0</span>, height=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.width = width</span><br><span class="line">        self.height = height</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">"square"</span>:</span><br><span class="line">            self.width = value</span><br><span class="line">            self.height = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            super().__setattr__(name, value)  <span class="comment"># 如果写成“self.name = value”，则会进入无限递归</span></span><br><span class="line">            <span class="comment"># 将上一句改为“self.__dict__[name] = value”也是可以的</span></span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getArea</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.width * self.height</span><br><span class="line">​</span><br><span class="line">r1 = Reactangle(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">r1.getArea()  <span class="comment"># 结果为20</span></span><br><span class="line">r1.height  <span class="comment"># 结果为5</span></span><br><span class="line">r1.width  <span class="comment"># 结果为4</span></span><br><span class="line">r1.square = <span class="number">10</span></span><br><span class="line">r1.height  <span class="comment"># 结果为10</span></span><br><span class="line">r1.width  <span class="comment"># 结果为10</span></span><br><span class="line">r1.getArea()  <span class="comment"># 结果为100</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="描述符"><a href="#描述符" class="headerlink" title="描述符"></a>描述符</h3><p>&emsp;&emsp;描述符就是将某种特殊类型的类的实例指派给另一个类的属性。</p>
<ul>
<li><code>__get__(self, instance, owner)</code>：用于访问属性，它返回属性的值。</li>
<li><code>__set__(self, instance, value)</code>：将在属性分配操作中调用，不返回任何内容。</li>
<li><code>__delete__(self, instance)</code>：控制删除操作，不返回任何内容。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDecriptor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">"getting..."</span>, self, instance, owner)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">"setting..."</span>, self, instance, value)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">"deleting..."</span>, self, instance)</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line">    x = MyDecriptor()</span><br><span class="line">​</span><br><span class="line">test = Test()</span><br><span class="line">test.x  <span class="comment"># 结果为“getting... &lt;__main__.MyDecriptor object&gt; &lt;__main__.Test object&gt; &lt;class '__main__.Test'&gt;”</span></span><br><span class="line">test.x = <span class="string">"X-man"</span>  <span class="comment"># 结果为“setting... &lt;__main__.MyDecriptor object&gt; &lt;__main__.Test object&gt; X-man”</span></span><br><span class="line"><span class="keyword">del</span> test.x  <span class="comment"># 结果为“deleting... &lt;__main__.MyDecriptor object&gt; &lt;__main__.Test object&gt;”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;自己实现<code>Python</code>的<code>property</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProperty</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, fget=None, fset=None, fdel=None)</span>:</span></span><br><span class="line">        self.fget = fget</span><br><span class="line">        self.fset = fset</span><br><span class="line">        self.fdel = fdel</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.fget(instance)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        self.fset(instance, value)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        self.fdel(instance)</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__x = <span class="keyword">None</span></span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getX</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__x</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setX</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.__x = value</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delX</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.__x</span><br><span class="line">​</span><br><span class="line">    x = MyProperty(getX, setX, delX)</span><br><span class="line">​</span><br><span class="line">c = C()</span><br><span class="line">c.x = <span class="string">"X-man"</span></span><br><span class="line">c.x  <span class="comment"># 结果为“X-man”</span></span><br><span class="line">c.__x  <span class="comment"># 结果为“出错”，“__x”是c的私有变量</span></span><br><span class="line"><span class="keyword">del</span> c.x</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;先定义一个温度类，然后定义两个描述符类用于描述摄氏度和华氏度两个属性。要求两个属性会自动进行转换，也就是说你可以给摄氏度这个属性赋值，然后打印的华氏度属性是自动转换的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Celsius</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value=<span class="number">26.0</span>)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.value</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        self.value = float(value)</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fahrenheit</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> instance.cel * <span class="number">1.8</span> + <span class="number">32</span></span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        instance.cel = (float(value) - <span class="number">32</span>) / <span class="number">1.8</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperture</span>:</span></span><br><span class="line">    cel = Celsius()</span><br><span class="line">    fah = Fahrenheit()</span><br><span class="line">​</span><br><span class="line">temp = Temperture()</span><br><span class="line">temp.cel  <span class="comment"># 结果为26.0</span></span><br><span class="line">temp.cel = <span class="number">30</span></span><br><span class="line">temp.fah  <span class="comment"># 结果为86.0</span></span><br><span class="line">temp.fah = <span class="number">100</span></span><br><span class="line">temp.cel  <span class="comment"># 结果为37.77777777777778</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/10/Python语法/unittest模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Python语法/unittest模块/" itemprop="url">unittest模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T08:51:32+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><p>&emsp;&emsp;如果你听说过<code>测试驱动开发</code>(<code>Test-Driven Development</code>，<code>TDD</code>)，单元测试就不陌生。单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。比如对函数<code>abs</code>，我们可以编写出以下几个测试情形：</p>
<ul>
<li>输入正数，比如<code>1</code>、<code>1.2</code>、<code>0.99</code>，期待返回值与输入相同。</li>
<li>输入负数，比如<code>-1</code>、<code>-1.2</code>、<code>-0.99</code>，期待返回值与输入相反。</li>
<li>输入<code>0</code>，期待返回<code>0</code>。</li>
<li>输入非数值类型，比如<code>None</code>、<code>[]</code>、<code>{}</code>，期待抛出<code>TypeError</code>。</li>
</ul>
<p>把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。如果单元测试通过，说明测试的这个函数能够正常工作；如果单元测试不通过，要么函数有<code>bug</code>，要么测试条件输入不正确，总之需要修复使单元测试能够通过。<br>&emsp;&emsp;单元测试通过后有什么意义呢？如果我们对<code>abs</code>函数代码做了修改，只需要再跑一遍单元测试，如果通过，说明修改不会对<code>abs</code>函数原有的行为造成影响；如果测试不通过，说明修改与原有行为不一致，要么修改代码，要么修改测试。这种以测试为驱动的开发模式最大的好处就是确保一个程序模块的行为符合设计的测试用例，在将来修改的时候，可以极大程度地保证该模块行为仍然是正确的。<br>&emsp;&emsp;我们来编写一个<code>Dict</code>类，这个类的行为和<code>dict</code>(字典)一致，但是可以通过属性来访问，用起来就像下面这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = Dict(a=<span class="number">1</span>, b=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'a'</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.a</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><code>mydict.py</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dict</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kw)</span>:</span></span><br><span class="line">        super(Dict, self).__init__(**kw)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">r"'Dict' object has no attribute '%s'"</span> % key)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self[key] = value</span><br></pre></td></tr></table></figure>
<p>为了编写单元测试，需要引入<code>Python</code>自带的<code>unittest</code>模块，编写<code>mydict_test.py</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> mydict <span class="keyword">import</span> Dict</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDict</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_init</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict(a=<span class="number">1</span>, b=<span class="string">'test'</span>)</span><br><span class="line">        self.assertEqual(d.a, <span class="number">1</span>)</span><br><span class="line">        self.assertEqual(d.b, <span class="string">'test'</span>)</span><br><span class="line">        self.assertTrue(isinstance(d, dict))</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_key</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        d[<span class="string">'key'</span>] = <span class="string">'value'</span></span><br><span class="line">        self.assertEqual(d.key, <span class="string">'value'</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_attr</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        d.key = <span class="string">'value'</span></span><br><span class="line">        self.assertTrue(<span class="string">'key'</span> <span class="keyword">in</span> d)</span><br><span class="line">        self.assertEqual(d[<span class="string">'key'</span>], <span class="string">'value'</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_keyerror</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(KeyError):</span><br><span class="line">            value = d[<span class="string">'empty'</span>]</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_attrerror</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(AttributeError):</span><br><span class="line">            value = d.empty</span><br></pre></td></tr></table></figure>
<p>编写单元测试时，我们需要编写一个测试类，从<code>unittest.TestCase</code>继承。<br>&emsp;&emsp;以<code>test</code>开头的方法就是测试方法，不以<code>test</code>开头的方法不被认为是测试方法，测试的时候不会被执行。对每一类测试都需要编写一个<code>test_xxx</code>方法。由于<code>unittest.TestCase</code>提供了很多内置的条件判断，只需要调用这些方法就可以断言输出是否是我们所期望的。最常用的断言就是<code>assertEqual</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.assertEqual(abs(<span class="number">-1</span>), <span class="number">1</span>)  <span class="comment"># 断言函数返回的结果与“1”相等</span></span><br></pre></td></tr></table></figure>
<p>另一种重要的断言就是期待抛出指定类型的<code>Error</code>，比如通过<code>d[&#39;empty&#39;]</code>访问不存在的<code>key</code>时，断言会抛出<code>KeyError</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> self.assertRaises(KeyError):</span><br><span class="line">    value = d[<span class="string">'empty'</span>]</span><br></pre></td></tr></table></figure>
<p>而通过<code>d.empty</code>访问不存在的<code>key</code>时，我们期待抛出<code>AttributeError</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> self.assertRaises(AttributeError):</span><br><span class="line">    value = d.empty</span><br></pre></td></tr></table></figure>
<h3 id="运行单元测试"><a href="#运行单元测试" class="headerlink" title="运行单元测试"></a>运行单元测试</h3><p>&emsp;&emsp;一旦编写好单元测试，我们就可以运行单元测试。最简单的运行方式是在<code>mydict_test.py</code>的最后加上两行代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p>这样就可以把<code>mydict_test.py</code>当做正常的<code>python</code>脚本运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python mydict_test.py</span><br></pre></td></tr></table></figure>
<p>另一种更常见的方法是在命令行通过参数<code>-m unittest</code>直接运行单元测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python -m unittest mydict_test</span><br><span class="line">.....</span><br><span class="line">----------------------------------------</span><br><span class="line">Ran 5 tests <span class="keyword">in</span> 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>这是推荐的做法，因为这样可以一次批量运行很多单元测试，并且有很多工具可以自动来运行这些单元测试。</p>
<h3 id="setUp与tearDown"><a href="#setUp与tearDown" class="headerlink" title="setUp与tearDown"></a>setUp与tearDown</h3><p>&emsp;&emsp;可以在单元测试中编写两个特殊的<code>setUp</code>和<code>tearDown</code>方法，这两个方法会在每调用一个测试方法的前后分别被执行。<br>&emsp;&emsp;<code>setUp</code>和<code>tearDown</code>方法有什么用呢？设想你的测试需要启动一个数据库，这时就可以在<code>setUp</code>方法中连接数据库，在<code>tearDown</code>方法中关闭数据库，这样不必在每个测试方法中重复相同的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDict</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'setUp...'</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'tearDown...'</span>)</span><br></pre></td></tr></table></figure>
<p>可以再次运行测试，看看每个测试方法调用前后是否会打印出<code>setUp...</code>和<code>tearDown...</code>。</p>
<h3 id="跳过某个case"><a href="#跳过某个case" class="headerlink" title="跳过某个case"></a>跳过某个case</h3><p>&emsp;&emsp;如果我们临时想要跳过某个<code>case</code>不执行怎么办？<code>unittest</code>提供了<code>skip</code>装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMathFunc</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="string">""" Test mathfuc.py """</span></span><br><span class="line">    ...</span><br><span class="line">    @unittest.skip(<span class="string">"I don't want to run this case."</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_divide</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Test method divide(a, b)"""</span></span><br><span class="line">        print(<span class="string">"divide"</span>)</span><br><span class="line">        self.assertEqual(<span class="number">2</span>, divide(<span class="number">6</span>, <span class="number">3</span>))</span><br><span class="line">        self.assertEqual(<span class="number">2.5</span>, divide(<span class="number">5</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<h3 id="setUpClass和tearDownClass"><a href="#setUpClass和tearDownClass" class="headerlink" title="setUpClass和tearDownClass"></a>setUpClass和tearDownClass</h3><p>&emsp;&emsp;可以使用<code>setUpClass</code>、<code>tearDownClass</code>做所有<code>case</code>的前置初始化和结束。以下示例的执行顺序是<code>setUpClass -&gt; test_case1 -&gt; test_case2 -&gt; tearDownClass</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    @classmethod</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'开始执行'</span>)</span><br><span class="line">​</span><br><span class="line">    @classmethod</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'结束执行'</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="comment"># 测试用例</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_case1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'用例1'</span>)</span><br><span class="line">​</span><br><span class="line">    <span class="comment"># 测试用例</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_case2</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'用例2'</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>&emsp;&emsp;单元测试可以有效地测试某个程序模块的行为，是未来重构代码的信心保证。<br>&emsp;&emsp;单元测试的测试用例要覆盖常用的输入组合、边界条件和异常。<br>&emsp;&emsp;单元测试代码要非常简单，如果测试代码太复杂，那么测试代码本身就可能有<code>bug</code>。<br>&emsp;&emsp;单元测试通过了并不意味着程序就没有<code>bug</code>了，但是不通过程序肯定有<code>bug</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/tempfile模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/tempfile模块/" itemprop="url">tempfile模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T21:33:45+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="tempfile-Generate-temporary-files-and-directories"><a href="#tempfile-Generate-temporary-files-and-directories" class="headerlink" title="tempfile: Generate temporary files and directories"></a>tempfile: Generate temporary files and directories</h3><p>&emsp;&emsp;This module creates temporary files and directories. It works on all supported platforms. <code>TemporaryFile</code>, <code>NamedTemporaryFile</code>, <code>TemporaryDirectory</code>, and <code>SpooledTemporaryFile</code> are <code>high-level</code> interfaces which provide automatic cleanup and can be used as context managers. <code>mkstemp()</code> and <code>mkdtemp()</code> are <code>lower-level</code> functions which require manual cleanup.<br>&emsp;&emsp;All the <code>user-callable</code> functions and constructors take additional arguments which allow direct control over the location and name of temporary files and directories. Files names used by this module include a string of random characters which allows those files to be securely created in shared temporary directories. To maintain backward compatibility, the argument order is somewhat odd; it is recommended to use keyword arguments for clarity.<br>&emsp;&emsp;The module defines the following <code>user-callable</code> items:<br>&emsp;&emsp;<code>tempfile.TemporaryFile(mode=&#39;w+b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None)</code>: Return a <code>file-like</code> object that can be used as a temporary storage area. The file is created securely, using the same rules as <code>mkstemp()</code>. It will be destroyed as soon as it is closed (including an implicit close when the object is garbage collected). Under <code>Unix</code>, the directory entry for the file is either not created at all or is removed immediately after the file is created. Other platforms do not support this; your code should not rely on a temporary file created using this function having or not having a visible name in the file system.<br>&emsp;&emsp;The resulting object can be used as a context manager. On completion of the context or destruction of the file object the temporary file will be removed from the filesystem.<br>&emsp;&emsp;The <code>mode</code> parameter defaults to <code>w+b</code> so that the file created can be read and written without being closed. Binary mode is used so that it behaves consistently on all platforms without regard for the data that is stored. <code>buffering</code>, <code>encoding</code> and <code>newline</code> are interpreted as for <code>open()</code>.<br>&emsp;&emsp;The <code>dir</code>, <code>prefix</code> and <code>suffix</code> parameters have the same meaning and defaults as with <code>mkstemp()</code>.<br>&emsp;&emsp;The returned object is a true file object on <code>POSIX</code> platforms. On other platforms, it is a <code>file-like</code> object whose file attribute is the underlying true file object.<br>&emsp;&emsp;<code>tempfile.NamedTemporaryFile(mode=&#39;w+b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None, delete=True)</code>: This function operates exactly as <code>TemporaryFile()</code> does, except that the file is guaranteed to have a visible name in the file system (on <code>Unix</code>, the directory entry is not unlinked). That name can be retrieved from the name attribute of the returned <code>file-like</code> object. Whether the name can be used to open the file a second time, while the named temporary file is still open, varies across platforms (it can be so used on <code>Unix</code>; it cannot on <code>Windows NT</code> or later). If delete is <code>true</code> (the default), the file is deleted as soon as it is closed. The returned object is always a <code>file-like</code> object whose file attribute is the underlying true file object. This <code>file-like</code> object can be used in a with statement, just like a normal file.<br>&emsp;&emsp;<code>tempfile.SpooledTemporaryFile(max_size=0, mode=&#39;w+b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None)</code>: This function operates exactly as <code>TemporaryFile()</code> does, except that data is spooled in memory until the file size exceeds <code>max_size</code>, or until the file’s <code>fileno()</code> method is called, at which point the contents are written to disk and operation proceeds as with <code>TemporaryFile()</code>.<br>&emsp;&emsp;The resulting file has one additional method, <code>rollover()</code>, which causes the file to roll over to an <code>on-disk</code> file regardless of its size.<br>&emsp;&emsp;The returned object is a <code>file-like</code> object whose <code>_file</code> attribute is either an <code>io.BytesIO</code> or <code>io.StringIO</code> object (depending on whether binary or text mode was specified) or a true file object, depending on whether <code>rollover()</code> has been called. This <code>file-like</code> object can be used in a with statement, just like a normal file.<br>&emsp;&emsp;<code>tempfile.TemporaryDirectory(suffix=None, prefix=None, dir=None)</code>: This function securely creates a temporary directory using the same rules as <code>mkdtemp()</code>. The resulting object can be used as a context manager. On completion of the context or destruction of the temporary directory object the newly created temporary directory and all its contents are removed from the filesystem.<br>&emsp;&emsp;The directory name can be retrieved from the name attribute of the returned object. When the returned object is used as a context manager, the name will be assigned to the target of the as clause in the with statement, if there is one.<br>&emsp;&emsp;The directory can be explicitly cleaned up by calling the <code>cleanup()</code> method.<br>&emsp;&emsp;<code>tempfile.mkstemp(suffix=None, prefix=None, dir=None, text=False)</code>: Creates a temporary file in the most secure manner possible. There are no race conditions in the file’s creation, assuming that the platform properly implements the <code>os.O_EXCL</code> flag for <code>os.open()</code>. The file is readable and writable only by the creating <code>user ID</code>. If the platform uses permission bits to indicate whether a file is executable, the file is executable by no one. The file descriptor is not inherited by child processes.<br>&emsp;&emsp;Unlike <code>TemporaryFile()</code>, the user of <code>mkstemp()</code> is responsible for deleting the temporary file when done with it.<br>&emsp;&emsp;If <code>suffix</code> is not None, the file name will end with that <code>suffix</code>, otherwise there will be no suffix. <code>mkstemp()</code> does not put a dot between the file name and the suffix; if you need one, put it at the beginning of <code>suffix</code>.<br>&emsp;&emsp;If <code>prefix</code> is not None, the file name will begin with that <code>prefix</code>; otherwise, a default prefix is used. The default is the return value of <code>gettempprefix()</code> or <code>gettempprefixb()</code>, as appropriate.<br>&emsp;&emsp;If <code>dir</code> is not None, the file will be created in that directory; otherwise, a default directory is used. The default directory is chosen from a <code>platform-dependent</code> list, but the user of the application can control the directory location by setting the <code>TMPDIR</code>, <code>TEMP</code> or <code>TMP</code> environment variables. There is thus no guarantee that the generated filename will have any nice properties, such as not requiring quoting when passed to external commands via <code>os.popen()</code>.<br>&emsp;&emsp;If any of <code>suffix</code>, <code>prefix</code>, and <code>dir</code> are not None, they must be the same type. If they are bytes, the returned name will be bytes instead of str. If you want to force a bytes return value with otherwise default behavior, pass <code>suffix=b&#39;&#39;</code>.<br>&emsp;&emsp;If <code>text</code> is specified, it indicates whether to open the file in binary mode (the default) or text mode. On some platforms, this makes no difference.<br>&emsp;&emsp;<code>mkstemp()</code> returns a tuple containing an <code>OS-level</code> handle to an open file (as would be returned by <code>os.open()</code>) and the absolute pathname of that file, in that order.<br>&emsp;&emsp;<code>tempfile.mkdtemp(suffix=None, prefix=None, dir=None)</code>: Creates a temporary directory in the most secure manner possible. There are no race conditions in the directory’s creation. The directory is readable, writable, and searchable only by the creating <code>user ID</code>.<br>&emsp;&emsp;The user of <code>mkdtemp()</code> is responsible for deleting the temporary directory and its contents when done with it.<br>&emsp;&emsp;The <code>prefix</code>, <code>suffix</code>, and dir arguments are the same as for <code>mkstemp()</code>.<br>&emsp;&emsp;<code>mkdtemp()</code> returns the absolute pathname of the new directory.<br>&emsp;&emsp;<code>tempfile.gettempdir()</code>: Return the name of the directory used for temporary files. This defines the default value for the dir argument to all functions in this module.<br>&emsp;&emsp;Python searches a standard list of directories to find one which the calling user can create files in. The list is:</p>
<ul>
<li>The directory named by the <code>TMPDIR</code> environment variable.</li>
<li>The directory named by the <code>TEMP</code> environment variable.</li>
<li>The directory named by the <code>TMP</code> environment variable.</li>
<li>A platform-specific location:</li>
</ul>
<ol>
<li>On <code>Windows</code>, the directories <code>C:\TEMP</code>, <code>C:\TMP</code>, <code>\TEMP</code>, and <code>\TMP</code>, in that order.</li>
<li>On all other platforms, the directories <code>/tmp</code>, <code>/var/tmp</code>, and <code>/usr/tmp</code>, in that order.</li>
</ol>
<ul>
<li>As a last resort, the current working directory.</li>
</ul>
<p>&emsp;&emsp;<code>tempfile.gettempdirb()</code>: Same as <code>gettempdir()</code> but the return value is in bytes.<br>&emsp;&emsp;<code>tempfile.gettempprefix()</code>: Return the filename prefix used to create temporary files. This does not contain the directory component.<br>&emsp;&emsp;<code>tempfile.gettempprefixb()</code>: Same as <code>gettempprefix()</code> but the return value is in bytes.<br>&emsp;&emsp;The module uses a global variable to store the name of the directory used for temporary files returned by <code>gettempdir()</code>. It can be set directly to override the selection process, but this is discouraged. All functions in this module take a dir argument which can be used to specify the directory and this is the recommended approach.<br>&emsp;&emsp;<code>tempfile.tempdir</code>: When set to a value other than <code>None</code>, this variable defines the default value for the dir argument to the functions defined in this module.<br>&emsp;&emsp;If <code>tempdir</code> is unset or <code>None</code> at any call to any of the above functions except <code>gettempprefix()</code> it is initialized following the algorithm described in <code>gettempdir()</code>.</p>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p>&emsp;&emsp;Here are some examples of typical usage of the tempfile module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># create a temporary file and write some data to it</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp = tempfile.TemporaryFile()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.write(<span class="string">b'Hello world!'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.seek(<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.read()  <span class="comment"># read data from file</span></span><br><span class="line"><span class="string">b'Hello world!'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.close()  <span class="comment"># close the file, it will be removed</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># create a temporary file using a context manager</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> tempfile.TemporaryFile() <span class="keyword">as</span> fp:</span><br><span class="line"><span class="meta">... </span>    fp.write(<span class="string">b'Hello world!'</span>)</span><br><span class="line"><span class="meta">... </span>    fp.seek(<span class="number">0</span>)</span><br><span class="line"><span class="meta">... </span>    fp.read()</span><br><span class="line"><span class="string">b'Hello world!'</span></span><br><span class="line"><span class="comment"># file is now closed and removed</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># create a temporary directory using the context manager</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> tempfile.TemporaryDirectory() <span class="keyword">as</span> tmpdirname:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'created temporary directory'</span>, tmpdirname)</span><br><span class="line"><span class="comment"># directory and contents have been removed</span></span><br></pre></td></tr></table></figure>
<h3 id="Deprecated-functions-and-variables"><a href="#Deprecated-functions-and-variables" class="headerlink" title="Deprecated functions and variables"></a>Deprecated functions and variables</h3><p>&emsp;&emsp;A historical way to create temporary files was to first generate a file name with the <code>mktemp()</code> function and then create a file using this name. Unfortunately this is not secure, because a different process may create a file with this name in the time between the call to <code>mktemp()</code> and the subsequent attempt to create the file by the first process. The solution is to combine the two steps and create the file immediately. This approach is used by <code>mkstemp()</code> and the other functions described above.<br>&emsp;&emsp;<code>tempfile.mktemp(suffix=&#39;&#39;, prefix=&#39;tmp&#39;, dir=None)</code>: Deprecated since <code>version 2.3</code>: Use <code>mkstemp()</code> instead.<br>&emsp;&emsp;Return an absolute pathname of a file that did not exist at the time the call is made. The <code>prefix</code>, <code>suffix</code>, and <code>dir</code> arguments are similar to those of <code>mkstemp()</code>, except that bytes file names, <code>suffix=None</code> and <code>prefix=None</code> are not supported.<br>&emsp;&emsp;<strong>Warning</strong>: Use of this function may introduce a security hole in your program. By the time you get around to doing anything with the file name it returns, someone else may have beaten you to the punch. <code>mktemp()</code> usage can be replaced easily with <code>NamedTemporaryFile()</code>, passing it the <code>delete=False</code> parameter:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = NamedTemporaryFile(delete=<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.name</span><br><span class="line"><span class="string">'/tmp/tmptjujjt'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">b"Hello World!\n"</span>)</span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.unlink(f.name)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.exists(f.name)</span><br><span class="line"><span class="keyword">False</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/datetime模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/datetime模块/" itemprop="url">datetime模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T21:14:50+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>datetime</code>是<code>Python</code>处理日期和时间的标准库。</p>
<h3 id="获取当前日期和时间"><a href="#获取当前日期和时间" class="headerlink" title="获取当前日期和时间"></a>获取当前日期和时间</h3><p>&emsp;&emsp;先看如何获取当前日期和时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()  <span class="comment"># 获取当前datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(now)</span><br><span class="line"><span class="number">2018</span><span class="number">-04</span><span class="number">-20</span> <span class="number">17</span>:<span class="number">28</span>:<span class="number">22.173096</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(now))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="获取指定日期和时间"><a href="#获取指定日期和时间" class="headerlink" title="获取指定日期和时间"></a>获取指定日期和时间</h3><p>&emsp;&emsp;要指定某个日期和时间，我们直接用参数构造一个<code>datetime</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>)  <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="datetime转换为timestamp"><a href="#datetime转换为timestamp" class="headerlink" title="datetime转换为timestamp"></a>datetime转换为timestamp</h3><p>&emsp;&emsp;在计算机中，时间实际上是用数字表示的。我们把<code>1970年1月1日 00:00:00 UTC+00:00时区</code>的时刻称为<code>epoch time</code>，记为<code>0</code>(<code>1970</code>年以前的时间<code>timestamp</code>为负数)。当前时间就是相对于<code>epoch time</code>的秒数，称为<code>timestamp</code>。你可以认为<code>timestamp = 0 = 1970-1-1 00:00:00 UTC+0:00</code>，对应的北京时间是<code>timestamp = 0 = 1970-1-1 08:00:00 UTC+8:00</code>。可见<code>timestamp</code>的值与时区毫无关系，因为<code>timestamp</code>一旦确定，其<code>UTC</code>时间就确定了，转换到任意时区的时间也是完全确定的，这就是为什么计算机存储的当前时间是以<code>timestamp</code>表示的，因为全球各地的计算机在任意时刻的<code>timestamp</code>都是完全相同的(假定时间已校准)。<br>&emsp;&emsp;把一个<code>datetime</code>类型转换为<code>timestamp</code>只需要简单调用<code>timestamp</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>)  <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.timestamp()  <span class="comment"># 把datetime转换为timestamp</span></span><br><span class="line"><span class="number">1429417200.0</span></span><br></pre></td></tr></table></figure>
<p>注意<code>Python</code>的<code>timestamp</code>是一个浮点数。如果有小数位，小数位表示毫秒数。某些编程语言(如<code>Java</code>和<code>JavaScript</code>)的<code>timestamp</code>使用整数表示毫秒数，这种情况下只需要把<code>timestamp</code>除以<code>1000</code>就得到<code>Python</code>的浮点表示方法。</p>
<h3 id="timestamp转换为datetime"><a href="#timestamp转换为datetime" class="headerlink" title="timestamp转换为datetime"></a>timestamp转换为datetime</h3><p>&emsp;&emsp;要把<code>timestamp</code>转换为<code>datetime</code>，使用<code>datetime</code>提供的<code>fromtimestamp</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="number">1429417200.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.fromtimestamp(t))</span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<p>注意到<code>timestamp</code>是一个浮点数，它没有时区的概念，而<code>datetime</code>是有时区的。上述转换是在<code>timestamp</code>和本地时间做转换。<br>&emsp;&emsp;本地时间是指当前操作系统设定的时区。例如北京时区是东<code>8</code>区，则本地时间<code>2015-04-19 12:20:00</code>，实际上就是<code>UTC+8:00时区</code>的时间<code>2015-04-19 12:20:00 UTC+8:00</code>。<br>&emsp;&emsp;<code>timestamp</code>也可以直接被转换到<code>UTC</code>标准时区的时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="number">1429417200.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.fromtimestamp(t))  <span class="comment"># 本地时间</span></span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.utcfromtimestamp(t))  <span class="comment"># UTC时间</span></span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">04</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="str转换为datetime"><a href="#str转换为datetime" class="headerlink" title="str转换为datetime"></a>str转换为datetime</h3><p>&emsp;&emsp;很多时候，用户输入的日期和时间是字符串，要处理日期和时间，首先必须把<code>str</code>转换为<code>datetime</code>。转换方法是通过<code>datetime.strptime</code>实现，需要一个日期和时间的格式化字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cday = datetime.strptime(<span class="string">'2015-6-1 18:19:59'</span>, <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(cday)</span><br><span class="line"><span class="number">2015</span><span class="number">-06</span><span class="number">-01</span> <span class="number">18</span>:<span class="number">19</span>:<span class="number">59</span></span><br></pre></td></tr></table></figure>
<p>字符串<code>%Y-%m-%d %H:%M:%S</code>规定了日期和时间部分的格式。注意转换后的<code>datetime</code>是没有时区信息的。</p>
<h3 id="datetime转换为str"><a href="#datetime转换为str" class="headerlink" title="datetime转换为str"></a>datetime转换为str</h3><p>&emsp;&emsp;如果已经有了<code>datetime</code>对象，要把它格式化为字符串显示给用户，就需要转换为<code>str</code>，转换方法是通过<code>strftime</code>实现的，同样需要一个日期和时间的格式化字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(now.strftime(<span class="string">'%a, %b %d %H:%M'</span>))</span><br><span class="line">Mon, May <span class="number">05</span> <span class="number">16</span>:<span class="number">28</span></span><br></pre></td></tr></table></figure>
<h3 id="datetime加减"><a href="#datetime加减" class="headerlink" title="datetime加减"></a>datetime加减</h3><p>&emsp;&emsp;对日期和时间进行加减实际上就是把<code>datetime</code>往后或往前计算，得到新的<code>datetime</code>。加减可以直接用<code>+</code>和<code>-</code>运算符，不过需要导入<code>timedelta</code>这个类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now + timedelta(hours=<span class="number">10</span>)</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now - timedelta(days=<span class="number">1</span>)</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">17</span>, <span class="number">16</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now + timedelta(days=<span class="number">2</span>, hours=<span class="number">12</span>)</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">4</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br></pre></td></tr></table></figure>
<p>可见，使用<code>timedelta</code>可以很容易地算出前几天和后几天的时刻。</p>
<h3 id="本地时间转换为UTC时间"><a href="#本地时间转换为UTC时间" class="headerlink" title="本地时间转换为UTC时间"></a>本地时间转换为UTC时间</h3><p>&emsp;&emsp;本地时间是指系统设定时区的时间，例如北京时间是<code>UTC+8:00时区</code>的时间，而<code>UTC</code>时间指<code>UTC+0:00时区</code>的时间。<br>&emsp;&emsp;一个<code>datetime</code>类型有一个时区属性<code>tzinfo</code>，但是默认为<code>None</code>，所以无法区分这个<code>datetime</code>到底是哪个时区，除非强行给<code>datetime</code>设置一个时区：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tz_utc_8 = timezone(timedelta(hours=<span class="number">8</span>))  <span class="comment"># 创建时区UTC+8:00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">17</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">871012</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = now.replace(tzinfo=tz_utc_8)  <span class="comment"># 强制设置为UTC+8:00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">17</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">871012</span>, tzinfo=datetime.timezone(datetime.timedelta(<span class="number">0</span>, <span class="number">28800</span>)))</span><br></pre></td></tr></table></figure>
<p>如果系统时区恰好是<code>UTC+8:00</code>，那么上述代码就是正确的，否则不能强制设置为<code>UTC+8:00时区</code>。</p>
<h3 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h3><p>&emsp;&emsp;我们可以先通过<code>utcnow</code>拿到当前的<code>UTC</code>时间，再转换为任意时区的时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 拿到UTC时间，并强制设置时区为“UTC+0:00”</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>utc_dt = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(utc_dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">09</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># astimezone将转换时区为北京时间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bj_dt = utc_dt.astimezone(timezone(timedelta(hours=<span class="number">8</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(bj_dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># astimezone将转换时区为东京时间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo_dt = utc_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(tokyo_dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">18</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">09</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># astimezone将bj_dt转换时区为东京时间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo_dt2 = bj_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(tokyo_dt2)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">18</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">09</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<p>时区转换的关键在于，拿到一个<code>datetime</code>时，要获知其正确的时区，然后强制设置时区，作为基准时间。利用带时区的<code>datetime</code>，通过<code>astimezone</code>方法，可以转换到任意时区。<br>&emsp;&emsp;注意，不是必须从<code>UTC+0:00时区</code>转换到其他时区，任何带时区的<code>datetime</code>都可以正确转换，例如上述<code>bj_dt</code>到<code>tokyo_dt</code>的转换。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/timeit模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/timeit模块/" itemprop="url">timeit模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T20:47:39+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>timeit</code>模块提供了简单的方式来测量小段<code>Python</code>代码片，它有两种执行方式：命令行接口执行方式和<code>Python</code>程序代码可调的函数的方式。该模块避免了很多常见的度量时间的陷进。</p>
<h3 id="基本的例子"><a href="#基本的例子" class="headerlink" title="基本的例子"></a>基本的例子</h3><p>&emsp;&emsp;下面例子演示使用<code>Command-Line Interface</code>比较三种不同的表达式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python -m timeit <span class="string">'"-".join(str(n) for n in range(100))'</span></span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">70.3</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'"-".join([str(n) for n in range(100)])'</span></span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">61</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'"-".join(map(str, range(100)))'</span></span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">56.5</span> usec per loop</span><br></pre></td></tr></table></figure>
<p>同样可以用<code>Python Interface</code>来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'"-".join(str(n) for n in range(100))'</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="number">0.5236273538834694</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'"-".join([str(n) for n in range(100)])'</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="number">0.4634496997189608</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'"-".join(map(str, range(100)))'</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="number">0.4363641106430016</span></span><br></pre></td></tr></table></figure>
<p>注意，模块只有用<code>Command-Line Interface</code>方式才会自动判断重复的次数。</p>
<h3 id="Python接口方式"><a href="#Python接口方式" class="headerlink" title="Python接口方式"></a>Python接口方式</h3><p>&emsp;&emsp;该模块定义了三个实用函数和一个公共类：</p>
<ul>
<li><code>timeit.timeit(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=&lt;default timer&gt;, number=1000000)</code>：用已给的语句创建一个<code>Timer</code>实例，参数分别是<code>stmt</code>(需要测量的语句或函数)、<code>setup</code>代码(初始化代码或构建环境的导入语句)、<code>timer</code>函数(计时函数)、<code>number</code>(每一次测量中语句被执行的次数)。注意，由于<code>timeit</code>正在执行语句，语句中如果存在返回值的话，会阻止<code>timeit</code>返回执行时间。<code>timeit</code>会取代原语句中的返回值。</li>
<li><code>timeit.repeat(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=&lt;default timer&gt;, repeat=3, number=1000000)</code>：用已给的语句创建一个<code>Timer</code>实例，参数<code>repeat</code>是重复测量的次数，其他参数与<code>timeit</code>类似。</li>
<li><code>timeit.default_timer()</code>：定义一个基于平台的默认的计时器。在<code>Windwos</code>系统，<code>time.clock</code>有微秒的精度，但是<code>time.time</code>只有<code>1/60</code>秒的精度；在<code>Unix</code>系统，<code>time.clock</code>有<code>1/100</code>秒的精度，而<code>time.time</code>的精度更高。</li>
<li><code>class timeit.Timer(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=&lt;timer function&gt;)</code>：计算小片代码段的类。构造函数需要的参数有<code>stmt</code>(需要测量的语句或函数)、<code>setup</code>代码(初始化代码或构建环境的导入语句)、<code>timer</code>函数(计时函数)，前两个参数的默认值都是<code>pass</code>。计时器函数依赖于具体平台，<code>stmt</code>和<code>setup</code>可以包括多个语句，以分号或者新行隔开。</li>
</ul>
<p>&emsp;&emsp;第一次测量语句的执行时间，可以使用<code>timeit</code>方法。<code>repeat</code>方法相当于多次调用<code>timeit</code>，并返回一个结果集的列表。<code>stmt</code>和<code>setup</code>参数同样可以调用无参的对象，这将会在一个计时函数中嵌套调用它们，然后被<code>timeit</code>所执行，这样做的话会增加额外的开销。</p>
<h3 id="timeit"><a href="#timeit" class="headerlink" title="timeit"></a>timeit</h3><p>&emsp;&emsp;<code>timeit(number=1000000)</code>：计算语句执行<code>1000000</code>次的时间。该语句会先执行一次<code>setup</code>参数语句，然后计算<code>stmt</code>参数的语句执行<code>number</code>次的时间，返回值是以秒为单位的浮点数。<code>number</code>参数默认是<code>1百万</code>，<code>stmt</code>、<code>setup</code>和<code>timer</code>参数由<code>timeit.Timer</code>类的构造函数传递。</p>
<h3 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h3><p>&emsp;&emsp;<code>repeat(repeat=3, number=1000000)</code>：<code>repeat</code>相当于持续多次调用<code>timeit</code>方法，并将结果返回为一个列表。参数<code>repeat</code>指定重复的次数，<code>number</code>是传递给<code>timeit</code>方法的<code>number</code>参数。</p>
<h3 id="print-exc"><a href="#print-exc" class="headerlink" title="print_exc"></a>print_exc</h3><p>&emsp;&emsp;<code>print_exc(file=None)</code>：输出计时代码中的<code>traceback</code>。典型用法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t = Timer(...)  <span class="comment"># 在“try/except”语句外使用</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    t.timeit(...)  <span class="comment"># 或t.repeat(...)</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    t.print_exc()</span><br></pre></td></tr></table></figure>
<p>这样做的好处是，可以将参数<code>file</code>直接定位到<code>traceback</code>，默认是<code>sys.stderr</code>。</p>
<h3 id="命令行接口方式"><a href="#命令行接口方式" class="headerlink" title="命令行接口方式"></a>命令行接口方式</h3><p>&emsp;&emsp;当在命令行方式执行时，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m timeit [-n N] [-r N] [-s S] [-t] [-c] [-h] [statement ...]</span><br></pre></td></tr></table></figure>
<p>详解如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>选项</th>
<th>原型</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n N</code></td>
<td><code>--number=N</code></td>
<td>执行指定语句(段)的次数</td>
</tr>
<tr>
<td><code>-r N</code></td>
<td><code>--repeat=N</code></td>
<td>重复测量的次数，默认是<code>3</code>次</td>
</tr>
<tr>
<td><code>-s S</code></td>
<td><code>--setup=S</code></td>
<td>执行时初始语句(默认是<code>pass</code>)</td>
</tr>
<tr>
<td><code>-p</code></td>
<td><code>--process</code></td>
<td>测量进程时间而不是实际执行时间(使用<code>time.process_time</code>代替默认的<code>time.perf_counter</code>)</td>
</tr>
<tr>
<td><code>-t</code></td>
<td><code>--time</code></td>
<td>使用<code>time.time</code>(默认除<code>Windows</code>外所有的操作系统)</td>
</tr>
<tr>
<td><code>-c</code></td>
<td><code>--clock</code></td>
<td>使用<code>time.clock</code>(默认只在<code>Windows</code>操作系统上执行)</td>
</tr>
<tr>
<td><code>-v</code></td>
<td><code>--verbose</code></td>
<td>打印原始的计时结果，输出更大精度的数值</td>
</tr>
<tr>
<td><code>-h</code></td>
<td><code>--help</code></td>
<td>打印一个简短的用法信息并退出</td>
</tr>
</tbody>
</table>
</div>
<h3 id="详细的例子"><a href="#详细的例子" class="headerlink" title="详细的例子"></a>详细的例子</h3><p>&emsp;&emsp;在开始时设置初始化语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python -m timeit -s <span class="string">'text = "sample string"; char = "g"'</span>  <span class="string">'char in text'</span></span><br><span class="line">10000000 loops, best of 3: 0.0936 usec per loop</span><br><span class="line">$ python -m timeit -s <span class="string">'text = "sample string"; char = "g"'</span>  <span class="string">'text.find(char)'</span></span><br><span class="line">1000000 loops, best of 3: 0.4 usec per loop</span><br></pre></td></tr></table></figure>
<p>使用<code>timeit</code>模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'char in text'</span>, setup=<span class="string">'text = "sample string"; char = "g"'</span>)</span><br><span class="line"><span class="number">0.1253384683015776</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'text.find(char)'</span>, setup=<span class="string">'text = "sample string"; char = "g"'</span>)</span><br><span class="line"><span class="number">0.5727204384393936</span></span><br></pre></td></tr></table></figure>
<p>同样可以用<code>Timer</code>类和它们的方法来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = timeit.Timer(<span class="string">'char in text'</span>, setup=<span class="string">'text = "sample string"; char = "g"'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.timeit()</span><br><span class="line"><span class="number">0.12571392650598057</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.repeat()</span><br><span class="line">[<span class="number">0.12860170469997456</span>, <span class="number">0.12690914937762443</span>, <span class="number">0.11270203329004858</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;下面的例子演示如何测量多行表达式的执行时间，这里主要比较<code>hasattr vs try/except</code>来测试缺省或存在两种情况下的对象属性的时间消耗：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python -m timeit <span class="string">'try:'</span> <span class="string">'  str.__nonzero__'</span> <span class="string">'except AttributeError:'</span> <span class="string">'  pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.86</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'if hasattr(str, "__nonzero__"): pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.22</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'try:'</span> <span class="string">'  int.__nonzero__'</span> <span class="string">'except AttributeError:'</span> <span class="string">'  pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.86</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'if hasattr(int, "__nonzero__"): pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.25</span> usec per loop</span><br></pre></td></tr></table></figure>
<p>使用<code>timeit</code>模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 属性缺省的情况</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">""" \</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    str.__nonzero__</span></span><br><span class="line"><span class="string">except AttributeError:</span></span><br><span class="line"><span class="string">    pass</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.08674410171410782</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"if hasattr(str, '__bool__'): pass"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.08676420027402543</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 属性存在的情况</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">""" \</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    int.__nonzero__</span></span><br><span class="line"><span class="string">except AttributeError:</span></span><br><span class="line"><span class="string">    pass</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.09908718327663735</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"if hasattr(int, '__bool__'): pass"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.028003708398131266</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果想让<code>timeit</code>模块测量你定义的函数，可以传递一个<code>setup</code>参数，该参数包括一个<code>import</code>语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    L = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        L.append(i)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> timeit</span><br><span class="line">    print(timeit.timeit(<span class="string">"test()"</span>, setup=<span class="string">"from __main__ import test"</span>))</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/socket模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/socket模块/" itemprop="url">socket模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T18:47:09+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="socket方法"><a href="#socket方法" class="headerlink" title="socket方法"></a>socket方法</h3><p>&emsp;&emsp;<code>socket</code>方法的原型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket(family, type[, protocal])</span><br></pre></td></tr></table></figure>
<p>使用给定的地址族、套接字类型、协议编号来创建套接字。<code>socket</code>类型如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>socket.AF_UNIX</code></td>
<td>只能够用于单一的Unix系统进程间通信</td>
</tr>
<tr>
<td><code>socket.AF_INET</code></td>
<td>服务器之间网络通信</td>
</tr>
<tr>
<td><code>socket.AF_INET6</code></td>
<td><code>IPv6</code></td>
</tr>
<tr>
<td><code>socket.SOCK_STREAM</code></td>
<td>流式<code>socket</code>(<code>for TCP</code>)</td>
</tr>
<tr>
<td><code>socket.SOCK_DGRAM</code></td>
<td>数据报式<code>socket</code>(<code>for UDP</code>)</td>
</tr>
<tr>
<td><code>socket.SOCK_RAW</code></td>
<td>原始套接字</td>
</tr>
<tr>
<td><code>socket.SOCK_SEQPACKET</code></td>
<td>可靠的连续数据包服务</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;创建<code>TCP Socket</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;创建<code>UDP Socket</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br></pre></td></tr></table></figure>
<h3 id="socket函数"><a href="#socket函数" class="headerlink" title="socket函数"></a>socket函数</h3><p>&emsp;&emsp;注意点以下几点：</p>
<ul>
<li><code>TCP</code>发送数据时，已建立好<code>TCP</code>连接，所以不需要指定地址。<code>UDP</code>是面向无连接的，每次发送要指定是发给地址。</li>
<li>服务端与客户端不能直接发送列表、元组、字典，需要将其字符串化(<code>repr(data)</code>)。</li>
</ul>
<p>&emsp;&emsp;服务端<code>socket</code>函数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s.bind(address)</code></td>
<td>将套接字绑定到地址，在<code>AF_INET</code>下，以元组<code>(host, port)</code>的形式表示地址</td>
</tr>
<tr>
<td><code>s.listen(backlog)</code></td>
<td>开始监听<code>TCP</code>传入连接。<code>backlog</code>指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为<code>1</code>，大部分应用程序设为<code>5</code>就可以了</td>
</tr>
<tr>
<td><code>s.accept()</code></td>
<td>接受<code>TCP</code>连接并返回<code>(conn, address)</code>，其中<code>conn</code>是新的套接字对象，可以用来接收和发送数据；<code>address</code>是连接客户端的地址</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;客户端<code>socket</code>函数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s.connect(address)</code></td>
<td>连接到<code>address</code>处的套接字。一般<code>address</code>的格式为元组<code>(hostname, port)</code>，如果连接出错，返回<code>socket.error</code>错误</td>
</tr>
<tr>
<td><code>s.connect_ex(adddress)</code></td>
<td>功能与<code>connect(address)</code>相同，但是成功返回<code>0</code>，失败返回<code>errno</code>的值</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;公共<code>socket</code>函数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s.recv(bufsize[, flag])</code></td>
<td>接受<code>TCP</code>套接字的数据。数据以字符串形式返回，<code>bufsize</code>指定要接收的最大数据量。<code>flag</code>提供有关消息的其他信息，通常可以忽略</td>
</tr>
<tr>
<td><code>s.send(string[, flag])</code></td>
<td>发送<code>TCP</code>数据。将<code>string</code>中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于<code>string</code>的字节大小</td>
</tr>
<tr>
<td><code>s.sendall(string[, flag])</code></td>
<td>完整发送<code>TCP</code>数据。将<code>string</code>中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功返回<code>None</code>，失败则抛出异常</td>
</tr>
<tr>
<td><code>s.recvfrom(bufsize[, flag])</code></td>
<td>接受<code>UDP</code>套接字的数据。与<code>recv</code>类似，但返回值是<code>(data, address)</code>。其中<code>data</code>是包含接收数据的字符串，<code>address</code>是发送数据的套接字地址</td>
</tr>
<tr>
<td><code>s.sendto(string[, flag], address)</code></td>
<td>发送<code>UDP</code>数据。将数据发送到套接字，<code>address</code>是形式为<code>(ipaddr, port)</code>的元组，指定远程地址。返回值是发送的字节数</td>
</tr>
<tr>
<td><code>s.close()</code></td>
<td>关闭套接字</td>
</tr>
<tr>
<td><code>s.getpeername()</code></td>
<td>返回连接套接字的远程地址。返回值通常是元组<code>(ipaddr, port)</code></td>
</tr>
<tr>
<td><code>s.getsockname()</code></td>
<td>返回套接字自己的地址。通常是一个元组<code>(ipaddr, port)</code></td>
</tr>
<tr>
<td><code>s.getsockopt(level, optname[, buflen])</code></td>
<td>返回套接字选项的值</td>
</tr>
<tr>
<td><code>s.settimeout(timeout)</code></td>
<td>设置套接字操作的超时期，<code>timeout</code>是一个浮点数，单位是秒。值为<code>None</code>表示没有超时期。一般超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作(例如<code>connect</code>函数)</td>
</tr>
<tr>
<td><code>s.gettimeout()</code></td>
<td>返回当前超时期的值，单位是秒。如果没有设置超时期，则返回<code>None</code></td>
</tr>
<tr>
<td><code>s.fileno()</code></td>
<td>返回套接字的文件描述符</td>
</tr>
<tr>
<td><code>s.setblocking(flag)</code></td>
<td>如果<code>flag</code>为<code>0</code>，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式(默认值)。非阻塞模式下，如果调用<code>recv</code>没有发现任何数据，或<code>send</code>调用无法立即发送数据，那么将引起<code>socket.error</code>异常</td>
</tr>
<tr>
<td><code>s.makefile()</code></td>
<td>创建一个与该套接字相关连的文件</td>
</tr>
<tr>
<td><code>s.setdefaulttimeout(timeout)</code></td>
<td>设置<code>Socket</code>默认超时时间，以秒计(<code>float</code>型)</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;<code>TCP</code>服务器端如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 创建socket对象</span></span><br><span class="line">serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">​</span><br><span class="line">host = socket.gethostname()  <span class="comment"># 获取本地主机名</span></span><br><span class="line">port = <span class="number">9999</span></span><br><span class="line">​</span><br><span class="line">serversocket.bind((host, port))</span><br><span class="line">serversocket.listen(<span class="number">5</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    clientsocket, addr = serversocket.accept()  <span class="comment"># 建立客户端连接</span></span><br><span class="line">    print(<span class="string">"连接地址: %s"</span> % str(addr))</span><br><span class="line">    msg = <span class="string">'欢迎访问菜鸟教程！'</span> + <span class="string">"\r\n"</span></span><br><span class="line">    clientsocket.send(msg.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    clientsocket.close()</span><br></pre></td></tr></table></figure>
<p><code>TCP</code>客户端如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">​</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">host = socket.gethostname()</span><br><span class="line">port = <span class="number">9999</span></span><br><span class="line">s.connect((host, port))</span><br><span class="line">msg = s.recv(<span class="number">1024</span>)  <span class="comment"># 接收小于1024字节的数据</span></span><br><span class="line">s.close()</span><br><span class="line">print(msg.decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<p>捕捉超时错误的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">​</span><br><span class="line">socket.setdefaulttimeout(<span class="number">0.01</span>)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sock.connect((<span class="string">"123123231"</span>, <span class="number">12345</span>))</span><br><span class="line"><span class="keyword">except</span> socket.timeout <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">"timeout"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>UDP</code>服务器如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line">host = <span class="string">"127.0.0.1"</span>  <span class="comment"># 服务器地址</span></span><br><span class="line">port = <span class="number">12345</span>  <span class="comment"># 服务器端口</span></span><br><span class="line">bufsiz = <span class="number">2048</span>  <span class="comment"># 缓存大小</span></span><br><span class="line">adds = (host, port)  <span class="comment"># 地址和端口</span></span><br><span class="line">​</span><br><span class="line">udpsersock = socket(AF_INET, SOCK_DGRAM)  <span class="comment"># 创建UDP的套接字类型</span></span><br><span class="line">udpsersock.bind(adds)  <span class="comment"># 绑定到地址和端口</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg = input(<span class="string">'服务器说：'</span>)  <span class="comment"># 输入数据</span></span><br><span class="line">    data, addc = udpsersock.recvfrom(bufsiz)</span><br><span class="line">    udpsersock.sendto(msg.encode(<span class="string">'utf-8'</span>), addc)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">'客户端回答：'</span>, data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">​</span><br><span class="line">udpsersock.close()</span><br></pre></td></tr></table></figure>
<p><code>UDP</code>客户端如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line">host = <span class="string">'localhost'</span>  <span class="comment"># 本地服务器地址</span></span><br><span class="line">port = <span class="number">12345</span>  <span class="comment"># 客户端端口(确保和服务器的端口一致)</span></span><br><span class="line">bufsiz = <span class="number">2048</span>  <span class="comment"># 缓存大小</span></span><br><span class="line">addc = (host, port)  <span class="comment"># 地址和端口</span></span><br><span class="line">​</span><br><span class="line">udpclisock = socket(AF_INET, SOCK_DGRAM)  <span class="comment"># 创建UDP的套接字类型</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg = input(<span class="string">'客户端说：'</span>)  <span class="comment"># 输入数据</span></span><br><span class="line">    udpclisock.sendto(msg.encode(<span class="string">'utf-8'</span>), addc)</span><br><span class="line">    data, adds = udpclisock.recvfrom(bufsiz)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">'服务器回答：'</span>, data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">​</span><br><span class="line">udpclisock.close()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>补充说明</strong>：<code>serversocket.bind((host, port))</code>的<code>host</code>参数最好用<code>IP</code>地址的字符串形式，例如<code>192.168.1.108</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/多线程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/多线程/" itemprop="url">多线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T18:00:09+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python 3</code>线程中常用的两个模块为<code>_thread</code>和<code>threading</code>，目前<code>thread</code>模块已被废弃。为了保持兼容性，<code>Python 3</code>将<code>thread</code>重命名为<code>_thread</code>。<br>&emsp;&emsp;<code>_thread</code>提供了低级别的、原始的线程以及一个简单的锁，它相比于<code>threading</code>模块的功能还是比较有限的。<code>threading</code>模块除了包含<code>_thread</code>模块中的所有方法外，还提供的其他方法：</p>
<ul>
<li><code>threading.currentThread</code>：返回当前的线程变量。</li>
<li><code>threading.enumerate</code>：返回一个包含正在运行的线程的<code>list</code>。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。</li>
<li><code>threading.activeCount</code>：返回正在运行的线程数量，与<code>len(threading.enumerate())</code>有相同的结果。</li>
</ul>
<p>&emsp;&emsp;<code>Python</code>使用线程有两种方式：函数或者用类来包装线程对象。</p>
<h3 id="函数式"><a href="#函数式" class="headerlink" title="函数式"></a>函数式</h3><p>&emsp;&emsp;调用<code>_thread</code>模块中的<code>start_new_thread</code>函数来产生新线程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_thread.start_new_thread(function, args[, kwargs])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>function</code>：线程函数。</li>
<li><code>args</code>：传递给线程函数的参数，必须是<code>tuple</code>类型。</li>
<li><code>kwargs</code>：可选参数。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_time</span><span class="params">(threadName, delay)</span>:</span>  <span class="comment"># 为线程定义一个函数</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; <span class="number">5</span>:</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"%s: %s"</span> % ( threadName, time.ctime(time.time()) ))</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:  <span class="comment"># 创建两个线程</span></span><br><span class="line">    _thread.start_new_thread(print_time, (<span class="string">"Thread-1"</span>, <span class="number">2</span>, ))</span><br><span class="line">    _thread.start_new_thread(print_time, (<span class="string">"Thread-2"</span>, <span class="number">4</span>, ))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Error: 无法启动线程"</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">33</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">35</span> <span class="number">2017</span></span><br></pre></td></tr></table></figure>
<h3 id="Thread类"><a href="#Thread类" class="headerlink" title="Thread类"></a>Thread类</h3><p>&emsp;&emsp;除了使用方法外，线程模块同样提供了<code>Thread</code>类来处理线程。<code>Thread</code>类提供了以下方法：</p>
<ul>
<li><code>run()</code>：用以表示线程活动的方法。</li>
<li><code>start()</code>：启动线程活动。</li>
<li><code>join([time])</code>：<code>join</code>的作用是保证当前线程执行完成后，再执行其它线程。<code>join</code>可以有<code>time</code>参数，表示阻塞其它线程<code>time</code>秒后，不再阻塞。</li>
<li><code>isAlive()</code>：返回线程是否活动的。</li>
<li><code>getName()</code>：返回线程名。</li>
<li><code>setName()</code>：设置线程名。</li>
</ul>
<p>&emsp;&emsp;可以通过直接从<code>threading.Thread</code>继承创建一个新的子类，实例化后调用<code>start</code>方法启动新线程，即它调用了线程的<code>run</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line">exitFlag = <span class="number">0</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadID, name, counter)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID = threadID</span><br><span class="line">        self.name = name</span><br><span class="line">        self.counter = counter</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"开始线程："</span> + self.name)</span><br><span class="line">        print_time(self.name, self.counter, <span class="number">5</span>)</span><br><span class="line">        print(<span class="string">"退出线程："</span> + self.name)</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_time</span><span class="params">(threadName, delay, counter)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> counter:</span><br><span class="line">        <span class="keyword">if</span> exitFlag:</span><br><span class="line">            threadName.exit()</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        print(<span class="string">"%s: %s"</span> % (threadName, time.ctime(time.time())))</span><br><span class="line">        counter -= <span class="number">1</span></span><br><span class="line">​</span><br><span class="line"><span class="comment"># 创建新线程</span></span><br><span class="line">thread1 = myThread(<span class="number">1</span>, <span class="string">"Thread-1"</span>, <span class="number">1</span>)</span><br><span class="line">thread2 = myThread(<span class="number">2</span>, <span class="string">"Thread-2"</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 开启新线程</span></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line">thread1.join()</span><br><span class="line">thread2.join()</span><br><span class="line">print(<span class="string">"退出主线程"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">开始线程：Thread<span class="number">-1</span></span><br><span class="line">开始线程：Thread<span class="number">-2</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">28</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">30</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">32</span> <span class="number">2017</span></span><br><span class="line">退出线程：Thread<span class="number">-1</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">33</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">35</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">37</span> <span class="number">2017</span></span><br><span class="line">退出线程：Thread<span class="number">-2</span></span><br><span class="line">退出主线程</span><br></pre></td></tr></table></figure>
<h3 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h3><p>&emsp;&emsp;如果多个线程共同对某个数据修改，则可能出现不可预料的结果。为了保证数据的正确性，需要对多个线程进行同步。<br>&emsp;&emsp;使用<code>Thread</code>对象的<code>Lock</code>和<code>Rlock</code>可以实现简单的线程同步，这两个对象都有<code>acquire</code>方法和<code>release</code>方法。对于那些需要每次只允许一个线程操作的数据，可以将其操作放到<code>acquire</code>和<code>release</code>方法之间。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadID, name, counter)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID = threadID</span><br><span class="line">        self.name = name</span><br><span class="line">        self.counter = counter</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"开启线程: "</span> + self.name)</span><br><span class="line">        threadLock.acquire()  <span class="comment"># 获取锁，用于线程同步</span></span><br><span class="line">        print_time(self.name, self.counter, <span class="number">3</span>)</span><br><span class="line">        threadLock.release()  <span class="comment"># 释放锁，开启下一个线程</span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_time</span><span class="params">(threadName, delay, counter)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> counter:</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        print(<span class="string">"%s: %s"</span> % (threadName, time.ctime(time.time())))</span><br><span class="line">        counter -= <span class="number">1</span></span><br><span class="line">​</span><br><span class="line">threadLock = threading.Lock()</span><br><span class="line">threads = []</span><br><span class="line"><span class="comment"># 创建新线程</span></span><br><span class="line">thread1 = myThread(<span class="number">1</span>, <span class="string">"Thread-1"</span>, <span class="number">1</span>)</span><br><span class="line">thread2 = myThread(<span class="number">2</span>, <span class="string">"Thread-2"</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 开启新线程</span></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"><span class="comment"># 添加线程到线程列表</span></span><br><span class="line">threads.append(thread1)</span><br><span class="line">threads.append(thread2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:  <span class="comment"># 等待所有线程完成</span></span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"退出主线程"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">开启线程: Thread<span class="number">-1</span></span><br><span class="line">开启线程: Thread<span class="number">-2</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">21</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">22</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">23</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">25</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">27</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">退出主线程</span><br></pre></td></tr></table></figure>
<h3 id="线程优先级队列"><a href="#线程优先级队列" class="headerlink" title="线程优先级队列"></a>线程优先级队列</h3><p>&emsp;&emsp;<code>Python</code>的<code>Queue</code>模块提供了同步的、线程安全的队列类，包括<code>FIFO</code>队列<code>Queue</code>、<code>LIFO</code>队列<code>LifoQueue</code>和优先级队列<code>PriorityQueue</code>。这些队列都实现了锁原语，能够在多线程中直接使用，可以使用队列来实现线程间的同步。<code>Queue</code>模块中的常用方法:</p>
<ul>
<li><code>Queue.qsize()</code>：返回队列的大小</li>
<li><code>Queue.empty()</code>：如果队列为空，返回<code>True</code>，否则<code>False</code>。</li>
<li><code>Queue.full()</code>：如果队列满了，返回<code>True</code>，否则<code>False</code>。</li>
<li><code>Queue.get([block[, timeout]])</code>：获取队列，<code>timeout</code>是等待时间。</li>
<li><code>Queue.get_nowait()</code>：相<code>当Queue.get(False)</code>。</li>
<li><code>Queue.put(item[, timeout])</code>：写入队列，<code>timeout</code>是等待时间。</li>
<li><code>Queue.put_nowait(item)</code>：相当<code>Queue.put(item, False)</code>。</li>
<li><code>Queue.task_done()</code>：在完成一项工作之后，<code>Queue.task_done</code>函数向任务已经完成的队列发送一个信号。</li>
<li><code>Queue.join()</code>：实际上意味着等到队列为空，再执行别的操作。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line">exitFlag = <span class="number">0</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadID, name, q)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID = threadID</span><br><span class="line">        self.name = name</span><br><span class="line">        self.q = q</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"开启线程："</span> + self.name)</span><br><span class="line">        process_data(self.name, self.q)</span><br><span class="line">        print(<span class="string">"退出线程："</span> + self.name)</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_data</span><span class="params">(threadName, q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> exitFlag:</span><br><span class="line">        queueLock.acquire()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> workQueue.empty():</span><br><span class="line">            data = q.get()</span><br><span class="line">            queueLock.release()</span><br><span class="line">            print(<span class="string">"%s processing %s"</span> % (threadName, data))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            queueLock.release()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">​</span><br><span class="line">threadList = [<span class="string">"Thread-1"</span>, <span class="string">"Thread-2"</span>, <span class="string">"Thread-3"</span>]</span><br><span class="line">nameList = [<span class="string">"One"</span>, <span class="string">"Two"</span>, <span class="string">"Three"</span>, <span class="string">"Four"</span>, <span class="string">"Five"</span>]</span><br><span class="line">queueLock = threading.Lock()</span><br><span class="line">workQueue = queue.Queue(<span class="number">10</span>)</span><br><span class="line">threads = []</span><br><span class="line">threadID = <span class="number">1</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> tName <span class="keyword">in</span> threadList:  <span class="comment"># 创建新线程</span></span><br><span class="line">    thread = myThread(threadID, tName, workQueue)</span><br><span class="line">    thread.start()</span><br><span class="line">    threads.append(thread)</span><br><span class="line">    threadID += <span class="number">1</span></span><br><span class="line">​</span><br><span class="line">queueLock.acquire()  <span class="comment"># 填充队列</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> nameList:</span><br><span class="line">    workQueue.put(word)</span><br><span class="line">​</span><br><span class="line">queueLock.release()</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> workQueue.empty():  <span class="comment"># 等待队列清空</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">exitFlag = <span class="number">1</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:  <span class="comment"># 等待所有线程完成</span></span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"退出主线程"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">开启线程：Thread<span class="number">-1</span></span><br><span class="line">开启线程：Thread<span class="number">-2</span></span><br><span class="line">开启线程：Thread<span class="number">-3</span></span><br><span class="line">Thread<span class="number">-3</span> processing One</span><br><span class="line">Thread<span class="number">-2</span> processing Two</span><br><span class="line">Thread<span class="number">-1</span> processing Three</span><br><span class="line">Thread<span class="number">-3</span> processing Four</span><br><span class="line">Thread<span class="number">-1</span> processing Five</span><br><span class="line">退出线程：Thread<span class="number">-2</span></span><br><span class="line">退出线程：Thread<span class="number">-3</span></span><br><span class="line">退出线程：Thread<span class="number">-1</span></span><br><span class="line">退出主线程</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/打印和条件分支/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/打印和条件分支/" itemprop="url">打印和条件分支</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T16:31:56+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h3><p>&emsp;&emsp;在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"I love python!"</span>)  <span class="comment"># 输出“I love python”</span></span><br><span class="line">print(<span class="number">5</span> + <span class="number">3</span>)  <span class="comment"># 输出“8”</span></span><br><span class="line">print(<span class="string">"well water"</span> + <span class="string">" river"</span>)  <span class="comment"># 输出“well water river”</span></span><br><span class="line">print(<span class="string">"I lover python"</span> * <span class="number">8</span>)  <span class="comment"># 输出“I lover python”8次</span></span><br><span class="line">print(<span class="string">"I lover python\n"</span> * <span class="number">8</span>)  <span class="comment"># 输出“I lover python”8次，带换行</span></span><br><span class="line">dec_Dumber = <span class="number">12.3456</span></span><br><span class="line">print(<span class="string">'It is %.2f degrees today.'</span> % dec_Dumber)  <span class="comment"># 输出“It is 12.35 degrees today.”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;猜数字游戏：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> guess == <span class="number">8</span>:</span><br><span class="line">    print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"No! you are wrong!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>print</code>函数具有重定向的功能。对于<code>python 2</code>，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logfile  = open(<span class="string">'/tmp/mylog.log'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">print</span> &gt;&gt; logfile, <span class="string">'writeen by python version 2'</span></span><br><span class="line">logfile.close()</span><br></pre></td></tr></table></figure>
<p>查看文件<code>/tmp/mylog.log</code>，其内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeen by python version <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>对于<code>python 3</code>，<code>print</code>重定向方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'mylog.log'</span>, <span class="string">'w'</span>)</span><br><span class="line">print(<span class="string">'writeen by python version 3'</span>, file=f)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>查看文件<code>mylog.log</code>，其内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeen by python version <span class="number">3</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="条件分支"><a href="#条件分支" class="headerlink" title="条件分支"></a>条件分支</h3><p>&emsp;&emsp;在终端输入<code>1 &lt; 3</code>，则输出<code>True</code>；输入<code>2 &gt; 3</code>，则输出<code>False</code>。<br>&emsp;&emsp;<code>Python</code>的条件分支语句(注意这里的缩进关系)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件:</span><br><span class="line">    条件为真(<span class="keyword">True</span>)执行的操作</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    条件为假(<span class="keyword">False</span>)执行的操作</span><br></pre></td></tr></table></figure>
<p>对小游戏的改进：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> guess == <span class="number">8</span>:</span><br><span class="line">    print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line">    print(<span class="string">"But, there is not a reward!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> guess &gt; <span class="number">8</span>:</span><br><span class="line">        print(<span class="string">"The number is bigger!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"The number is litter!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p><code>Python</code>是靠缩进来确定分支关系，不像<code>C</code>语言那样需要大括号来确定关系。<br>&emsp;&emsp;<code>Python</code>的<code>while</code>循环语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件:</span><br><span class="line">    条件为真(<span class="keyword">True</span>)执行的操作</span><br></pre></td></tr></table></figure>
<p>对小游戏的改进：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> guess != <span class="number">8</span>:</span><br><span class="line">    temp = input(<span class="string">"Oh! This is wrong! Please input a number: "</span>)</span><br><span class="line">    guess = int(temp)</span><br><span class="line">    <span class="keyword">if</span> guess == <span class="number">8</span>:</span><br><span class="line">        print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line">        print(<span class="string">"But, there is not a reward!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> guess &gt; <span class="number">8</span>:</span><br><span class="line">            print(<span class="string">"The number is bigger!"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"The number is litter!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>Python</code>的<code>and</code>逻辑操作符可以将任意表达式连接在一起，并得到一个布尔类型的值。在终端输入<code>3&gt;2 and 1&lt;2</code>，则输出<code>True</code>。在终端输入<code>(3&gt;2) and (1&lt;2)</code>，同样输出<code>True</code>，只不过这样更加明确了运算的优先级。<br>&emsp;&emsp;我们希望每次程序产生的答案是随机的，于是需要引入外援<code>random</code>模块。这个<code>random</code>模块里边有一个函数叫做<code>randint</code>，它会返回一个随机的整数。改进程序如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">​</span><br><span class="line">secret = random.randint(<span class="number">1</span>, <span class="number">10</span>)  <span class="comment"># 产生一个1到10的随机数</span></span><br><span class="line">​</span><br><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> guess != secret:</span><br><span class="line">    temp = input(<span class="string">"Oh! This is wrong! Please input a number: "</span>)</span><br><span class="line">    guess = int(temp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> guess == secret:</span><br><span class="line">        print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line">        print(<span class="string">"But, there is not a reward!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> guess &gt; secret:</span><br><span class="line">            print(<span class="string">"The number is bigger!"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"The number is litter!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;判断成绩的程序如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">score = int(input(<span class="string">"Please input a number: "</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">100</span> &gt;= score &gt;= <span class="number">90</span>:</span><br><span class="line">    print(<span class="string">'A'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">90</span> &gt; score &gt;= <span class="number">80</span>:  <span class="comment"># else if</span></span><br><span class="line">    print(<span class="string">'B'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">80</span> &gt; score &gt;= <span class="number">60</span>:</span><br><span class="line">    print(<span class="string">'C'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">60</span> &gt; score &gt;= <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">'D'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'输入错误!'</span>)</span><br></pre></td></tr></table></figure>
<p><code>Python</code>可以有效地避免悬挂<code>else</code>，即<code>C</code>语言中的<code>else</code>匹配问题。</p>
<h4 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h4><p>&emsp;&emsp;条件表达式类似于<code>C</code>语言的三元操作符：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x, y = <span class="number">4</span>, <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x &lt; y:</span><br><span class="line">    small = x</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    small = y</span><br></pre></td></tr></table></figure>
<p>可以被改进为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">small = x <span class="keyword">if</span> x &lt; y <span class="keyword">else</span> y</span><br></pre></td></tr></table></figure>
<h4 id="and、or、not"><a href="#and、or、not" class="headerlink" title="and、or、not"></a>and、or、not</h4><ul>
<li><code>and</code>：<code>x and y</code>返回的结果是决定表达式结果的值。如果<code>x</code>为真，则<code>y</code>决定结果，返回<code>y</code>；如果<code>x</code>为假，<code>x</code>决定了结果为假，返回<code>x</code>。</li>
<li><code>or</code>：<code>x or y</code>中其中一个为真，则整个表达式为真。</li>
<li><code>not</code>：返回表达式结果的<code>相反的值</code>。如果表达式结果为真，则返回<code>false</code>；如果表达式结果为假，则返回<code>true</code>。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><span class="space">&hellip;</span><a class="page-number" href="/page/95/">95</a><a class="extend next" rel="next" href="/page/28/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">943</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
