<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="暴徒">
<meta property="og:url" content="http://fukangwei.gitee.io/page/27/index.html">
<meta property="og:site_name" content="暴徒">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="暴徒">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/page/27/">





  <title>暴徒</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">暴徒</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/tempfile模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/tempfile模块/" itemprop="url">tempfile模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T21:33:45+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="tempfile-Generate-temporary-files-and-directories"><a href="#tempfile-Generate-temporary-files-and-directories" class="headerlink" title="tempfile: Generate temporary files and directories"></a>tempfile: Generate temporary files and directories</h3><p>&emsp;&emsp;This module creates temporary files and directories. It works on all supported platforms. <code>TemporaryFile</code>, <code>NamedTemporaryFile</code>, <code>TemporaryDirectory</code>, and <code>SpooledTemporaryFile</code> are <code>high-level</code> interfaces which provide automatic cleanup and can be used as context managers. <code>mkstemp()</code> and <code>mkdtemp()</code> are <code>lower-level</code> functions which require manual cleanup.<br>&emsp;&emsp;All the <code>user-callable</code> functions and constructors take additional arguments which allow direct control over the location and name of temporary files and directories. Files names used by this module include a string of random characters which allows those files to be securely created in shared temporary directories. To maintain backward compatibility, the argument order is somewhat odd; it is recommended to use keyword arguments for clarity.<br>&emsp;&emsp;The module defines the following <code>user-callable</code> items:<br>&emsp;&emsp;<code>tempfile.TemporaryFile(mode=&#39;w+b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None)</code>: Return a <code>file-like</code> object that can be used as a temporary storage area. The file is created securely, using the same rules as <code>mkstemp()</code>. It will be destroyed as soon as it is closed (including an implicit close when the object is garbage collected). Under <code>Unix</code>, the directory entry for the file is either not created at all or is removed immediately after the file is created. Other platforms do not support this; your code should not rely on a temporary file created using this function having or not having a visible name in the file system.<br>&emsp;&emsp;The resulting object can be used as a context manager. On completion of the context or destruction of the file object the temporary file will be removed from the filesystem.<br>&emsp;&emsp;The <code>mode</code> parameter defaults to <code>w+b</code> so that the file created can be read and written without being closed. Binary mode is used so that it behaves consistently on all platforms without regard for the data that is stored. <code>buffering</code>, <code>encoding</code> and <code>newline</code> are interpreted as for <code>open()</code>.<br>&emsp;&emsp;The <code>dir</code>, <code>prefix</code> and <code>suffix</code> parameters have the same meaning and defaults as with <code>mkstemp()</code>.<br>&emsp;&emsp;The returned object is a true file object on <code>POSIX</code> platforms. On other platforms, it is a <code>file-like</code> object whose file attribute is the underlying true file object.<br>&emsp;&emsp;<code>tempfile.NamedTemporaryFile(mode=&#39;w+b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None, delete=True)</code>: This function operates exactly as <code>TemporaryFile()</code> does, except that the file is guaranteed to have a visible name in the file system (on <code>Unix</code>, the directory entry is not unlinked). That name can be retrieved from the name attribute of the returned <code>file-like</code> object. Whether the name can be used to open the file a second time, while the named temporary file is still open, varies across platforms (it can be so used on <code>Unix</code>; it cannot on <code>Windows NT</code> or later). If delete is <code>true</code> (the default), the file is deleted as soon as it is closed. The returned object is always a <code>file-like</code> object whose file attribute is the underlying true file object. This <code>file-like</code> object can be used in a with statement, just like a normal file.<br>&emsp;&emsp;<code>tempfile.SpooledTemporaryFile(max_size=0, mode=&#39;w+b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None)</code>: This function operates exactly as <code>TemporaryFile()</code> does, except that data is spooled in memory until the file size exceeds <code>max_size</code>, or until the file’s <code>fileno()</code> method is called, at which point the contents are written to disk and operation proceeds as with <code>TemporaryFile()</code>.<br>&emsp;&emsp;The resulting file has one additional method, <code>rollover()</code>, which causes the file to roll over to an <code>on-disk</code> file regardless of its size.<br>&emsp;&emsp;The returned object is a <code>file-like</code> object whose <code>_file</code> attribute is either an <code>io.BytesIO</code> or <code>io.StringIO</code> object (depending on whether binary or text mode was specified) or a true file object, depending on whether <code>rollover()</code> has been called. This <code>file-like</code> object can be used in a with statement, just like a normal file.<br>&emsp;&emsp;<code>tempfile.TemporaryDirectory(suffix=None, prefix=None, dir=None)</code>: This function securely creates a temporary directory using the same rules as <code>mkdtemp()</code>. The resulting object can be used as a context manager. On completion of the context or destruction of the temporary directory object the newly created temporary directory and all its contents are removed from the filesystem.<br>&emsp;&emsp;The directory name can be retrieved from the name attribute of the returned object. When the returned object is used as a context manager, the name will be assigned to the target of the as clause in the with statement, if there is one.<br>&emsp;&emsp;The directory can be explicitly cleaned up by calling the <code>cleanup()</code> method.<br>&emsp;&emsp;<code>tempfile.mkstemp(suffix=None, prefix=None, dir=None, text=False)</code>: Creates a temporary file in the most secure manner possible. There are no race conditions in the file’s creation, assuming that the platform properly implements the <code>os.O_EXCL</code> flag for <code>os.open()</code>. The file is readable and writable only by the creating <code>user ID</code>. If the platform uses permission bits to indicate whether a file is executable, the file is executable by no one. The file descriptor is not inherited by child processes.<br>&emsp;&emsp;Unlike <code>TemporaryFile()</code>, the user of <code>mkstemp()</code> is responsible for deleting the temporary file when done with it.<br>&emsp;&emsp;If <code>suffix</code> is not None, the file name will end with that <code>suffix</code>, otherwise there will be no suffix. <code>mkstemp()</code> does not put a dot between the file name and the suffix; if you need one, put it at the beginning of <code>suffix</code>.<br>&emsp;&emsp;If <code>prefix</code> is not None, the file name will begin with that <code>prefix</code>; otherwise, a default prefix is used. The default is the return value of <code>gettempprefix()</code> or <code>gettempprefixb()</code>, as appropriate.<br>&emsp;&emsp;If <code>dir</code> is not None, the file will be created in that directory; otherwise, a default directory is used. The default directory is chosen from a <code>platform-dependent</code> list, but the user of the application can control the directory location by setting the <code>TMPDIR</code>, <code>TEMP</code> or <code>TMP</code> environment variables. There is thus no guarantee that the generated filename will have any nice properties, such as not requiring quoting when passed to external commands via <code>os.popen()</code>.<br>&emsp;&emsp;If any of <code>suffix</code>, <code>prefix</code>, and <code>dir</code> are not None, they must be the same type. If they are bytes, the returned name will be bytes instead of str. If you want to force a bytes return value with otherwise default behavior, pass <code>suffix=b&#39;&#39;</code>.<br>&emsp;&emsp;If <code>text</code> is specified, it indicates whether to open the file in binary mode (the default) or text mode. On some platforms, this makes no difference.<br>&emsp;&emsp;<code>mkstemp()</code> returns a tuple containing an <code>OS-level</code> handle to an open file (as would be returned by <code>os.open()</code>) and the absolute pathname of that file, in that order.<br>&emsp;&emsp;<code>tempfile.mkdtemp(suffix=None, prefix=None, dir=None)</code>: Creates a temporary directory in the most secure manner possible. There are no race conditions in the directory’s creation. The directory is readable, writable, and searchable only by the creating <code>user ID</code>.<br>&emsp;&emsp;The user of <code>mkdtemp()</code> is responsible for deleting the temporary directory and its contents when done with it.<br>&emsp;&emsp;The <code>prefix</code>, <code>suffix</code>, and dir arguments are the same as for <code>mkstemp()</code>.<br>&emsp;&emsp;<code>mkdtemp()</code> returns the absolute pathname of the new directory.<br>&emsp;&emsp;<code>tempfile.gettempdir()</code>: Return the name of the directory used for temporary files. This defines the default value for the dir argument to all functions in this module.<br>&emsp;&emsp;Python searches a standard list of directories to find one which the calling user can create files in. The list is:</p>
<ul>
<li>The directory named by the <code>TMPDIR</code> environment variable.</li>
<li>The directory named by the <code>TEMP</code> environment variable.</li>
<li>The directory named by the <code>TMP</code> environment variable.</li>
<li>A platform-specific location:</li>
</ul>
<ol>
<li>On <code>Windows</code>, the directories <code>C:\TEMP</code>, <code>C:\TMP</code>, <code>\TEMP</code>, and <code>\TMP</code>, in that order.</li>
<li>On all other platforms, the directories <code>/tmp</code>, <code>/var/tmp</code>, and <code>/usr/tmp</code>, in that order.</li>
</ol>
<ul>
<li>As a last resort, the current working directory.</li>
</ul>
<p>&emsp;&emsp;<code>tempfile.gettempdirb()</code>: Same as <code>gettempdir()</code> but the return value is in bytes.<br>&emsp;&emsp;<code>tempfile.gettempprefix()</code>: Return the filename prefix used to create temporary files. This does not contain the directory component.<br>&emsp;&emsp;<code>tempfile.gettempprefixb()</code>: Same as <code>gettempprefix()</code> but the return value is in bytes.<br>&emsp;&emsp;The module uses a global variable to store the name of the directory used for temporary files returned by <code>gettempdir()</code>. It can be set directly to override the selection process, but this is discouraged. All functions in this module take a dir argument which can be used to specify the directory and this is the recommended approach.<br>&emsp;&emsp;<code>tempfile.tempdir</code>: When set to a value other than <code>None</code>, this variable defines the default value for the dir argument to the functions defined in this module.<br>&emsp;&emsp;If <code>tempdir</code> is unset or <code>None</code> at any call to any of the above functions except <code>gettempprefix()</code> it is initialized following the algorithm described in <code>gettempdir()</code>.</p>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p>&emsp;&emsp;Here are some examples of typical usage of the tempfile module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># create a temporary file and write some data to it</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp = tempfile.TemporaryFile()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.write(<span class="string">b'Hello world!'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.seek(<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.read()  <span class="comment"># read data from file</span></span><br><span class="line"><span class="string">b'Hello world!'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.close()  <span class="comment"># close the file, it will be removed</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># create a temporary file using a context manager</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> tempfile.TemporaryFile() <span class="keyword">as</span> fp:</span><br><span class="line"><span class="meta">... </span>    fp.write(<span class="string">b'Hello world!'</span>)</span><br><span class="line"><span class="meta">... </span>    fp.seek(<span class="number">0</span>)</span><br><span class="line"><span class="meta">... </span>    fp.read()</span><br><span class="line"><span class="string">b'Hello world!'</span></span><br><span class="line"><span class="comment"># file is now closed and removed</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># create a temporary directory using the context manager</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> tempfile.TemporaryDirectory() <span class="keyword">as</span> tmpdirname:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'created temporary directory'</span>, tmpdirname)</span><br><span class="line"><span class="comment"># directory and contents have been removed</span></span><br></pre></td></tr></table></figure>
<h3 id="Deprecated-functions-and-variables"><a href="#Deprecated-functions-and-variables" class="headerlink" title="Deprecated functions and variables"></a>Deprecated functions and variables</h3><p>&emsp;&emsp;A historical way to create temporary files was to first generate a file name with the <code>mktemp()</code> function and then create a file using this name. Unfortunately this is not secure, because a different process may create a file with this name in the time between the call to <code>mktemp()</code> and the subsequent attempt to create the file by the first process. The solution is to combine the two steps and create the file immediately. This approach is used by <code>mkstemp()</code> and the other functions described above.<br>&emsp;&emsp;<code>tempfile.mktemp(suffix=&#39;&#39;, prefix=&#39;tmp&#39;, dir=None)</code>: Deprecated since <code>version 2.3</code>: Use <code>mkstemp()</code> instead.<br>&emsp;&emsp;Return an absolute pathname of a file that did not exist at the time the call is made. The <code>prefix</code>, <code>suffix</code>, and <code>dir</code> arguments are similar to those of <code>mkstemp()</code>, except that bytes file names, <code>suffix=None</code> and <code>prefix=None</code> are not supported.<br>&emsp;&emsp;<strong>Warning</strong>: Use of this function may introduce a security hole in your program. By the time you get around to doing anything with the file name it returns, someone else may have beaten you to the punch. <code>mktemp()</code> usage can be replaced easily with <code>NamedTemporaryFile()</code>, passing it the <code>delete=False</code> parameter:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = NamedTemporaryFile(delete=<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.name</span><br><span class="line"><span class="string">'/tmp/tmptjujjt'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">b"Hello World!\n"</span>)</span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.unlink(f.name)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.exists(f.name)</span><br><span class="line"><span class="keyword">False</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/datetime模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/datetime模块/" itemprop="url">datetime模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T21:14:50+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>datetime</code>是<code>Python</code>处理日期和时间的标准库。</p>
<h3 id="获取当前日期和时间"><a href="#获取当前日期和时间" class="headerlink" title="获取当前日期和时间"></a>获取当前日期和时间</h3><p>&emsp;&emsp;先看如何获取当前日期和时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()  <span class="comment"># 获取当前datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(now)</span><br><span class="line"><span class="number">2018</span><span class="number">-04</span><span class="number">-20</span> <span class="number">17</span>:<span class="number">28</span>:<span class="number">22.173096</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(now))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="获取指定日期和时间"><a href="#获取指定日期和时间" class="headerlink" title="获取指定日期和时间"></a>获取指定日期和时间</h3><p>&emsp;&emsp;要指定某个日期和时间，我们直接用参数构造一个<code>datetime</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>)  <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="datetime转换为timestamp"><a href="#datetime转换为timestamp" class="headerlink" title="datetime转换为timestamp"></a>datetime转换为timestamp</h3><p>&emsp;&emsp;在计算机中，时间实际上是用数字表示的。我们把<code>1970年1月1日 00:00:00 UTC+00:00时区</code>的时刻称为<code>epoch time</code>，记为<code>0</code>(<code>1970</code>年以前的时间<code>timestamp</code>为负数)。当前时间就是相对于<code>epoch time</code>的秒数，称为<code>timestamp</code>。你可以认为<code>timestamp = 0 = 1970-1-1 00:00:00 UTC+0:00</code>，对应的北京时间是<code>timestamp = 0 = 1970-1-1 08:00:00 UTC+8:00</code>。可见<code>timestamp</code>的值与时区毫无关系，因为<code>timestamp</code>一旦确定，其<code>UTC</code>时间就确定了，转换到任意时区的时间也是完全确定的，这就是为什么计算机存储的当前时间是以<code>timestamp</code>表示的，因为全球各地的计算机在任意时刻的<code>timestamp</code>都是完全相同的(假定时间已校准)。<br>&emsp;&emsp;把一个<code>datetime</code>类型转换为<code>timestamp</code>只需要简单调用<code>timestamp</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>)  <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.timestamp()  <span class="comment"># 把datetime转换为timestamp</span></span><br><span class="line"><span class="number">1429417200.0</span></span><br></pre></td></tr></table></figure>
<p>注意<code>Python</code>的<code>timestamp</code>是一个浮点数。如果有小数位，小数位表示毫秒数。某些编程语言(如<code>Java</code>和<code>JavaScript</code>)的<code>timestamp</code>使用整数表示毫秒数，这种情况下只需要把<code>timestamp</code>除以<code>1000</code>就得到<code>Python</code>的浮点表示方法。</p>
<h3 id="timestamp转换为datetime"><a href="#timestamp转换为datetime" class="headerlink" title="timestamp转换为datetime"></a>timestamp转换为datetime</h3><p>&emsp;&emsp;要把<code>timestamp</code>转换为<code>datetime</code>，使用<code>datetime</code>提供的<code>fromtimestamp</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="number">1429417200.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.fromtimestamp(t))</span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<p>注意到<code>timestamp</code>是一个浮点数，它没有时区的概念，而<code>datetime</code>是有时区的。上述转换是在<code>timestamp</code>和本地时间做转换。<br>&emsp;&emsp;本地时间是指当前操作系统设定的时区。例如北京时区是东<code>8</code>区，则本地时间<code>2015-04-19 12:20:00</code>，实际上就是<code>UTC+8:00时区</code>的时间<code>2015-04-19 12:20:00 UTC+8:00</code>。<br>&emsp;&emsp;<code>timestamp</code>也可以直接被转换到<code>UTC</code>标准时区的时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="number">1429417200.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.fromtimestamp(t))  <span class="comment"># 本地时间</span></span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.utcfromtimestamp(t))  <span class="comment"># UTC时间</span></span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">04</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="str转换为datetime"><a href="#str转换为datetime" class="headerlink" title="str转换为datetime"></a>str转换为datetime</h3><p>&emsp;&emsp;很多时候，用户输入的日期和时间是字符串，要处理日期和时间，首先必须把<code>str</code>转换为<code>datetime</code>。转换方法是通过<code>datetime.strptime</code>实现，需要一个日期和时间的格式化字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cday = datetime.strptime(<span class="string">'2015-6-1 18:19:59'</span>, <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(cday)</span><br><span class="line"><span class="number">2015</span><span class="number">-06</span><span class="number">-01</span> <span class="number">18</span>:<span class="number">19</span>:<span class="number">59</span></span><br></pre></td></tr></table></figure>
<p>字符串<code>%Y-%m-%d %H:%M:%S</code>规定了日期和时间部分的格式。注意转换后的<code>datetime</code>是没有时区信息的。</p>
<h3 id="datetime转换为str"><a href="#datetime转换为str" class="headerlink" title="datetime转换为str"></a>datetime转换为str</h3><p>&emsp;&emsp;如果已经有了<code>datetime</code>对象，要把它格式化为字符串显示给用户，就需要转换为<code>str</code>，转换方法是通过<code>strftime</code>实现的，同样需要一个日期和时间的格式化字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(now.strftime(<span class="string">'%a, %b %d %H:%M'</span>))</span><br><span class="line">Mon, May <span class="number">05</span> <span class="number">16</span>:<span class="number">28</span></span><br></pre></td></tr></table></figure>
<h3 id="datetime加减"><a href="#datetime加减" class="headerlink" title="datetime加减"></a>datetime加减</h3><p>&emsp;&emsp;对日期和时间进行加减实际上就是把<code>datetime</code>往后或往前计算，得到新的<code>datetime</code>。加减可以直接用<code>+</code>和<code>-</code>运算符，不过需要导入<code>timedelta</code>这个类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now + timedelta(hours=<span class="number">10</span>)</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now - timedelta(days=<span class="number">1</span>)</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">17</span>, <span class="number">16</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now + timedelta(days=<span class="number">2</span>, hours=<span class="number">12</span>)</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">4</span>, <span class="number">57</span>, <span class="number">3</span>, <span class="number">540997</span>)</span><br></pre></td></tr></table></figure>
<p>可见，使用<code>timedelta</code>可以很容易地算出前几天和后几天的时刻。</p>
<h3 id="本地时间转换为UTC时间"><a href="#本地时间转换为UTC时间" class="headerlink" title="本地时间转换为UTC时间"></a>本地时间转换为UTC时间</h3><p>&emsp;&emsp;本地时间是指系统设定时区的时间，例如北京时间是<code>UTC+8:00时区</code>的时间，而<code>UTC</code>时间指<code>UTC+0:00时区</code>的时间。<br>&emsp;&emsp;一个<code>datetime</code>类型有一个时区属性<code>tzinfo</code>，但是默认为<code>None</code>，所以无法区分这个<code>datetime</code>到底是哪个时区，除非强行给<code>datetime</code>设置一个时区：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tz_utc_8 = timezone(timedelta(hours=<span class="number">8</span>))  <span class="comment"># 创建时区UTC+8:00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">17</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">871012</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = now.replace(tzinfo=tz_utc_8)  <span class="comment"># 强制设置为UTC+8:00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt</span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">17</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">871012</span>, tzinfo=datetime.timezone(datetime.timedelta(<span class="number">0</span>, <span class="number">28800</span>)))</span><br></pre></td></tr></table></figure>
<p>如果系统时区恰好是<code>UTC+8:00</code>，那么上述代码就是正确的，否则不能强制设置为<code>UTC+8:00时区</code>。</p>
<h3 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h3><p>&emsp;&emsp;我们可以先通过<code>utcnow</code>拿到当前的<code>UTC</code>时间，再转换为任意时区的时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 拿到UTC时间，并强制设置时区为“UTC+0:00”</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>utc_dt = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(utc_dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">09</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># astimezone将转换时区为北京时间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bj_dt = utc_dt.astimezone(timezone(timedelta(hours=<span class="number">8</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(bj_dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># astimezone将转换时区为东京时间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo_dt = utc_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(tokyo_dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">18</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">09</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># astimezone将bj_dt转换时区为东京时间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo_dt2 = bj_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(tokyo_dt2)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">18</span>:<span class="number">05</span>:<span class="number">12.377316</span>+<span class="number">09</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<p>时区转换的关键在于，拿到一个<code>datetime</code>时，要获知其正确的时区，然后强制设置时区，作为基准时间。利用带时区的<code>datetime</code>，通过<code>astimezone</code>方法，可以转换到任意时区。<br>&emsp;&emsp;注意，不是必须从<code>UTC+0:00时区</code>转换到其他时区，任何带时区的<code>datetime</code>都可以正确转换，例如上述<code>bj_dt</code>到<code>tokyo_dt</code>的转换。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/timeit模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/timeit模块/" itemprop="url">timeit模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T20:47:39+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>timeit</code>模块提供了简单的方式来测量小段<code>Python</code>代码片，它有两种执行方式：命令行接口执行方式和<code>Python</code>程序代码可调的函数的方式。该模块避免了很多常见的度量时间的陷进。</p>
<h3 id="基本的例子"><a href="#基本的例子" class="headerlink" title="基本的例子"></a>基本的例子</h3><p>&emsp;&emsp;下面例子演示使用<code>Command-Line Interface</code>比较三种不同的表达式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python -m timeit <span class="string">'"-".join(str(n) for n in range(100))'</span></span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">70.3</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'"-".join([str(n) for n in range(100)])'</span></span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">61</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'"-".join(map(str, range(100)))'</span></span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">56.5</span> usec per loop</span><br></pre></td></tr></table></figure>
<p>同样可以用<code>Python Interface</code>来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'"-".join(str(n) for n in range(100))'</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="number">0.5236273538834694</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'"-".join([str(n) for n in range(100)])'</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="number">0.4634496997189608</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'"-".join(map(str, range(100)))'</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="number">0.4363641106430016</span></span><br></pre></td></tr></table></figure>
<p>注意，模块只有用<code>Command-Line Interface</code>方式才会自动判断重复的次数。</p>
<h3 id="Python接口方式"><a href="#Python接口方式" class="headerlink" title="Python接口方式"></a>Python接口方式</h3><p>&emsp;&emsp;该模块定义了三个实用函数和一个公共类：</p>
<ul>
<li><code>timeit.timeit(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=&lt;default timer&gt;, number=1000000)</code>：用已给的语句创建一个<code>Timer</code>实例，参数分别是<code>stmt</code>(需要测量的语句或函数)、<code>setup</code>代码(初始化代码或构建环境的导入语句)、<code>timer</code>函数(计时函数)、<code>number</code>(每一次测量中语句被执行的次数)。注意，由于<code>timeit</code>正在执行语句，语句中如果存在返回值的话，会阻止<code>timeit</code>返回执行时间。<code>timeit</code>会取代原语句中的返回值。</li>
<li><code>timeit.repeat(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=&lt;default timer&gt;, repeat=3, number=1000000)</code>：用已给的语句创建一个<code>Timer</code>实例，参数<code>repeat</code>是重复测量的次数，其他参数与<code>timeit</code>类似。</li>
<li><code>timeit.default_timer()</code>：定义一个基于平台的默认的计时器。在<code>Windwos</code>系统，<code>time.clock</code>有微秒的精度，但是<code>time.time</code>只有<code>1/60</code>秒的精度；在<code>Unix</code>系统，<code>time.clock</code>有<code>1/100</code>秒的精度，而<code>time.time</code>的精度更高。</li>
<li><code>class timeit.Timer(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=&lt;timer function&gt;)</code>：计算小片代码段的类。构造函数需要的参数有<code>stmt</code>(需要测量的语句或函数)、<code>setup</code>代码(初始化代码或构建环境的导入语句)、<code>timer</code>函数(计时函数)，前两个参数的默认值都是<code>pass</code>。计时器函数依赖于具体平台，<code>stmt</code>和<code>setup</code>可以包括多个语句，以分号或者新行隔开。</li>
</ul>
<p>&emsp;&emsp;第一次测量语句的执行时间，可以使用<code>timeit</code>方法。<code>repeat</code>方法相当于多次调用<code>timeit</code>，并返回一个结果集的列表。<code>stmt</code>和<code>setup</code>参数同样可以调用无参的对象，这将会在一个计时函数中嵌套调用它们，然后被<code>timeit</code>所执行，这样做的话会增加额外的开销。</p>
<h3 id="timeit"><a href="#timeit" class="headerlink" title="timeit"></a>timeit</h3><p>&emsp;&emsp;<code>timeit(number=1000000)</code>：计算语句执行<code>1000000</code>次的时间。该语句会先执行一次<code>setup</code>参数语句，然后计算<code>stmt</code>参数的语句执行<code>number</code>次的时间，返回值是以秒为单位的浮点数。<code>number</code>参数默认是<code>1百万</code>，<code>stmt</code>、<code>setup</code>和<code>timer</code>参数由<code>timeit.Timer</code>类的构造函数传递。</p>
<h3 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h3><p>&emsp;&emsp;<code>repeat(repeat=3, number=1000000)</code>：<code>repeat</code>相当于持续多次调用<code>timeit</code>方法，并将结果返回为一个列表。参数<code>repeat</code>指定重复的次数，<code>number</code>是传递给<code>timeit</code>方法的<code>number</code>参数。</p>
<h3 id="print-exc"><a href="#print-exc" class="headerlink" title="print_exc"></a>print_exc</h3><p>&emsp;&emsp;<code>print_exc(file=None)</code>：输出计时代码中的<code>traceback</code>。典型用法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t = Timer(...)  <span class="comment"># 在“try/except”语句外使用</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    t.timeit(...)  <span class="comment"># 或t.repeat(...)</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    t.print_exc()</span><br></pre></td></tr></table></figure>
<p>这样做的好处是，可以将参数<code>file</code>直接定位到<code>traceback</code>，默认是<code>sys.stderr</code>。</p>
<h3 id="命令行接口方式"><a href="#命令行接口方式" class="headerlink" title="命令行接口方式"></a>命令行接口方式</h3><p>&emsp;&emsp;当在命令行方式执行时，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m timeit [-n N] [-r N] [-s S] [-t] [-c] [-h] [statement ...]</span><br></pre></td></tr></table></figure>
<p>详解如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>选项</th>
<th>原型</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n N</code></td>
<td><code>--number=N</code></td>
<td>执行指定语句(段)的次数</td>
</tr>
<tr>
<td><code>-r N</code></td>
<td><code>--repeat=N</code></td>
<td>重复测量的次数，默认是<code>3</code>次</td>
</tr>
<tr>
<td><code>-s S</code></td>
<td><code>--setup=S</code></td>
<td>执行时初始语句(默认是<code>pass</code>)</td>
</tr>
<tr>
<td><code>-p</code></td>
<td><code>--process</code></td>
<td>测量进程时间而不是实际执行时间(使用<code>time.process_time</code>代替默认的<code>time.perf_counter</code>)</td>
</tr>
<tr>
<td><code>-t</code></td>
<td><code>--time</code></td>
<td>使用<code>time.time</code>(默认除<code>Windows</code>外所有的操作系统)</td>
</tr>
<tr>
<td><code>-c</code></td>
<td><code>--clock</code></td>
<td>使用<code>time.clock</code>(默认只在<code>Windows</code>操作系统上执行)</td>
</tr>
<tr>
<td><code>-v</code></td>
<td><code>--verbose</code></td>
<td>打印原始的计时结果，输出更大精度的数值</td>
</tr>
<tr>
<td><code>-h</code></td>
<td><code>--help</code></td>
<td>打印一个简短的用法信息并退出</td>
</tr>
</tbody>
</table>
</div>
<h3 id="详细的例子"><a href="#详细的例子" class="headerlink" title="详细的例子"></a>详细的例子</h3><p>&emsp;&emsp;在开始时设置初始化语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python -m timeit -s <span class="string">'text = "sample string"; char = "g"'</span>  <span class="string">'char in text'</span></span><br><span class="line">10000000 loops, best of 3: 0.0936 usec per loop</span><br><span class="line">$ python -m timeit -s <span class="string">'text = "sample string"; char = "g"'</span>  <span class="string">'text.find(char)'</span></span><br><span class="line">1000000 loops, best of 3: 0.4 usec per loop</span><br></pre></td></tr></table></figure>
<p>使用<code>timeit</code>模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'char in text'</span>, setup=<span class="string">'text = "sample string"; char = "g"'</span>)</span><br><span class="line"><span class="number">0.1253384683015776</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">'text.find(char)'</span>, setup=<span class="string">'text = "sample string"; char = "g"'</span>)</span><br><span class="line"><span class="number">0.5727204384393936</span></span><br></pre></td></tr></table></figure>
<p>同样可以用<code>Timer</code>类和它们的方法来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = timeit.Timer(<span class="string">'char in text'</span>, setup=<span class="string">'text = "sample string"; char = "g"'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.timeit()</span><br><span class="line"><span class="number">0.12571392650598057</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.repeat()</span><br><span class="line">[<span class="number">0.12860170469997456</span>, <span class="number">0.12690914937762443</span>, <span class="number">0.11270203329004858</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;下面的例子演示如何测量多行表达式的执行时间，这里主要比较<code>hasattr vs try/except</code>来测试缺省或存在两种情况下的对象属性的时间消耗：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python -m timeit <span class="string">'try:'</span> <span class="string">'  str.__nonzero__'</span> <span class="string">'except AttributeError:'</span> <span class="string">'  pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.86</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'if hasattr(str, "__nonzero__"): pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.22</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'try:'</span> <span class="string">'  int.__nonzero__'</span> <span class="string">'except AttributeError:'</span> <span class="string">'  pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.86</span> usec per loop</span><br><span class="line">$ python -m timeit <span class="string">'if hasattr(int, "__nonzero__"): pass'</span></span><br><span class="line"><span class="number">1000000</span> loops, best of <span class="number">3</span>: <span class="number">1.25</span> usec per loop</span><br></pre></td></tr></table></figure>
<p>使用<code>timeit</code>模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 属性缺省的情况</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">""" \</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    str.__nonzero__</span></span><br><span class="line"><span class="string">except AttributeError:</span></span><br><span class="line"><span class="string">    pass</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.08674410171410782</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"if hasattr(str, '__bool__'): pass"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.08676420027402543</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 属性存在的情况</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">""" \</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    int.__nonzero__</span></span><br><span class="line"><span class="string">except AttributeError:</span></span><br><span class="line"><span class="string">    pass</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.09908718327663735</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"if hasattr(int, '__bool__'): pass"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(stmt=s, number=<span class="number">100000</span>)</span><br><span class="line"><span class="number">0.028003708398131266</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果想让<code>timeit</code>模块测量你定义的函数，可以传递一个<code>setup</code>参数，该参数包括一个<code>import</code>语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    L = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        L.append(i)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> timeit</span><br><span class="line">    print(timeit.timeit(<span class="string">"test()"</span>, setup=<span class="string">"from __main__ import test"</span>))</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/socket模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/socket模块/" itemprop="url">socket模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T18:47:09+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="socket方法"><a href="#socket方法" class="headerlink" title="socket方法"></a>socket方法</h3><p>&emsp;&emsp;<code>socket</code>方法的原型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket(family, type[, protocal])</span><br></pre></td></tr></table></figure>
<p>使用给定的地址族、套接字类型、协议编号来创建套接字。<code>socket</code>类型如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>socket.AF_UNIX</code></td>
<td>只能够用于单一的Unix系统进程间通信</td>
</tr>
<tr>
<td><code>socket.AF_INET</code></td>
<td>服务器之间网络通信</td>
</tr>
<tr>
<td><code>socket.AF_INET6</code></td>
<td><code>IPv6</code></td>
</tr>
<tr>
<td><code>socket.SOCK_STREAM</code></td>
<td>流式<code>socket</code>(<code>for TCP</code>)</td>
</tr>
<tr>
<td><code>socket.SOCK_DGRAM</code></td>
<td>数据报式<code>socket</code>(<code>for UDP</code>)</td>
</tr>
<tr>
<td><code>socket.SOCK_RAW</code></td>
<td>原始套接字</td>
</tr>
<tr>
<td><code>socket.SOCK_SEQPACKET</code></td>
<td>可靠的连续数据包服务</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;创建<code>TCP Socket</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;创建<code>UDP Socket</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br></pre></td></tr></table></figure>
<h3 id="socket函数"><a href="#socket函数" class="headerlink" title="socket函数"></a>socket函数</h3><p>&emsp;&emsp;注意点以下几点：</p>
<ul>
<li><code>TCP</code>发送数据时，已建立好<code>TCP</code>连接，所以不需要指定地址。<code>UDP</code>是面向无连接的，每次发送要指定是发给地址。</li>
<li>服务端与客户端不能直接发送列表、元组、字典，需要将其字符串化(<code>repr(data)</code>)。</li>
</ul>
<p>&emsp;&emsp;服务端<code>socket</code>函数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s.bind(address)</code></td>
<td>将套接字绑定到地址，在<code>AF_INET</code>下，以元组<code>(host, port)</code>的形式表示地址</td>
</tr>
<tr>
<td><code>s.listen(backlog)</code></td>
<td>开始监听<code>TCP</code>传入连接。<code>backlog</code>指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为<code>1</code>，大部分应用程序设为<code>5</code>就可以了</td>
</tr>
<tr>
<td><code>s.accept()</code></td>
<td>接受<code>TCP</code>连接并返回<code>(conn, address)</code>，其中<code>conn</code>是新的套接字对象，可以用来接收和发送数据；<code>address</code>是连接客户端的地址</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;客户端<code>socket</code>函数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s.connect(address)</code></td>
<td>连接到<code>address</code>处的套接字。一般<code>address</code>的格式为元组<code>(hostname, port)</code>，如果连接出错，返回<code>socket.error</code>错误</td>
</tr>
<tr>
<td><code>s.connect_ex(adddress)</code></td>
<td>功能与<code>connect(address)</code>相同，但是成功返回<code>0</code>，失败返回<code>errno</code>的值</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;公共<code>socket</code>函数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>socket函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s.recv(bufsize[, flag])</code></td>
<td>接受<code>TCP</code>套接字的数据。数据以字符串形式返回，<code>bufsize</code>指定要接收的最大数据量。<code>flag</code>提供有关消息的其他信息，通常可以忽略</td>
</tr>
<tr>
<td><code>s.send(string[, flag])</code></td>
<td>发送<code>TCP</code>数据。将<code>string</code>中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于<code>string</code>的字节大小</td>
</tr>
<tr>
<td><code>s.sendall(string[, flag])</code></td>
<td>完整发送<code>TCP</code>数据。将<code>string</code>中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功返回<code>None</code>，失败则抛出异常</td>
</tr>
<tr>
<td><code>s.recvfrom(bufsize[, flag])</code></td>
<td>接受<code>UDP</code>套接字的数据。与<code>recv</code>类似，但返回值是<code>(data, address)</code>。其中<code>data</code>是包含接收数据的字符串，<code>address</code>是发送数据的套接字地址</td>
</tr>
<tr>
<td><code>s.sendto(string[, flag], address)</code></td>
<td>发送<code>UDP</code>数据。将数据发送到套接字，<code>address</code>是形式为<code>(ipaddr, port)</code>的元组，指定远程地址。返回值是发送的字节数</td>
</tr>
<tr>
<td><code>s.close()</code></td>
<td>关闭套接字</td>
</tr>
<tr>
<td><code>s.getpeername()</code></td>
<td>返回连接套接字的远程地址。返回值通常是元组<code>(ipaddr, port)</code></td>
</tr>
<tr>
<td><code>s.getsockname()</code></td>
<td>返回套接字自己的地址。通常是一个元组<code>(ipaddr, port)</code></td>
</tr>
<tr>
<td><code>s.getsockopt(level, optname[, buflen])</code></td>
<td>返回套接字选项的值</td>
</tr>
<tr>
<td><code>s.settimeout(timeout)</code></td>
<td>设置套接字操作的超时期，<code>timeout</code>是一个浮点数，单位是秒。值为<code>None</code>表示没有超时期。一般超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作(例如<code>connect</code>函数)</td>
</tr>
<tr>
<td><code>s.gettimeout()</code></td>
<td>返回当前超时期的值，单位是秒。如果没有设置超时期，则返回<code>None</code></td>
</tr>
<tr>
<td><code>s.fileno()</code></td>
<td>返回套接字的文件描述符</td>
</tr>
<tr>
<td><code>s.setblocking(flag)</code></td>
<td>如果<code>flag</code>为<code>0</code>，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式(默认值)。非阻塞模式下，如果调用<code>recv</code>没有发现任何数据，或<code>send</code>调用无法立即发送数据，那么将引起<code>socket.error</code>异常</td>
</tr>
<tr>
<td><code>s.makefile()</code></td>
<td>创建一个与该套接字相关连的文件</td>
</tr>
<tr>
<td><code>s.setdefaulttimeout(timeout)</code></td>
<td>设置<code>Socket</code>默认超时时间，以秒计(<code>float</code>型)</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;<code>TCP</code>服务器端如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 创建socket对象</span></span><br><span class="line">serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">​</span><br><span class="line">host = socket.gethostname()  <span class="comment"># 获取本地主机名</span></span><br><span class="line">port = <span class="number">9999</span></span><br><span class="line">​</span><br><span class="line">serversocket.bind((host, port))</span><br><span class="line">serversocket.listen(<span class="number">5</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    clientsocket, addr = serversocket.accept()  <span class="comment"># 建立客户端连接</span></span><br><span class="line">    print(<span class="string">"连接地址: %s"</span> % str(addr))</span><br><span class="line">    msg = <span class="string">'欢迎访问菜鸟教程！'</span> + <span class="string">"\r\n"</span></span><br><span class="line">    clientsocket.send(msg.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    clientsocket.close()</span><br></pre></td></tr></table></figure>
<p><code>TCP</code>客户端如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">​</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">host = socket.gethostname()</span><br><span class="line">port = <span class="number">9999</span></span><br><span class="line">s.connect((host, port))</span><br><span class="line">msg = s.recv(<span class="number">1024</span>)  <span class="comment"># 接收小于1024字节的数据</span></span><br><span class="line">s.close()</span><br><span class="line">print(msg.decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<p>捕捉超时错误的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">​</span><br><span class="line">socket.setdefaulttimeout(<span class="number">0.01</span>)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sock.connect((<span class="string">"123123231"</span>, <span class="number">12345</span>))</span><br><span class="line"><span class="keyword">except</span> socket.timeout <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">"timeout"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>UDP</code>服务器如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line">host = <span class="string">"127.0.0.1"</span>  <span class="comment"># 服务器地址</span></span><br><span class="line">port = <span class="number">12345</span>  <span class="comment"># 服务器端口</span></span><br><span class="line">bufsiz = <span class="number">2048</span>  <span class="comment"># 缓存大小</span></span><br><span class="line">adds = (host, port)  <span class="comment"># 地址和端口</span></span><br><span class="line">​</span><br><span class="line">udpsersock = socket(AF_INET, SOCK_DGRAM)  <span class="comment"># 创建UDP的套接字类型</span></span><br><span class="line">udpsersock.bind(adds)  <span class="comment"># 绑定到地址和端口</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg = input(<span class="string">'服务器说：'</span>)  <span class="comment"># 输入数据</span></span><br><span class="line">    data, addc = udpsersock.recvfrom(bufsiz)</span><br><span class="line">    udpsersock.sendto(msg.encode(<span class="string">'utf-8'</span>), addc)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">'客户端回答：'</span>, data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">​</span><br><span class="line">udpsersock.close()</span><br></pre></td></tr></table></figure>
<p><code>UDP</code>客户端如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line">host = <span class="string">'localhost'</span>  <span class="comment"># 本地服务器地址</span></span><br><span class="line">port = <span class="number">12345</span>  <span class="comment"># 客户端端口(确保和服务器的端口一致)</span></span><br><span class="line">bufsiz = <span class="number">2048</span>  <span class="comment"># 缓存大小</span></span><br><span class="line">addc = (host, port)  <span class="comment"># 地址和端口</span></span><br><span class="line">​</span><br><span class="line">udpclisock = socket(AF_INET, SOCK_DGRAM)  <span class="comment"># 创建UDP的套接字类型</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg = input(<span class="string">'客户端说：'</span>)  <span class="comment"># 输入数据</span></span><br><span class="line">    udpclisock.sendto(msg.encode(<span class="string">'utf-8'</span>), addc)</span><br><span class="line">    data, adds = udpclisock.recvfrom(bufsiz)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">'服务器回答：'</span>, data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">​</span><br><span class="line">udpclisock.close()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>补充说明</strong>：<code>serversocket.bind((host, port))</code>的<code>host</code>参数最好用<code>IP</code>地址的字符串形式，例如<code>192.168.1.108</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/多线程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/多线程/" itemprop="url">多线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T18:00:09+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Python 3</code>线程中常用的两个模块为<code>_thread</code>和<code>threading</code>，目前<code>thread</code>模块已被废弃。为了保持兼容性，<code>Python 3</code>将<code>thread</code>重命名为<code>_thread</code>。<br>&emsp;&emsp;<code>_thread</code>提供了低级别的、原始的线程以及一个简单的锁，它相比于<code>threading</code>模块的功能还是比较有限的。<code>threading</code>模块除了包含<code>_thread</code>模块中的所有方法外，还提供的其他方法：</p>
<ul>
<li><code>threading.currentThread</code>：返回当前的线程变量。</li>
<li><code>threading.enumerate</code>：返回一个包含正在运行的线程的<code>list</code>。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。</li>
<li><code>threading.activeCount</code>：返回正在运行的线程数量，与<code>len(threading.enumerate())</code>有相同的结果。</li>
</ul>
<p>&emsp;&emsp;<code>Python</code>使用线程有两种方式：函数或者用类来包装线程对象。</p>
<h3 id="函数式"><a href="#函数式" class="headerlink" title="函数式"></a>函数式</h3><p>&emsp;&emsp;调用<code>_thread</code>模块中的<code>start_new_thread</code>函数来产生新线程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_thread.start_new_thread(function, args[, kwargs])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>function</code>：线程函数。</li>
<li><code>args</code>：传递给线程函数的参数，必须是<code>tuple</code>类型。</li>
<li><code>kwargs</code>：可选参数。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_time</span><span class="params">(threadName, delay)</span>:</span>  <span class="comment"># 为线程定义一个函数</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; <span class="number">5</span>:</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"%s: %s"</span> % ( threadName, time.ctime(time.time()) ))</span><br><span class="line">​</span><br><span class="line"><span class="keyword">try</span>:  <span class="comment"># 创建两个线程</span></span><br><span class="line">    _thread.start_new_thread(print_time, (<span class="string">"Thread-1"</span>, <span class="number">2</span>, ))</span><br><span class="line">    _thread.start_new_thread(print_time, (<span class="string">"Thread-2"</span>, <span class="number">4</span>, ))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Error: 无法启动线程"</span>)</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">33</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">35</span> <span class="number">2017</span></span><br></pre></td></tr></table></figure>
<h3 id="Thread类"><a href="#Thread类" class="headerlink" title="Thread类"></a>Thread类</h3><p>&emsp;&emsp;除了使用方法外，线程模块同样提供了<code>Thread</code>类来处理线程。<code>Thread</code>类提供了以下方法：</p>
<ul>
<li><code>run()</code>：用以表示线程活动的方法。</li>
<li><code>start()</code>：启动线程活动。</li>
<li><code>join([time])</code>：<code>join</code>的作用是保证当前线程执行完成后，再执行其它线程。<code>join</code>可以有<code>time</code>参数，表示阻塞其它线程<code>time</code>秒后，不再阻塞。</li>
<li><code>isAlive()</code>：返回线程是否活动的。</li>
<li><code>getName()</code>：返回线程名。</li>
<li><code>setName()</code>：设置线程名。</li>
</ul>
<p>&emsp;&emsp;可以通过直接从<code>threading.Thread</code>继承创建一个新的子类，实例化后调用<code>start</code>方法启动新线程，即它调用了线程的<code>run</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line">exitFlag = <span class="number">0</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadID, name, counter)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID = threadID</span><br><span class="line">        self.name = name</span><br><span class="line">        self.counter = counter</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"开始线程："</span> + self.name)</span><br><span class="line">        print_time(self.name, self.counter, <span class="number">5</span>)</span><br><span class="line">        print(<span class="string">"退出线程："</span> + self.name)</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_time</span><span class="params">(threadName, delay, counter)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> counter:</span><br><span class="line">        <span class="keyword">if</span> exitFlag:</span><br><span class="line">            threadName.exit()</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        print(<span class="string">"%s: %s"</span> % (threadName, time.ctime(time.time())))</span><br><span class="line">        counter -= <span class="number">1</span></span><br><span class="line">​</span><br><span class="line"><span class="comment"># 创建新线程</span></span><br><span class="line">thread1 = myThread(<span class="number">1</span>, <span class="string">"Thread-1"</span>, <span class="number">1</span>)</span><br><span class="line">thread2 = myThread(<span class="number">2</span>, <span class="string">"Thread-2"</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 开启新线程</span></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line">thread1.join()</span><br><span class="line">thread2.join()</span><br><span class="line">print(<span class="string">"退出主线程"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">开始线程：Thread<span class="number">-1</span></span><br><span class="line">开始线程：Thread<span class="number">-2</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">28</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">30</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">31</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">32</span> <span class="number">2017</span></span><br><span class="line">退出线程：Thread<span class="number">-1</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">33</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">35</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">20</span>:<span class="number">51</span>:<span class="number">37</span> <span class="number">2017</span></span><br><span class="line">退出线程：Thread<span class="number">-2</span></span><br><span class="line">退出主线程</span><br></pre></td></tr></table></figure>
<h3 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h3><p>&emsp;&emsp;如果多个线程共同对某个数据修改，则可能出现不可预料的结果。为了保证数据的正确性，需要对多个线程进行同步。<br>&emsp;&emsp;使用<code>Thread</code>对象的<code>Lock</code>和<code>Rlock</code>可以实现简单的线程同步，这两个对象都有<code>acquire</code>方法和<code>release</code>方法。对于那些需要每次只允许一个线程操作的数据，可以将其操作放到<code>acquire</code>和<code>release</code>方法之间。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadID, name, counter)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID = threadID</span><br><span class="line">        self.name = name</span><br><span class="line">        self.counter = counter</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"开启线程: "</span> + self.name)</span><br><span class="line">        threadLock.acquire()  <span class="comment"># 获取锁，用于线程同步</span></span><br><span class="line">        print_time(self.name, self.counter, <span class="number">3</span>)</span><br><span class="line">        threadLock.release()  <span class="comment"># 释放锁，开启下一个线程</span></span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_time</span><span class="params">(threadName, delay, counter)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> counter:</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        print(<span class="string">"%s: %s"</span> % (threadName, time.ctime(time.time())))</span><br><span class="line">        counter -= <span class="number">1</span></span><br><span class="line">​</span><br><span class="line">threadLock = threading.Lock()</span><br><span class="line">threads = []</span><br><span class="line"><span class="comment"># 创建新线程</span></span><br><span class="line">thread1 = myThread(<span class="number">1</span>, <span class="string">"Thread-1"</span>, <span class="number">1</span>)</span><br><span class="line">thread2 = myThread(<span class="number">2</span>, <span class="string">"Thread-2"</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 开启新线程</span></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"><span class="comment"># 添加线程到线程列表</span></span><br><span class="line">threads.append(thread1)</span><br><span class="line">threads.append(thread2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:  <span class="comment"># 等待所有线程完成</span></span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"退出主线程"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">开启线程: Thread<span class="number">-1</span></span><br><span class="line">开启线程: Thread<span class="number">-2</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">21</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">22</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-1</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">23</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">25</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">27</span> <span class="number">2017</span></span><br><span class="line">Thread<span class="number">-2</span>: Sat Nov  <span class="number">4</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">29</span> <span class="number">2017</span></span><br><span class="line">退出主线程</span><br></pre></td></tr></table></figure>
<h3 id="线程优先级队列"><a href="#线程优先级队列" class="headerlink" title="线程优先级队列"></a>线程优先级队列</h3><p>&emsp;&emsp;<code>Python</code>的<code>Queue</code>模块提供了同步的、线程安全的队列类，包括<code>FIFO</code>队列<code>Queue</code>、<code>LIFO</code>队列<code>LifoQueue</code>和优先级队列<code>PriorityQueue</code>。这些队列都实现了锁原语，能够在多线程中直接使用，可以使用队列来实现线程间的同步。<code>Queue</code>模块中的常用方法:</p>
<ul>
<li><code>Queue.qsize()</code>：返回队列的大小</li>
<li><code>Queue.empty()</code>：如果队列为空，返回<code>True</code>，否则<code>False</code>。</li>
<li><code>Queue.full()</code>：如果队列满了，返回<code>True</code>，否则<code>False</code>。</li>
<li><code>Queue.get([block[, timeout]])</code>：获取队列，<code>timeout</code>是等待时间。</li>
<li><code>Queue.get_nowait()</code>：相<code>当Queue.get(False)</code>。</li>
<li><code>Queue.put(item[, timeout])</code>：写入队列，<code>timeout</code>是等待时间。</li>
<li><code>Queue.put_nowait(item)</code>：相当<code>Queue.put(item, False)</code>。</li>
<li><code>Queue.task_done()</code>：在完成一项工作之后，<code>Queue.task_done</code>函数向任务已经完成的队列发送一个信号。</li>
<li><code>Queue.join()</code>：实际上意味着等到队列为空，再执行别的操作。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line">exitFlag = <span class="number">0</span></span><br><span class="line">​</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadID, name, q)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID = threadID</span><br><span class="line">        self.name = name</span><br><span class="line">        self.q = q</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"开启线程："</span> + self.name)</span><br><span class="line">        process_data(self.name, self.q)</span><br><span class="line">        print(<span class="string">"退出线程："</span> + self.name)</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_data</span><span class="params">(threadName, q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> exitFlag:</span><br><span class="line">        queueLock.acquire()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> workQueue.empty():</span><br><span class="line">            data = q.get()</span><br><span class="line">            queueLock.release()</span><br><span class="line">            print(<span class="string">"%s processing %s"</span> % (threadName, data))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            queueLock.release()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">​</span><br><span class="line">threadList = [<span class="string">"Thread-1"</span>, <span class="string">"Thread-2"</span>, <span class="string">"Thread-3"</span>]</span><br><span class="line">nameList = [<span class="string">"One"</span>, <span class="string">"Two"</span>, <span class="string">"Three"</span>, <span class="string">"Four"</span>, <span class="string">"Five"</span>]</span><br><span class="line">queueLock = threading.Lock()</span><br><span class="line">workQueue = queue.Queue(<span class="number">10</span>)</span><br><span class="line">threads = []</span><br><span class="line">threadID = <span class="number">1</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> tName <span class="keyword">in</span> threadList:  <span class="comment"># 创建新线程</span></span><br><span class="line">    thread = myThread(threadID, tName, workQueue)</span><br><span class="line">    thread.start()</span><br><span class="line">    threads.append(thread)</span><br><span class="line">    threadID += <span class="number">1</span></span><br><span class="line">​</span><br><span class="line">queueLock.acquire()  <span class="comment"># 填充队列</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> nameList:</span><br><span class="line">    workQueue.put(word)</span><br><span class="line">​</span><br><span class="line">queueLock.release()</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> workQueue.empty():  <span class="comment"># 等待队列清空</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">exitFlag = <span class="number">1</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:  <span class="comment"># 等待所有线程完成</span></span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"退出主线程"</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">开启线程：Thread<span class="number">-1</span></span><br><span class="line">开启线程：Thread<span class="number">-2</span></span><br><span class="line">开启线程：Thread<span class="number">-3</span></span><br><span class="line">Thread<span class="number">-3</span> processing One</span><br><span class="line">Thread<span class="number">-2</span> processing Two</span><br><span class="line">Thread<span class="number">-1</span> processing Three</span><br><span class="line">Thread<span class="number">-3</span> processing Four</span><br><span class="line">Thread<span class="number">-1</span> processing Five</span><br><span class="line">退出线程：Thread<span class="number">-2</span></span><br><span class="line">退出线程：Thread<span class="number">-3</span></span><br><span class="line">退出线程：Thread<span class="number">-1</span></span><br><span class="line">退出主线程</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/打印和条件分支/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/打印和条件分支/" itemprop="url">打印和条件分支</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T16:31:56+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h3><p>&emsp;&emsp;在终端输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"I love python!"</span>)  <span class="comment"># 输出“I love python”</span></span><br><span class="line">print(<span class="number">5</span> + <span class="number">3</span>)  <span class="comment"># 输出“8”</span></span><br><span class="line">print(<span class="string">"well water"</span> + <span class="string">" river"</span>)  <span class="comment"># 输出“well water river”</span></span><br><span class="line">print(<span class="string">"I lover python"</span> * <span class="number">8</span>)  <span class="comment"># 输出“I lover python”8次</span></span><br><span class="line">print(<span class="string">"I lover python\n"</span> * <span class="number">8</span>)  <span class="comment"># 输出“I lover python”8次，带换行</span></span><br><span class="line">dec_Dumber = <span class="number">12.3456</span></span><br><span class="line">print(<span class="string">'It is %.2f degrees today.'</span> % dec_Dumber)  <span class="comment"># 输出“It is 12.35 degrees today.”</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;猜数字游戏：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> guess == <span class="number">8</span>:</span><br><span class="line">    print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"No! you are wrong!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>print</code>函数具有重定向的功能。对于<code>python 2</code>，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logfile  = open(<span class="string">'/tmp/mylog.log'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">print</span> &gt;&gt; logfile, <span class="string">'writeen by python version 2'</span></span><br><span class="line">logfile.close()</span><br></pre></td></tr></table></figure>
<p>查看文件<code>/tmp/mylog.log</code>，其内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeen by python version <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>对于<code>python 3</code>，<code>print</code>重定向方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'mylog.log'</span>, <span class="string">'w'</span>)</span><br><span class="line">print(<span class="string">'writeen by python version 3'</span>, file=f)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>查看文件<code>mylog.log</code>，其内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeen by python version <span class="number">3</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="条件分支"><a href="#条件分支" class="headerlink" title="条件分支"></a>条件分支</h3><p>&emsp;&emsp;在终端输入<code>1 &lt; 3</code>，则输出<code>True</code>；输入<code>2 &gt; 3</code>，则输出<code>False</code>。<br>&emsp;&emsp;<code>Python</code>的条件分支语句(注意这里的缩进关系)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件:</span><br><span class="line">    条件为真(<span class="keyword">True</span>)执行的操作</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    条件为假(<span class="keyword">False</span>)执行的操作</span><br></pre></td></tr></table></figure>
<p>对小游戏的改进：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> guess == <span class="number">8</span>:</span><br><span class="line">    print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line">    print(<span class="string">"But, there is not a reward!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> guess &gt; <span class="number">8</span>:</span><br><span class="line">        print(<span class="string">"The number is bigger!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"The number is litter!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p><code>Python</code>是靠缩进来确定分支关系，不像<code>C</code>语言那样需要大括号来确定关系。<br>&emsp;&emsp;<code>Python</code>的<code>while</code>循环语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件:</span><br><span class="line">    条件为真(<span class="keyword">True</span>)执行的操作</span><br></pre></td></tr></table></figure>
<p>对小游戏的改进：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> guess != <span class="number">8</span>:</span><br><span class="line">    temp = input(<span class="string">"Oh! This is wrong! Please input a number: "</span>)</span><br><span class="line">    guess = int(temp)</span><br><span class="line">    <span class="keyword">if</span> guess == <span class="number">8</span>:</span><br><span class="line">        print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line">        print(<span class="string">"But, there is not a reward!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> guess &gt; <span class="number">8</span>:</span><br><span class="line">            print(<span class="string">"The number is bigger!"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"The number is litter!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>Python</code>的<code>and</code>逻辑操作符可以将任意表达式连接在一起，并得到一个布尔类型的值。在终端输入<code>3&gt;2 and 1&lt;2</code>，则输出<code>True</code>。在终端输入<code>(3&gt;2) and (1&lt;2)</code>，同样输出<code>True</code>，只不过这样更加明确了运算的优先级。<br>&emsp;&emsp;我们希望每次程序产生的答案是随机的，于是需要引入外援<code>random</code>模块。这个<code>random</code>模块里边有一个函数叫做<code>randint</code>，它会返回一个随机的整数。改进程序如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">​</span><br><span class="line">secret = random.randint(<span class="number">1</span>, <span class="number">10</span>)  <span class="comment"># 产生一个1到10的随机数</span></span><br><span class="line">​</span><br><span class="line">temp = input(<span class="string">"guess the number in my heart: "</span>)</span><br><span class="line">guess = int(temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> guess != secret:</span><br><span class="line">    temp = input(<span class="string">"Oh! This is wrong! Please input a number: "</span>)</span><br><span class="line">    guess = int(temp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> guess == secret:</span><br><span class="line">        print(<span class="string">"Yes! you are right!"</span>)</span><br><span class="line">        print(<span class="string">"But, there is not a reward!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> guess &gt; secret:</span><br><span class="line">            print(<span class="string">"The number is bigger!"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"The number is litter!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"The game is over!"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;判断成绩的程序如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">score = int(input(<span class="string">"Please input a number: "</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">100</span> &gt;= score &gt;= <span class="number">90</span>:</span><br><span class="line">    print(<span class="string">'A'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">90</span> &gt; score &gt;= <span class="number">80</span>:  <span class="comment"># else if</span></span><br><span class="line">    print(<span class="string">'B'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">80</span> &gt; score &gt;= <span class="number">60</span>:</span><br><span class="line">    print(<span class="string">'C'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">60</span> &gt; score &gt;= <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">'D'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'输入错误!'</span>)</span><br></pre></td></tr></table></figure>
<p><code>Python</code>可以有效地避免悬挂<code>else</code>，即<code>C</code>语言中的<code>else</code>匹配问题。</p>
<h4 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h4><p>&emsp;&emsp;条件表达式类似于<code>C</code>语言的三元操作符：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x, y = <span class="number">4</span>, <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x &lt; y:</span><br><span class="line">    small = x</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    small = y</span><br></pre></td></tr></table></figure>
<p>可以被改进为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">small = x <span class="keyword">if</span> x &lt; y <span class="keyword">else</span> y</span><br></pre></td></tr></table></figure>
<h4 id="and、or、not"><a href="#and、or、not" class="headerlink" title="and、or、not"></a>and、or、not</h4><ul>
<li><code>and</code>：<code>x and y</code>返回的结果是决定表达式结果的值。如果<code>x</code>为真，则<code>y</code>决定结果，返回<code>y</code>；如果<code>x</code>为假，<code>x</code>决定了结果为假，返回<code>x</code>。</li>
<li><code>or</code>：<code>x or y</code>中其中一个为真，则整个表达式为真。</li>
<li><code>not</code>：返回表达式结果的<code>相反的值</code>。如果表达式结果为真，则返回<code>false</code>；如果表达式结果为假，则返回<code>true</code>。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/bisect模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/bisect模块/" itemprop="url">bisect模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T16:18:36+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;本模块实现已经排序的队列列表插入元素之后保持排序。对于个大量数据的列表来看，插入元素并保持排序，计算量是非常大的。本模块实现了<code>bisect</code>算法，主要基于二分算法来实现。<br>&emsp;&emsp;<code>bisect_left</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bisect.bisect_left(a, x, lo=<span class="number">0</span>, hi=len(a))</span><br></pre></td></tr></table></figure>
<p>对有序列表<code>a</code>里插入元素<code>x</code>，保持有序不变，返回插入的位置。参数<code>lo</code>和<code>hi</code>是表示判断列表的范围，默认是整个范围。如果插入的元素<code>x</code>已经在列表<code>a</code>存在，那就插入在存在元素的左边。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">​</span><br><span class="line">l = [<span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line">l.sort()</span><br><span class="line">print(l)</span><br><span class="line">print(bisect.bisect_left(l, <span class="number">0</span>))</span><br><span class="line">print(l)</span><br><span class="line">print(bisect.bisect_left(l, <span class="number">5</span>))</span><br><span class="line">print(l)</span><br><span class="line">print(bisect.bisect_left(l, <span class="number">7</span>))</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="number">4</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>bisect_right</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bisect.bisect_right(a, x, lo=<span class="number">0</span>, hi=len(a))</span><br><span class="line">bisect.bisect(a, x, lo=<span class="number">0</span>, hi=len(a))</span><br></pre></td></tr></table></figure>
<p>在有序队列<code>a</code>里查找<code>x</code>可以插入的位置，并保持队列有序。如果插入的值与队列里的值相同，则插入在相同元素的右边，把这个位置的索引值返回。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">​</span><br><span class="line">l = [<span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line">l.sort()</span><br><span class="line">print(l)</span><br><span class="line">print(bisect.bisect_right(l, <span class="number">0</span>))</span><br><span class="line">print(l)</span><br><span class="line">print(bisect.bisect(l, <span class="number">5</span>))</span><br><span class="line">print(l)</span><br><span class="line">print(bisect.bisect(l, <span class="number">7</span>))</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="number">2</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="number">4</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>insort_left</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bisect.insort_left(a, x, lo=<span class="number">0</span>, hi=len(a))</span><br></pre></td></tr></table></figure>
<p>插入一个元素<code>x</code>到队列<code>a</code>，并把队列排序，相当于<code>a.insert(bisect.bisect_left(a, x, lo, hi), x)</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">​</span><br><span class="line">l = [<span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line">l.sort()</span><br><span class="line">print(l)</span><br><span class="line">bisect.insort_left(l, <span class="number">0</span>)</span><br><span class="line">print(l)</span><br><span class="line">bisect.insort_left(l, <span class="number">5</span>)</span><br><span class="line">print(l)</span><br><span class="line">bisect.insort_left(l, <span class="number">7</span>)</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>insort_right</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bisect.insort_right(a, x, lo=<span class="number">0</span>, hi=len(a))</span><br><span class="line">bisect.insort(a, x, lo=<span class="number">0</span>, hi=len(a))</span><br></pre></td></tr></table></figure>
<p>插入元素<code>x</code>到<code>a</code>队列里，如果发现有相同元素，就插入到相同元素的右边。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">​</span><br><span class="line">l = [<span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line">l.sort()</span><br><span class="line">print(l)</span><br><span class="line">bisect.insort_right(l, <span class="number">0</span>)</span><br><span class="line">print(l)</span><br><span class="line">bisect.insort(l, <span class="number">5</span>)</span><br><span class="line">print(l)</span><br><span class="line">bisect.insort(l, <span class="number">7</span>)</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p>对上面的函数进行一些简单地封装：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(a, x)</span>:</span></span><br><span class="line">    <span class="string">'Locate the leftmost value exactly equal to x'</span></span><br><span class="line">    i = bisect.bisect_left(a, x)</span><br><span class="line">    <span class="keyword">if</span> i != len(a) <span class="keyword">and</span> a[i] == x:</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_lt</span><span class="params">(a, x)</span>:</span></span><br><span class="line">    <span class="string">'Find rightmost value less than x'</span></span><br><span class="line">    i = bisect.bisect_left(a, x)</span><br><span class="line">    <span class="keyword">if</span> i:</span><br><span class="line">        <span class="keyword">return</span> a[i - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_le</span><span class="params">(a, x)</span>:</span></span><br><span class="line">    <span class="string">'Find rightmost value less than or equal to x'</span></span><br><span class="line">    i = bisect.bisect_right(a, x)</span><br><span class="line">    <span class="keyword">if</span> i:</span><br><span class="line">        <span class="keyword">return</span> a[i - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_gt</span><span class="params">(a, x)</span>:</span></span><br><span class="line">    <span class="string">'Find leftmost value greater than x'</span></span><br><span class="line">    i = bisect.bisect_right(a, x)</span><br><span class="line">    <span class="keyword">if</span> i != len(a):</span><br><span class="line">        <span class="keyword">return</span> a[i]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_ge</span><span class="params">(a, x)</span>:</span></span><br><span class="line">    <span class="string">'Find leftmost item greater than or equal to x'</span></span><br><span class="line">    i = bisect.bisect_left(a, x)</span><br><span class="line">    <span class="keyword">if</span> i != len(a):</span><br><span class="line">        <span class="keyword">return</span> a[i]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;对学生成绩转换为<code>ABCDF</code>四个等级：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grade</span><span class="params">(score, breakpoints=[<span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">90</span>], grades=<span class="string">'FDCBA'</span>)</span>:</span></span><br><span class="line">    i = bisect.bisect(breakpoints, score)</span><br><span class="line">    <span class="keyword">return</span> grades[i]</span><br><span class="line">​</span><br><span class="line">print([<span class="number">33</span>, <span class="number">99</span>, <span class="number">77</span>, <span class="number">70</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">100</span>])</span><br><span class="line">print([grade(score) <span class="keyword">for</span> score <span class="keyword">in</span> [<span class="number">33</span>, <span class="number">99</span>, <span class="number">77</span>, <span class="number">70</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">100</span>]])</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">33</span>, <span class="number">99</span>, <span class="number">77</span>, <span class="number">70</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">100</span>]</span><br><span class="line">[<span class="string">'F'</span>, <span class="string">'A'</span>, <span class="string">'C'</span>, <span class="string">'C'</span>, <span class="string">'B'</span>, <span class="string">'A'</span>, <span class="string">'A'</span>]</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/time模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/time模块/" itemprop="url">time模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T15:52:45+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>time</code>模块提供各种时间相关的功能。在<code>Python</code>中，与时间处理有关的模块包括：<code>time</code>、<code>datetime</code>以及<code>calendar</code>。虽然这个模块总是可用，但并非所有的功能都适用于各个平台。该模块中定义的大部分函数是调用<code>C</code>平台上的同名函数实现，所以各个平台上实现可能略有不同。一些术语和约定的解释如下：</p>
<ul>
<li>时间戳(<code>timestamp</code>)：通常来说，时间戳表示的是从<code>1970</code>年<code>1</code>月<code>1</code>日<code>00:00:00</code>开始按秒计算的偏移量(<code>time.gmtime(0)</code>)。此模块中的函数无法处理<code>1970</code>纪元年以前的日期和时间或太遥远的未来(处理极限取决于<code>C</code>函数库，对于<code>32</code>位系统来说，是<code>2038</code>年)。</li>
<li><code>UTC</code>(<code>Coordinated Universal Time</code>)：也叫格林威治天文时间，是世界标准时间，在中国为<code>UTC + 8</code>。</li>
<li><code>DST</code>(<code>Daylight Saving Time</code>)：夏令时。</li>
</ul>
<p>一些实时函数的计算精度可能低于它们建议的值或参数，例如在大部分<code>Unix</code>系统，时钟一秒钟滴答<code>50</code>至<code>100</code>次。</p>
<h3 id="time-struct-time"><a href="#time-struct-time" class="headerlink" title="time.struct_time"></a>time.struct_time</h3><p>&emsp;&emsp;<code>gmtime</code>、<code>localtime</code>和<code>strptime</code>以时间元祖(<code>struct_time</code>)的形式返回。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>索引值</th>
<th>属性</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td><code>tm_year</code>(年)</td>
<td>例如<code>2015</code></td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>tm_mon</code>(月)</td>
<td><code>1</code>至<code>12</code></td>
</tr>
<tr>
<td><code>2</code></td>
<td><code>tm_mday</code>(日)</td>
<td><code>1</code>至<code>31</code></td>
</tr>
<tr>
<td><code>3</code></td>
<td><code>tm_hour</code>(时)</td>
<td><code>0</code>至<code>23</code></td>
</tr>
<tr>
<td><code>4</code></td>
<td><code>tm_min</code>(分)</td>
<td><code>0</code>至<code>59</code></td>
</tr>
<tr>
<td><code>5</code></td>
<td><code>tm_sec</code>(秒)</td>
<td><code>0</code>至<code>61</code>(<code>60</code>代表闰秒，<code>61</code>基于历史原因保留)</td>
</tr>
<tr>
<td><code>6</code></td>
<td><code>tm_wday</code>(星期几)</td>
<td><code>0</code>至<code>6</code>(<code>0</code>表示星期一)</td>
</tr>
<tr>
<td><code>7</code></td>
<td><code>tm_yday</code>(一年中的第几天)</td>
<td><code>1</code>至<code>366</code></td>
</tr>
<tr>
<td><code>8</code></td>
<td><code>tm_isdst</code>(是否为夏令时)</td>
<td><code>0</code>、<code>1</code>、<code>-1</code>(<code>-1</code>代表夏令时)</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>time.altzone</code>：返回格林威治西部的夏令时地区的偏移秒数；如果该地区在格林威治东部会返回负值(如西欧，包括英国)；对夏令时启用地区才能使用。</li>
<li><code>time.asctime([t])</code>：接受时间元组并返回一个可读的形式为<code>Tue Dec 11 18:07:14 2015</code>(<code>2015</code>年<code>12</code>月<code>11</code>日周二<code>18</code>时<code>07</code>分<code>14</code>秒)的<code>24</code>个字符的字符串。</li>
<li><code>time.clock</code>：用以浮点数计算的秒数返回当前的<code>CPU</code>时间。用来衡量不同程序的耗时，比<code>time.time</code>更有用。由于该方法依赖操作系统，建议使用<code>perf_counter</code>或<code>process_time</code>代替(一个返回系统运行时间，一个返回进程运行时间，请按照实际需求选择)。</li>
<li><code>time.ctime([secs])</code>：作用相当于<code>asctime(localtime(secs))</code>，未给参数相当于<code>asctime</code>。</li>
<li><code>time.gmtime([secs])</code>：接收时间辍(<code>1970</code>纪元年后经过的浮点秒数)并返回格林威治天文时间下的时间元组<code>t</code>(<code>t.tm_isdst</code>始终为<code>0</code>)。</li>
<li><code>time.daylight</code>：如果夏令时被定义，则该值为非零。</li>
<li><code>time.localtime([secs])</code>：接收时间辍(<code>1970</code>纪元年后经过的浮点秒数)并返回当地时间下的时间元组<code>t</code>(<code>t.tm_isdst</code>可取<code>0</code>或<code>1</code>，取决于当地当时是不是夏令时)。</li>
<li><code>time.mktime(t)</code>：接受时间元组并返回时间辍(<code>1970</code>纪元后经过的浮点秒数)。</li>
<li><code>time.perf_counter</code>：返回计时器的精准时间(系统的运行时间)，包含整个系统的睡眠时间。由于返回值的基准点是未定义的，所以只有连续调用的结果之间的差才是有效的。</li>
<li><code>time.process_time</code>：返回当前进程执行<code>CPU</code>的时间总和，不包含睡眠时间。由于返回值的基准点是未定义的，所以只有连续调用的结果之间的差才是有效的。</li>
<li><code>time.sleep(secs)</code>：推迟调用线程的运行，<code>secs</code>的单位是秒。</li>
<li><code>time.strftime(format[, t])</code>：把一个代表时间的元组或者<code>struct_time</code>(例如由<code>time.localtime</code>和<code>time.gmtime</code>返回)转化为格式化的时间字符串。如果<code>t</code>未指定，将传入<code>time.localtime</code>。如果元组中任何一个元素越界，将会抛出<code>ValueError</code>异常。<code>format</code>格式如下：</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>格式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%a</code></td>
<td>本地(<code>locale</code>)简化星期名称</td>
</tr>
<tr>
<td><code>%A</code></td>
<td>本地完整星期名称</td>
</tr>
<tr>
<td><code>%b</code></td>
<td>本地简化月份名称</td>
</tr>
<tr>
<td><code>%B</code></td>
<td>本地完整月份名称</td>
</tr>
<tr>
<td><code>%c</code></td>
<td>本地相应的日期和时间表示</td>
</tr>
<tr>
<td><code>%d</code></td>
<td>一个月中的第几天(<code>01</code>至<code>31</code>)</td>
</tr>
<tr>
<td><code>%H</code></td>
<td>一天中的第几个小时(<code>24</code>小时制，<code>00</code>至<code>23</code>)</td>
</tr>
<tr>
<td><code>%l</code></td>
<td>一天中的第几个小时(<code>12</code>小时制，<code>01</code>至<code>12</code>)</td>
</tr>
<tr>
<td><code>%j</code></td>
<td>一年中的第几天(<code>001</code>至<code>366</code>)</td>
</tr>
<tr>
<td><code>%m</code></td>
<td>月份(<code>01</code>至<code>12</code>)</td>
</tr>
<tr>
<td><code>%M</code></td>
<td>分钟数(<code>00</code>至<code>59</code>)</td>
</tr>
<tr>
<td><code>%p</code></td>
<td>本地<code>am</code>或者<code>pm</code>的相应符</td>
</tr>
<tr>
<td><code>%S</code></td>
<td>秒(<code>01</code>至<code>61</code>)</td>
</tr>
<tr>
<td><code>%U</code></td>
<td>一年中的星期数(<code>00</code>至<code>53</code>，星期天是一个星期的开始)，第一个星期天之前的所有天数都放在第<code>0</code>周</td>
</tr>
<tr>
<td><code>%w</code></td>
<td>一个星期中的第几天(<code>0</code>至<code>6</code>，<code>0</code>是星期天)</td>
</tr>
<tr>
<td><code>%W</code></td>
<td>和<code>%U</code>基本相同，不同的是<code>%W</code>以星期一为一个星期的开始</td>
</tr>
<tr>
<td><code>%x</code></td>
<td>本地相应日期</td>
</tr>
<tr>
<td><code>%X</code></td>
<td>本地相应时间</td>
</tr>
<tr>
<td><code>%y</code></td>
<td>去掉世纪的年份(<code>00</code>至<code>99</code>)</td>
</tr>
<tr>
<td><code>%Y</code></td>
<td>完整的年份</td>
</tr>
<tr>
<td><code>%z</code></td>
<td>用<code>+HHMM</code>或<code>-HHMM</code>表示距离格林威治的时区偏移(<code>H</code>代表十进制的小时数，<code>M</code>代表十进制的分钟数)</td>
</tr>
<tr>
<td><code>%Z</code></td>
<td>时区的名字(如果不存在，则为空字符)</td>
</tr>
<tr>
<td><code>%%</code></td>
<td><code>%</code>号本身</td>
</tr>
</tbody>
</table>
</div>
<p><code>%p</code>只有与<code>%I</code>配合使用才有效果。当使用<code>strptime</code>函数时，只有当在这年中的周数和天数被确定的时候<code>%U</code>和<code>%W</code>才会被计算。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> t</span><br><span class="line">time_str = t.strftime(<span class="string">"a, %d %b %Y %H:%M:%S +0000"</span>, t.gmtime())</span><br><span class="line">print(time_str)  <span class="comment"># 结果为“a, 19 Nov 2015 00:10:32 +0000”</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>time.strptime(string[, format])</code>：把一个格式化时间字符串转化为<code>struct_time</code>，实际上它和<code>strftime</code>是逆操作。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> t</span><br><span class="line">time_str = t.strptime(<span class="string">"30 Nov 14"</span>, <span class="string">"%d %b %y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果为time.struct_time(tm_year=2014, tm_mon=11, tm_mday=30, tm_hour=0, \</span></span><br><span class="line"><span class="comment">#                        tm_min=0, tm_sec=0, tm_wday=6, tm_yday=334, tm_isdst=-1)</span></span><br><span class="line">print(time_str)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>time.time</code>：返回当前时间的时间戳(<code>1970</code>纪元年后经过的浮点秒数)。</li>
<li><code>time.timezone</code>：<code>time.timezone</code>属性是当地时区(未启动夏令时)距离格林威治的偏移秒数(美洲大于<code>0</code>；大部分欧洲、亚洲、非洲小于等于<code>0</code>)。</li>
<li><code>time.tzname</code>：<code>time.tzname</code>属性是包含两个字符串的元组：第一是当地非夏令时区的名称，第二个是当地的<code>DST</code>时区的名称。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/subprocess模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/subprocess模块/" itemprop="url">subprocess模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T15:30:45+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>subprocess</code>的目的就是启动一个新的进程并且与之通信。<code>subprocess</code>模块中只定义了一个类<code>Popen</code>，可以使用<code>Popen</code>来创建进程，并与进程进行复杂的交互。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subprocess.Popen(</span><br><span class="line">    args, bufsize=<span class="number">0</span>, executable=<span class="keyword">None</span>, stdin=<span class="keyword">None</span>, stdout=<span class="keyword">None</span>, stderr=<span class="keyword">None</span>,</span><br><span class="line">    preexec_fn=<span class="keyword">None</span>, close_fds=<span class="keyword">False</span>, shell=<span class="keyword">False</span>, cwd=<span class="keyword">None</span>, env=<span class="keyword">None</span>,</span><br><span class="line">    universal_newlines=<span class="keyword">False</span>, startupinfo=<span class="keyword">None</span>, creationflags=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>args</code>：可以是字符串或者序列类型，用于指定进程的可执行文件及其参数。如果是序列类型，第一个元素通常是可执行文件的路径。我们也可以显式地使用<code>executeable</code>参数来指定可执行文件的路径。</li>
<li><code>bufsize</code>：指定缓冲区的大小。<code>0</code>表示无缓冲，<code>1</code>表示行缓冲，负值表示系统缓冲(全缓冲)，其他数值表示缓冲区大小</li>
<li><code>stdin</code>、<code>stdout</code>、<code>stderr</code>：分别表示程序的标准输入、输出、错误句柄。它们可以是<code>PIPE</code>、文件描述符或文件对象，也可以设置为<code>None</code>，表示从父进程继承。</li>
<li><code>preexec_fn</code>：只在<code>Unix</code>平台下有效，用于指定一个可执行对象(<code>callable object</code>)，它将在子进程运行之前被调用。</li>
<li><code>close_sfs</code>：在<code>windows</code>平台下，如果<code>close_fds</code>被设置为<code>True</code>，则新创建的子进程将不会继承父进程的输入、输出、错误管道。我们不能将<code>close_fds</code>设置为<code>True</code>的同时，重定向子进程的标准输入、输出与错误(<code>stdin</code>、<code>stdout</code>和<code>stderr</code>)。</li>
<li><code>shell</code>：如果设为<code>true</code>，程序将通过<code>shell</code>来执行。</li>
<li><code>cwd</code>：用于设置子进程的当前目录。</li>
<li><code>env</code>：字典类型，用于指定子进程的环境变量。如果<code>env</code>为<code>None</code>，子进程的环境变量将从父进程中继承。</li>
<li><code>universal_newlines</code>：不同操作系统下，文本的换行符是不一样的。例如<code>Windows</code>下用<code>\r\n</code>表示换，而<code>Linux</code>下用<code>\n</code>。如果将此参数设置为<code>True</code>，<code>Python</code>统一把这些换行符当作<code>\n</code>来处理。</li>
<li><code>startupinfo</code>与<code>createionflags</code>：只在<code>Windows</code>下有效，它们将被传递给底层的<code>CreateProcess</code>函数，用于设置子进程的一些属性，例如主窗口的外观、进程的优先级。</li>
</ul>
<p>&emsp;&emsp;<code>subprocess.PIPE</code>：在创建<code>Popen</code>对象时，<code>subprocess.PIPE</code>可以初始化<code>stdin</code>、<code>stdout</code>或<code>stderr</code>参数，表示与子进程通信的标准流。<br>&emsp;&emsp;<code>subprocess.STDOUT</code>：创建<code>Popen</code>对象时，用于初始化<code>stderr</code>参数，表示将错误通过标准输出流输出。<br>&emsp;&emsp;<code>subprocess.call(*popenargs, **kwargs)</code>：运行命令。该函数将一直等待到子进程运行结束，并返回进程的<code>returncode</code>。如果子进程不需要进行交互，就可以使用该函数来创建。<br>&emsp;&emsp;<code>subprocess.check_call(*popenargs, **kwargs)</code>：与<code>subprocess.call</code>功能一样，只是如果子进程返回的<code>returncode</code>不为<code>0</code>的话，将触发<code>CalledProcessError</code>异常。在异常对象中，包括进程的<code>returncode</code>信息。<br>&emsp;&emsp;<code>Popen</code>的方法如下：</p>
<ul>
<li><code>Popen.poll</code>：用于检查子进程是否已经结束，设置并返回<code>returncode</code>属性。</li>
<li><code>Popen.wait</code>：等待子进程结束，设置并返回<code>returncode</code>属性。</li>
<li><code>Popen.communicate(input=None)</code>：与子进程进行交互。向<code>stdin</code>发送数据，或从<code>stdout</code>和<code>stderr</code>中读取数据。可选参数<code>input</code>指定发送到子进程的参数。<code>communicate</code>返回一个元组，即<code>(stdoutdata, stderrdata)</code>。注意，如果希望通过进程的<code>stdin</code>向其发送数据，在创建<code>Popen</code>对象时，参数<code>stdin</code>必须被设置为<code>PIPE</code>。同样，如果希望从<code>stdout</code>和<code>stderr</code>获取数据，必须将<code>stdout</code>和<code>stderr</code>设置为<code>PIPE</code>。</li>
<li><code>Popen.send_signal(signal)</code>：向子进程发送信号。</li>
<li><code>Popen.terminate</code>：停止(<code>stop</code>)子进程。在<code>Windows</code>平台下，该方法将调用<code>Windows</code>的<code>TerminateProcess</code>来结束子进程。</li>
<li><code>Popen.kill</code>：杀死子进程。</li>
<li><code>Popen.pid</code>：获取子进程的进程<code>ID</code>。</li>
<li><code>Popen.returncode</code>：获取进程的返回值。如果进程还没有结束，返回<code>None</code>。</li>
</ul>
<p>&emsp;&emsp;在程序中运行其他程序或<code>shell</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">subprocess.Popen(<span class="string">'shell脚本'</span>, shell=<span class="keyword">True</span>)</span><br><span class="line">subprocess.call(<span class="string">'shell脚本'</span>, shell=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>两者的区别是前者无阻塞，会和主程序并行运行，后者必须等待命令执行完毕。<br>&emsp;&emsp;有时候我们需要程序的返回结果，可以这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = subprocess.Popen(<span class="string">'ls -l'</span>, shell=<span class="keyword">True</span>, stdout=subprocess.PIPE)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.communicate()</span><br><span class="line">(<span class="string">'\xe6\x80\xbb\xe7\x94\xa8\xe9\x87\x8f 152\n</span></span><br><span class="line"><span class="string">-rw------- 1 limbo limbo   808  7\xe6\x9c\x88  6 17:46 0000-00-00-welcome-to-jekyll.markdown.erb\n</span></span><br><span class="line"><span class="string">drwx------ 2 limbo limbo  4096  8\xe6\x9c\x88 15 18:43 arg\n</span></span><br><span class="line"><span class="string">drwx------ 2 limbo limbo  4096  8\xe6\x9c\x88  7 17:37 argv\n</span></span><br><span class="line"><span class="string">drwxrwxr-x 2 limbo limbo  4096  9\xe6\x9c\x88 10 15:27 c\n</span></span><br><span class="line"><span class="string">drwxrwxr-x 3 limbo limbo  4096  9\xe6\x9c\x88 11 14:35 d3\n</span></span><br><span class="line"><span class="string">drwxrwxr-x 3 limbo limbo  4096  9\xe6\x9n'</span>, <span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>它会返回一个元组，即<code>(stdoutdata, stderrdata)</code>。<code>subprocess</code>还有另一种更简单方法，它会返回<code>stdout</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = subprocess.check_output(<span class="string">'ls -l'</span>, shell=<span class="keyword">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'\xe6\x80\xbb\xe7\x94\xa8\xe9\x87\x8f 152\n</span></span><br><span class="line"><span class="string">-rw------- 1 limbo limbo   808  7\xe6\x9c\x88  6 17:46 0000-00-00-welcome-to-jekyll.markdown.erb\n</span></span><br><span class="line"><span class="string">drwx------ 2 limbo limbo  4096  8\xe6\x9c\x88 15 18:43 arg\n</span></span><br><span class="line"><span class="string">drwx------ 2 limbo limbo  4096  8\xe6\x9c\x88  7 17:37 argv\n</span></span><br><span class="line"><span class="string">drwxrwxr-x 2 limbo limbo  4096  9\xe6\x9c\x88 10 15:27 c\n</span></span><br><span class="line"><span class="string">drwxrwxr-x 3 limbo limbo  4096  9\xe6\x9c\x88 11 14:35 d3\n</span></span><br><span class="line"><span class="string">drwxrwxr-x 3 limbo limbo  4096  9\xe6\x9n'</span></span><br></pre></td></tr></table></figure>
<p>但是前者可以实现更多的交互(例如<code>stderr</code>和<code>stdin</code>)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">​</span><br><span class="line">child1 = subprocess.Popen([<span class="string">"ls"</span>, <span class="string">"-l"</span>], stdout=subprocess.PIPE)</span><br><span class="line">child2 = subprocess.Popen([<span class="string">"wc"</span>], stdin=child1.stdout, stdout=subprocess.PIPE)</span><br><span class="line">out = child2.communicate()</span><br><span class="line">print(out)</span><br></pre></td></tr></table></figure>
<p>实际上是这样的过程：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">child1.stdout -&gt; subprocess.PIPE</span><br><span class="line">child2.stdin &lt;- subprocess.PIPE</span><br><span class="line">child2.stdout -&gt; subprocess.PIPE</span><br></pre></td></tr></table></figure>
<p><code>subprocess.PIPE</code>实际上为文本流提供一个缓存区，直到<code>communicate</code>方法从<code>PIPE</code>中读取出数据。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/02/09/Python语法/gzip模块/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="暴徒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Python语法/gzip模块/" itemprop="url">gzip模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T15:04:04+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python语法/" itemprop="url" rel="index">
                    <span itemprop="name">Python语法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="gzip-module"><a href="#gzip-module" class="headerlink" title="gzip module"></a>gzip module</h3><p>&emsp;&emsp;This module provides a simple interface to compress and decompress files just like the <code>GNU</code> programs <code>gzip</code> and <code>gunzip</code> would.<br>&emsp;&emsp;The data compression is provided by the <code>zlib</code> module.<br>&emsp;&emsp;The <code>gzip</code> module provides the <code>GzipFile</code> class, as well as the <code>open()</code>, <code>compress()</code> and <code>decompress()</code> convenience functions. The <code>GzipFile</code> class reads and writes <code>gzip-format</code> files, automatically compressing or decompressing the data so that it looks like an ordinary file object.<br>&emsp;&emsp;Note that additional file formats which can be decompressed by the <code>gzip</code> and <code>gunzip</code> programs, such as those produced by compress and pack, are not supported by this module.<br>&emsp;&emsp;The module defines the following items:<br>&emsp;&emsp;<code>gzip.open(filename, mode=&#39;rb&#39;, compresslevel=9, encoding=None, errors=None, newline=None)</code>: Open a <code>gzip-compressed</code> file in binary or text mode, returning a file object. The <code>filename</code> argument can be an actual filename (a str or bytes object), or an existing file object to read from or write to.<br>&emsp;&emsp;The <code>mode</code> argument can be any of <code>r</code>, <code>rb</code>, <code>a</code>, <code>ab</code>, <code>w</code>, <code>wb</code>, <code>x</code> or <code>xb</code> for binary mode, or <code>rt</code>, <code>at</code>, <code>wt</code>, or <code>xt</code> for text mode. The default is <code>rb</code>.<br>&emsp;&emsp;The <code>compresslevel</code> argument is an integer from <code>0</code> to <code>9</code>, as for the <code>GzipFile</code> constructor.<br>&emsp;&emsp;<code>class gzip.GzipFile(filename=None, mode=None, compresslevel=9, fileobj=None, mtime=None)</code>: Constructor for the <code>GzipFile</code> class, which simulates most of the methods of a file object, with the exception of the <code>truncate()</code> method. At least one of fileobj and filename must be given a <code>non-trivial</code> value.<br>&emsp;&emsp;The new class instance is based on fileobj, which can be a regular file, an <code>io.BytesIO</code> object, or any other object which simulates a file. It defaults to None, in which case filename is opened to provide a file object.<br>&emsp;&emsp;When fileobj is not None, the <code>filename</code> argument is only used to be included in the <code>gzip</code> file header, which may include the original filename of the uncompressed file. It defaults to the filename of fileobj, if discernible; otherwise, it defaults to the empty string, and in this case the original filename is not included in the header.<br>&emsp;&emsp;The <code>mode</code> argument can be any of <code>r</code>, <code>rb</code>, <code>a</code>, <code>ab</code>, <code>w</code>, <code>wb</code>, <code>x</code>, or <code>xb</code>, depending on whether the file will be read or written. The default is the mode of fileobj if discernible; otherwise, the default is <code>rb</code>.<br>&emsp;&emsp;Note that the file is always opened in binary mode. To open a compressed file in text mode, use <code>open()</code> (or wrap your <code>GzipFile</code> with an <code>io.TextIOWrapper</code>).<br>&emsp;&emsp;The <code>compresslevel</code> argument is an integer from <code>0</code> to <code>9</code> controlling the level of compression; <code>1</code> is fastest and produces the least compression, and <code>9</code> is slowest and produces the most compression. <code>0</code> is no compression. The default is <code>9</code>.<br>&emsp;&emsp;The <code>mtime</code> argument is an optional numeric timestamp to be written to the last modification time field in the stream when compressing. It should only be provided in compression mode. If omitted or None, the current time is used.<br>&emsp;&emsp;Calling a <code>GzipFile</code> object’s <code>close()</code> method does not close fileobj, since you might wish to append more material after the compressed data. This also allows you to pass an <code>io.BytesIO</code> object opened for writing as fileobj, and retrieve the resulting memory buffer using the <code>io.BytesIO</code> object’s <code>getvalue()</code> method.<br>&emsp;&emsp;<code>GzipFile</code> supports the <code>io.BufferedIOBase</code> interface, including iteration and the with statement. Only the <code>truncate()</code> method isn’t implemented.<br>&emsp;&emsp;<code>GzipFile</code> also provides the following method and attribute:<br>&emsp;&emsp;<code>peek(n)</code>: Read <code>n</code> uncompressed bytes without advancing the file position. At most one single read on the compressed stream is done to satisfy the call. The number of bytes returned may be more or less than requested.<br>&emsp;&emsp;Note While calling <code>peek()</code> does not change the file position of the <code>GzipFile</code>, it may change the position of the underlying file object (e.g. if the <code>GzipFile</code> was constructed with the fileobj parameter).<br>&emsp;&emsp;<code>mtime</code>: When decompressing, the value of the last modification time field in the most recently read header may be read from this attribute, as an integer. The initial value before reading any headers is None.<br>&emsp;&emsp;All <code>gzip</code> compressed streams are required to contain this timestamp field. Some programs, such as <code>gunzip</code>, make use of the timestamp. The format is the same as the return value of <code>time.time()</code> and the <code>st_mtime</code> attribute of the object returned by <code>os.stat()</code>.<br>&emsp;&emsp;<code>gzip.compress(data, compresslevel=9)</code>: Compress the <code>data</code>, returning a bytes object containing the compressed data. <code>compresslevel</code> has the same meaning as in the <code>GzipFile</code> constructor above.<br>&emsp;&emsp;<code>gzip.decompress(data)</code>: Decompress the <code>data</code>, returning a bytes object containing the uncompressed data.</p>
<h3 id="Examples-of-usage"><a href="#Examples-of-usage" class="headerlink" title="Examples of usage"></a>Examples of usage</h3><p>&emsp;&emsp;Example of how to read a compressed file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line">​</span><br><span class="line"><span class="keyword">with</span> gzip.open(<span class="string">'/home/joe/file.txt.gz'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    file_content = f.read()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Example of how to create a compressed <code>GZIP</code> file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line">​</span><br><span class="line">content = <span class="string">b"Lots of content here"</span></span><br><span class="line"><span class="keyword">with</span> gzip.open(<span class="string">'/home/joe/file.txt.gz'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(content)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Example of how to <code>GZIP</code> compress an existing file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line">​</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'/home/joe/file.txt'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f_in:</span><br><span class="line">    <span class="keyword">with</span> gzip.open(<span class="string">'/home/joe/file.txt.gz'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f_out:</span><br><span class="line">        shutil.copyfileobj(f_in, f_out)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Example of how to <code>GZIP</code> compress a binary string:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line">​</span><br><span class="line">s_in = <span class="string">b"Lots of content here"</span></span><br><span class="line">s_out = gzip.compress(s_in)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><span class="space">&hellip;</span><a class="page-number" href="/page/94/">94</a><a class="extend next" rel="next" href="/page/28/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">939</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
