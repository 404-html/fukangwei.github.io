<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="泥腿子出身">
<meta property="og:url" content="http://fukangwei.gitee.io/page/61/index.html">
<meta property="og:site_name" content="泥腿子出身">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="泥腿子出身">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/page/61/">





  <title>泥腿子出身</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泥腿子出身</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QReadWriteLock/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QReadWriteLock/" itemprop="url">Qt之QReadWriteLock</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T16:28:02+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;The <code>QReadWriteLock</code> class provides <code>read-write</code> locking. The header file is <code>QReadWriteLock</code>. <strong>Note</strong>: All functions in this class are <code>thread-safe</code>.</p>
<h3 id="Public-Types"><a href="#Public-Types" class="headerlink" title="Public Types"></a>Public Types</h3><ul>
<li><code>enum</code>: RecursionMode { <code>Recursive</code>, <code>NonRecursive</code> }</li>
</ul>
<h3 id="Public-Functions"><a href="#Public-Functions" class="headerlink" title="Public Functions"></a>Public Functions</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     QReadWriteLock()</span><br><span class="line">     QReadWriteLock(RecursionMode recursionMode)</span><br><span class="line">     ~QReadWriteLock()</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lockForRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lockForWrite</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryLockForRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryLockForRead</span><span class="params">(<span class="keyword">int</span> timeout)</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryLockForWrite</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryLockForWrite</span><span class="params">(<span class="keyword">int</span> timeout)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Detailed-Description"><a href="#Detailed-Description" class="headerlink" title="Detailed Description"></a>Detailed Description</h3><p>&emsp;&emsp;The <code>QReadWriteLock</code> class provides <code>read-write</code> locking.<br>&emsp;&emsp;A <code>read-write</code> lock is a synchronization tool for protecting resources that can be accessed for <code>reading</code> and <code>writing</code>. This type of lock is useful if you want to allow multiple threads to have simultaneous <code>read-only</code> access, but as soon as one thread wants to write to the resource, all other threads must be blocked until the <code>writing</code> is complete.<br>&emsp;&emsp;In many cases, <code>QReadWriteLock</code> is a direct competitor to <code>QMutex</code>. <code>QReadWriteLock</code> is a good choice if there are many concurrent reads and <code>writing</code> occurs infrequently. Example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">QReadWriteLock lock;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">void</span> ReaderThread::run() &#123;</span><br><span class="line">    ...</span><br><span class="line">    lock.lockForRead();</span><br><span class="line">    read_file();</span><br><span class="line">    lock.unlock();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">void</span> WriterThread::run() &#123;</span><br><span class="line">    ...</span><br><span class="line">    lock.lockForWrite();</span><br><span class="line">    write_file();</span><br><span class="line">    lock.unlock();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To ensure that writers aren’t blocked forever by readers, readers attempting to obtain a lock will not succeed if there is a blocked writer waiting for access, even if the lock is currently only accessed by other readers. Also, if the lock is accessed by a writer and another writer comes in, that writer will have priority over any readers that might also be waiting.<br>&emsp;&emsp;Like <code>QMutex</code>, a <code>QReadWriteLock</code> can be recursively locked by the same thread when constructed in <code>QReadWriteLock::RecursionMode</code>. In such cases, <code>unlock()</code> must be called the same number of times <code>lockForWrite()</code> or <code>lockForRead()</code> was called. Note that the lock type cannot be changed when trying to lock recursively, i.e. it is not possible to lock for <code>reading</code> in a thread that already has locked for <code>writing</code> (and vice versa).</p>
<h3 id="Member-Type-Documentation"><a href="#Member-Type-Documentation" class="headerlink" title="Member Type Documentation"></a>Member Type Documentation</h3><ul>
<li><code>enum</code>: <code>QReadWriteLock::RecursionMode</code></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Constant</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>QReadWriteLock::Recursive</code></td>
<td><code>1</code></td>
<td>In this mode, a thread can lock the same <code>QReadWriteLock</code> multiple times and the mutex won’t be unlocked until a corresponding number of <code>unlock()</code> calls have been made.</td>
</tr>
<tr>
<td><code>QReadWriteLock::NonRecursive</code></td>
<td><code>0</code></td>
<td>In this mode, a thread may only lock a <code>QReadWriteLock</code> once.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Member-Function-Documentation"><a href="#Member-Function-Documentation" class="headerlink" title="Member Function Documentation"></a>Member Function Documentation</h3><ul>
<li><code>QReadWriteLock::QReadWriteLock()</code>: Constructs a <code>QReadWriteLock</code> object in <code>NonRecursive</code> mode.</li>
<li><code>QReadWriteLock::QReadWriteLock(RecursionMode recursionMode)</code>: Constructs a <code>QReadWriteLock</code> object in the given <code>recursionMode</code>.</li>
<li><code>QReadWriteLock::~QReadWriteLock()</code>: Destroys the <code>QReadWriteLock</code> object. <strong>Warning</strong>: Destroying a <code>read-write</code> <code>lock</code> that is in use may result in undefined behavior.</li>
<li><code>void QReadWriteLock::lockForRead()</code>: Locks the <code>lock</code> for <code>reading</code>. This function will block the current thread if any thread (including the current) has locked for <code>writing</code>.</li>
<li><code>void QReadWriteLock::lockForWrite()</code>: Locks the <code>lock</code> for <code>writing</code>. This function will block the current thread if another thread has locked for <code>reading</code> or <code>writing</code>.</li>
<li><code>bool QReadWriteLock::tryLockForRead()</code>: <code>Attempts</code> to <code>lock</code> for <code>reading</code>. If the lock was obtained, this function returns <code>true</code>, otherwise it returns <code>false</code> instead of waiting for the lock to become available, i.e. it does not block. The lock attempt will fail if another thread has locked for <code>writing</code>. If the lock was obtained, the lock must be unlocked with <code>unlock()</code> before another thread can successfully lock it.</li>
<li><code>bool QReadWriteLock::tryLockForRead(int timeout)</code>: This is an overloaded function. <code>Attempts</code> to <code>lock</code> for <code>reading</code>. This function returns <code>true</code> if the lock was obtained; otherwise it returns <code>false</code>. If another thread has locked for <code>writing</code>, this function will wait for at most <code>timeout</code> milliseconds for the lock to become available. <strong>Note</strong>: Passing a negative number as the <code>timeout</code> is equivalent to calling <code>lockForRead()</code>, i.e. this function will wait forever until lock can be locked for <code>reading</code> when <code>timeout</code> is negative. If the lock was obtained, the lock must be unlocked with <code>unlock()</code> before another thread can successfully lock it.</li>
<li><code>bool QReadWriteLock::tryLockForWrite()</code>: <code>Attempts</code> to <code>lock</code> for <code>writing</code>. If the lock was obtained, this function returns <code>true</code>; otherwise, it returns <code>false</code> immediately. The lock attempt will fail if another thread has locked for <code>reading</code> or <code>writing</code>. If the lock was obtained, the lock must be unlocked with <code>unlock()</code> before another thread can successfully lock it.</li>
<li><code>bool QReadWriteLock::tryLockForWrite(int timeout)</code>: This is an overloaded function. <code>Attempts</code> to <code>lock</code> for <code>writing</code>. This function returns <code>true</code> if the lock was obtained; otherwise it returns <code>false</code>. If another thread has locked for <code>reading</code> or <code>writing</code>, this function will wait for at most <code>timeout</code> milliseconds for the lock to become available. <strong>Note</strong>: Passing a negative number as the <code>timeout</code> is equivalent to calling <code>lockForWrite()</code>, i.e. this function will wait forever until lock can be locked for <code>writing</code> when <code>timeout</code> is negative. If the lock was obtained, the lock must be unlocked with <code>unlock()</code> before another thread can successfully lock it.</li>
<li><code>void QReadWriteLock::unlock()</code>: <code>Unlocks</code> the lock. Attempting to unlock a lock that is not locked is an error, and will result in program termination.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QSemaphore/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QSemaphore/" itemprop="url">Qt之QSemaphore</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T15:47:32+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;The <code>QSemaphore</code> class provides a general counting semaphore. The header file is <code>QSemaphore</code>. <strong>Note</strong>: All functions in this class are <code>thread-safe</code>.</p>
<h3 id="Public-Functions"><a href="#Public-Functions" class="headerlink" title="Public Functions"></a>Public Functions</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">     QSemaphore(<span class="keyword">int</span> n = <span class="number">0</span>)</span><br><span class="line">     ~QSemaphore()</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> n = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">available</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> n = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> n = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> timeout)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Detailed-Description"><a href="#Detailed-Description" class="headerlink" title="Detailed Description"></a>Detailed Description</h3><p>&emsp;&emsp;The <code>QSemaphore</code> class provides a general counting semaphore. A semaphore is a generalization of a mutex. While a mutex can only be locked once, it’s possible to acquire a semaphore multiple times. Semaphores are typically used to protect a certain number of identical resources. Semaphores support two fundamental operations, <code>acquire()</code> and <code>release()</code>:</p>
<ul>
<li><code>acquire(n)</code> tries to acquire <code>n</code> resources. If there aren’t that many resources available, the call will block until this is the case.</li>
<li><code>release(n)</code> releases <code>n</code> resources.</li>
</ul>
<p>&emsp;&emsp;There’s also a <code>tryAcquire()</code> function that returns immediately if it cannot acquire the resources, and an <code>available()</code> function that returns the number of available resources at any time. Example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QSemaphore <span class="title">sem</span> <span class="params">( <span class="number">5</span> )</span></span>; <span class="comment">/* sem.available() = 5 */</span></span><br><span class="line">​</span><br><span class="line">sem.acquire ( <span class="number">3</span> ); <span class="comment">/* sem.available() = 2 */</span></span><br><span class="line">sem.acquire ( <span class="number">2</span> ); <span class="comment">/* sem.available() = 0 */</span></span><br><span class="line">sem.release ( <span class="number">5</span> ); <span class="comment">/* sem.available() = 5 */</span></span><br><span class="line">sem.release ( <span class="number">5</span> ); <span class="comment">/* sem.available() = 10 */</span></span><br><span class="line">​</span><br><span class="line">sem.tryAcquire ( <span class="number">1</span> ); <span class="comment">/* sem.available() = 9, returns true */</span></span><br><span class="line">sem.tryAcquire ( <span class="number">250</span> ); <span class="comment">/* sem.available() = 9, returns false */</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;A typical application of semaphores is for controlling access to a circular buffer shared by a producer thread and a consumer thread. The Semaphores example shows how to use <code>QSemaphore</code> to solve that problem.<br>&emsp;&emsp;A <code>non-computing</code> example of a semaphore would be dining at a restaurant. A semaphore is initialized with the number of chairs in the restaurant. As people arrive, they want a seat. As seats are filled, <code>available()</code> is decremented. As people leave, the <code>available()</code> is incremented, allowing more people to enter. If a party of <code>10</code> people want to be seated, but there are only <code>9</code> seats, those <code>10</code> people will wait, but a party of <code>4</code> people would be seated (taking the available seats to <code>5</code>, making the party of <code>10</code> people wait longer).</p>
<h3 id="Member-Function-Documentation"><a href="#Member-Function-Documentation" class="headerlink" title="Member Function Documentation"></a>Member Function Documentation</h3><ul>
<li><code>QSemaphore::QSemaphore(int n = 0)</code>: Creates a new semaphore and initializes the number of resources it guards to <code>n</code> (by default, <code>0</code>).</li>
<li><code>QSemaphore::~QSemaphore()</code>: Destroys the semaphore. Warning: Destroying a semaphore that is in use may result in undefined behavior.</li>
<li><code>void QSemaphore::acquire(int n = 1)</code>: Tries to <code>acquire</code> <code>n</code> resources guarded by the semaphore. If <code>n</code> &gt; <code>available()</code>, this call will block until enough resources are available.</li>
<li><code>int QSemaphore::available() const</code>: Returns the number of resources currently <code>available</code> to the semaphore. This number can never be negative.</li>
<li><code>void QSemaphore::release(int n = 1)</code>: <code>Releases</code> <code>n</code> resources guarded by the semaphore. This function can be used to <code>&quot;create&quot;</code> resources as well. For example:</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QSemaphore <span class="title">sem</span> <span class="params">( <span class="number">5</span> )</span></span>; <span class="comment">/* a semaphore that guards 5 resources */</span></span><br><span class="line">sem.acquire ( <span class="number">5</span> ); <span class="comment">/* acquire all 5 resources */</span></span><br><span class="line">sem.release ( <span class="number">5</span> ); <span class="comment">/* release the 5 resources */</span></span><br><span class="line">sem.release ( <span class="number">10</span> ); <span class="comment">/* "create" 10 new resources */</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>bool QSemaphore::tryAcquire(int n = 1)</code>: Tries to <code>acquire</code> <code>n</code> resources guarded by the semaphore and returns <code>true</code> on success. If <code>available()</code> &lt; <code>n</code>, this call immediately returns <code>false</code> without acquiring any resources. Example:</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QSemaphore <span class="title">sem</span> <span class="params">( <span class="number">5</span> )</span></span>; <span class="comment">/* sem.available() = 5 */</span></span><br><span class="line">sem.tryAcquire ( <span class="number">250</span> ); <span class="comment">/* sem.available() = 5, returns false */</span></span><br><span class="line">sem.tryAcquire ( <span class="number">3</span> ); <span class="comment">/* sem.available() = 2, returns true */</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>bool QSemaphore::tryAcquire(int n, int timeout)</code>: Tries to <code>acquire</code> <code>n</code> resources guarded by the semaphore and returns <code>true</code> on success. If <code>available()</code> &lt; <code>n</code>, this call will wait for at most <code>timeout</code> milliseconds for resources to become <code>available</code>. <strong>Note</strong>: Passing a negative number as the <code>timeout</code> is equivalent to calling <code>acquire()</code>, i.e. this function will wait forever for resources to become available if <code>timeout</code> is negative. Example:</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QSemaphore <span class="title">sem</span> <span class="params">( <span class="number">5</span> )</span></span>; <span class="comment">/* sem.available() = 5 */</span></span><br><span class="line"><span class="comment">/* sem.available() = 5, waits 1000 milliseconds and returns false */</span></span><br><span class="line">sem.tryAcquire ( <span class="number">250</span>, <span class="number">1000</span> );</span><br><span class="line"><span class="comment">/* sem.available() = 2, returns true without waiting */</span></span><br><span class="line">sem.tryAcquire ( <span class="number">3</span>, <span class="number">30000</span> );</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QTime/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QTime/" itemprop="url">Qt之QTime</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T14:16:18+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;在<code>Qt</code>中，可以利用<code>QTime</code>类来控制时间，这里介绍一下<code>QTime</code>的成员函数的用法：</p>
<ul>
<li><code>QTime::QTime()</code>：默认构造函数，构造一个时、分、秒都为<code>0</code>的时间，例如<code>00:00:00.000</code>(午夜)。</li>
<li><code>QTime::QTime(int h, int m, int s = 0, int ms = 0)</code>：构造一个用户指定时、分、秒的时间，参数有效值范围：<code>h</code>为<code>0</code>至<code>23</code>，<code>m</code>为<code>0</code>至<code>59</code>，<code>ms</code>为<code>0</code>至<code>999</code>。</li>
<li><code>QTime QTime::addMSecs(int ms) const</code>：返回一个当前时间对象之后或之前<code>ms</code>毫秒的时间对象(之前还是之后要看<code>ms</code>的符号，如果为正，就是之后，否则是之前)：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QTime <span class="title">time</span> <span class="params">( <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span> )</span></span>;</span><br><span class="line">QTime newTime1 = time.addMSecs ( <span class="number">1000</span> );</span><br><span class="line">QTime newTime2 = time.addMSecs ( <span class="number">-1000</span> );</span><br></pre></td></tr></table></figure>
<p><code>newTime1</code>是一个比<code>time</code>所指定时间(<code>03:00:00.000</code>)延后<code>1000</code>毫秒(即<code>1</code>秒)的时间(<code>03:00:01.000</code>)，而<code>newTime2</code>则提前<code>1000</code>毫秒(<code>02:59:59.000</code>)。</p>
<ul>
<li><code>QTime QTime::addSecs(int nsecs) const</code>：与<code>addMSecs</code>相同，只是<code>nsecs</code>单位为秒，即返回一个当前时间对象之前或之后的时间对象。</li>
<li><code>int QTime::elapsed() const</code>：返回最后一次调用<code>start</code>或<code>restart</code>到现在已经经过的毫秒数。如果超过<code>24</code>小时，则计数器置<code>0</code>。</li>
<li><code>int QTime::hour() const</code>：返回时间对象的小时，取值范围为<code>0</code>至<code>23</code>。</li>
<li><code>int QTime::minute() const</code>：返回时间对象的分钟，取值范围为<code>0</code>至<code>59</code>。</li>
<li><code>int QTime::second() const</code>：返回时间对象的秒，取值范围为<code>0</code>至<code>59</code>。</li>
<li><code>int QTime::msec() const</code>：返回时间对象的毫秒，取值范围为<code>0</code>至<code>999</code>。</li>
<li><code>bool QTime::isNull() const</code>：如果时间对象等于<code>00:00:00.000</code>，就返回<code>true</code>，否则返回<code>false</code>。</li>
<li><code>bool QTime::isValid() const</code>：如果时间对象是有效的，就返回<code>true</code>，否则返回<code>false</code>(就是说时、分、秒、毫秒的数值都在其取值范围之内)。</li>
<li><code>int QTime::msecsTo(const QTime &amp;t) const</code>：返回当前时间对象到<code>t</code>所指定的时间之间的毫秒数。如果<code>t</code>早于当前时间对象的时间，则返回的值是负值。因为一天的时间是<code>86400000</code>毫秒，所以返回值范围是<code>-86400000</code>至<code>86400000</code>。</li>
<li><code>int QTime::secsTo(const QTime &amp;t) const</code>：与<code>msecsTo</code>基本相同，只是返回的是秒数，返回值的有效范围是<code>-86400</code>至<code>86400</code>。</li>
<li><code>int QTime::restart()</code>：设置当前时间对象的值为当前系统时间，并且返回从最后一次调用<code>start</code>或<code>restart</code>到现在的毫秒数。如果超过<code>24</code>小时，则计数器置<code>0</code>。</li>
<li><code>bool QTime::setHMS(int h, int m, int s, int ms = 0)</code>：设置当前时间对象的时、分、秒和毫秒。如果给定的参数值有效，就返回<code>true</code>，否则返回<code>false</code>。</li>
<li><code>void QTime::start()</code>：设置当前时间对象的值为当前系统时间，这个函数实际上是结合<code>restart</code>和<code>elapsed</code>来计数的。</li>
<li><code>QString QTime::toString(const QString &amp;format) const</code>：按照参数<code>format</code>指定的格式用字符串形式输出当前时间对象的时间。参数<code>format</code>用来指定时、分、秒、毫秒的输出格式，例如<code>hh:mm:ss.zzz AP/ap</code>。</li>
</ul>
<ol>
<li><code>h</code>表示小时，范围是<code>0</code>至<code>23</code>；<code>hh</code>用两位数表示小时，不足两位的前面用<code>0</code>补足，例如<code>0</code>点为<code>00</code>，<code>3</code>点为<code>03</code>，<code>11</code>点为<code>11</code>。</li>
<li><code>m</code>表示分钟，范围是<code>0</code>至<code>59</code>；<code>mm</code>用两位数表示分钟，不足两位的前面用<code>0</code>补足。</li>
<li><code>s</code>表示秒，范围是<code>0</code>至<code>59</code>；<code>ss</code>用两位数表示秒，不足两位的前面用<code>0</code>补足。</li>
<li><code>z</code>表示毫秒，范围是<code>0</code>至<code>999</code>；<code>zzz</code>用三位数表示毫秒，不足三位的前面用<code>0</code>补足。</li>
<li><code>AP</code>表示用<code>AM/PM</code>显示，<code>ap</code>表示用<code>ap/pm</code>显示。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QTime <span class="title">time</span> <span class="params">( <span class="number">14</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">42</span> )</span></span>; <span class="comment">/* 设置时间为“14:03:09.042” */</span></span><br><span class="line">QString i = time.toString ( <span class="string">"hh:mm:ss.zzz"</span> ); <span class="comment">/* 结果为“14:03:09.042” */</span></span><br><span class="line">QString j = time.toString ( <span class="string">"h:m:s.z"</span> ); <span class="comment">/* 结果为“14:3:9.42” */</span></span><br><span class="line">QString m = time.toString ( <span class="string">"h:m:s.z AP"</span> ); <span class="comment">/* 结果为“2:3:9.42 PM” */</span></span><br><span class="line">QString n = time.toString ( <span class="string">"h:m:s.z ap"</span> ); <span class="comment">/* 结果为“2:3:9.42 pm” */</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>QString QTime::toString(Qt::DateFormat f = Qt::TextDate) const</code>：按照参数<code>format</code>指定的格式用字符串形式输出当前时间对象的时间。<code>f</code>可选值如下：</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>可选值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Qt::TextDate</code></td>
<td>格式为<code>HH:MM:SS</code></td>
</tr>
<tr>
<td><code>Qt::ISODate</code></td>
<td><code>ISO 8601</code>标准的时间表示格式，同样也为<code>HH:MM:SS</code></td>
</tr>
<tr>
<td><code>Qt::LocalDate</code></td>
<td>字符串格式依赖系统本地设置</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;&emsp;静态成员函数如下：</p>
<ul>
<li><code>QTime QTime::currentTime()</code>：返回当前的系统时间。</li>
<li><code>QTime QTime::fromString(const QString &amp;string, Qt::DateFormat format = Qt::TextDate)</code>：使用参数<code>format</code>指定的格式，根据参数<code>string</code>指定的时间返回一个时间对象。如果<code>string</code>指定的时间不合法，则返回一个无效的时间对象。<code>format</code>可选值如下：</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>可选值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Qt::TextDate</code></td>
<td>格式为<code>HH:MM:SS</code></td>
</tr>
<tr>
<td><code>Qt::ISODate</code></td>
<td><code>ISO 8601</code>标准的时间表示格式，同样也为<code>HH:MM:SS</code></td>
</tr>
<tr>
<td><code>Qt::LocalDate</code></td>
<td>字符串格式依赖系统本地设置</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>QTime QTime::fromString(const QString &amp;string, const QString &amp;format)</code>：使用参数<code>format</code>指定的格式，根据参数<code>string</code>指定的时间返回一个时间对象。如果<code>string</code>指定的时间不合法，则返回一个无效的时间对象。<code>format</code>的格式参考<code>QString QTime::toString(const QString &amp;format) const</code>。</li>
<li><code>bool QTime::isValid(int h, int m, int s, int ms = 0)</code>：如果参数所指定的时间是合法的，就返回<code>true</code>，否则返回<code>false</code>。</li>
</ul>
<p>&emsp;&emsp;静态成员函数不依赖于对象，可以通过类直接调用。例如获取当前系统时间的小时部分不需要定义<code>QTime</code>对象：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> hour = QTime::currentTime().hour();</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QSharedMemory/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QSharedMemory/" itemprop="url">Qt之QSharedMemory</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T12:28:04+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Qt</code>提供了<code>QSharedMemory</code>类来访问共享内存，实现共享内存的操作。</p>
<h3 id="创建QSharedMemory类对象"><a href="#创建QSharedMemory类对象" class="headerlink" title="创建QSharedMemory类对象"></a>创建QSharedMemory类对象</h3><p>&emsp;&emsp;利用<code>QSharedMemory</code>类创建实例对象时，必须为该共享内存指定关键字(即为该共享内存起一个名字)。只有当共享内存被设置了关键字之后，才可以执行创建(<code>create</code>)、关联(<code>attach</code>)等操作。为共享内存指定关键字有两种方法：</p>
<ul>
<li>通过构造函数<code>QSharedMemory::QSharedMemory ( const QString &amp; key, QObject * parent =0 )</code>为实例对象传入关键字：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SharedMemory *sharememory;</span><br><span class="line">sharememory = newQSharedMemory ( <span class="string">"QSharedMemoryExample"</span> );</span><br></pre></td></tr></table></figure>
<ul>
<li>通过构造函数<code>QSharedMemory::QSharedMemory (QObject * parent = 0 )</code>构造实例对象，之后调用<code>setKey</code>函数为该实例对象设置关键字：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QSharedMemory *sharememory;</span><br><span class="line">sharememory = <span class="keyword">new</span> QSharedMemory();</span><br><span class="line">sharememory-&gt;setKey ( <span class="string">"QSharedMemoryExample"</span> );</span><br></pre></td></tr></table></figure>
<h3 id="创建共享内存"><a href="#创建共享内存" class="headerlink" title="创建共享内存"></a>创建共享内存</h3><p>&emsp;&emsp;如下代码为<code>QSharedMemory</code>类实例对象创建一个空间大小为<code>size</code>的共享内存，该内存空间默认的访问方式为可读可写。共享内存创建成功返回<code>true</code>，否则返回<code>false</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> QSharedMemory::create ( <span class="keyword">int</span> size, AccessMode mode = ReadWrite );</span><br></pre></td></tr></table></figure>
<p><code>QSharedMemory</code>类定义一个枚举类变量<code>AccessMode</code>，指定了两种共享内存的访问方式：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QSharedMemory::ReadOnly <span class="comment">/* 只读方式访问共享内存 */</span></span><br><span class="line">QSharedMemory::ReadWrite  <span class="comment">/* 读写方式访问共享内存 */</span></span><br></pre></td></tr></table></figure>
<h3 id="关联共享内存"><a href="#关联共享内存" class="headerlink" title="关联共享内存"></a>关联共享内存</h3><p>&emsp;&emsp;如下代码将以关键字<code>key</code>命名的共享内存和当前程序进行关联，共享内存默认的访问方式为可读可写。如果程序和共享内存关联成功，返回<code>true</code>，否则返回<code>false</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> QSharedMemory::attach ( AccessMode mode = ReadWrite );</span><br></pre></td></tr></table></figure>
<h3 id="分离共享内存"><a href="#分离共享内存" class="headerlink" title="分离共享内存"></a>分离共享内存</h3><p>&emsp;&emsp;如下代码解除共享内存和程序的关联，即调用该函数后，程序不可以再访问共享内存：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> QSharedMemory::detach ();</span><br></pre></td></tr></table></figure>
<p>如果该共享内存被多个程序实例所关联，当最后一个程序实例和共享内存解除关联后，该共享内存将由操作系统自动释放掉。分离操作成功，则返回<code>true</code>；如果返回<code>false</code>，通常意味着该共享内存和程序分离失败，可能其他程序当前正在访问该共享内存。</p>
<h3 id="判断共享内存的关联状态"><a href="#判断共享内存的关联状态" class="headerlink" title="判断共享内存的关联状态"></a>判断共享内存的关联状态</h3><p>&emsp;&emsp;函数<code>isAttached</code>用来判断程序(调用该函数的程序)是否和共享内存进行关联，如果是，就返回<code>true</code>，否则返回<code>false</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> QSharedMemory::isAttached () <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
<h3 id="设置-获取共享内存的关键字"><a href="#设置-获取共享内存的关键字" class="headerlink" title="设置/获取共享内存的关键字"></a>设置/获取共享内存的关键字</h3><p>&emsp;&emsp;<code>Qt</code>应用程序通过关键字来辨识共享内存。<code>key</code>函数用来获取共享内存的关键字，如果没有指定实例对象的关键字，或者共享内存的关键字是由<code>nativeKey</code>函数指定的话，则返回<code>NULL</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QString QSharedMemory::key () <span class="keyword">const</span>; <span class="comment">/* 获取共享内存关键字 */</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>setKey</code>函数用来为共享内存段设定关键字(为共享内存命名)，如果参数<code>key</code>的值和构造函数或者之前指定的关键字相同的话，则该函数将不做任何操作，直接返回：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> QSharedMemory::setKey ( <span class="keyword">const</span> QString &amp;key ); <span class="comment">/* 设定共享内存关键字 */</span></span><br></pre></td></tr></table></figure>
<h3 id="锁定-解锁共享内存"><a href="#锁定-解锁共享内存" class="headerlink" title="锁定/解锁共享内存"></a>锁定/解锁共享内存</h3><p>&emsp;&emsp;为了保证共享内存中数据的完整性，当一个进程在读写共享内存的时候，其他进程不允许对该共享区域进行访问。<code>QSharedMemory</code>类提供了<code>lock</code>函数和<code>unlock</code>函数来实现这一共享内存访问机制。某一程序对共享内存进行读写操作之前，需要调用<code>lock</code>函数锁定该共享内存，之后独享共享内存中的数据，并对数据进行读写等操作；共享内存访问完毕，调用<code>unlock</code>函数，释放共享内存的使用权限。<br>&emsp;&emsp;如果共享内存资源当前处于释放状态，进程调用<code>lock</code>函数将共享内存中的资源锁定，并返回<code>true</code>，其他进程将不能访问该共享内存：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> QSharedMemory::lock (); <span class="comment">/* 锁定共享内存 */</span></span><br></pre></td></tr></table></figure>
<p>如果共享内存被其他进程占用时，则该函数会一直处于阻塞状态，直到其他进程使用完毕，并且释放共享内存资源。<br>&emsp;&emsp;如果共享内存资源被当前进程所占有，调用<code>unlock</code>函数将解锁该共享资源，并返回<code>true</code>。如果当前进程没有占用该资源，或者共享内存被其他进程访问，则不做任何操作，并返回<code>false</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> QSharedMemory::unlock (); <span class="comment">/* 解锁共享内存 */</span></span><br></pre></td></tr></table></figure>
<h3 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h3><p>&emsp;&emsp;当共享内存出错时，调用<code>error</code>函数显示相应的错误代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharedMemoryError QSharedMemory::error () <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;当共享内存出错时，调用<code>errorString</code>函数，以文本形式显示错误原因：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QString QSharedMemory::errorString () <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
<h3 id="获取共享内存的地址"><a href="#获取共享内存的地址" class="headerlink" title="获取共享内存的地址"></a>获取共享内存的地址</h3><p>&emsp;&emsp;在程序关联共享内存的前提下，调用<code>constData</code>或<code>data</code>函数返回共享内存中数据的起始地址。如果没有关联共享内存，则返回<code>0</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">void</span> *QSharedMemory::constData () <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">void</span> *QSharedMemory::data ();</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">void</span> *QSharedMemory::data () <span class="keyword">const</span>; <span class="comment">/* 重载函数 */</span></span><br></pre></td></tr></table></figure>
<h3 id="获取共享内存的大小"><a href="#获取共享内存的大小" class="headerlink" title="获取共享内存的大小"></a>获取共享内存的大小</h3><p>&emsp;&emsp;调用<code>size</code>函数将返回程序所关联的共享内存的大小(字节)。如果没有关联的共享内存，则返回<code>0</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> QSharedMemory::size () <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/QT之paintEvent事件/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/QT之paintEvent事件/" itemprop="url">QT之paintEvent事件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T11:36:16+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;当发生以下情况时，<code>Qt</code>会产生绘制事件，并调用<code>paintEvent</code>函数：</p>
<ul>
<li>在窗口部件第一次显示时，系统会自动产生一个绘图事件，从而强制绘制这个窗口部件。</li>
<li>当重新调整窗口部件的大小时，系统也会产生一个绘制事件。</li>
<li>当窗口部件被其他窗口部件遮挡，然后又再次显示出来的时候，就会对那些隐藏的区域产生一个绘制事件。</li>
</ul>
<p>&emsp;&emsp;同时可以调用<code>QWidget::update</code>或者<code>QWidget::repaint</code>来强制产生一个绘制事件。二者的区别是：<code>repaint</code>函数会强制产生一个即时的重绘事件，而<code>update</code>函数只是在<code>Qt</code>下一次处理事件时才调用一次绘制事件。如果多次调用<code>update</code>，<code>Qt</code>会把连续多次的绘制事件压缩成一个单一的绘制事件，这样可避免闪烁现象。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QTextListFormat/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QTextListFormat/" itemprop="url">Qt之QTextListFormat</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T10:19:23+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;The <code>QTextListFormat</code> class provides formatting information for lists in a <code>QTextDocument</code>.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Header</th>
<th>Inherits</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>QTextListFormat</code></td>
<td><code>QTextFormat</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Note</strong>: All functions in this class are reentrant.</p>
<h3 id="Public-Types"><a href="#Public-Types" class="headerlink" title="Public Types"></a>Public Types</h3><ul>
<li><code>enum</code>: Style { <code>ListDisc</code>, <code>ListCircle</code>, <code>ListSquare</code>, <code>ListDecimal</code>, …, <code>ListUpperRoman</code> }</li>
</ul>
<h3 id="Public-Functions"><a href="#Public-Functions" class="headerlink" title="Public Functions"></a>Public Functions</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">        QTextListFormat()</span><br><span class="line"><span class="function"><span class="keyword">int</span>     <span class="title">indent</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span>    <span class="title">isValid</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">QString <span class="title">numberPrefix</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">QString <span class="title">numberSuffix</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span>    <span class="title">setIndent</span><span class="params">(<span class="keyword">int</span> indentation)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span>    <span class="title">setNumberPrefix</span><span class="params">(<span class="keyword">const</span> QString &amp; numberPrefix)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span>    <span class="title">setNumberSuffix</span><span class="params">(<span class="keyword">const</span> QString &amp; numberSuffix)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span>    <span class="title">setStyle</span><span class="params">(Style style)</span></span></span><br><span class="line"><span class="function">Style   <span class="title">style</span><span class="params">()</span> <span class="keyword">const</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Detailed-Description"><a href="#Detailed-Description" class="headerlink" title="Detailed Description"></a>Detailed Description</h3><p>&emsp;&emsp;The <code>QTextListFormat</code> class provides formatting information for lists in a <code>QTextDocument</code>.<br>&emsp;&emsp;A list is composed of one or more items, represented as text blocks. The list’s format specifies the appearance of items in the list. In particular, it determines the indentation and the style of each item.<br>&emsp;&emsp;The indentation of the items is an integer value that causes each item to be offset from the left margin by a certain amount. This value is read with <code>indent()</code> and set with <code>setIndent()</code>.<br>&emsp;&emsp;The style used to decorate each item is set with <code>setStyle()</code> and can be read with the <code>style()</code> function. The style controls the type of bullet points and numbering scheme used for items in the list. Note that lists that use the decimal numbering scheme begin counting at <code>1</code> rather than <code>0</code>.<br>&emsp;&emsp;Style properties can be set to further configure the appearance of list items; for example, the <code>ListNumberPrefix</code> and <code>ListNumberSuffix</code> properties can be used to customize the numbers used in an ordered list so that they appear as <code>(1), (2), (3)</code>, etc.:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QTextListFormat listFormat;</span><br><span class="line">​</span><br><span class="line">listFormat.setStyle ( QTextListFormat::ListDecimal );</span><br><span class="line">listFormat.setNumberPrefix ( <span class="string">"("</span> );</span><br><span class="line">listFormat.setNumberSuffix ( <span class="string">")"</span> );</span><br><span class="line">​</span><br><span class="line">cursor.insertList ( listFormat );</span><br></pre></td></tr></table></figure>
<h3 id="Member-Type-Documentation"><a href="#Member-Type-Documentation" class="headerlink" title="Member Type Documentation"></a>Member Type Documentation</h3><p>&emsp;&emsp;<code>enum QTextListFormat::Style</code>: This enum describes the symbols used to decorate list items:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Constant</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>QTextListFormat::ListDisc</code></td>
<td><code>-1</code></td>
<td>a filled <code>circle</code></td>
</tr>
<tr>
<td><code>QTextListFormat::ListCircle</code></td>
<td><code>-2</code></td>
<td>an empty <code>circle</code></td>
</tr>
<tr>
<td><code>QTextListFormat::ListSquare</code></td>
<td><code>-3</code></td>
<td>a filled <code>square</code></td>
</tr>
<tr>
<td><code>QTextListFormat::ListDecimal</code></td>
<td><code>-4</code></td>
<td><code>decimal</code> values in ascending order</td>
</tr>
<tr>
<td><code>QTextListFormat::ListLowerAlpha</code></td>
<td><code>-5</code></td>
<td><code>lower</code> case Latin characters in <code>alphabetical</code> order</td>
</tr>
<tr>
<td><code>QTextListFormat::ListUpperAlpha</code></td>
<td><code>-6</code></td>
<td><code>upper</code> case Latin characters in <code>alphabetical</code> order</td>
</tr>
<tr>
<td><code>QTextListFormat::ListLowerRoman</code></td>
<td><code>-7</code></td>
<td><code>lower</code> case <code>roman</code> numerals (supports up to <code>4999</code> items only)</td>
</tr>
<tr>
<td><code>QTextListFormat::ListUpperRoman</code></td>
<td><code>-8</code></td>
<td><code>upper</code> case <code>roman</code> numerals (supports up to <code>4999</code> items only)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Member-Function-Documentation"><a href="#Member-Function-Documentation" class="headerlink" title="Member Function Documentation"></a>Member Function Documentation</h3><ul>
<li><code>QTextListFormat::QTextListFormat()</code>: Constructs a new list format <code>object</code>.</li>
<li><code>int QTextListFormat::indent() const</code>: Returns the list format’s <code>indentation</code>. The indentation is multiplied by the <code>QTextDocument::indentWidth</code> property to get the effective <code>indent</code> in pixels.</li>
<li><code>bool QTextListFormat::isValid() const</code>: Returns <code>true</code> if this list format is <code>valid</code>; otherwise returns <code>false</code>.</li>
<li><code>QString QTextListFormat::numberPrefix() const</code>: Returns the list format’s number <code>prefix</code>.</li>
<li><code>QString QTextListFormat::numberSuffix() const</code>: Returns the list format’s number <code>suffix</code>.</li>
<li><code>void QTextListFormat::setIndent(int indentation)</code>: Sets the list format’s <code>indentation</code>. The indentation is multiplied by the <code>QTextDocument::indentWidth</code> property to get the effective <code>indent</code> in pixels.</li>
<li><code>void QTextListFormat::setNumberPrefix(const QString &amp; numberPrefix)</code>: Sets the list format’s number <code>prefix</code> to the string specified by <code>numberPrefix</code>. This can be used with all sorted list types. It does not have any effect on unsorted list types. The default prefix is an empty string.</li>
<li><code>void QTextListFormat::setNumberSuffix(const QString &amp; numberSuffix)</code>: Sets the list format’s number <code>suffix</code> to the string specified by <code>numberSuffix</code>. This can be used with all sorted list types. It does not have any effect on unsorted list types. The default suffix is <code>.</code>.</li>
<li><code>void QTextListFormat::setStyle(Style style)</code>: Sets the list format’s <code>style</code>.</li>
<li><code>Style QTextListFormat::style() const</code>: Returns the list format’s <code>style</code>.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之事件过滤器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之事件过滤器/" itemprop="url">Qt之事件过滤器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T09:52:53+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>Qt</code>创建了<code>QEvent</code>事件对象之后，会调用<code>QObject</code>的<code>event</code>函数做事件的分发。有时你可能需要在调用<code>event</code>函数之前做一些另外的操作，比如对话框上某些组件可能并不需要响应回车按下的事件，此时你就需要重新定义组件的<code>event</code>函数。如果组件很多，就需要重写很多次<code>event</code>函数，这显然没有效率。为此，你可以使用一个事件过滤器，来判断是否需要调用<code>event</code>函数。<br>&emsp;&emsp;<code>QOjbect</code>有一个<code>eventFilter</code>函数用于建立事件过滤器：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">virtual</span> <span class="keyword">bool</span> QObject::eventFilter ( QObject *watched, QEvent *event );</span><br></pre></td></tr></table></figure>
<p>如果<code>watched</code>对象安装了事件过滤器，这个函数会被调用并进行事件过滤，然后才轮到组件进行事件处理。在重写这个函数时，如果需要过滤掉某个事件，例如停止对这个事件的响应，需要返回<code>true</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> MainWindow::eventFilter ( QObject *obj, QEvent *event ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( obj == textEdit ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( event-&gt;type() == QEvent::KeyPress ) &#123;</span><br><span class="line">            QKeyEvent *keyEvent = <span class="keyword">static_cast</span>&lt;QKeyEvent *&gt; ( event );</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">"Ate key press"</span> &lt;&lt; keyEvent-&gt;key();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* pass the event on to the parent class */</span></span><br><span class="line">        <span class="keyword">return</span> QMainWindow::eventFilter ( obj, event );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子中为<code>MainWindow</code>建立了一个事件过滤器。为了过滤某个组件上的事件，首先需要判断这个对象是哪个组件，然后判断这个事件的类型。例如，我不想让<code>textEdit</code>组件处理键盘事件，于是就首先找到这个组件，如果这个事件是键盘事件，则直接返回<code>true</code>，也就是过滤掉了这个事件，其他事件还是要继续处理，所以返回<code>false</code>。对于其他组件，我们并不保证是不是还有过滤器，于是最保险的办法是调用父类的函数。<br>&emsp;&emsp;在创建了过滤器之后，下面要做的是安装这个过滤器。安装过滤器需要调用<code>installEventFilter</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> QObject::installEventFilter ( QObject *filterObj );</span><br></pre></td></tr></table></figure>
<p>这个函数是<code>QObject</code>的一个函数，因此可以安装到任何<code>QObject</code>的子类，并不仅仅是<code>UI</code>组件。这个函数接收一个<code>QObject</code>对象，调用了这个函数安装事件过滤器的组件会调用<code>filterObj</code>定义的<code>eventFilter</code>函数。例如<code>textField.installEventFilter(obj)</code>，如果有事件发送到<code>textField</code>组件时，会先调用<code>obj-&gt;eventFilter</code>函数，然后才会调用<code>textField.event</code>。<br>&emsp;&emsp;当然，你也可以把事件过滤器安装到<code>QApplication</code>上面，这样就可以过滤所有的事件，已获得更大的控制权。不过，这样做的后果就是会降低事件分发的效率。如果一个组件安装了多个过滤器，则最后一个安装的会最先调用，类似于堆栈的行为。注意，如果你在事件过滤器中<code>delete</code>某个接收组件，务必将返回值设为<code>true</code>。否则，<code>Qt</code>还是会将事件分发给这个接收组件，从而导致程序崩溃。<br>&emsp;&emsp;事件过滤器和被安装的组件必须在同一线程，否则过滤器不起作用。另外，如果在<code>install</code>之后，这两个组件到了不同的线程，那么只有等到二者重新回到同一线程的时候过滤器才会有效。<br>&emsp;&emsp;事件的调用最终都会调用<code>QCoreApplication</code>的<code>notify</code>函数，因此最大的控制权实际上是重写<code>QCoreApplication</code>的<code>notify</code>函数。由此可以看出，<code>Qt</code>的事件处理实际上分为五个层次：</p>
<ul>
<li>重定义事件处理函数。</li>
<li>重定义<code>event</code>函数。</li>
<li>为单个组件安装事件过滤器。</li>
<li>为<code>QApplication</code>安装事件过滤器。</li>
<li>重定义<code>QCoreApplication</code>的<code>notify</code>函数。</li>
</ul>
<p>这几个层次的控制权是逐层增大的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QNetworkAddressEntry/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QNetworkAddressEntry/" itemprop="url">Qt之QNetworkAddressEntry</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T09:04:44+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>QNetworkAddressEntry</code>类由网络接口支持，存储了<code>IP</code>地址、子网掩码和广播地址。每个网络接口可以包含零个或多个<code>IP</code>地址，进而可以关联到一个子网掩码<code>和/或</code>一个广播地址(取决于操作系统的支持)。常用接口如下：</p>
<ul>
<li><code>QHostAddress broadcast() const</code>：返回<code>IPv4</code>地址和子网掩码相关联的广播地址。对于<code>IPv6</code>地址来说，返回的总是空，因为广播的概念已被抛弃，多播的概念开始兴起。</li>
<li><code>QHostAddress ip() const</code>：返回一个网络接口中存在的<code>IPv4</code>或<code>IPv6</code>地址。</li>
<li><code>QHostAddress netmask() const</code>：返回与<code>IP</code>地址相关联的子网掩码。子网掩码是一个<code>IP</code>地址的形式表示，例如<code>255.255.0.0</code>。对于<code>IPv6</code>地址，前缀长度被转换成一个地址，其中设置为<code>1</code>的位数等于前缀长度。前缀长度为<code>64</code>位(最常见的值)，子网掩码将被表示为一个地址为<code>FFFF:FFFF:FFFF:FFFF::</code>的<code>QHostAddress</code>。</li>
<li><code>int prefixLength() const</code>：返回此<code>IP</code>地址的前缀长度。前缀长度和子网掩码中设置为<code>1</code>的位数相匹配。<code>IPv4</code>地址的值在<code>0</code>至<code>32</code>之间，<code>IPv6</code>地址的值在<code>0</code>至<code>128</code>之间。如果前缀长度不能确定，则返回<code>0</code>(即<code>netmask</code>返回一个空的<code>QHostAddress</code>)。例如<code>255.255.240.0</code>转换成二进制为<code>11111111_11111111_11110000_00000000</code>，那么前缀长度就是<code>8 * 2 + 4 = 20</code>(<code>1</code>的个数)。<code>ffff:ffff:ffff:ffff::</code>转换成二进制为<code>1111111111111111_1111111111111111_1111111111111111_1111111111111111</code>，那么前缀长度就是<code>16 * 4 = 64</code>(<code>1</code>的个数)。</li>
</ul>
<p>&emsp;&emsp;<code>QNetworkInterface</code>类中提供了一个便利的静态函数<code>allInterfaces</code>，用于返回所有的网络接口：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">QList&lt;QNetworkInterface&gt; <span class="built_in">list</span> = QNetworkInterface::allInterfaces();</span><br><span class="line">​</span><br><span class="line">foreach ( QNetworkInterface netInterface, <span class="built_in">list</span> ) &#123;</span><br><span class="line">    QList&lt;QNetworkAddressEntry&gt; entryList = netInterface.addressEntries();</span><br><span class="line">​</span><br><span class="line">    foreach ( QNetworkAddressEntry entry, entryList ) &#123; <span class="comment">/* 遍历每一个IP地址 */</span></span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"IP Address:"</span> &lt;&lt; entry.ip().toString(); <span class="comment">/* IP地址 */</span></span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"Netmask:"</span> &lt;&lt; entry.netmask().toString(); <span class="comment">/* 子网掩码 */</span></span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"Broadcast:"</span> &lt;&lt; entry.broadcast().toString(); <span class="comment">/* 广播地址 */</span></span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"Prefix Length:"</span> &lt;&lt; entry.prefixLength(); <span class="comment">/* 前缀长度 */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过遍历每一个网络接口<code>QNetworkInterface</code>，根据其<code>addressEntries</code>函数，可以很容易地获取到所有的<code>QNetworkAddressEntry</code>，然后通过<code>ip</code>、<code>netmask</code>、<code>broadcast</code>函数获取对应的<code>IP</code>地址、子网掩码以及广播地址。执行结果：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">IP Address: <span class="string">"fe80::550c:ab19:fb48:1c9%15"</span></span><br><span class="line">Netmask: <span class="string">"ffff:ffff:ffff:ffff::"</span></span><br><span class="line">Broadcast: <span class="string">""</span></span><br><span class="line">Prefix Length: <span class="number">64</span></span><br><span class="line">​</span><br><span class="line">IP Address: <span class="string">"169.254.1.201"</span></span><br><span class="line">Netmask: <span class="string">""</span></span><br><span class="line">Broadcast: <span class="string">""</span></span><br><span class="line">Prefix Length: <span class="number">-1</span></span><br><span class="line">​</span><br><span class="line">IP Address: <span class="string">"fe80::d086:8566:6065:8954%11"</span></span><br><span class="line">Netmask: <span class="string">"ffff:ffff:ffff:ffff::"</span></span><br><span class="line">Broadcast: <span class="string">""</span></span><br><span class="line">Prefix Length: <span class="number">64</span></span><br><span class="line">​</span><br><span class="line">IP Address: <span class="string">"172.18.4.165"</span></span><br><span class="line">Netmask: <span class="string">"255.255.240.0"</span></span><br><span class="line">Broadcast: <span class="string">"172.18.15.255"</span></span><br><span class="line">Prefix Length: <span class="number">20</span></span><br><span class="line">​</span><br><span class="line">IP Address: <span class="string">"::1"</span></span><br><span class="line">Netmask: <span class="string">"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"</span></span><br><span class="line">Broadcast: <span class="string">""</span></span><br><span class="line">Prefix Length: <span class="number">128</span></span><br><span class="line">​</span><br><span class="line">IP Address: <span class="string">"127.0.0.1"</span></span><br><span class="line">Netmask: <span class="string">""</span></span><br><span class="line">Broadcast: <span class="string">""</span></span><br><span class="line">Prefix Length: <span class="number">-1</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/03/Qt语法详解/Qt之QVariant/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Qt语法详解/Qt之QVariant/" itemprop="url">Qt之QVariant</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-03T08:16:15+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;<code>QVariant</code>类是一个最为普遍的<code>Qt</code>数据类型的联合。因为<code>C++</code>禁止没有构造函数和析构函数的联合体，许多继承的<code>Qt</code>类不能够在联合体当中使用(联合体当中的变量共用一个存储区)。没有了联合变量，我们在物体属性以及数据库的工作等方面受到很多的困扰。一个<code>QVariant</code>对象在一个时间内只保留一种类型的值。我们可以使用<code>canConvert</code>来查询是否能够转换当前的类型。转换类型一般以<code>toT</code>命名。<br>&emsp;&emsp;摘录了一个<code>example</code>来说明<code>QVariant</code>的使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QDataStream <span class="title">out</span> <span class="params">( ... )</span></span>;</span><br><span class="line"><span class="function">QVariant <span class="title">v</span> <span class="params">( <span class="number">123</span> )</span></span>;                    <span class="comment">/* The variant now contains an int */</span></span><br><span class="line"><span class="keyword">int</span> x = v.toInt();                     <span class="comment">/* x = 123 */</span></span><br><span class="line">out &lt;&lt; v;                              <span class="comment">/* Writes a type tag and an int to out */</span></span><br><span class="line">v = QVariant ( <span class="string">"hello"</span> );              <span class="comment">/* The variant now contains a QByteArray */</span></span><br><span class="line">v = QVariant ( tr ( <span class="string">"hello"</span> ) );       <span class="comment">/* The variant now contains a QString */</span></span><br><span class="line"><span class="keyword">int</span> y = v.toInt();                     <span class="comment">/* y = 0 since v cannot be converted to an int */</span></span><br><span class="line">QString s = v.toString();              <span class="comment">/* s = tr("hello") */</span></span><br><span class="line">out &lt;&lt; v;                              <span class="comment">/* Writes a type tag and a QString to out */</span></span><br><span class="line">...</span><br><span class="line"><span class="function">QDataStream <span class="title">in</span> <span class="params">( ... )</span></span>;                <span class="comment">/* opening the previously written stream */</span></span><br><span class="line">in &gt;&gt; v;                               <span class="comment">/* Reads an Int variant */</span></span><br><span class="line"><span class="keyword">int</span> z = v.toInt();                     <span class="comment">/* z = 123 */</span></span><br><span class="line">qDebug ( <span class="string">"Type is %s"</span>, v.typeName() ); <span class="comment">/* prints "Type is int" */</span></span><br><span class="line">v = v.toInt() + <span class="number">100</span>;                   <span class="comment">/* The variant now hold the value 223 */</span></span><br><span class="line">v = QVariant ( QStringList() );</span><br></pre></td></tr></table></figure>
<p>你甚至可以存储<code>QList&lt;QVariant&gt;</code>和<code>QMap&lt;QString, QVariant&gt;</code>，所以可以构造任意复杂的数据类型，这是非常强大而且又有用的。<code>QVariant</code>也支持<code>null</code>值，可以定义一个没有任何值的类型，然而也要注意<code>QVariant</code>类型只能在它们有值的时候被强制转换：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QVariant x, y ( QString() ), z ( QString ( <span class="string">""</span> ) );</span><br><span class="line">x.convert ( QVariant::Int );</span><br><span class="line"><span class="comment">// x.isNull() == true</span></span><br><span class="line"><span class="comment">// y.isNull() == true, z.isNull() == false</span></span><br></pre></td></tr></table></figure>
<p>因为<code>QVariant</code>是<code>QtCore</code>库的一部分，它不能够提供定义在<code>QtGui</code>当中的类型的转换，例如<code>QColor</code>、<code>QImage</code>和<code>QPixmap</code>等。换句话说，没有<code>toColor</code>这样的函数。但是你可以使用<code>QVariant::value</code>或者<code>qVariantValue</code>这两个模板函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QVariant variant;</span><br><span class="line">QColor color = variant.value&lt;QColor&gt;();</span><br></pre></td></tr></table></figure>
<p>反向转换(例如把<code>QColor</code>转成<code>QVariant</code>)是自动完成的，这也包含了<code>GUI</code>相关的那些数据类型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QColor color = palette().background().color();</span><br><span class="line">QVariant variant = color;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2019/01/02/Qt语法详解/Qt之正则表达式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/02/Qt语法详解/Qt之正则表达式/" itemprop="url">Qt之正则表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-02T21:39:17+08:00">
                2019-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt语法详解/" itemprop="url" rel="index">
                    <span itemprop="name">Qt语法详解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"widget.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ui_widget.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line">​</span><br><span class="line">Widget::Widget ( QWidget *parent ) : QWidget ( parent ), ui ( <span class="keyword">new</span> Ui::Widget ) &#123;</span><br><span class="line">    ui-&gt;setupUi ( <span class="keyword">this</span> );</span><br><span class="line">    <span class="function">QRegExp <span class="title">rx</span> <span class="params">( <span class="string">"^\\d\\d?$"</span> )</span></span>; <span class="comment">/* 两个字符都必须为数字，第二个字符可以没有 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"a1"</span> ); <span class="comment">/* 结果为“-1”，不是数字开头 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"5"</span> ); <span class="comment">/* 结果为0 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"5b"</span> ); <span class="comment">/* 结果为“-1”，第二个字符不是数字 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"12"</span> ); <span class="comment">/* 结果为0 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"123"</span> ); <span class="comment">/* 结果为“-1”，超过了两个字符 */</span></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"*******************"</span>; <span class="comment">/* 输出分割符，为了显示清晰 */</span></span><br><span class="line">    rx.setPattern ( <span class="string">"\\b(mail|letter)\\b"</span> ); <span class="comment">/* 匹配“mail”或者“letter”单词 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"emailletter"</span> ); <span class="comment">/* 结果为“-1”，“mail”不是一个单词 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"my mail"</span> ); <span class="comment">/* 返回3 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx.indexIn ( <span class="string">"my email letter"</span> ); <span class="comment">/* 返回9 */</span></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"*******************"</span>;</span><br><span class="line">    rx.setPattern ( <span class="string">"M(?!ail)"</span> ); <span class="comment">/* 匹配字符“M”，其后面不能跟有“ail”字符 */</span></span><br><span class="line">    QString str1 = <span class="string">"this is M"</span>;</span><br><span class="line">    str1.replace ( rx, <span class="string">"Mail"</span> ); <span class="comment">/* 使用“Mail”替换匹配到的字符 */</span></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"str1: "</span> &lt;&lt; str1; <span class="comment">/* 结果为“this is Mail” */</span></span><br><span class="line">    QString str2 = <span class="string">"my M,your Ms,his Mail"</span>;</span><br><span class="line">    str2.replace ( rx, <span class="string">"Mail"</span> );</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"str2: "</span> &lt;&lt; str2; <span class="comment">/* 结果为“my Mail,your Mails,his Mail” */</span></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"*******************"</span>;</span><br><span class="line">    <span class="comment">/* 一个字符串如果一行写不完，换行后两行都需要加双引号 */</span></span><br><span class="line">    QString str3 = <span class="string">"One Eric another Eirik, and an Ericsson. "</span></span><br><span class="line">                   <span class="string">"How many Eiriks, Eric?"</span>;</span><br><span class="line">    <span class="function">QRegExp <span class="title">rx2</span> <span class="params">( <span class="string">"\\bEi?ri[ck]\\b"</span> )</span></span>; <span class="comment">/* 匹配“Eric”或者“Eirik” */</span></span><br><span class="line">    <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">while</span> ( pos &gt;= <span class="number">0</span> ) &#123;</span><br><span class="line">        pos = rx2.indexIn ( str3, pos );</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> ( pos &gt;= <span class="number">0</span> ) &#123;</span><br><span class="line">            ++pos; <span class="comment">/* 从匹配的字符的下一个字符开始匹配 */</span></span><br><span class="line">            ++count; <span class="comment">/* 匹配到的数目加1 */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"count: "</span> &lt;&lt; count; <span class="comment">/* 结果为3 */</span></span><br><span class="line">    <span class="function">QRegExp <span class="title">rx3</span> <span class="params">( <span class="string">"*.txt"</span> )</span></span>;</span><br><span class="line">    rx3.setPatternSyntax ( QRegExp::Wildcard );</span><br><span class="line">    qDebug() &lt;&lt; rx3.exactMatch ( <span class="string">"README.txt"</span> ); <span class="comment">/* 结果为true */</span></span><br><span class="line">    qDebug() &lt;&lt; rx3.exactMatch ( <span class="string">"welcome.txt.bak"</span> ); <span class="comment">/* 结果为false */</span></span><br><span class="line">    <span class="function">QRegExp <span class="title">rx4</span> <span class="params">( <span class="string">"(\\d+)"</span> )</span></span>;</span><br><span class="line">    QString str4 = <span class="string">"Offsets: 12 14 99 231 7"</span>;</span><br><span class="line">    QStringList <span class="built_in">list</span>;</span><br><span class="line">    <span class="keyword">int</span> pos2 = <span class="number">0</span>;</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">while</span> ( ( pos2 = rx4.indexIn ( str4, pos2 ) ) != <span class="number">-1</span> ) &#123;</span><br><span class="line">        <span class="built_in">list</span> &lt;&lt; rx4.cap ( 1 ); /* 第一个捕获到的文本 */</span><br><span class="line">        pos2 += rx4.matchedLength(); /* 上一个匹配的字符串的长度 */</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    qDebug() &lt;&lt; <span class="built_in">list</span>; /* 结果“12,14,99,231,7” */</span><br><span class="line">    QRegExp rxlen ( "(\\d+)(?:\\s*)(cm|inch)" );</span><br><span class="line">    <span class="keyword">int</span> pos3 = rxlen.indexIn ( "Length: 189cm" );</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> ( pos3 &gt; <span class="number">-1</span> ) &#123;</span><br><span class="line">        QString value = rxlen.cap ( <span class="number">1</span> ); <span class="comment">/* 结果为189 */</span></span><br><span class="line">        QString unit = rxlen.cap ( <span class="number">2</span> ); <span class="comment">/* 结果为cm */</span></span><br><span class="line">        QString <span class="built_in">string</span> = rxlen.cap ( <span class="number">0</span> ); <span class="comment">/* 结果为189cm */</span></span><br><span class="line">        qDebug() &lt;&lt; value &lt;&lt; unit &lt;&lt; <span class="built_in">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    <span class="function">QRegExp <span class="title">rx5</span> <span class="params">( <span class="string">"\\b(\\w+)\\W+\\1\\b"</span> )</span></span>;</span><br><span class="line">    rx5.setCaseSensitivity ( Qt::CaseInsensitive ); <span class="comment">/* 设置不区分大小写 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx5.indexIn ( <span class="string">"Hello--hello"</span> ); <span class="comment">/* 结果为0 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx5.cap ( <span class="number">1</span> ); <span class="comment">/* 结果为Hello */</span></span><br><span class="line">    <span class="function">QRegExp <span class="title">rx6</span> <span class="params">( <span class="string">"\\b你好\\b"</span> )</span></span>; <span class="comment">/* 匹配中文 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx6.indexIn ( <span class="string">"你好"</span> ); <span class="comment">/* 结果为0 */</span></span><br><span class="line">    qDebug() &lt;&lt; rx6.cap ( <span class="number">0</span> ); <span class="comment">/* 整个字符串完全匹配，使用“cap(0)”捕获，结果为“你好” */</span></span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line">Widget::~Widget() &#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/60/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><span class="page-number current">61</span><a class="page-number" href="/page/62/">62</a><span class="space">&hellip;</span><a class="page-number" href="/page/95/">95</a><a class="extend next" rel="next" href="/page/62/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">943</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
