<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="cvCreateSeq&amp;emsp;&amp;emsp;该函数的功能是创建一个序列： 1CvSeq *cvCreateSeq (int seq_flags, int header_size, int elem_size, CvMemStorage *storage);  seq_flags：它是序列的符号标志。如果序列不会被传递给任何使用特定序列的函数，那么将它设为0，否则从预定义的序列类型中选择一合适的类">
<meta property="og:type" content="article">
<meta property="og:title" content="cvSeq的用法">
<meta property="og:url" content="http://fukangwei.gitee.io/2018/12/30/opencv和图像处理/cvSeq的用法/index.html">
<meta property="og:site_name" content="泥腿子出身">
<meta property="og:description" content="cvCreateSeq&amp;emsp;&amp;emsp;该函数的功能是创建一个序列： 1CvSeq *cvCreateSeq (int seq_flags, int header_size, int elem_size, CvMemStorage *storage);  seq_flags：它是序列的符号标志。如果序列不会被传递给任何使用特定序列的函数，那么将它设为0，否则从预定义的序列类型中选择一合适的类">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-01-18T05:42:44.394Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cvSeq的用法">
<meta name="twitter:description" content="cvCreateSeq&amp;emsp;&amp;emsp;该函数的功能是创建一个序列： 1CvSeq *cvCreateSeq (int seq_flags, int header_size, int elem_size, CvMemStorage *storage);  seq_flags：它是序列的符号标志。如果序列不会被传递给任何使用特定序列的函数，那么将它设为0，否则从预定义的序列类型中选择一合适的类">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '561O3H1PZB',
      apiKey: '7631d3cf19ac49bd39ada7163ec937a7',
      indexName: 'fuxinzi',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://fukangwei.gitee.io/2018/12/30/opencv和图像处理/cvSeq的用法/">





  <title>cvSeq的用法 | 泥腿子出身</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泥腿子出身</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fukangwei.gitee.io/2018/12/30/opencv和图像处理/cvSeq的用法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="付康为">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泥腿子出身">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">cvSeq的用法</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-30T18:13:46+08:00">
                2018-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/opencv和图像处理/" itemprop="url" rel="index">
                    <span itemprop="name">opencv和图像处理</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="cvCreateSeq"><a href="#cvCreateSeq" class="headerlink" title="cvCreateSeq"></a>cvCreateSeq</h3><p>&emsp;&emsp;该函数的功能是创建一个序列：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CvSeq *<span class="title">cvCreateSeq</span> <span class="params">(<span class="keyword">int</span> seq_flags, <span class="keyword">int</span> header_size, <span class="keyword">int</span> elem_size, CvMemStorage *storage)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>seq_flags</code>：它是序列的符号标志。如果序列不会被传递给任何使用特定序列的函数，那么将它设为<code>0</code>，否则从预定义的序列类型中选择一合适的类型。</li>
<li><code>header_size</code>：它是序列头部的大小，其值必须大于或等于<code>sizeof(CvSeq)</code>。如果制定了类型或它的扩展名，则此类型必须适合基类的头部大小。</li>
<li><code>elem_size</code>：它是元素的大小，以字节计算。这个大小必须与序列类型(由<code>seq_flags</code>指定)相一致。例如对于一个点的序列，元素类型<code>CV_SEQ_ELTYPE_POINT</code>应当被指定，参数<code>elem_size</code>必须等同于<code>sizeof(CvPoint)</code>。</li>
<li><code>storage</code>：它指向前面定义的内存存储器。</li>
</ul>
<h3 id="cvCloneSeq"><a href="#cvCloneSeq" class="headerlink" title="cvCloneSeq"></a>cvCloneSeq</h3><p>&emsp;&emsp;该函数的作用是创建序列的一份拷贝：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CvSeq *<span class="title">cvCloneSeq</span> <span class="params">( <span class="keyword">const</span> CvSeq *seq, CvMemStorage *storage = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqInvert"><a href="#cvSeqInvert" class="headerlink" title="cvSeqInvert"></a>cvSeqInvert</h3><p>&emsp;&emsp;该函数的作用是将序列中的元素进行逆序操作：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqInvert</span> <span class="params">( CvSeq *seq )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqSort"><a href="#cvSeqSort" class="headerlink" title="cvSeqSort"></a>cvSeqSort</h3><p>&emsp;&emsp;该函数的功能是使用特定的比较函数对序列中的元素进行排序：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqSort</span> <span class="params">( CvSeq *seq, CvCmpFunc func, <span class="keyword">void</span> *userdata = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqSearch"><a href="#cvSeqSearch" class="headerlink" title="cvSeqSearch"></a>cvSeqSearch</h3><p>&emsp;&emsp;该函数的功能是查询序列中的元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">cvSeqSearch</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    CvSeq *seq, <span class="keyword">const</span> <span class="keyword">void</span> *elem, CvCmpFunc func,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> is_sorted, <span class="keyword">int</span> *elem_idx, <span class="keyword">void</span> *userdata = <span class="literal">NULL</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvClearSeq"><a href="#cvClearSeq" class="headerlink" title="cvClearSeq"></a>cvClearSeq</h3><p>&emsp;&emsp;其函数的功能是清空序列：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvClearSeq</span> <span class="params">( CvSeq *seq )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqPush"><a href="#cvSeqPush" class="headerlink" title="cvSeqPush"></a>cvSeqPush</h3><p>&emsp;&emsp;该函数的功能是添加元素到序列的尾部：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">cvSeqPush</span> <span class="params">( CvSeq *seq, <span class="keyword">void</span> *element = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqPop"><a href="#cvSeqPop" class="headerlink" title="cvSeqPop"></a>cvSeqPop</h3><p>&emsp;&emsp;该函数的作用是删除序列尾部元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqPop</span> <span class="params">( CvSeq *seq, <span class="keyword">void</span> *element = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqPushFront"><a href="#cvSeqPushFront" class="headerlink" title="cvSeqPushFront"></a>cvSeqPushFront</h3><p>&emsp;&emsp;该函数的作用是在序列头部添加元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">cvSeqPushFront</span> <span class="params">( CvSeq *seq, <span class="keyword">void</span> *element = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqPopFront"><a href="#cvSeqPopFront" class="headerlink" title="cvSeqPopFront"></a>cvSeqPopFront</h3><p>&emsp;&emsp;其函数的作用是删除在序列的头部的元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqPopFront</span> <span class="params">( CvSeq *seq, <span class="keyword">void</span> *element = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqPushMulti"><a href="#cvSeqPushMulti" class="headerlink" title="cvSeqPushMulti"></a>cvSeqPushMulti</h3><p>&emsp;&emsp;其函数的作用是添加多个元素到序列尾部或头部：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqPushMulti</span> <span class="params">( CvSeq *seq, <span class="keyword">void</span> *elements, <span class="keyword">int</span> count, <span class="keyword">int</span> in_front = <span class="number">0</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqPopMulti"><a href="#cvSeqPopMulti" class="headerlink" title="cvSeqPopMulti"></a>cvSeqPopMulti</h3><p>&emsp;&emsp;其函数作用是删除多个序列头部或尾部元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqPopMulti</span> <span class="params">( CvSeq *seq, <span class="keyword">void</span> *elements, <span class="keyword">int</span> count, <span class="keyword">int</span> in_front = <span class="number">0</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqInsert"><a href="#cvSeqInsert" class="headerlink" title="cvSeqInsert"></a>cvSeqInsert</h3><p>&emsp;&emsp;该函数的作用是在序列中的指定位置添加元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">cvSeqInsert</span> <span class="params">( CvSeq *seq, <span class="keyword">int</span> before_index, <span class="keyword">void</span> *element = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqRemove"><a href="#cvSeqRemove" class="headerlink" title="cvSeqRemove"></a>cvSeqRemove</h3><p>&emsp;&emsp;其函数的作用是删除序列中的指定位置的元素：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSeqRemove</span> <span class="params">( CvSeq *seq, <span class="keyword">int</span> index )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvGetSeqElem"><a href="#cvGetSeqElem" class="headerlink" title="cvGetSeqElem"></a>cvGetSeqElem</h3><p>&emsp;&emsp;其函数的作用是返回索引所指定的元素指针：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">cvGetSeqElem</span> <span class="params">( <span class="keyword">const</span> CvSeq *seq, <span class="keyword">int</span> index )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvSeqElemIdx"><a href="#cvSeqElemIdx" class="headerlink" title="cvSeqElemIdx"></a>cvSeqElemIdx</h3><p>&emsp;&emsp;其函数的作用是返回序列中元素的索引：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cvSeqElemIdx</span> <span class="params">( <span class="keyword">const</span> CvSeq *seq, <span class="keyword">const</span> <span class="keyword">void</span> *element, CvSeqBlock **block = <span class="literal">NULL</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvStartAppendToSeq"><a href="#cvStartAppendToSeq" class="headerlink" title="cvStartAppendToSeq"></a>cvStartAppendToSeq</h3><p>&emsp;&emsp;其函数的作用是将数据写入序列中，并初始化该过程：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvStartAppendToSeq</span> <span class="params">( CvSeq *seq, CvSeqWriter *writer )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvStartWriteSeq"><a href="#cvStartWriteSeq" class="headerlink" title="cvStartWriteSeq"></a>cvStartWriteSeq</h3><p>&emsp;&emsp;其函数的作用是创建新序列，并初始化写入部分：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvStartWriteSeq</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> seq_flags, <span class="keyword">int</span> header_size, <span class="keyword">int</span> elem_size,</span></span></span><br><span class="line"><span class="function"><span class="params">    CvMemStorage *storage, CvSeqWriter *writer)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvEndWriteSeq"><a href="#cvEndWriteSeq" class="headerlink" title="cvEndWriteSeq"></a>cvEndWriteSeq</h3><p>&emsp;&emsp;其函数的作用是完成写入操作：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CvSeq *<span class="title">cvEndWriteSeq</span> <span class="params">( CvSeqWriter *writer )</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="cvStartReadSeq"><a href="#cvStartReadSeq" class="headerlink" title="cvStartReadSeq"></a>cvStartReadSeq</h3><p>&emsp;&emsp;其函数的作用是初始化序列中的读取过程：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvStartReadSeq</span> <span class="params">( <span class="keyword">const</span> CvSeq *seq, CvSeqReader *reader, <span class="keyword">int</span> reverse = <span class="number">0</span> )</span></span>;</span><br></pre></td></tr></table></figure>
<hr>
<p>&emsp;&emsp;一直困惑于<code>CvSeq</code>到底是个什么样的东西，因为曾经拿到别人写的一个函数库，其返回值是一个<code>CvSeq</code>指针。我的任务是遍历所有的<code>Sequence</code>，然后删除其中不符合要求的<code>Sequence</code>。由于没有文档，我当时并不知道需要遍历的是<code>Sequence</code>还是<code>Sequence</code>中的<code>Element</code>，于是写下了类似如下的代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CvSeq *pCurSeq = pInputSeq;</span><br><span class="line"><span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> ( pCurSeq = pCurSeq-&gt;h_next ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( process ( pCurSeq ) ) &#123;</span><br><span class="line">        pCurSeq = pCurSeq-&gt;h_prev; <span class="comment">/* 这里为了简单，不考虑是否为列表头 */</span></span><br><span class="line">        cvSeqRemove ( pInputSeq, index );</span><br><span class="line">        --index;</span><br><span class="line">    &#125;</span><br><span class="line">​</span><br><span class="line">    ++index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事实证明这段代码是错误的，而且返回的错误信息是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; OpenCV ERROR: One of arguments<span class="string">' values is out of range (Invalid index)</span></span><br><span class="line"><span class="string">&gt; in function cvSeqRemove, cxdatastructs.cpp(1587)</span></span><br></pre></td></tr></table></figure>
<p>为什么会有这样的错误呢？看一下<code>CvSeq</code>的源代码就清楚了。下面是<code>OpenCV 1.0</code>版本有关<code>CvSeq</code>的定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CV_TREE_NODE_FIELDS(node_type)                       \</span></span><br><span class="line">    <span class="keyword">int</span>    flags;             <span class="comment">/* micsellaneous flags */</span>      \</span><br><span class="line">    <span class="keyword">int</span>    header_size;       <span class="comment">/* size of sequence header */</span>  \</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_type</span>* <span class="title">h_prev</span>;</span> <span class="comment">/* previous sequence */</span>        \</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_type</span>* <span class="title">h_next</span>;</span> <span class="comment">/* next sequence */</span>            \</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_type</span>* <span class="title">v_prev</span>;</span> <span class="comment">/* 2nd previous sequence */</span>    \</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_type</span>* <span class="title">v_next</span>  /* 2<span class="title">nd</span> <span class="title">next</span> <span class="title">sequence</span> */</span></span><br><span class="line"><span class="class">​</span></span><br><span class="line"><span class="class">/*</span></span><br><span class="line"><span class="class">   <span class="title">Read</span>/<span class="title">Write</span> <span class="title">sequence</span>.</span></span><br><span class="line"><span class="class">   <span class="title">Elements</span> <span class="title">can</span> <span class="title">be</span> <span class="title">dynamically</span> <span class="title">inserted</span> <span class="title">to</span> <span class="title">or</span> <span class="title">deleted</span> <span class="title">from</span> <span class="title">the</span> <span class="title">sequence</span>.</span></span><br><span class="line"><span class="class">*/</span></span><br><span class="line"><span class="class">#<span class="title">define</span> <span class="title">CV_SEQUENCE_FIELDS</span>()                                   \</span></span><br><span class="line"><span class="class">    <span class="title">CV_TREE_NODE_FIELDS</span>(<span class="title">CvSeq</span>);</span>                                \</span><br><span class="line">    <span class="keyword">int</span>   total;       <span class="comment">/* total number of elements */</span>          \</span><br><span class="line">    <span class="keyword">int</span>   elem_size;   <span class="comment">/* size of sequence element in bytes */</span> \</span><br><span class="line">    <span class="keyword">char</span>* block_max;   <span class="comment">/* maximal bound of the last block */</span>   \</span><br><span class="line">    <span class="keyword">char</span>* ptr;         <span class="comment">/* current write pointer */</span>             \</span><br><span class="line">    <span class="keyword">int</span>   delta_elems; <span class="comment">/* how many elements allocated when the seq grows */</span>  \</span><br><span class="line">    CvMemStorage* storage;   <span class="comment">/* where the seq is stored */</span>                   \</span><br><span class="line">    CvSeqBlock* free_blocks; <span class="comment">/* free blocks list */</span>                          \</span><br><span class="line">    CvSeqBlock* first; <span class="comment">/* pointer to the first sequence block */</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CvSeq</span> &#123;</span></span><br><span class="line">    CV_SEQUENCE_FIELDS()</span><br><span class="line">&#125; CvSeq;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;原来<code>CvSeq</code>本身就是一个可增长的序列，<code>CvSeq::total</code>是指序列内部有效元素的个数；而<code>h_next</code>和<code>h_prev</code>并不是指向<code>CvSeq</code>内部元素的指针，它们是指向其它<code>CvSeq</code>的。再回到最初的代码，可以看到该代码具有逻辑上的错误，首先<code>while</code>语句遍历的是所有的<code>CvSeq</code>，使用<code>process</code>处理每一个<code>CvSeq</code>，而遇到需要删除的<code>CvSeq</code>时，又使用<code>cvSeqRemove</code>删除当前<code>CvSeq</code>中的第<code>index</code>个元素。实际上此时<code>index</code>很可能超出了当前<code>CvSeq</code>中总元素的个数，所以出现了超出边界的错误。正确的做法是直接删除该<code>CvSeq</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">CvSeq *pCurSeq = pInputSeq;</span><br><span class="line">CvSeq *pOldSeq = <span class="literal">NULL</span>;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">while</span> ( pCurSeq ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( process ( pCurSeq ) ) &#123;</span><br><span class="line">        pOldSeq = pCurSeq;</span><br><span class="line">​</span><br><span class="line">        <span class="keyword">if</span> ( pOldSeq-&gt;h_prev ) &#123;</span><br><span class="line">            pCurSeq = pOldSeq-&gt;h_prev;</span><br><span class="line">            pCurSeq-&gt;h_next = pOldSeq-&gt;h_next;</span><br><span class="line">            pOldSeq-&gt;h_next-&gt;h_prev = pCurSeq;</span><br><span class="line">            pCurSeq = pCurSeq-&gt;h_next;</span><br><span class="line">            cvClearSeq ( pOldSeq );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pCurSeq = pOldSeq-&gt;h_next;</span><br><span class="line">            pCurSeq-&gt;h_prev = <span class="literal">NULL</span>;</span><br><span class="line">            cvClearSeq ( pOldSeq );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pCurSeq = pCurSeq-&gt;h_next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;后来在<code>Google Book</code>里查了一下，发现<code>《Learning OpenCV: Computer Vision with the OpenCV Library》</code>中有这么一段话：The sequence structure itself has some important elements that you should be aware of. The first, and one you will use often, is total. This is the total number of points or objects in the sequence. The next four important elements are pointers to other sequence: <code>h_prev</code>, <code>h_next</code>, <code>v_prev</code> and <code>v_next</code>. These four pointers are part of what are called <code>CV_TREE_NODE_FIELDS</code>; they are used not to indicate elements inside of the sequence but rather to connect different sequences to one another. Other objects in the OpenCV universe also contain these tree node fields。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/30/opencv和图像处理/动态内存存储/" rel="next" title="动态内存存储">
                <i class="fa fa-chevron-left"></i> 动态内存存储
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/30/opencv和图像处理/随机数生成器RNG/" rel="prev" title="随机数生成器RNG">
                随机数生成器RNG <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">付康为</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">949</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#cvCreateSeq"><span class="nav-number">1.</span> <span class="nav-text">cvCreateSeq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvCloneSeq"><span class="nav-number">2.</span> <span class="nav-text">cvCloneSeq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqInvert"><span class="nav-number">3.</span> <span class="nav-text">cvSeqInvert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqSort"><span class="nav-number">4.</span> <span class="nav-text">cvSeqSort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqSearch"><span class="nav-number">5.</span> <span class="nav-text">cvSeqSearch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvClearSeq"><span class="nav-number">6.</span> <span class="nav-text">cvClearSeq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqPush"><span class="nav-number">7.</span> <span class="nav-text">cvSeqPush</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqPop"><span class="nav-number">8.</span> <span class="nav-text">cvSeqPop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqPushFront"><span class="nav-number">9.</span> <span class="nav-text">cvSeqPushFront</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqPopFront"><span class="nav-number">10.</span> <span class="nav-text">cvSeqPopFront</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqPushMulti"><span class="nav-number">11.</span> <span class="nav-text">cvSeqPushMulti</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqPopMulti"><span class="nav-number">12.</span> <span class="nav-text">cvSeqPopMulti</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqInsert"><span class="nav-number">13.</span> <span class="nav-text">cvSeqInsert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqRemove"><span class="nav-number">14.</span> <span class="nav-text">cvSeqRemove</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvGetSeqElem"><span class="nav-number">15.</span> <span class="nav-text">cvGetSeqElem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvSeqElemIdx"><span class="nav-number">16.</span> <span class="nav-text">cvSeqElemIdx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvStartAppendToSeq"><span class="nav-number">17.</span> <span class="nav-text">cvStartAppendToSeq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvStartWriteSeq"><span class="nav-number">18.</span> <span class="nav-text">cvStartWriteSeq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvEndWriteSeq"><span class="nav-number">19.</span> <span class="nav-text">cvEndWriteSeq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cvStartReadSeq"><span class="nav-number">20.</span> <span class="nav-text">cvStartReadSeq</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">付康为</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

</body>
</html>
